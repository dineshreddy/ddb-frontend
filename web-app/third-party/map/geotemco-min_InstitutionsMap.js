if(!window.console){window.console={log:function(){},dir:function(){},info:function(){},warn:function(){},debug:function(){}}}var arrayIndex=function(c,b){if(Array.indexOf){return c.indexOf(b)}for(var a=0;a<c.length;a++){if(c[a]==b){return a}}return -1};for(var i=0;i<document.getElementsByTagName("script").length;i++){var script=document.getElementsByTagName("script")[i];var index=script.src.search(/geotemco[^\/]*\.js$/);if(index==-1){index=script.src.indexOf("geotemco-min.js")}if(index!=-1){GeoTemCoMinifier_urlPrefix=script.src.substring(0,index);break}}if(typeof console!="undefined"){if(typeof GeoTemCoMinifier_urlPrefix!="undefined"){console.log("GeoTemCoMinifier_urlPrefix: "+GeoTemCoMinifier_urlPrefix)}else{console.warn("GeoTemCoMinifier_urlPrefix: undefined")}}if(!document.createElement("canvas").getContext){(function(){var v=Math;var w=v.round;var s=v.sin;var E=v.cos;var n=v.abs;var D=v.sqrt;var a=10;var o=a/2;function h(){return this.context_||(this.context_=new q(this))}var u=Array.prototype.slice;function F(m,G,H){var j=u.call(arguments,2);return function(){return m.apply(G,j.concat(u.call(arguments)))}}var k={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",F(this.init_,this,m))}},init_:function(H){if(!H.namespaces.g_vml_){H.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!H.namespaces.g_o_){H.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!H.styleSheets.ex_canvas_){var G=H.createStyleSheet();G.owningElement.id="ex_canvas_";G.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=H.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=h;m.innerHTML="";m.attachEvent("onpropertychange",C);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function C(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}k.init();var e=[];for(var z=0;z<16;z++){for(var y=0;y<16;y++){e[z*16+y]=z.toString(16)+y.toString(16)}}function r(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(H,G){var m=r();for(var j=0;j<3;j++){for(var K=0;K<3;K++){var I=0;for(var J=0;J<3;J++){I+=H[j][J]*G[J][K]}m[j][K]=I}}return m}function x(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var I,H=1;m=String(m);if(m.substring(0,3)=="rgb"){var K=m.indexOf("(",3);var j=m.indexOf(")",K+1);var J=m.substring(K+1,j).split(",");I="#";for(var G=0;G<3;G++){I+=e[Number(J[G])]}if(J.length==4&&m.substr(3,1)=="a"){H=J[3]}}else{I=m}return{color:I,alpha:H}}function t(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function q(m){this.m_=r();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var l=q.prototype;l.clearRect=function(){this.element_.innerHTML=""};l.beginPath=function(){this.currentPath_=[]};l.moveTo=function(m,j){var G=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:G.x,y:G.y});this.currentX_=G.x;this.currentY_=G.y};l.lineTo=function(m,j){var G=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:G.x,y:G.y});this.currentX_=G.x;this.currentY_=G.y};l.bezierCurveTo=function(G,m,M,L,K,I){var j=this.getCoords_(K,I);var J=this.getCoords_(G,m);var H=this.getCoords_(M,L);p(this,J,H,j)};function p(j,H,G,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:H.x,cp1y:H.y,cp2x:G.x,cp2y:G.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}l.quadraticCurveTo=function(K,G,m,j){var J=this.getCoords_(K,G);var I=this.getCoords_(m,j);var L={x:this.currentX_+2/3*(J.x-this.currentX_),y:this.currentY_+2/3*(J.y-this.currentY_)};var H={x:L.x+(I.x-this.currentX_)/3,y:L.y+(I.y-this.currentY_)/3};p(this,L,H,I)};l.arc=function(N,L,M,I,m,G){M*=a;var R=G?"at":"wa";var O=N+E(I)*M-o;var Q=L+s(I)*M-o;var j=N+E(m)*M-o;var P=L+s(m)*M-o;if(O==j&&!G){O+=0.125}var H=this.getCoords_(N,L);var K=this.getCoords_(O,Q);var J=this.getCoords_(j,P);this.currentPath_.push({type:R,x:H.x,y:H.y,radius:M,xStart:K.x,yStart:K.y,xEnd:J.x,yEnd:J.y})};l.rect=function(G,m,j,H){this.moveTo(G,m);this.lineTo(G+j,m);this.lineTo(G+j,m+H);this.lineTo(G,m+H);this.closePath()};l.strokeRect=function(G,m,j,H){var I=this.currentPath_;this.beginPath();this.moveTo(G,m);this.lineTo(G+j,m);this.lineTo(G+j,m+H);this.lineTo(G,m+H);this.closePath();this.stroke();this.currentPath_=I};l.fillRect=function(G,m,j,H){var I=this.currentPath_;this.beginPath();this.moveTo(G,m);this.lineTo(G+j,m);this.lineTo(G+j,m+H);this.lineTo(G,m+H);this.closePath();this.fill();this.currentPath_=I};l.createLinearGradient=function(m,H,j,G){var I=new A("gradient");I.x0_=m;I.y0_=H;I.x1_=j;I.y1_=G;return I};l.createRadialGradient=function(H,J,G,m,I,j){var K=new A("gradientradial");K.x0_=H;K.y0_=J;K.r0_=G;K.x1_=m;K.y1_=I;K.r1_=j;return K};l.drawImage=function(U,G){var N,L,P,ac,S,Q,X,ae;var O=U.runtimeStyle.width;var T=U.runtimeStyle.height;U.runtimeStyle.width="auto";U.runtimeStyle.height="auto";var M=U.width;var aa=U.height;U.runtimeStyle.width=O;U.runtimeStyle.height=T;if(arguments.length==3){N=arguments[1];L=arguments[2];S=Q=0;X=P=M;ae=ac=aa}else{if(arguments.length==5){N=arguments[1];L=arguments[2];P=arguments[3];ac=arguments[4];S=Q=0;X=M;ae=aa}else{if(arguments.length==9){S=arguments[1];Q=arguments[2];X=arguments[3];ae=arguments[4];N=arguments[5];L=arguments[6];P=arguments[7];ac=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ad=this.getCoords_(N,L);var I=X/2;var m=ae/2;var ab=[];var j=10;var K=10;ab.push(" <g_vml_:group",' coordsize="',a*j,",",a*K,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",K,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var J=[];J.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",w(ad.x/a),",","Dy=",w(ad.y/a),"");var Z=ad;var Y=this.getCoords_(N+P,L);var V=this.getCoords_(N,L+ac);var R=this.getCoords_(N+P,L+ac);Z.x=v.max(Z.x,Y.x,V.x,R.x);Z.y=v.max(Z.y,Y.y,V.y,R.y);ab.push("padding:0 ",w(Z.x/a),"px ",w(Z.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",J.join(""),", sizingmethod='clip');")}else{ab.push("top:",w(ad.y/a),"px;left:",w(ad.x/a),"px;")}ab.push(' ">','<g_vml_:image src="',U.src,'"',' style="width:',a*P,"px;"," height:",a*ac,'px;"',' cropleft="',S/M,'"',' croptop="',Q/aa,'"',' cropright="',(M-S-X)/M,'"',' cropbottom="',(aa-Q-ae)/aa,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ab.join(""))};l.stroke=function(ag){var L=[];var M=false;var ar=c(ag?this.fillStyle:this.strokeStyle);var ac=ar.color;var am=ar.alpha*this.globalAlpha;var I=10;var O=10;L.push("<g_vml_:shape",' filled="',!!ag,'"',' style="position:absolute;width:',I,"px;height:",O,'px;"',' coordorigin="0 0" coordsize="',a*I," ",a*O,'"',' stroked="',!ag,'"',' path="');var N=false;var aq={x:null,y:null};var Y={x:null,y:null};for(var al=0;al<this.currentPath_.length;al++){var ak=this.currentPath_[al];var ap;switch(ak.type){case"moveTo":ap=ak;L.push(" m ",w(ak.x),",",w(ak.y));break;case"lineTo":L.push(" l ",w(ak.x),",",w(ak.y));break;case"close":L.push(" x ");ak=null;break;case"bezierCurveTo":L.push(" c ",w(ak.cp1x),",",w(ak.cp1y),",",w(ak.cp2x),",",w(ak.cp2y),",",w(ak.x),",",w(ak.y));break;case"at":case"wa":L.push(" ",ak.type," ",w(ak.x-this.arcScaleX_*ak.radius),",",w(ak.y-this.arcScaleY_*ak.radius)," ",w(ak.x+this.arcScaleX_*ak.radius),",",w(ak.y+this.arcScaleY_*ak.radius)," ",w(ak.xStart),",",w(ak.yStart)," ",w(ak.xEnd),",",w(ak.yEnd));break}if(ak){if(aq.x==null||ak.x<aq.x){aq.x=ak.x}if(Y.x==null||ak.x>Y.x){Y.x=ak.x}if(aq.y==null||ak.y<aq.y){aq.y=ak.y}if(Y.y==null||ak.y>Y.y){Y.y=ak.y}}}L.push(' ">');if(!ag){var X=this.lineScale_*this.lineWidth;if(X<1){am*=X}L.push("<g_vml_:stroke",' opacity="',am,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',t(this.lineCap),'"',' weight="',X,'px"',' color="',ac,'" />')}else{if(typeof this.fillStyle=="object"){var P=this.fillStyle;var U=0;var aj={x:0,y:0};var ad=0;var S=1;if(P.type_=="gradient"){var R=P.x0_/this.arcScaleX_;var m=P.y0_/this.arcScaleY_;var Q=P.x1_/this.arcScaleX_;var at=P.y1_/this.arcScaleY_;var ao=this.getCoords_(R,m);var an=this.getCoords_(Q,at);var K=an.x-ao.x;var J=an.y-ao.y;U=Math.atan2(K,J)*180/Math.PI;if(U<0){U+=360}if(U<0.000001){U=0}}else{var ao=this.getCoords_(P.x0_,P.y0_);var j=Y.x-aq.x;var G=Y.y-aq.y;aj={x:(ao.x-aq.x)/j,y:(ao.y-aq.y)/G};j/=this.arcScaleX_*a;G/=this.arcScaleY_*a;var ai=v.max(j,G);ad=2*P.r0_/ai;S=2*P.r1_/ai-ad}var ab=P.colors_;ab.sort(function(W,H){return W.offset-H.offset});var V=ab.length;var aa=ab[0].color;var Z=ab[V-1].color;var af=ab[0].alpha*this.globalAlpha;var ae=ab[V-1].alpha*this.globalAlpha;var ah=[];for(var al=0;al<V;al++){var T=ab[al];ah.push(T.offset*S+ad+" "+T.color)}L.push('<g_vml_:fill type="',P.type_,'"',' method="none" focus="100%"',' color="',aa,'"',' color2="',Z,'"',' colors="',ah.join(","),'"',' opacity="',ae,'"',' g_o_:opacity2="',af,'"',' angle="',U,'"',' focusposition="',aj.x,",",aj.y,'" />')}else{L.push('<g_vml_:fill color="',ac,'" opacity="',am,'" />')}}L.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",L.join(""))};l.fill=function(){this.stroke(true)};l.closePath=function(){this.currentPath_.push({type:"close"})};l.getCoords_=function(H,G){var j=this.m_;return{x:a*(H*j[0][0]+G*j[1][0]+j[2][0])-o,y:a*(H*j[0][1]+G*j[1][1]+j[2][1])-o}};l.save=function(){var j={};x(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(r(),this.m_)};l.restore=function(){x(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(G){for(var I=0;I<3;I++){for(var H=0;H<2;H++){if(!isFinite(G[I][H])||isNaN(G[I][H])){return false}}}return true}function B(G,j,H){if(!g(j)){return}G.m_=j;if(H){var I=j[0][0]*j[1][1]-j[0][1]*j[1][0];G.lineScale_=D(n(I))}}l.translate=function(G,m){var j=[[1,0,0],[0,1,0],[G,m,1]];B(this,d(j,this.m_),false)};l.rotate=function(m){var H=E(m);var G=s(m);var j=[[H,G,0],[-G,H,0],[0,0,1]];B(this,d(j,this.m_),false)};l.scale=function(G,m){this.arcScaleX_*=G;this.arcScaleY_*=m;var j=[[G,0,0],[0,m,0],[0,0,1]];B(this,d(j,this.m_),true)};l.transform=function(I,H,K,J,m,j){var G=[[I,H,0],[K,J,0],[m,j,1]];B(this,d(G,this.m_),true)};l.setTransform=function(J,I,L,K,H,G){var j=[[J,I,0],[L,K,0],[H,G,1]];B(this,j,true)};l.clip=function(){};l.arcTo=function(){};l.createPattern=function(){return new f};function A(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}A.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=k;CanvasRenderingContext2D=q;CanvasGradient=A;CanvasPattern=f})()}function Range(){this._value=0;this._minimum=0;this._maximum=100;this._extent=0;this._isChanging=false}Range.prototype.setValue=function(a){a=Math.round(parseFloat(a));if(isNaN(a)){return}if(this._value!=a){if(a+this._extent>this._maximum){this._value=this._maximum-this._extent}else{if(a<this._minimum){this._value=this._minimum}else{this._value=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getValue=function(){return this._value};Range.prototype.setExtent=function(a){if(this._extent!=a){if(a<0){this._extent=0}else{if(this._value+a>this._maximum){this._extent=this._maximum-this._value}else{this._extent=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getExtent=function(){return this._extent};Range.prototype.setMinimum=function(a){if(this._minimum!=a){var b=this._isChanging;this._isChanging=true;this._minimum=a;if(a>this._value){this.setValue(a)}if(a>this._maximum){this._extent=0;this.setMaximum(a);this.setValue(a)}if(a+this._extent>this._maximum){this._extent=this._maximum-this._minimum}this._isChanging=b;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMinimum=function(){return this._minimum};Range.prototype.setMaximum=function(b){if(this._maximum!=b){var a=this._isChanging;this._isChanging=true;this._maximum=b;if(b<this._value){this.setValue(b-this._extent)}if(b<this._minimum){this._extent=0;this.setMinimum(b);this.setValue(this._maximum)}if(b<this._minimum+this._extent){this._extent=this._maximum-this._minimum}if(b<this._value+this._extent){this._extent=this._maximum-this._value}this._isChanging=a;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMaximum=function(){return this._maximum};Slider.isSupported=typeof document.createElement!="undefined"&&typeof document.documentElement!="undefined"&&typeof document.documentElement.offsetWidth=="number";function Slider(b,d,c){if(!b){return}this._orientation=c||"horizontal";this._range=new Range();this._range.setExtent(0);this._blockIncrement=10;this._unitIncrement=1;this._timer=new Timer(100);if(Slider.isSupported&&b){this.document=b.ownerDocument||b.document;this.element=b;this.element.slider=this;this.element.unselectable="on";this.element.className=this._orientation+" "+this.classNameTag+" "+this.element.className;this.line=this.document.createElement("DIV");this.line.className="line";this.line.unselectable="on";this.line.appendChild(this.document.createElement("DIV"));this.element.appendChild(this.line);this.handle=this.document.createElement("DIV");this.handle.className="handle";this.handle.unselectable="on";this.handle.appendChild(this.document.createElement("DIV"));this.handle.firstChild.appendChild(this.document.createTextNode(String.fromCharCode(160)));this.element.appendChild(this.handle)}this.input=d;var a=this;this._range.onchange=function(){a.recalculate();if(typeof a.onchange=="function"){a.onchange()}};if(Slider.isSupported&&b){this.element.onfocus=Slider.eventHandlers.onfocus;this.element.onblur=Slider.eventHandlers.onblur;this.element.onmousedown=Slider.eventHandlers.onmousedown;this.element.onmouseover=Slider.eventHandlers.onmouseover;this.element.onmouseout=Slider.eventHandlers.onmouseout;this.element.onkeydown=Slider.eventHandlers.onkeydown;this.element.onkeypress=Slider.eventHandlers.onkeypress;this.element.onmousewheel=Slider.eventHandlers.onmousewheel;this.handle.onselectstart=this.element.onselectstart=function(){return false};this._timer.ontimer=function(){a.ontimer()};window.setTimeout(function(){a.recalculate()},1)}else{this.input.onchange=function(f){a.setValue(a.input.value)}}}Slider.eventHandlers={getEvent:function(b,a){if(!b){if(a){b=a.document.parentWindow.event}else{b=window.event}}if(!b.srcElement){var a=b.target;while(a!=null&&a.nodeType!=1){a=a.parentNode}b.srcElement=a}if(typeof b.offsetX=="undefined"){b.offsetX=b.layerX;b.offsetY=b.layerY}return b},getDocument:function(a){if(a.target){return a.target.ownerDocument}return a.srcElement.document},getSlider:function(b){var a=b.target||b.srcElement;while(a!=null&&a.slider==null){a=a.parentNode}if(a){return a.slider}return null},getLine:function(b){var a=b.target||b.srcElement;while(a!=null&&a.className!="line"){a=a.parentNode}return a},getHandle:function(c){var b=c.target||c.srcElement;var a=/handle/;while(b!=null&&!a.test(b.className)){b=b.parentNode}return b},onfocus:function(b){var a=this.slider;a._focused=true;a.handle.className="handle hover"},onblur:function(b){var a=this.slider;a._focused=false;a.handle.className="handle"},onmouseover:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle){a.handle.className="handle hover"}},onmouseout:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle&&!a._focused){a.handle.className="handle"}},onmousedown:function(d){d=Slider.eventHandlers.getEvent(d,this);var a=this.slider;if(a.element.focus){a.element.focus()}Slider._currentInstance=a;var c=a.document;if(c.addEventListener){c.addEventListener("mousemove",Slider.eventHandlers.onmousemove,true);c.addEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(c.attachEvent){c.attachEvent("onmousemove",Slider.eventHandlers.onmousemove);c.attachEvent("onmouseup",Slider.eventHandlers.onmouseup);c.attachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.setCapture()}}if(Slider.eventHandlers.getHandle(d)){Slider._sliderDragData={screenX:d.screenX,screenY:d.screenY,dx:d.screenX-a.handle.offsetLeft,dy:d.screenY-a.handle.offsetTop,startValue:a.getValue(),slider:a}}else{return;var b=Slider.eventHandlers.getLine(d);a._mouseX=d.offsetX+(b?a.line.offsetLeft:0);a._mouseY=d.offsetY+(b?a.line.offsetTop:0);a._increasing=null;a.ontimer()}},onmousemove:function(g){g=Slider.eventHandlers.getEvent(g,this);if(Slider._sliderDragData){var c=Slider._sliderDragData.slider;var a=c.getMaximum()-c.getMinimum();var b,h,f;if(c._orientation=="horizontal"){b=c.element.offsetWidth-c.handle.offsetWidth;h=g.screenX-Slider._sliderDragData.dx;f=Math.abs(g.screenY-Slider._sliderDragData.screenY)>100}else{b=c.element.offsetHeight-c.handle.offsetHeight;h=c.element.offsetHeight-c.handle.offsetHeight-(g.screenY-Slider._sliderDragData.dy);f=Math.abs(g.screenX-Slider._sliderDragData.screenX)>100}c.setValue(f?Slider._sliderDragData.startValue:c.getMinimum()+a*h/b);return false}else{return;var c=Slider._currentInstance;if(c!=null){var d=Slider.eventHandlers.getLine(g);c._mouseX=g.offsetX+(d?c.line.offsetLeft:0);c._mouseY=g.offsetY+(d?c.line.offsetTop:0)}}},onmouseup:function(c){c=Slider.eventHandlers.getEvent(c,this);var a=Slider._currentInstance;var b=a.document;if(b.removeEventListener){b.removeEventListener("mousemove",Slider.eventHandlers.onmousemove,true);b.removeEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(b.detachEvent){b.detachEvent("onmousemove",Slider.eventHandlers.onmousemove);b.detachEvent("onmouseup",Slider.eventHandlers.onmouseup);b.detachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.releaseCapture()}}if(Slider._sliderDragData){Slider._sliderDragData=null}else{return;a._timer.stop();a._increasing=null}Slider._currentInstance=null},onkeydown:function(c){return;c=Slider.eventHandlers.getEvent(c,this);var b=this.slider;var a=c.keyCode;switch(a){case 33:b.setValue(b.getValue()+b.getBlockIncrement());break;case 34:b.setValue(b.getValue()-b.getBlockIncrement());break;case 35:b.setValue(b.getOrientation()=="horizontal"?b.getMaximum():b.getMinimum());break;case 36:b.setValue(b.getOrientation()=="horizontal"?b.getMinimum():b.getMaximum());break;case 38:case 39:b.setValue(b.getValue()+b.getUnitIncrement());break;case 37:case 40:b.setValue(b.getValue()-b.getUnitIncrement());break}if(a>=33&&a<=40){return false}},onkeypress:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=b.keyCode;if(a>=33&&a<=40){return false}},onmousewheel:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(a._focused){a.setValue(a.getValue()+b.wheelDelta/120*a.getUnitIncrement());return false}}};Slider.prototype.classNameTag="dynamic-slider-control",Slider.prototype.setValue=function(a){this._range.setValue(a);this.input.value=this.getValue()};Slider.prototype.getValue=function(){return this._range.getValue()};Slider.prototype.setMinimum=function(a){this._range.setMinimum(a);this.input.value=this.getValue()};Slider.prototype.getMinimum=function(){return this._range.getMinimum()};Slider.prototype.setMaximum=function(a){this._range.setMaximum(a);this.input.value=this.getValue()};Slider.prototype.getMaximum=function(){return this._range.getMaximum()};Slider.prototype.setUnitIncrement=function(a){this._unitIncrement=a};Slider.prototype.getUnitIncrement=function(){return this._unitIncrement};Slider.prototype.setBlockIncrement=function(a){this._blockIncrement=a};Slider.prototype.getBlockIncrement=function(){return this._blockIncrement};Slider.prototype.getOrientation=function(){return this._orientation};Slider.prototype.setOrientation=function(a){if(a!=this._orientation){if(Slider.isSupported&&this.element){this.element.className=this.element.className.replace(this._orientation,a)}this._orientation=a;this.recalculate()}};Slider.prototype.recalculate=function(){if(!Slider.isSupported||!this.element){return}var c=this.element.offsetWidth;var e=this.element.offsetHeight;var a=this.handle.offsetWidth;var d=this.handle.offsetHeight;var f=this.line.offsetWidth;var b=this.line.offsetHeight;if(this._orientation=="horizontal"){this.handle.style.left=(c-a)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.handle.style.top=(e-d)/2+"px";this.line.style.top=(e-b)/2+"px";this.line.style.left=a/2+"px";this.line.style.width=Math.max(0,c-a-2)+"px";this.line.firstChild.style.width=Math.max(0,c-a-4)+"px"}else{this.handle.style.left=(c-a)/2+"px";this.handle.style.top=e-d-(e-d)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.line.style.left=(c-f)/2+"px";this.line.style.top=d/2+"px";this.line.style.height=Math.max(0,e-d-2)+"px";this.line.firstChild.style.height=Math.max(0,e-d-4)+"px"}};Slider.prototype.ontimer=function(){var b=this.handle.offsetWidth;var d=this.handle.offsetHeight;var a=this.handle.offsetLeft;var c=this.handle.offsetTop;if(this._orientation=="horizontal"){if(this._mouseX>a+b&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}else{if(this._mouseX<a&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}}}else{if(this._mouseY>c+d&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}else{if(this._mouseY<c&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}}}this._timer.start()};function Timer(a){this._pauseTime=typeof a=="undefined"?1000:a;this._timer=null;this._isStarted=false}Timer.prototype.start=function(){if(this.isStarted()){this.stop()}var a=this;this._timer=window.setTimeout(function(){if(typeof a.ontimer=="function"){a.ontimer()}},this._pauseTime);this._isStarted=false};Timer.prototype.stop=function(){if(this._timer!=null){window.clearTimeout(this._timer)}this._isStarted=false};Timer.prototype.isStarted=function(){return this._isStarted};Timer.prototype.getPauseTime=function(){return this._pauseTime};Timer.prototype.setPauseTime=function(a){this._pauseTime=a};var OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:!0,_getScriptLocation:function(){for(var h=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,g=document.getElementsByTagName("script"),m,l="",k=0,j=g.length;k<j;k++){if(m=g[k].getAttribute("src")){if(m=m.match(h)){l=m[1];break}}}return function(){return l}}(),ImgPath:""};OpenLayers.Class=function(){var f=arguments.length,e=arguments[0],h=arguments[f-1],g="function"==typeof h.initialize?h.initialize:function(){e.prototype.initialize.apply(this,arguments)};1<f?(f=[g,e].concat(Array.prototype.slice.call(arguments).slice(1,f-1),h),OpenLayers.inherit.apply(null,f)):g.prototype=h;return g};OpenLayers.inherit=function(g,f){var k=function(){};k.prototype=f.prototype;g.prototype=new k;var j,h,k=2;for(j=arguments.length;k<j;k++){h=arguments[k],"function"===typeof h&&(h=h.prototype),OpenLayers.Util.extend(g.prototype,h)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(f,e){f=f||{};if(e){for(var h in e){var g=e[h];void 0!==g&&(f[h]=g)}!("function"==typeof window.Event&&e instanceof window.Event)&&(e.hasOwnProperty&&e.hasOwnProperty("toString"))&&(f.toString=e.toString)}return f};OpenLayers.String={startsWith:function(d,c){return 0==d.indexOf(c)},contains:function(d,c){return -1!=d.indexOf(c)},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(g){for(var g=g.split("-"),f=g[0],k=1,j=g.length;k<j;k++){var h=g[k],f=f+(h.charAt(0).toUpperCase()+h.substring(1))}return f},format:function(e,d,f){d||(d=window);return e.replace(OpenLayers.String.tokenRegEx,function(b,l){for(var k,j=l.split(/\.+/),c=0;c<j.length;c++){0==c&&(k=d),k=k[j[c]]}"function"==typeof k&&(k=f?k.apply(null,f):k());return"undefined"==typeof k?"undefined":k})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b)},numericIf:function(b){return OpenLayers.String.isNumeric(b)?parseFloat(b):b}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,d){var f=0;0<d&&(f=parseFloat(e.toPrecision(d)));return f},format:function(h,g,m,l){g="undefined"!=typeof g?g:0;m="undefined"!=typeof m?m:OpenLayers.Number.thousandsSeparator;l="undefined"!=typeof l?l:OpenLayers.Number.decimalSeparator;null!=g&&(h=parseFloat(h.toFixed(g)));var k=h.toString().split(".");1==k.length&&null==g&&(g=0);h=k[0];if(m){for(var j=/(-?[0-9]+)([0-9]{3})/;j.test(h);){h=h.replace(j,"$1"+m+"$2")}}0==g?g=h:(m=1<k.length?k[1]:"0",null!=g&&(m+=Array(g-m.length+1).join("0")),g=h+l+m);return g}};OpenLayers.Function={bind:function(e,d){var f=Array.prototype.slice.apply(arguments,[2]);return function(){var a=f.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(d,a)}},bindAsEventListener:function(d,c){return function(a){return d.call(c,a||window.event)}},False:function(){return !1},True:function(){return !0},Void:function(){}};OpenLayers.Array={filter:function(j,h,o){var n=[];if(Array.prototype.filter){n=j.filter(h,o)}else{var m=j.length;if("function"!=typeof h){throw new TypeError}for(var l=0;l<m;l++){if(l in j){var k=j[l];h.call(o,k,l,j)&&n.push(k)}}}return n}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(f,e,h,g){OpenLayers.Util.isArray(f)&&(g=f[3],h=f[2],e=f[1],f=f[0]);null!=f&&(this.left=OpenLayers.Util.toFloat(f));null!=e&&(this.bottom=OpenLayers.Util.toFloat(e));null!=h&&(this.right=OpenLayers.Util.toFloat(h));null!=g&&(this.top=OpenLayers.Util.toFloat(g))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(d){var c=!1;null!=d&&(c=this.left==d.left&&this.right==d.right&&this.top==d.top&&this.bottom==d.bottom);return c},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(b){return !0===b?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(h,g){null==h&&(h=6);var m=Math.pow(10,h),l=Math.round(this.left*m)/m,k=Math.round(this.bottom*m)/m,j=Math.round(this.right*m)/m,m=Math.round(this.top*m)/m;return !0===g?k+","+l+","+m+","+j:l+","+k+","+j+","+m},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(f,e){null==e&&(e=this.getCenterLonLat());var h,g;"OpenLayers.LonLat"==e.CLASS_NAME?(h=e.lon,g=e.lat):(h=e.x,g=e.y);return new OpenLayers.Bounds((this.left-h)*f+h,(this.bottom-g)*f+g,(this.right-h)*f+h,(this.top-g)*f+g)},add:function(d,c){if(null==d||null==c){throw new TypeError("Bounds.add cannot receive null values")}return new OpenLayers.Bounds(this.left+d,this.bottom+c,this.right+d,this.top+c)},extend:function(d){var c=null;if(d){switch(d.CLASS_NAME){case"OpenLayers.LonLat":c=new OpenLayers.Bounds(d.lon,d.lat,d.lon,d.lat);break;case"OpenLayers.Geometry.Point":c=new OpenLayers.Bounds(d.x,d.y,d.x,d.y);break;case"OpenLayers.Bounds":c=d}if(c){this.centerLonLat=null;if(null==this.left||c.left<this.left){this.left=c.left}if(null==this.bottom||c.bottom<this.bottom){this.bottom=c.bottom}if(null==this.right||c.right>this.right){this.right=c.right}if(null==this.top||c.top>this.top){this.top=c.top}}}},containsLonLat:function(f,e){"boolean"===typeof e&&(e={inclusive:e});var e=e||{},h=this.contains(f.lon,f.lat,e.inclusive),g=e.worldBounds;g&&!h&&(h=g.getWidth(),g=Math.round((f.lon-(g.left+g.right)/2)/h),h=this.containsLonLat({lon:f.lon-g*h,lat:f.lat},{inclusive:e.inclusive}));return h},containsPixel:function(d,c){return this.contains(d.x,d.y,c)},contains:function(f,e,h){null==h&&(h=!0);if(null==f||null==e){return !1}var f=OpenLayers.Util.toFloat(f),e=OpenLayers.Util.toFloat(e),g=!1;return g=h?f>=this.left&&f<=this.right&&e>=this.bottom&&e<=this.top:f>this.left&&f<this.right&&e>this.bottom&&e<this.top},intersectsBounds:function(j,h){"boolean"===typeof h&&(h={inclusive:h});h=h||{};if(h.worldBounds){var o=this.wrapDateLine(h.worldBounds),j=j.wrapDateLine(h.worldBounds)}else{o=this}null==h.inclusive&&(h.inclusive=!0);var n=!1,m=o.left==j.right||o.right==j.left||o.top==j.bottom||o.bottom==j.top;if(h.inclusive||!m){var n=j.top>=o.bottom&&j.top<=o.top||o.top>j.bottom&&o.top<j.top,m=j.left>=o.left&&j.left<=o.right||o.left>=j.left&&o.left<=j.right,l=j.right>=o.left&&j.right<=o.right||o.right>=j.left&&o.right<=j.right,n=(j.bottom>=o.bottom&&j.bottom<=o.top||o.bottom>=j.bottom&&o.bottom<=j.top||n)&&(m||l)}if(h.worldBounds&&!n){var k=h.worldBounds,m=k.getWidth(),l=!k.containsBounds(o),k=!k.containsBounds(j);l&&!k?(j=j.add(-m,0),n=o.intersectsBounds(j,{inclusive:h.inclusive})):k&&!l&&(o=o.add(-m,0),n=j.intersectsBounds(o,{inclusive:h.inclusive}))}return n},containsBounds:function(h,g,m){null==g&&(g=!1);null==m&&(m=!0);var l=this.contains(h.left,h.bottom,m),k=this.contains(h.right,h.bottom,m),j=this.contains(h.left,h.top,m),h=this.contains(h.right,h.top,m);return g?l||k||j||h:l&&k&&j&&h},determineQuadrant:function(e){var d="",f=this.getCenterLonLat(),d=d+(e.lat<f.lat?"b":"t");return d+=e.lon<f.lon?"l":"r"},transform:function(h,g){this.centerLonLat=null;var m=OpenLayers.Projection.transform({x:this.left,y:this.bottom},h,g),l=OpenLayers.Projection.transform({x:this.right,y:this.bottom},h,g),k=OpenLayers.Projection.transform({x:this.left,y:this.top},h,g),j=OpenLayers.Projection.transform({x:this.right,y:this.top},h,g);this.left=Math.min(m.x,k.x);this.bottom=Math.min(m.y,l.y);this.right=Math.max(l.x,j.x);this.top=Math.max(k.y,j.y);return this},wrapDateLine:function(h,g){var g=g||{},m=g.leftTolerance||0,l=g.rightTolerance||0,k=this.clone();if(h){for(var j=h.getWidth();k.left<h.left&&k.right-l<=h.left;){k=k.add(j,0)}for(;k.left+m>=h.right&&k.right>h.right;){k=k.add(-j,0)}m=k.left+m;m<h.right&&(m>h.left&&k.right-l>h.right)&&(k=k.add(-j,0))}return k},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,d){var f=e.split(",");return OpenLayers.Bounds.fromArray(f,d)};OpenLayers.Bounds.fromArray=function(d,c){return !0===c?new OpenLayers.Bounds(d[1],d[0],d[3],d[2]):new OpenLayers.Bounds(d[0],d[1],d[2],d[3])};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(d){var c;c=""+("t"==d.charAt(0)?"b":"t");return c+="l"==d.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(b){return"none"!=OpenLayers.Util.getElement(b).style.display},toggle:function(){for(var f=0,e=arguments.length;f<e;f++){var h=OpenLayers.Util.getElement(arguments[f]),g=OpenLayers.Element.visible(h)?"none":"";h.style.display=g}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b)},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight},hasClass:function(e,d){var f=e.className;return !!f&&RegExp("(^|\\s)"+d+"(\\s|$)").test(f)},addClass:function(d,c){OpenLayers.Element.hasClass(d,c)||(d.className+=(d.className?" ":"")+c);return d},removeClass:function(e,d){var f=e.className;f&&(e.className=OpenLayers.String.trim(f.replace(RegExp("(^|\\s+)"+d+"(\\s+|$)")," ")));return e},toggleClass:function(d,c){OpenLayers.Element.hasClass(d,c)?OpenLayers.Element.removeClass(d,c):OpenLayers.Element.addClass(d,c);return d},getStyle:function(f,e){var f=OpenLayers.Util.getElement(f),h=null;if(f&&f.style){h=f.style[OpenLayers.String.camelize(e)];h||(document.defaultView&&document.defaultView.getComputedStyle?h=(h=document.defaultView.getComputedStyle(f,null))?h.getPropertyValue(e):null:f.currentStyle&&(h=f.currentStyle[OpenLayers.String.camelize(e)]));var g=["left","top","right","bottom"];window.opera&&(-1!=OpenLayers.Util.indexOf(g,e)&&"static"==OpenLayers.Element.getStyle(f,"position"))&&(h="auto")}return"auto"==h?null:h}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(d,c){OpenLayers.Util.isArray(d)&&(c=d[1],d=d[0]);this.lon=OpenLayers.Util.toFloat(d);this.lat=OpenLayers.Util.toFloat(c)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(d,c){if(null==d||null==c){throw new TypeError("LonLat.add cannot receive null values")}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(c))},equals:function(d){var c=!1;null!=d&&(c=this.lon==d.lon&&this.lat==d.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(d.lon)&&isNaN(d.lat));return c},transform:function(e,d){var f=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,d);this.lon=f.x;this.lat=f.y;return this},wrapDateLine:function(d){var c=this.clone();if(d){for(;c.lon<d.left;){c.lon+=d.getWidth()}for(;c.lon>d.right;){c.lon-=d.getWidth()}}return c},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){b=b.split(",");return new OpenLayers.LonLat(b[0],b[1])};OpenLayers.LonLat.fromArray=function(d){var c=OpenLayers.Util.isArray(d);return new OpenLayers.LonLat(c&&d[0],c&&d[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(d,c){this.x=parseFloat(d);this.y=parseFloat(c)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},add:function(d,c){if(null==d||null==c){throw new TypeError("Pixel.add cannot receive null values")}return new OpenLayers.Pixel(this.x+d,this.y+c)},offset:function(d){var c=this.clone();d&&(c=this.add(d.x,d.y));return c},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(d,c){this.w=parseFloat(d);this.h=parseFloat(c)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(d){var c=!1;null!=d&&(c=this.w==d.w&&this.h==d.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(d.w)&&isNaN(d.h));return c},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){for(var e=document.getElementsByTagName("script"),d=0,f=e.length;d<f;++d){if(-1!=e[d].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}})();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var d;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);e=e.split("-");e[0]=e[0].toLowerCase();"object"==typeof OpenLayers.Lang[e[0]]&&(d=e[0]);if(e[1]){var f=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[f]&&(d=f)}d||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),d=OpenLayers.Lang.defaultCode);OpenLayers.Lang.code=d},translate:function(e,d){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];(f=f&&f[e])||(f=e);d&&(f=OpenLayers.String.format(f,d));return f}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var f=[],e=0,h=arguments.length;e<h;e++){var g=arguments[e];"string"==typeof g&&(g=document.getElementById(g));if(1==arguments.length){return g}f.push(g)}return f};OpenLayers.Util.isElement=function(b){return !!(b&&1===b.nodeType)};OpenLayers.Util.isArray=function(b){return"[object Array]"===Object.prototype.toString.call(b)};"undefined"===typeof window.$&&(window.$=OpenLayers.Util.getElement);OpenLayers.Util.removeItem=function(e,d){for(var f=e.length-1;f>=0;f--){e[f]==d&&e.splice(f,1)}return e};OpenLayers.Util.indexOf=function(f,e){if(typeof f.indexOf=="function"){return f.indexOf(e)}for(var h=0,g=f.length;h<g;h++){if(f[h]==e){return h}}return -1};OpenLayers.Util.modifyDOMElement=function(k,j,q,p,o,n,m,l){if(j){k.id=j}if(q){k.style.left=q.x+"px";k.style.top=q.y+"px"}if(p){k.style.width=p.w+"px";k.style.height=p.h+"px"}if(o){k.style.position=o}if(n){k.style.border=n}if(m){k.style.overflow=m}if(parseFloat(l)>=0&&parseFloat(l)<1){k.style.filter="alpha(opacity="+l*100+")";k.style.opacity=l}else{if(parseFloat(l)==1){k.style.filter="";k.style.opacity=""}}};OpenLayers.Util.createDiv=function(r,q,p,o,n,m,l,k){var j=document.createElement("div");if(o){j.style.backgroundImage="url("+o+")"}r||(r=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="absolute");OpenLayers.Util.modifyDOMElement(j,r,q,p,n,m,l,k);return j};OpenLayers.Util.createImage=function(r,q,p,o,n,m,l,k){var j=document.createElement("img");r||(r=OpenLayers.Util.createUniqueID("OpenLayersDiv"));n||(n="relative");OpenLayers.Util.modifyDOMElement(j,r,q,p,n,m,null,l);if(k){j.style.display="none";q=function(){j.style.display="";OpenLayers.Event.stopObservingElement(j)};OpenLayers.Event.observe(j,"load",q);OpenLayers.Event.observe(j,"error",q)}j.style.alt=r;j.galleryImg="no";if(o){j.src=o}return j};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),d=false;try{d=!!document.body.filters}catch(f){}OpenLayers.Util.alphaHackNeeded=d&&e>=5.5&&e<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(r,q,p,o,n,m,l,k,j){OpenLayers.Util.modifyDOMElement(r,q,p,o,m,null,null,j);q=r.childNodes[0];if(n){q.src=n}OpenLayers.Util.modifyDOMElement(q,r.id+"_innerImage",null,o,"relative",l);if(OpenLayers.Util.alphaHack()){if(r.style.display!="none"){r.style.display="inline-block"}k==null&&(k="scale");r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q.src+"', sizingMethod='"+k+"')";if(parseFloat(r.style.opacity)>=0&&parseFloat(r.style.opacity)<1){r.style.filter=r.style.filter+(" alpha(opacity="+r.style.opacity*100+")")}q.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(t,s,r,q,p,o,n,m,l){var k=OpenLayers.Util.createDiv(),l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);l.className="olAlphaImg";k.appendChild(l);OpenLayers.Util.modifyAlphaImageDiv(k,t,s,r,q,p,o,n,m);return k};OpenLayers.Util.upperCaseObject=function(e){var d={},f;for(f in e){d[f.toUpperCase()]=e[f]}return d};OpenLayers.Util.applyDefaults=function(f,e){var f=f||{},h=typeof window.Event=="function"&&e instanceof window.Event,g;for(g in e){if(f[g]===void 0||!h&&e.hasOwnProperty&&e.hasOwnProperty(g)&&!f.hasOwnProperty(g)){f[g]=e[g]}}if(!h&&e&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&!f.hasOwnProperty("toString")){f.toString=e.toString}return f};OpenLayers.Util.getParameterString=function(k){var j=[],q;for(q in k){var p=k[q];if(p!=null&&typeof p!="function"){if(typeof p=="object"&&p.constructor==Array){for(var o=[],n,m=0,l=p.length;m<l;m++){n=p[m];o.push(encodeURIComponent(n===null||n===void 0?"":n))}p=o.join(",")}else{p=encodeURIComponent(p)}j.push(encodeURIComponent(q)+"="+p)}}return j.join("&")};OpenLayers.Util.urlAppend=function(f,e){var h=f;if(e){var g=(f+" ").split(/[?&]/),h=h+(g.pop()===" "?e:g.length?"&"+e:"?"+e)}return h};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(b){return OpenLayers.Util.getImagesLocation()+b};OpenLayers.Util.Try=function(){for(var g=null,f=0,k=arguments.length;f<k;f++){var j=arguments[f];try{g=j();break}catch(h){}}return g};OpenLayers.Util.getXmlNodeValue=function(d){var c=null;OpenLayers.Util.Try(function(){c=d.text;if(!c){c=d.textContent}if(!c){c=d.firstChild.nodeValue}},function(){c=d.textContent});return c};OpenLayers.Util.mouseLeft=function(e,d){for(var f=e.relatedTarget?e.relatedTarget:e.toElement;f!=d&&f!=null;){f=f.parentNode}return f!=d};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(d,c){if(c==null){c=OpenLayers.Util.DEFAULT_PRECISION}typeof d!=="number"&&(d=parseFloat(d));return c===0?d:parseFloat(d.toPrecision(c))};OpenLayers.Util.rad=function(b){return b*Math.PI/180};OpenLayers.Util.deg=function(b){return b*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(N,M){for(var L=OpenLayers.Util.VincentyConstants,K=L.a,J=L.b,L=L.f,I=OpenLayers.Util.rad(M.lon-N.lon),H=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(N.lat))),G=Math.atan((1-L)*Math.tan(OpenLayers.Util.rad(M.lat))),F=Math.sin(H),H=Math.cos(H),E=Math.sin(G),G=Math.cos(G),D=I,C=2*Math.PI,B=20;Math.abs(D-C)>1e-12&&--B>0;){var A=Math.sin(D),z=Math.cos(D),y=Math.sqrt(G*A*G*A+(H*E-F*G*z)*(H*E-F*G*z));if(y==0){return 0}var z=F*E+H*G*z,x=Math.atan2(y,z),w=Math.asin(H*G*A/y),v=Math.cos(w)*Math.cos(w),A=z-2*F*E/v,u=L/16*v*(4+L*(4-3*v)),C=D,D=I+(1-u)*L*Math.sin(w)*(x+u*y*(A+u*z*(-1+2*A*A)))}if(B==0){return NaN}K=v*(K*K-J*J)/(J*J);L=K/1024*(256+K*(-128+K*(74-47*K)));return(J*(1+K/16384*(4096+K*(-768+K*(320-175*K))))*(x-L*y*(A+L/4*(z*(-1+2*A*A)-L/6*A*(-3+4*y*y)*(-3+4*A*A))))).toFixed(3)/1000};OpenLayers.Util.destinationVincenty=function(N,M,L){for(var K=OpenLayers.Util,J=K.VincentyConstants,I=J.a,H=J.b,G=J.f,J=N.lon,N=N.lat,F=K.rad(M),M=Math.sin(F),F=Math.cos(F),N=(1-G)*Math.tan(K.rad(N)),E=1/Math.sqrt(1+N*N),D=N*E,C=Math.atan2(N,F),N=E*M,B=1-N*N,I=B*(I*I-H*H)/(H*H),A=1+I/16384*(4096+I*(-768+I*(320-175*I))),z=I/1024*(256+I*(-128+I*(74-47*I))),I=L/(H*A),y=2*Math.PI;Math.abs(I-y)>1e-12;){var x=Math.cos(2*C+I),w=Math.sin(I),v=Math.cos(I),u=z*w*(x+z/4*(v*(-1+2*x*x)-z/6*x*(-3+4*w*w)*(-3+4*x*x))),y=I,I=L/(H*A)+u}L=D*w-E*v*F;H=Math.atan2(D*v+E*w*F,(1-G)*Math.sqrt(N*N+L*L));M=Math.atan2(w*M,E*v-D*w*F);F=G/16*B*(4+G*(4-3*B));x=M-(1-F)*G*N*(I+F*w*(x+F*v*(-1+2*x*x)));Math.atan2(N,-L);return new OpenLayers.LonLat(J+K.deg(x),K.deg(H))};OpenLayers.Util.getParameters=function(k){var k=k===null||k===void 0?window.location.href:k,j="";if(OpenLayers.String.contains(k,"?")){var j=k.indexOf("?")+1,q=OpenLayers.String.contains(k,"#")?k.indexOf("#"):k.length,j=k.substring(j,q)}for(var k={},j=j.split(/[&;]/),q=0,p=j.length;q<p;++q){var o=j[q].split("=");if(o[0]){var n=o[0];try{n=decodeURIComponent(n)}catch(m){n=unescape(n)}o=(o[1]||"").replace(/\+/g," ");try{o=decodeURIComponent(o)}catch(l){o=unescape(o)}o=o.split(",");o.length==1&&(o=o[0]);k[n]=o}}return k};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){b==null&&(b="id_");OpenLayers.Util.lastSeqID=OpenLayers.Util.lastSeqID+1;return b+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1000*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){return b>1?1/b:b};OpenLayers.Util.getResolutionFromScale=function(e,d){var f;if(e){d==null&&(d="degrees");f=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[d]*OpenLayers.DOTS_PER_INCH)}return f};OpenLayers.Util.getScaleFromResolution=function(d,c){c==null&&(c="degrees");return d*OpenLayers.INCHES_PER_UNIT[c]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(g){var f=[0,0],k=OpenLayers.Util.getViewportElement();if(!g||g==window||g==k){return f}var j=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(g,"position")=="absolute"&&(g.style.top==""||g.style.left==""),h=null;if(g.getBoundingClientRect){g=g.getBoundingClientRect();h=k.scrollTop;f[0]=g.left+k.scrollLeft;f[1]=g.top+h}else{if(document.getBoxObjectFor&&!j){g=document.getBoxObjectFor(g);k=document.getBoxObjectFor(k);f[0]=g.screenX-k.screenX;f[1]=g.screenY-k.screenY}else{f[0]=g.offsetLeft;f[1]=g.offsetTop;h=g.offsetParent;if(h!=g){for(;h;){f[0]=f[0]+h.offsetLeft;f[1]=f[1]+h.offsetTop;h=h.offsetParent}}k=OpenLayers.BROWSER_NAME;if(k=="opera"||k=="safari"&&OpenLayers.Element.getStyle(g,"position")=="absolute"){f[1]=f[1]-document.body.offsetTop}for(h=g.offsetParent;h&&h!=document.body;){f[0]=f[0]-h.scrollLeft;if(k!="opera"||h.tagName!="TR"){f[1]=f[1]-h.scrollTop}h=h.offsetParent}}}return f};OpenLayers.Util.getViewportElement=function(){var b=arguments.callee.viewportElement;if(b==void 0){b=OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat"?document.body:document.documentElement;arguments.callee.viewportElement=b}return b};OpenLayers.Util.isEquivalentUrl=function(f,e,h){h=h||{};OpenLayers.Util.applyDefaults(h,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var f=OpenLayers.Util.createUrlObject(f,h),e=OpenLayers.Util.createUrlObject(e,h),g;for(g in f){if(g!=="args"&&f[g]!=e[g]){return false}}for(g in f.args){if(f.args[g]!=e.args[g]){return false}delete e.args[g]}for(g in e.args){return false}return true};OpenLayers.Util.createUrlObject=function(g,f){f=f||{};if(!/^\w+:\/\//.test(g)){var k=window.location,j=k.port?":"+k.port:"",j=k.protocol+"//"+k.host.split(":").shift()+j;if(g.indexOf("/")===0){g=j+g}else{k=k.pathname.split("/");k.pop();g=j+k.join("/")+"/"+g}}f.ignoreCase&&(g=g.toLowerCase());k=document.createElement("a");k.href=g;j={};j.host=k.host.split(":").shift();j.protocol=k.protocol;j.port=f.ignorePort80?k.port=="80"||k.port=="0"?"":k.port:k.port==""||k.port=="0"?"80":k.port;j.hash=f.ignoreHash||k.hash==="#"?"":k.hash;var h=k.search;if(!h){h=g.indexOf("?");h=h!=-1?g.substr(h):""}j.args=OpenLayers.Util.getParameters(h);j.pathname=k.pathname.charAt(0)=="/"?k.pathname:"/"+k.pathname;return j};OpenLayers.Util.removeTail=function(e){var d=null,d=e.indexOf("?"),f=e.indexOf("#");return d=d==-1?f!=-1?e.substr(0,f):e:f!=-1?e.substr(0,Math.min(d,f)):e.substr(0,d)};OpenLayers.IS_GECKO=function(){var b=navigator.userAgent.toLowerCase();return b.indexOf("webkit")==-1&&b.indexOf("gecko")!=-1}();OpenLayers.CANVAS_SUPPORTED=function(){var b=document.createElement("canvas");return !(!b.getContext||!b.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var d="",c=navigator.userAgent.toLowerCase();c.indexOf("opera")!=-1?d="opera":c.indexOf("msie")!=-1?d="msie":c.indexOf("safari")!=-1?d="safari":c.indexOf("mozilla")!=-1&&(d=c.indexOf("firefox")!=-1?"firefox":"mozilla");return d}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(v,u,t){var s,r,q=document.createElement("div");q.style.visibility="hidden";for(var p=t&&t.containerElement?t.containerElement:document.body,o=false,n=null,m=p;m&&m.tagName.toLowerCase()!="body";){var l=OpenLayers.Element.getStyle(m,"position");if(l=="absolute"){o=true;break}else{if(l&&l!="static"){break}}m=m.parentNode}if(o&&(p.clientHeight===0||p.clientWidth===0)){n=document.createElement("div");n.style.visibility="hidden";n.style.position="absolute";n.style.overflow="visible";n.style.width=document.body.clientWidth+"px";n.style.height=document.body.clientHeight+"px";n.appendChild(q)}q.style.position="absolute";if(u){if(u.w){s=u.w;q.style.width=s+"px"}else{if(u.h){r=u.h;q.style.height=r+"px"}}}if(t&&t.displayClass){q.className=t.displayClass}u=document.createElement("div");u.innerHTML=v;u.style.overflow="visible";if(u.childNodes){v=0;for(t=u.childNodes.length;v<t;v++){if(u.childNodes[v].style){u.childNodes[v].style.overflow="visible"}}}q.appendChild(u);n?p.appendChild(n):p.appendChild(q);if(!s){s=parseInt(u.scrollWidth);q.style.width=s+"px"}r||(r=parseInt(u.scrollHeight));q.removeChild(u);if(n){n.removeChild(q);p.removeChild(n)}else{p.removeChild(q)}return new OpenLayers.Size(s,r)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(e==null){var d=null,f=null,d=e=0,d=document.createElement("div");d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";d.style.width="100px";d.style.height="50px";d.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";d.appendChild(f);document.body.appendChild(d);e=f.offsetWidth;d.style.overflow="scroll";d=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=e-d;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(h,g,m){m||(m="dms");var h=(h+540)%360-180,l=Math.abs(h),k=Math.floor(l),j=l=(l-k)/(1/60),l=Math.floor(l),j=Math.round((j-l)/(1/60)*10),j=j/10;if(j>=60){j=j-60;l=l+1;if(l>=60){l=l-60;k=k+1}}k<10&&(k="0"+k);k=k+"\u00b0";if(m.indexOf("dm")>=0){l<10&&(l="0"+l);k=k+(l+"'");if(m.indexOf("dms")>=0){j<10&&(j="0"+j);k=k+(j+'"')}}return k=g=="lon"?k+(h<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")):k+(h<0?OpenLayers.i18n("S"):OpenLayers.i18n("N"))};OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b},destroy:function(){},read:function(){throw Error("Read not implemented.")},write:function(){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.CSWGetRecords=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.CSWGetRecords.DEFAULTS),c=OpenLayers.Format.CSWGetRecords["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSWGetRecords version: "+d.version}return new c(d)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null);this.eventListeners=null;this.handler&&(this.handler.destroy(),this.handler=null);if(this.handlers){for(var b in this.handlers){this.handlers.hasOwnProperty(b)&&"function"==typeof this.handlers[b].destroy&&this.handlers[b].destroy()}this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null);this.div=null},setMap:function(b){this.map=b;this.handler&&this.handler.setMap(b)},draw:function(b){if(null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title)){this.div.title=this.title}null!=b&&(this.position=b.clone());this.moveTo(this.position);return this.div},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},activate:function(){if(this.active){return !1}this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return !0},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement},isSingleTouch:function(b){return b.touches&&1==b.touches.length},isMultiTouch:function(b){return b.touches&&1<b.touches.length},isLeftClick:function(b){return b.which&&1==b.which||b.button&&1==b.button},isRightClick:function(b){return b.which&&3==b.which||b.button&&2==b.button},stop:function(d,c){c||(d.preventDefault?d.preventDefault():d.returnValue=!1);d.stopPropagation?d.stopPropagation():d.cancelBubble=!0},findElement:function(e,d){for(var f=OpenLayers.Event.element(e);f.parentNode&&(!f.tagName||f.tagName.toUpperCase()!=d.toUpperCase());){f=f.parentNode}return f},observe:function(g,f,k,j){g=OpenLayers.Util.getElement(g);j=j||!1;if("keypress"==f&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown"}this.observers||(this.observers={});if(!g._eventCacheID){var h="eventCacheID_";g.id&&(h=g.id+"_"+h);g._eventCacheID=OpenLayers.Util.createUniqueID(h)}h=g._eventCacheID;this.observers[h]||(this.observers[h]=[]);this.observers[h].push({element:g,name:f,observer:k,useCapture:j});g.addEventListener?g.addEventListener(f,k,j):g.attachEvent&&g.attachEvent("on"+f,k)},stopObservingElement:function(b){b=OpenLayers.Util.getElement(b)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[b])},_removeElementObservers:function(e){if(e){for(var d=e.length-1;0<=d;d--){var f=e[d];OpenLayers.Event.stopObserving.apply(this,[f.element,f.name,f.observer,f.useCapture])}}},stopObserving:function(r,q,p,o){var o=o||!1,r=OpenLayers.Util.getElement(r),n=r._eventCacheID;if("keypress"==q&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.detachEvent)){q="keydown"}var m=!1,l=OpenLayers.Event.observers[n];if(l){for(var k=0;!m&&k<l.length;){var j=l[k];if(j.name==q&&j.observer==p&&j.useCapture==o){l.splice(k,1);0==l.length&&delete OpenLayers.Event.observers[n];m=!0;break}k++}}m&&(r.removeEventListener?r.removeEventListener(q,p,o):r&&r.detachEvent&&r.detachEvent("on"+q,p));return m},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var b in OpenLayers.Event.observers){OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[b]])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(g,f,k,j,h){OpenLayers.Util.extend(this,h);this.object=g;this.fallThrough=j;this.listeners={};this.extensions={};this.extensionCount={};null!=f&&this.attachToElement(f)},destroy:function(){for(var b in this.extensions){"boolean"!==typeof this.extensions[b]&&this.extensions[b].destroy()}this.extensions=null;this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener));this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this));this.element=e;for(var d=0,f=this.BROWSER_EVENTS.length;d<f;d++){OpenLayers.Event.observe(e,this.BROWSER_EVENTS[d],this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.register(c,d.scope,d[c])}},register:function(g,f,k,j){g in OpenLayers.Events&&!this.extensions[g]&&(this.extensions[g]=new OpenLayers.Events[g](this));if(null!=k){null==f&&(f=this.object);var h=this.listeners[g];h||(h=[],this.listeners[g]=h,this.extensionCount[g]=0);f={obj:f,func:k};j?(h.splice(this.extensionCount[g],0,f),"object"===typeof j&&j.extension&&this.extensionCount[g]++):h.push(f)}},registerPriority:function(e,d,f){this.register(e,d,f,!0)},un:function(d){for(var c in d){"scope"!=c&&d.hasOwnProperty(c)&&this.unregister(c,d.scope,d[c])}},unregister:function(g,f,k){null==f&&(f=this.object);g=this.listeners[g];if(null!=g){for(var j=0,h=g.length;j<h;j++){if(g[j].obj==f&&g[j].func==k){g.splice(j,1);break}}}},remove:function(b){null!=this.listeners[b]&&(this.listeners[b]=[])},triggerEvent:function(h,g){var m=this.listeners[h];if(m&&0!=m.length){null==g&&(g={});g.object=this.object;g.element=this.element;g.type||(g.type=h);for(var m=m.slice(),l,k=0,j=m.length;k<j&&!(l=m[k],l=l.func.apply(l.obj,[g]),void 0!=l&&!1==l);k++){}this.fallThrough||OpenLayers.Event.stop(g,!0);return l}},handleBrowserEvent:function(k){var j=k.type,q=this.listeners[j];if(q&&0!=q.length){if((q=k.touches)&&q[0]){for(var p=0,o=0,n=q.length,m,l=0;l<n;++l){m=q[l],p+=m.clientX,o+=m.clientY}k.clientX=p/n;k.clientY=o/n}this.includeXY&&(k.xy=this.getMousePosition(k));this.triggerEvent(j,k)}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var b=document.body;if(b&&(!(0!=b.scrollTop||0!=b.scrollLeft)||!navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(d){this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache();if(!this.element.scrolls){var c=OpenLayers.Util.getViewportElement();this.element.scrolls=[c.scrollLeft,c.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(d.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],d.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(b){this.target=b;for(b=this.events.length-1;0<=b;--b){this.target.register(this.events[b],this,this.buttonClick,{extension:!0})}},destroy:function(){for(var b=this.events.length-1;0<=b;--b){this.target.unregister(this.events[b],this,this.buttonClick)}delete this.target},getPressedButton:function(e){var d=3,f;do{if(OpenLayers.Element.hasClass(e,"olButton")){f=e;break}e=e.parentNode}while(0<--d&&e);return f},buttonClick:function(e){var d=!0,f=OpenLayers.Event.element(e);if(f&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){if(f=this.getPressedButton(f)){if("keydown"===e.type){switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:f}),OpenLayers.Event.stop(e),d=!1}}else{this.startEvt&&(this.completeRegEx.test(e.type)&&(d=OpenLayers.Util.pagePosition(f),this.target.triggerEvent("buttonclick",{buttonElement:f,buttonXY:{x:this.startEvt.clientX-d[0],y:this.startEvt.clientY-d[1]}})),this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),d=!1)}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),d=!1)}else{delete this.startEvt}}return d}});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(b){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(this.map.baseLayer){this.layers=[this.map.baseLayer.clone()]}else{return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport){this.element.style.display=""}else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(h){var g=this.handlers.drag.last.x-h.x,m=this.handlers.drag.last.y-h.y;if(0!=g||0!=m){var l=this.rectPxBounds.top,k=this.rectPxBounds.left,h=Math.abs(this.rectPxBounds.getHeight()),j=this.rectPxBounds.getWidth(),m=Math.max(0,l-m),m=Math.min(m,this.ovmap.size.h-this.hComp-h),g=Math.max(0,k-g),g=Math.min(g,this.ovmap.size.w-this.wComp-j);this.setRectPxBounds(new OpenLayers.Bounds(g,m+h,g+j,m))}},mapDivClick:function(h){var g=this.rectPxBounds.getCenterPixel(),m=h.xy.x-g.x,l=h.xy.y-g.y,k=this.rectPxBounds.top,j=this.rectPxBounds.left,h=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),l=Math.max(0,k+l),l=Math.min(l,this.ovmap.size.h-h),m=Math.max(0,j+m),m=Math.min(m,this.ovmap.size.w-g);this.setRectPxBounds(new OpenLayers.Bounds(m,l+h,m+g,l));this.updateMapToRect()},onButtonClick:function(b){b.buttonElement===this.minimizeDiv?this.minimizeControl():b.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(b){this.element.style.display="";this.showToggle(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.element.style.display="none";this.showToggle(!0);null!=b&&OpenLayers.Event.stop(b)},showToggle:function(b){this.maximizeDiv.style.display=b?"":"none";this.minimizeDiv.style.display=b?"none":""},update:function(){null==this.ovmap&&this.createMap();(this.autoPan||!this.isSuitableOverview())&&this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var d=this.map.getExtent(),c=this.map.maxExtent,d=new OpenLayers.Bounds(Math.max(d.left,c.left),Math.max(d.bottom,c.bottom),Math.min(d.right,c.right),Math.min(d.top,c.top));this.ovmap.getProjection()!=this.map.getProjection()&&(d=d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));c=this.ovmap.getResolution()/this.map.getResolution();return c>this.minRatio&&c<=this.maxRatio&&this.ovmap.getExtent().containsBounds(d)},updateOverview:function(){var e=this.map.getResolution(),d=this.ovmap.getResolution(),f=d/e;f>this.maxRatio?d=this.minRatio*e:f<=this.minRatio&&(d=this.maxRatio*e);this.ovmap.getProjection()!=this.map.getProjection()?(e=this.map.center.clone(),e.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):e=this.map.center;this.ovmap.setCenter(e,this.ovmap.getZoomForResolution(d*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var d=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,d);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2;this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(){!this.handlers.drag.active&&!this.map.dragging&&this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=d&&c?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var b=this.getRectBoundsFromMapBounds(this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent());b&&this.setRectPxBounds(b)},updateMapToRect:function(){var b=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(b=b.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(b.getCenterLonLat())},setRectPxBounds:function(h){var g=Math.max(h.top,0),m=Math.max(h.left,0),l=Math.min(h.top+Math.abs(h.getHeight()),this.ovmap.size.h-this.hComp),h=Math.min(h.left+h.getWidth(),this.ovmap.size.w-this.wComp),k=Math.max(h-m,0),j=Math.max(l-g,0);k<this.minRectSize||j<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,k=m+k/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(g+j/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(k)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(g)+"px",this.extentRectangle.style.left=Math.round(m)+"px",this.extentRectangle.style.height=Math.round(j)+"px",this.extentRectangle.style.width=Math.round(k)+"px");this.rectPxBounds=new OpenLayers.Bounds(Math.round(m),Math.round(l),Math.round(h),Math.round(g))},getRectBoundsFromMapBounds:function(e){var d=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),e=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),f=null;d&&e&&(f=new OpenLayers.Bounds(d.x,d.y,e.x,e.y));return f},getMapBoundsFromRectBounds:function(d){var c=this.getLonLatFromOverviewPx({x:d.left,y:d.bottom}),d=this.getLonLatFromOverviewPx({x:d.right,y:d.top});return new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)},getLonLatFromOverviewPx:function(f){var e=this.ovmap.size,h=this.ovmap.getResolution(),g=this.ovmap.getExtent().getCenterLonLat();return{lon:g.lon+(f.x-e.w/2)*h,lat:g.lat-(f.y-e.h/2)*h}},getOverviewPxFromLonLat:function(e){var d=this.ovmap.getResolution(),f=this.ovmap.getExtent();if(f){return{x:Math.round(1/d*(e.lon-f.left)),y:Math.round(1/d*(f.top-e.lat))}}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Animation=function(g){var f=!(!g.requestAnimationFrame&&!g.webkitRequestAnimationFrame&&!g.mozRequestAnimationFrame&&!g.oRequestAnimationFrame&&!g.msRequestAnimationFrame),k=function(){var a=g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(c){g.setTimeout(c,16)};return function(e,b){a.apply(g,[e,b])}}(),j=0,h={};return{isNative:f,requestFrame:k,start:function(d,c,m){var c=0<c?c:Number.POSITIVE_INFINITY,l=++j,e=+new Date;h[l]=function(){h[l]&&+new Date-e<=c?(d(),h[l]&&k(h[l],m)):delete h[l]};k(h[l],m);return l},stop:function(b){delete h[b]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(b){this.easing=b?b:OpenLayers.Easing.Expo.easeOut},start:function(f,e,h,g){this.playing=!0;this.begin=f;this.finish=e;this.duration=h;this.callbacks=g.callbacks;this.time=0;OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var f={},e;for(e in this.begin){var h=this.begin[e],g=this.finish[e];if(null==h||null==g||isNaN(h)||isNaN(g)){throw new TypeError("invalid value for Tween")}f[e]=this.easing.apply(this,[this.time,h,g-h,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,f);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(f,e,h,g){return h*f/g+e},easeOut:function(f,e,h,g){return h*f/g+e},easeInOut:function(f,e,h,g){return h*f/g+e},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(f,e,h,g){return 0==f?e:h*Math.pow(2,10*(f/g-1))+e},easeOut:function(f,e,h,g){return f==g?e+h:h*(-Math.pow(2,-10*f/g)+1)+e},easeInOut:function(f,e,h,g){return 0==f?e:f==g?e+h:1>(f/=g/2)?h/2*Math.pow(2,10*(f-1))+e:h/2*(-Math.pow(2,-10*--f)+2)+e},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(f,e,h,g){return h*(f/=g)*f+e},easeOut:function(f,e,h,g){return -h*(f/=g)*(f-2)+e},easeInOut:function(f,e,h,g){return 1>(f/=g/2)?h/2*f*f+e:-h/2*(--f*(f-2)-1)+e},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.projCode=d;window.Proj4js&&(this.proj=new Proj4js.Proj(d))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(d){var c=!1;d&&(d instanceof OpenLayers.Projection||(d=new OpenLayers.Projection(d)),window.Proj4js&&this.proj.defData&&d.proj.defData?c=this.proj.defData.replace(this.titleRegEx,"")==d.proj.defData.replace(this.titleRegEx,""):d.getCode&&(c=this.getCode(),d=d.getCode(),c=c==d||!!OpenLayers.Projection.transforms[c]&&OpenLayers.Projection.transforms[c][d]===OpenLayers.Projection.nullTransform));return c},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(f,e,h){if(h===OpenLayers.Projection.nullTransform){var g=OpenLayers.Projection.defaults[f];g&&!OpenLayers.Projection.defaults[e]&&(OpenLayers.Projection.defaults[e]=g)}OpenLayers.Projection.transforms[f]||(OpenLayers.Projection.transforms[f]={});OpenLayers.Projection.transforms[f][e]=h};OpenLayers.Projection.transform=function(f,e,h){if(e&&h){if(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),h instanceof OpenLayers.Projection||(h=new OpenLayers.Projection(h)),e.proj&&h.proj){f=Proj4js.transform(e.proj,h.proj,f)}else{var e=e.getCode(),h=h.getCode(),g=OpenLayers.Projection.transforms;if(g[e]&&g[e][h]){g[e][h](f)}}}return f};OpenLayers.Projection.nullTransform=function(b){return b};(function(){function j(b){b.x=180*b.x/n;b.y=180/Math.PI*(2*Math.atan(Math.exp(b.y/n*Math.PI))-Math.PI/2);return b}function h(b){b.x=b.x*n/180;b.y=Math.log(Math.tan((90+b.y)*Math.PI/360))/Math.PI*n;return b}function o(w,v){var u=OpenLayers.Projection.addTransform,t=OpenLayers.Projection.nullTransform,s,r,q,b,a;s=0;for(r=v.length;s<r;++s){q=v[s];u(w,q,h);u(q,w,j);for(a=s+1;a<r;++a){b=v[a],u(q,b,t),u(b,q,t)}}}var n=20037508.34,m=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],l=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],k;for(k=m.length-1;0<=k;--k){o(m[k],l)}for(k=l.length-1;0<=k;--k){o(l[k],m)}})();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(h,g){1===arguments.length&&"object"===typeof h&&(h=(g=h)&&g.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},g);OpenLayers.Util.extend(this,g);OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]);this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)&&(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)&&(this.minExtent=new OpenLayers.Bounds(this.minExtent));this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)&&(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));this.center&&!(this.center instanceof OpenLayers.LonLat)&&(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px");OpenLayers.Element.addClass(this.div,"olMap");var m=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(m,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});m=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(m);this.layerContainerDiv.style.width="100px";this.layerContainerDiv.style.height="100px";this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}9>parseFloat(navigator.appVersion.split("MSIE")[1])?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy));if(this.theme){for(var m=!0,l=document.getElementsByTagName("link"),k=0,j=l.length;k<j;++k){if(OpenLayers.Util.isEquivalentUrl(l.item(k).href,this.theme)){m=!1;break}}m&&(m=document.createElement("link"),m.setAttribute("rel","stylesheet"),m.setAttribute("type","text/css"),m.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(m))}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));k=0;for(j=this.controls.length;k<j;k++){this.addControlToMap(this.controls[k])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);g&&g.layers&&(delete this.center,this.addLayers(g.layers),g.center&&!this.getCenter()&&this.setCenter(g.center,g.zoom))},getViewport:function(){return this.viewPortDiv},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return !1}this.panTween&&(this.panTween.stop(),this.panTween=null);OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize);this.paddingForPopups=null;if(null!=this.controls){for(var b=this.controls.length-1;0<=b;--b){this.controls[b].destroy()}this.controls=null}if(null!=this.layers){for(b=this.layers.length-1;0<=b;--b){this.layers[b].destroy(!1)}this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv);this.viewPortDiv=null;this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null);this.events.destroy();this.options=this.events=null},setOptions:function(d){var c=this.minPx&&d.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,d);c&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(f,e,h){var g="function"==typeof h.test;return OpenLayers.Array.filter(this[f],function(b){return b[e]==h||g&&h.test(b[e])})},getLayersBy:function(d,c){return this.getBy("layers",d,c)},getLayersByName:function(b){return this.getLayersBy("name",b)},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b)},getControlsBy:function(d,c){return this.getBy("controls",d,c)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},getLayer:function(g){for(var f=null,k=0,j=this.layers.length;k<j;k++){var h=this.layers[k];if(h.id==g){f=h;break}}return f},setLayerZIndex:function(d,c){d.setZIndex(this.Z_INDEX_BASE[d.isBaseLayer?"BaseLayer":"Overlay"]+5*c)},resetLayersZIndex:function(){for(var d=0,c=this.layers.length;d<c;d++){this.setLayerZIndex(this.layers[d],d)}},addLayer:function(e){for(var d=0,f=this.layers.length;d<f;d++){if(this.layers[d]==e){return !1}}if(!1===this.events.triggerEvent("preaddlayer",{layer:e})){return !1}this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return !0},addLayers:function(e){for(var d=0,f=e.length;d<f;d++){this.addLayer(e[d])}},removeLayer:function(g,f){if(!1!==this.events.triggerEvent("preremovelayer",{layer:g})){null==f&&(f=!0);g.isFixed?this.viewPortDiv.removeChild(g.div):this.layerContainerDiv.removeChild(g.div);OpenLayers.Util.removeItem(this.layers,g);g.removeMap(this);g.map=null;if(this.baseLayer==g&&(this.baseLayer=null,f)){for(var k=0,j=this.layers.length;k<j;k++){var h=this.layers[k];if(h.isBaseLayer||this.allOverlays){this.setBaseLayer(h);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:g});g.events.triggerEvent("removed",{map:this,layer:g})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b)},setLayerIndex:function(f,e){var h=this.getLayerIndex(f);0>e?e=0:e>this.layers.length&&(e=this.layers.length);if(h!=e){this.layers.splice(h,1);this.layers.splice(e,0,f);for(var h=0,g=this.layers.length;h<g;h++){this.setLayerZIndex(this.layers[h],h)}this.events.triggerEvent("changelayer",{layer:f,property:"order"});this.allOverlays&&(0===e?this.setBaseLayer(f):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,d){var f=this.getLayerIndex(e)+d;this.setLayerIndex(e,f)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var d=this.getCachedCenter(),f=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null!=this.baseLayer&&!this.allOverlays&&this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()}null!=d&&(e=this.getZoomForResolution(f||this.resolution,!0),this.setCenter(d,e,!1,!0));this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(d,c){this.controls.push(d);this.addControlToMap(d,c)},addControls:function(g,f){for(var k=1===arguments.length?[]:f,j=0,h=g.length;j<h;j++){this.addControl(g[j],k[j]?k[j]:null)}},addControlToMap:function(e,d){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var f=e.draw(d);f&&!e.outsideViewport&&(f.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(f));e.autoActivate&&e.activate()},getControl:function(g){for(var f=null,k=0,j=this.controls.length;k<j;k++){var h=this.controls[k];if(h.id==g){f=h;break}}return f},removeControl:function(b){b&&b==this.getControl(b.id)&&(b.div&&b.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(b.div),OpenLayers.Util.removeItem(this.controls,b))},addPopup:function(e,d){if(d){for(var f=this.popups.length-1;0<=f;--f){this.removePopup(this.popups[f])}}e.map=this;this.popups.push(e);if(f=e.draw()){f.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(f)}},removePopup:function(d){OpenLayers.Util.removeItem(this.popups,d);if(d.div){try{this.layerContainerDiv.removeChild(d.div)}catch(c){}}d.map=null},getSize:function(){var b=null;null!=this.size&&(b=this.size.clone());return b},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var c=this.getSize();null==c&&(this.size=c=d);if(!d.equals(c)){this.size=d;d=0;for(c=this.layers.length;d<c;d++){this.layers[d].onMapResize()}d=this.getCachedCenter();null!=this.baseLayer&&null!=d&&(c=this.getZoom(),this.zoom=null,this.setCenter(d,c))}}},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth,b.h=this.div.offsetHeight}if(0==b.w&&0==b.h||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width),b.h=parseInt(this.div.style.height)}return b},calculateBounds:function(f,e){var h=null;null==f&&(f=this.getCachedCenter());null==e&&(e=this.getResolution());if(null!=f&&null!=e){var h=this.size.w*e/2,g=this.size.h*e/2,h=new OpenLayers.Bounds(f.lon-h,f.lat-g,f.lon+h,f.lat+g)}return h},getCenter:function(){var d=null,c=this.getCachedCenter();c&&(d=c.clone());return d},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(f,e,h){h=OpenLayers.Util.applyDefaults(h,{animate:!0,dragging:!1});if(h.dragging){(0!=f||0!=e)&&this.moveByPx(f,e)}else{var g=this.getViewPortPxFromLonLat(this.getCachedCenter()),f=g.add(f,e);if(this.dragging||!f.equals(g)){g=this.getLonLatFromViewPortPx(f),h.animate?this.panTo(g):(this.moveTo(g),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(g){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(g)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var f=this.getCachedCenter();if(!g.equals(f)){var f=this.getPixelFromLonLat(f),k=this.getPixelFromLonLat(g),j=0,h=0;this.panTween.start({x:0,y:0},{x:k.x-f.x,y:k.y-f.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(b){this.moveByPx(b.x-j,b.y-h);j=Math.round(b.x);h=Math.round(b.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(g);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}}else{this.setCenter(g)}},setCenter:function(f,e,h,g){this.panTween&&this.panTween.stop();this.moveTo(f,e,{dragging:h,forceZoomChange:g})},moveByPx:function(r,q){var p=this.size.w/2,o=this.size.h/2,n=p+r,m=o+q,l=this.baseLayer.wrapDateLine,k=0,j=0;this.restrictedExtent&&(k=p,j=o,l=!1);r=l||n<=this.maxPx.x-k&&n>=this.minPx.x+k?Math.round(r):0;q=m<=this.maxPx.y-j&&m>=this.minPx.y+j?Math.round(q):0;if(r||q){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart"));this.center=null;r&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-r+"px",this.minPx.x-=r,this.maxPx.x-=r);q&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-q+"px",this.minPx.y-=q,this.maxPx.y-=q);o=0;for(n=this.layers.length;o<n;++o){if(p=this.layers[o],p.visibility&&(p===this.baseLayer||p.inRange)){p.moveByPx(r,q),p.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(g){var f=this.baseLayer.resolutions,k=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(g)>k){for(var j=g|0,h=f.length;j<h;++j){if(f[j]<=k){g=j;break}}}return g},moveTo:function(t,s,r){null!=t&&!(t instanceof OpenLayers.LonLat)&&(t=new OpenLayers.LonLat(t));r||(r={});null!=s&&(s=parseFloat(s),this.fractionalZoom||(s=Math.round(s)));if(this.baseLayer.wrapDateLine){var q=s,s=this.adjustZoom(s);s!==q&&(t=this.getCenter())}var q=r.dragging||this.dragging,p=r.forceZoomChange;!this.getCachedCenter()&&!this.isValidLonLat(t)&&(t=this.maxExtent.getCenterLonLat(),this.center=t.clone());if(null!=this.restrictedExtent){null==t&&(t=this.center);null==s&&(s=this.getZoom());var o=this.getResolutionForZoom(s),o=this.calculateBounds(t,o);if(!this.restrictedExtent.containsBounds(o)){var n=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?t=new OpenLayers.LonLat(n.lon,t.lat):o.left<this.restrictedExtent.left?t=t.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(t=t.add(this.restrictedExtent.right-o.right,0));o.getHeight()>this.restrictedExtent.getHeight()?t=new OpenLayers.LonLat(t.lon,n.lat):o.bottom<this.restrictedExtent.bottom?t=t.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(t=t.add(0,this.restrictedExtent.top-o.top))}}p=p||this.isValidZoomLevel(s)&&s!=this.getZoom();o=this.isValidLonLat(t)&&!t.equals(this.center);if(p||o||q){q||this.events.triggerEvent("movestart");o&&(!p&&this.center&&this.centerLayerContainer(t),this.center=t.clone());t=p?this.getResolutionForZoom(s):this.getResolution();if(p||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var o=this.getMaxExtent({restricted:!0}),m=o.getCenterLonLat(),n=this.center.lon-m.lon,m=m.lat-this.center.lat,l=Math.round(o.getWidth()/t),k=Math.round(o.getHeight()/t);this.minPx={x:(this.size.w-l)/2-n/t,y:(this.size.h-k)/2-m/t};this.maxPx={x:this.minPx.x+Math.round(o.getWidth()/t),y:this.minPx.y+Math.round(o.getHeight()/t)}}p&&(this.zoom=s,this.resolution=t);t=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(t,p,r.dragging),r.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:p}));t=this.baseLayer.getExtent();for(s=this.layers.length-1;0<=s;--s){if(o=this.layers[s],o!==this.baseLayer&&!o.isBaseLayer&&(n=o.calculateInRange(),o.inRange!=n&&((o.inRange=n)||o.display(!1),this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})),n&&o.visibility)){o.moveTo(t,p,r.dragging),r.dragging||o.events.triggerEvent("moveend",{zoomChanged:p})}}this.events.triggerEvent("move");q||this.events.triggerEvent("moveend");if(p){s=0;for(r=this.popups.length;s<r;s++){this.popups[s].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(g){var f=this.getViewPortPxFromLonLat(this.layerContainerOrigin),k=this.getViewPortPxFromLonLat(g);if(null!=f&&null!=k){var j=parseInt(this.layerContainerDiv.style.left),g=parseInt(this.layerContainerDiv.style.top),h=Math.round(f.x-k.x),f=Math.round(f.y-k.y);this.layerContainerDiv.style.left=h+"px";this.layerContainerDiv.style.top=f+"px";j-=h;g-=f;this.minPx.x-=j;this.maxPx.x-=j;this.minPx.y-=g;this.maxPx.y-=g}},isValidZoomLevel:function(b){return null!=b&&0<=b&&b<this.getNumZoomLevels()},isValidLonLat:function(d){var c=!1;null!=d&&(c=this.getMaxExtent(),c=c.containsLonLat(d,{worldBounds:this.baseLayer.wrapDateLine&&c}));return c},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null},getProjectionObject:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.projection);return b},getMaxResolution:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.maxResolution);return b},getMaxExtent:function(d){var c=null;d&&d.restricted&&this.restrictedExtent?c=this.restrictedExtent:null!=this.baseLayer&&(c=this.baseLayer.maxExtent);return c},getNumZoomLevels:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.numZoomLevels);return b},getExtent:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.getExtent());return b},getResolution:function(){var b=null;null!=this.baseLayer?b=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(b=this.layers[0].getResolution());return b},getUnits:function(){var b=null;null!=this.baseLayer&&(b=this.baseLayer.units);return b},getScale:function(){var b=null;null!=this.baseLayer&&(b=this.getResolution(),b=OpenLayers.Util.getScaleFromResolution(b,this.baseLayer.units));return b},getZoomForExtent:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForExtent(e,d));return f},getResolutionForZoom:function(d){var c=null;this.baseLayer&&(c=this.baseLayer.getResolutionForZoom(d));return c},getZoomForResolution:function(e,d){var f=null;null!=this.baseLayer&&(f=this.baseLayer.getZoomForResolution(e,d));return f},zoomTo:function(b){this.isValidZoomLevel(b)&&this.setCenter(null,b)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,d){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var f=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){f=this.getMaxExtent();for(e=e.clone();e.right<e.left;){e.right+=f.getWidth()}f=e.getCenterLonLat().wrapDateLine(f)}this.setCenter(f,this.getZoomForExtent(e,d))},zoomToMaxExtent:function(b){this.zoomToExtent(this.getMaxExtent({restricted:b?b.restricted:!0}))},zoomToScale:function(g,f){var k=OpenLayers.Util.getResolutionFromScale(g,this.baseLayer.units),j=this.size.w*k/2,k=this.size.h*k/2,h=this.getCachedCenter();this.zoomToExtent(new OpenLayers.Bounds(h.lon-j,h.lat-k,h.lon+j,h.lat+k),f)},getLonLatFromViewPortPx:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getLonLatFromViewPortPx(d));return c},getViewPortPxFromLonLat:function(d){var c=null;null!=this.baseLayer&&(c=this.baseLayer.getViewPortPxFromLonLat(d));return c},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b)},getPixelFromLonLat:function(b){b=this.getViewPortPxFromLonLat(b);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getGeodesicPixelSize:function(h){var g=h?this.getLonLatFromPixel(h):this.getCachedCenter()||new OpenLayers.LonLat(0,0),m=this.getResolution(),h=g.add(-m/2,0),l=g.add(m/2,0),k=g.add(0,-m/2),g=g.add(0,m/2),m=new OpenLayers.Projection("EPSG:4326"),j=this.getProjectionObject()||m;j.equals(m)||(h.transform(j,m),l.transform(j,m),k.transform(j,m),g.transform(j,m));return new OpenLayers.Size(OpenLayers.Util.distVincenty(h,l),OpenLayers.Util.distVincenty(k,g))},getViewPortPxFromLayerPx:function(e){var d=null;if(null!=e){var d=parseInt(this.layerContainerDiv.style.left),f=parseInt(this.layerContainerDiv.style.top),d=e.add(d,f)}return d},getLayerPxFromViewPortPx:function(e){var d=null;if(null!=e){var d=-parseInt(this.layerContainerDiv.style.left),f=-parseInt(this.layerContainerDiv.style.top),d=e.add(d,f);if(isNaN(d.x)||isNaN(d.y)){d=null}}return d},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b)},getLayerPxFromLonLat:function(b){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(b))},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(d,c){this.metadata={};this.addOptions(c);this.name=d;if(null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)){this.events.on(this.eventListeners)}},destroy:function(b){null==b&&(b=!0);null!=this.map&&this.map.removeLayer(this,b);this.options=this.div=this.name=this.map=this.projection=null;this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy());this.events=this.eventListeners=null},clone:function(b){null==b&&(b=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(b,this);b.map=null;return b},getOptions:function(){var d={},c;for(c in this.options){d[c]=this[c]}return d},setName:function(b){b!=this.name&&(this.name=b,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(g,f){null==this.options&&(this.options={});if(g&&("string"==typeof g.projection&&(g.projection=new OpenLayers.Projection(g.projection)),g.projection&&OpenLayers.Util.applyDefaults(g,OpenLayers.Projection.defaults[g.projection.getCode()]),g.maxExtent&&!(g.maxExtent instanceof OpenLayers.Bounds)&&(g.maxExtent=new OpenLayers.Bounds(g.maxExtent)),g.minExtent&&!(g.minExtent instanceof OpenLayers.Bounds))){g.minExtent=new OpenLayers.Bounds(g.minExtent)}OpenLayers.Util.extend(this.options,g);OpenLayers.Util.extend(this,g);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var k=this.map.getResolution(),j=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]),h;for(h in g){if(g.hasOwnProperty(h)&&0<=OpenLayers.Util.indexOf(j,h)){this.initResolutions();f&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(k),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}}},onMapResize:function(){},redraw:function(){var d=!1;if(this.map){this.inRange=this.calculateInRange();var c=this.getExtent();c&&(this.inRange&&this.visibility)&&(this.moveTo(c,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),d=!0)}return d},moveTo:function(){var b=this.visibility;this.isBaseLayer||(b=b&&this.inRange);this.display(b)},moveByPx:function(){},setMap:function(b){null==this.map&&(this.map=b,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(b){this.tileSize=b=b?b:this.tileSize?this.tileSize:this.map.getTileSize();this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(b){b!=this.visibility&&(this.visibility=b,this.display(b),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(b){b!=("none"!=this.div.style.display)&&(this.div.style.display=b&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var b=!1;this.alwaysInRange?b=!0:this.map&&(b=this.map.getResolution(),b=b>=this.minResolution&&b<=this.maxResolution);return b},setIsBaseLayer:function(b){b!=this.isBaseLayer&&(this.isBaseLayer=b,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var j,h,o,n={},m=!0;j=0;for(h=this.RESOLUTION_PROPERTIES.length;j<h;j++){o=this.RESOLUTION_PROPERTIES[j],n[o]=this.options[o],m&&this.options[o]&&(m=!1)}null==this.alwaysInRange&&(this.alwaysInRange=m);null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales));null==n.resolutions&&(n.resolutions=this.calculateResolutions(n));if(null==n.resolutions){j=0;for(h=this.RESOLUTION_PROPERTIES.length;j<h;j++){o=this.RESOLUTION_PROPERTIES[j],n[o]=null!=this.options[o]?this.options[o]:this.map[o]}null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales));null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var l;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(l=this.options.maxResolution);this.options.minScale&&(l=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var k;this.options.minResolution&&"auto"!==this.options.minResolution&&(k=this.options.minResolution);this.options.maxScale&&(k=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));n.resolutions&&(n.resolutions.sort(function(d,c){return c-d}),l||(l=n.resolutions[0]),k||(k=n.resolutions[n.resolutions.length-1]));if(this.resolutions=n.resolutions){h=this.resolutions.length;this.scales=Array(h);for(j=0;j<h;j++){this.scales[j]=OpenLayers.Util.getScaleFromResolution(this.resolutions[j],this.units)}this.numZoomLevels=h}if(this.minResolution=k){this.maxScale=OpenLayers.Util.getScaleFromResolution(k,this.units)}if(this.maxResolution=l){this.minScale=OpenLayers.Util.getScaleFromResolution(l,this.units)}},resolutionsFromScales:function(f){if(null!=f){var e,h,g;g=f.length;e=Array(g);for(h=0;h<g;h++){e[h]=OpenLayers.Util.getResolutionFromScale(f[h],this.units)}return e}},calculateResolutions:function(h){var g,m,l=h.maxResolution;null!=h.minScale?l=OpenLayers.Util.getResolutionFromScale(h.minScale,this.units):"auto"==l&&null!=this.maxExtent&&(g=this.map.getSize(),m=this.maxExtent.getWidth()/g.w,g=this.maxExtent.getHeight()/g.h,l=Math.max(m,g));m=h.minResolution;null!=h.maxScale?m=OpenLayers.Util.getResolutionFromScale(h.maxScale,this.units):"auto"==h.minResolution&&null!=this.minExtent&&(g=this.map.getSize(),m=this.minExtent.getWidth()/g.w,g=this.minExtent.getHeight()/g.h,m=Math.max(m,g));"number"!==typeof l&&("number"!==typeof m&&null!=this.maxExtent)&&(l=this.map.getTileSize(),l=Math.max(this.maxExtent.getWidth()/l.w,this.maxExtent.getHeight()/l.h));g=h.maxZoomLevel;h=h.numZoomLevels;"number"===typeof m&&"number"===typeof l&&void 0===h?h=Math.floor(Math.log(l/m)/Math.log(2))+1:void 0===h&&null!=g&&(h=g+1);if(!("number"!==typeof h||0>=h||"number"!==typeof l&&"number"!==typeof m)){g=Array(h);var k=2;"number"==typeof m&&"number"==typeof l&&(k=Math.pow(l/m,1/(h-1)));var j;if("number"===typeof l){for(j=0;j<h;j++){g[j]=l/Math.pow(k,j)}}else{for(j=0;j<h;j++){g[h-1-j]=m*Math.pow(k,j)}}return g}},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,d){var f=this.map.getSize();return this.getZoomForResolution(Math.max(e.getWidth()/f.w,e.getHeight()/f.h),d)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));if(this.map.fractionalZoom){var d=Math.floor(e),f=Math.ceil(e),e=this.resolutions[d]-(e-d)*(this.resolutions[d]-this.resolutions[f])}else{e=this.resolutions[Math.round(e)]}return e},getZoomForResolution:function(k,j){var q,p;if(this.map.fractionalZoom){var o=0,n=this.resolutions[o],m=this.resolutions[this.resolutions.length-1],l;q=0;for(p=this.resolutions.length;q<p;++q){if(l=this.resolutions[q],l>=k&&(n=l,o=q),l<=k){m=l;break}}q=n-m;q=0<q?o+(n-k)/q:o}else{n=Number.POSITIVE_INFINITY;q=0;for(p=this.resolutions.length;q<p;q++){if(j){o=Math.abs(this.resolutions[q]-k);if(o>n){break}n=o}else{if(this.resolutions[q]<k){break}}}q=Math.max(0,q-1)}return q},getLonLatFromViewPortPx:function(f){var e=null,h=this.map;if(null!=f&&h.minPx){var e=h.getResolution(),g=h.getMaxExtent({restricted:!0}),e=new OpenLayers.LonLat((f.x-h.minPx.x)*e+g.left,(h.minPx.y-f.y)*e+g.top);this.wrapDateLine&&(e=e.wrapDateLine(this.maxExtent))}return e},getViewPortPxFromLonLat:function(e,d){var f=null;null!=e&&(d=d||this.map.getResolution(),f=this.map.calculateBounds(null,d),f=new OpenLayers.Pixel(1/d*(e.lon-f.left),1/d*(f.top-e.lat)));return f},setOpacity:function(h){if(h!=this.opacity){this.opacity=h;for(var g=this.div.childNodes,m=0,l=g.length;m<l;++m){var k=g[m].firstChild||g[m],j=g[m].lastChild;j&&"iframe"===j.nodeName.toLowerCase()&&(k=j.parentNode);OpenLayers.Util.modifyDOMElement(k,null,null,null,null,null,null,h)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(b){this.div.style.zIndex=b},adjustBounds:function(d){if(this.gutter){var c=this.gutter*this.map.getResolution(),d=new OpenLayers.Bounds(d.left-c,d.bottom-c,d.right+c,d.top+c)}this.wrapDateLine&&(c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},d=d.wrapDateLine(this.maxExtent,c));return d},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var b=null;return b=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(b){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(b){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=156543.03390625/Math.pow(2,b)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var d=new OpenLayers.Projection("EPSG:4326"),c=new OpenLayers.Projection("EPSG:900913");return function(f,b){var a=OpenLayers.Projection.transform({x:f,y:b},d,c);return new OpenLayers.LonLat(a.x,a.y)}}(),inverseMercator:function(){var d=new OpenLayers.Projection("EPSG:4326"),c=new OpenLayers.Projection("EPSG:900913");return function(f,b){var a=OpenLayers.Projection.transform({x:f,y:b},c,d);return new OpenLayers.LonLat(a.x,a.y)}}()};OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(d,c){OpenLayers.Layer.prototype.initialize.apply(this,arguments);null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.pane=this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";"msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")");this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane);this.loadMapObject();null==this.mapObject&&this.loadWarningMessage()},removeMap:function(b){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane);OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var e=this.map.getSize(),d=Math.min(e.w,300),f=Math.min(e.h,200),d=new OpenLayers.Size(d,f),e=(new OpenLayers.Pixel(e.w/2,e.h/2)).add(-d.w/2,-d.h/2),e=OpenLayers.Util.createDiv(this.name+"_warning",e,d,null,null,null,"auto");e.style.padding="7px";e.style.backgroundColor="yellow";e.innerHTML=this.getWarningHTML();this.div.appendChild(e)},getWarningHTML:function(){return""},display:function(b){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(b){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(d,c){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);this.dragPanMapObject?this.dragPanMapObject(d,-c):this.moveTo(this.map.getCachedCenter())},moveTo:function(j,h,o){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(null!=this.mapObject){var n=this.map.getCenter(),m=this.map.getZoom();if(null!=n){var l=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectCenter()),k=this.getOLZoomFromMapObjectZoom(this.getMapObjectZoom());if(!n.equals(l)||m!=k){!h&&l&&this.dragPanMapObject&&this.smoothDragPan?(m=this.map.getViewPortPxFromLonLat(l),n=this.map.getViewPortPxFromLonLat(n),this.dragPanMapObject(n.x-m.x,m.y-n.y)):(n=this.getMapObjectLonLatFromOLLonLat(n),m=this.getMapObjectZoomFromOLZoom(m),this.setMapObjectCenter(n,m,o))}}}},getLonLatFromViewPortPx:function(d){var c=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectLonLatFromMapObjectPixel(this.getMapObjectPixelFromOLPixel(d))));return c},getViewPortPxFromLonLat:function(d){var c=null;null!=this.mapObject&&null!=this.getMapObjectCenter()&&(c=this.getOLPixelFromMapObjectPixel(this.getMapObjectPixelFromMapObjectLonLat(this.getMapObjectLonLatFromOLLonLat(d))));return c},getOLLonLatFromMapObjectLonLat:function(d){var c=null;null!=d&&(c=this.getLongitudeFromMapObjectLonLat(d),d=this.getLatitudeFromMapObjectLonLat(d),c=new OpenLayers.LonLat(c,d));return c},getMapObjectLonLatFromOLLonLat:function(d){var c=null;null!=d&&(c=this.getMapObjectLonLatFromLonLat(d.lon,d.lat));return c},getOLPixelFromMapObjectPixel:function(d){var c=null;null!=d&&(c=this.getXFromMapObjectPixel(d),d=this.getYFromMapObjectPixel(d),c=new OpenLayers.Pixel(c,d));return c},getMapObjectPixelFromOLPixel:function(d){var c=null;null!=d&&(c=this.getMapObjectPixelFromXY(d.x,d.y));return c},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var f=["minZoomLevel","maxZoomLevel","numZoomLevels"],e=0,h=f.length;e<h;e++){var g=f[e];this[g]=null!=this.options[g]?this.options[g]:this.map[g]}if(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL){this.minZoomLevel=this.MIN_ZOOM_LEVEL}f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;e=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels;this.numZoomLevels=null!=e?Math.min(e,f):f;this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(null!=this.RESOLUTIONS){f=0;this.resolutions=[];for(e=this.minZoomLevel;e<=this.maxZoomLevel;e++){this.resolutions[f++]=this.RESOLUTIONS[e]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}var e=null,d=this.map.getSize(),f=this.getExtent();null!=d&&null!=f&&(e=Math.max(f.getWidth()/d.w,f.getHeight()/d.h));return e},getExtent:function(){var d=this.map.getSize(),c=this.getLonLatFromViewPortPx({x:0,y:0}),d=this.getLonLatFromViewPortPx({x:d.w,y:d.h});return null!=c&&null!=d?new OpenLayers.Bounds(c.lon,d.lat,d.lon,c.lat):null},getZoomForResolution:function(b){return null!=this.resolutions?OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments):this.getZoomForExtent(OpenLayers.Layer.prototype.getExtent.apply(this,[]))},getOLZoomFromMapObjectZoom:function(d){var c=null;null!=d&&(c=d-this.minZoomLevel,this.map.baseLayer!==this&&(c=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(c))));return c},getMapObjectZoomFromOLZoom:function(d){var c=null;null!=d&&(c=d+this.minZoomLevel,this.map.baseLayer!==this&&(c=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(c))));return c},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257,0.000001341104507446289,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(e,d){d=d||{};d.version||(d.version="function"===typeof GMap2?"2":"3");var f=OpenLayers.Layer.Google["v"+d.version.replace(/\./g,"_")];if(f){OpenLayers.Util.applyDefaults(d,f)}else{throw"Unsupported Google Maps API version: "+d.version}OpenLayers.Util.applyDefaults(d,f.DEFAULTS);d.maxExtent&&(d.maxExtent=d.maxExtent.clone());OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[e,d]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[e,d]);this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(d){var c=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(c)},display:function(b){this._dragging||this.setGMapVisibility(b);OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(e,d,f){this._dragging=f;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(d){d!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=d);if(this.getVisibility()){var c=this.getMapContainer();OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,d)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[this.map.id];b&&1>=b.count&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var d=OpenLayers.Layer.Google.cache[this.map.id];if(d){var c=this.mapObject&&this.getMapContainer();c&&c.parentNode&&c.parentNode.removeChild(c);(c=d.termsOfUse)&&c.parentNode&&c.parentNode.removeChild(c);(d=d.poweredBy)&&d.parentNode&&d.parentNode.removeChild(d)}},removeMap:function(d){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var c=OpenLayers.Layer.Google.cache[d.id];c&&(1>=c.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[d.id]):--c.count);delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(d){var c=null;null!=d&&(c=d.getSouthWest(),d=d.getNorthEast(),this.sphericalMercator?(c=this.forwardMercator(c.lng(),c.lat()),d=this.forwardMercator(d.lng(),d.lat())):(c=new OpenLayers.LonLat(c.lng(),c.lat()),d=new OpenLayers.LonLat(d.lng(),d.lat())),c=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat));return c},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lon:b.lng()},getLatitudeFromMapObjectLonLat:function(b){return this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat()},getXFromMapObjectPixel:function(b){return b.x},getYFromMapObjectPixel:function(b){return b.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var h,g,m,l=OpenLayers.Layer.Google.cache[this.map.id];if(l){h=l.mapObject,g=l.termsOfUse,m=l.poweredBy,++l.count}else{var l=this.map.viewPortDiv,k=document.createElement("div");k.id=this.map.id+"_GMap2Container";k.style.position="absolute";k.style.width="100%";k.style.height="100%";l.appendChild(k);try{h=new GMap2(k),g=k.lastChild,l.appendChild(g),g.style.zIndex="1100",g.style.right="",g.style.bottom="",g.className="olLayerGoogleCopyright",m=k.lastChild,l.appendChild(m),m.style.zIndex="1100",m.style.right="",m.style.bottom="",m.className="olLayerGooglePoweredBy gmnoprint"}catch(j){throw j}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:h,termsOfUse:g,poweredBy:m,count:1}}this.mapObject=h;this.termsOfUse=g;this.poweredBy=m;-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type);"function"==typeof h.getDragObject?this.dragObject=h.getDragObject():this.dragPanMapObject=null;!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var d=this,c=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(c);delete d._resized;d.mapObject.checkResize();d.moveTo(d.map.getCenter(),d.map.getZoom())})}this._resized=!0}},setGMapVisibility:function(e){var d=OpenLayers.Layer.Google.cache[this.map.id];if(d){var f=this.mapObject.getContainer();!0===e?(this.mapObject.setMapType(this.type),f.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",d.displayed=this.id):(d.displayed===this.id&&delete d.displayed,d.displayed||(f.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(d){var c=null;null!=d&&(c=this.sphericalMercator?this.inverseMercator(d.bottom,d.left):new OpenLayers.LonLat(d.bottom,d.left),d=this.sphericalMercator?this.inverseMercator(d.top,d.right):new OpenLayers.LonLat(d.top,d.right),c=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon)));return c},setMapObjectCenter:function(d,c){this.mapObject.setCenter(d,c)},dragPanMapObject:function(d,c){this.dragObject.moveBy(new GSize(-d,c))},getMapObjectLonLatFromMapObjectPixel:function(b){return this.mapObject.fromContainerPixelToLatLng(b)},getMapObjectPixelFromMapObjectLonLat:function(b){return this.mapObject.fromLatLngToContainerPixel(b)},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(e,d){var f;this.sphericalMercator?(f=this.inverseMercator(e,d),f=new GLatLng(f.lat,f.lon)):f=new GLatLng(d,e);return f},getMapObjectPixelFromXY:function(d,c){return new GPoint(d,c)}};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(d){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[d]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var c in this.namespaces){this.namespaceAlias[this.namespaces[c]]=c}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(d,c){this.namespaces[d]=c;this.namespaceAlias[c]=d},read:function(d){var c=d.indexOf("<");0<c&&(d=d.substring(c));c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var a;a=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;a.loadXML(d);return a},this),function(){return(new DOMParser).parseFromString(d,"text/xml")},function(){var a=new XMLHttpRequest;a.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),!1);a.overrideMimeType&&a.overrideMimeType("text/xml");a.send(null);return a.responseXML});this.keepData&&(this.data=c);return c},write:function(e){if(this.xmldom){e=e.xml}else{var d=new XMLSerializer;if(1==e.nodeType){var f=document.implementation.createDocument("","",null);f.importNode&&(e=f.importNode(e,!0));f.appendChild(e);e=d.serializeToString(f)}else{e=d.serializeToString(e)}}return e},createElementNS:function(d,c){return this.xmldom?"string"==typeof d?this.xmldom.createNode(1,c,d):this.xmldom.createNode(1,c,""):document.createElementNS(d,c)},createTextNode:function(b){"string"!==typeof b&&(b=""+b);return this.xmldom?this.xmldom.createTextNode(b):document.createTextNode(b)},getElementsByTagNameNS:function(k,j,q){var p=[];if(k.getElementsByTagNameNS){p=k.getElementsByTagNameNS(j,q)}else{for(var k=k.getElementsByTagName("*"),o,n,m=0,l=k.length;m<l;++m){if(o=k[m],n=o.prefix?o.prefix+":"+q:q,"*"==q||n==o.nodeName){("*"==j||j==o.namespaceURI)&&p.push(o)}}}return p},getAttributeNodeNS:function(k,j,q){var p=null;if(k.getAttributeNodeNS){p=k.getAttributeNodeNS(j,q)}else{for(var k=k.attributes,o,n,m=0,l=k.length;m<l;++m){if(o=k[m],o.namespaceURI==j&&(n=o.prefix?o.prefix+":"+q:q,n==o.nodeName)){p=o;break}}}return p},getAttributeNS:function(f,e,h){var g="";if(f.getAttributeNS){g=f.getAttributeNS(e,h)||""}else{if(f=this.getAttributeNodeNS(f,e,h)){g=f.nodeValue}}return g},getChildValue:function(f,e){var h=e||"";if(f){for(var g=f.firstChild;g;g=g.nextSibling){switch(g.nodeType){case 3:case 4:h+=g.nodeValue}}}return h},isSimpleContent:function(d){for(var c=!0,d=d.firstChild;d;d=d.nextSibling){if(1===d.nodeType){c=!1;break}}return c},contentType:function(f){for(var e=!1,h=!1,g=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,f=f.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:h=!0;break;case 8:break;default:e=!0}if(h&&e){break}}if(h&&e){g=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(h){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}if(e){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}return g},hasAttributeNS:function(f,e,h){var g=!1;return g=f.hasAttributeNS?f.hasAttributeNS(e,h):!!this.getAttributeNodeNS(f,e,h)},setAttributeNS:function(f,e,h,g){if(f.setAttributeNS){f.setAttributeNS(e,h,g)}else{if(this.xmldom){e?(e=f.ownerDocument.createNode(2,h,e),e.nodeValue=g,f.setAttributeNode(e)):f.setAttribute(h,g)}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(f,e){var e=e||{},h=e.uri||this.namespaces[e.prefix];h||(h=f.indexOf(":"),h=this.namespaces[f.substring(0,h)]);h||(h=this.namespaces[this.defaultPrefix]);h=this.createElementNS(h,f);e.attributes&&this.setAttributes(h,e.attributes);var g=e.value;null!=g&&h.appendChild(this.createTextNode(g));return h},setAttributes:function(g,f){var k,j,h;for(h in f){null!=f[h]&&f[h].toString&&(k=f[h].toString(),j=this.namespaces[h.substring(0,h.indexOf(":"))]||null,this.setAttributeNS(g,j,h,k))}},readNode:function(f,e){e||(e={});var h=this.readers[f.namespaceURI?this.namespaceAlias[f.namespaceURI]:this.defaultPrefix];if(h){var g=f.localName||f.nodeName.split(":").pop();(h=h[g]||h["*"])&&h.apply(this,[f,e])}return e},readChildNodes:function(h,g){g||(g={});for(var m=h.childNodes,l,k=0,j=m.length;k<j;++k){l=m[k],1==l.nodeType&&this.readNode(l,g)}return g},writeNode:function(g,f,k){var j,h=g.indexOf(":");0<h?(j=g.substring(0,h),g=g.substring(h+1)):j=k?this.namespaceAlias[k.namespaceURI]:this.defaultPrefix;f=this.writers[j][g].apply(this,[f]);k&&k.appendChild(f);return f},getChildEl:function(e,d,f){return e&&this.getThisOrNextEl(e.firstChild,d,f)},getNextEl:function(e,d,f){return e&&this.getThisOrNextEl(e.nextSibling,d,f)},getThisOrNextEl:function(e,d,f){e:for(;e;e=e.nextSibling){switch(e.nodeType){case 1:if((!d||d===(e.localName||e.nodeName.split(":").pop()))&&(!f||f===e.namespaceURI)){break e}e=null;break e;case 3:if(/^\s*$/.test(e.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:e=null;break e}}return e||null},lookupNamespaceURI:function(g,f){var k=null;if(g){if(g.lookupNamespaceURI){k=g.lookupNamespaceURI(f)}else{g:switch(g.nodeType){case 1:if(null!==g.namespaceURI&&g.prefix===f){k=g.namespaceURI;break g}if(k=g.attributes.length){for(var j,h=0;h<k;++h){if(j=g.attributes[h],"xmlns"===j.prefix&&j.name==="xmlns:"+f){k=j.value||null;break g}else{if("xmlns"===j.name&&null===f){k=j.value||null;break g}}}}k=this.lookupNamespaceURI(g.parentNode,f);break g;case 2:k=this.lookupNamespaceURI(g.ownerElement,f);break g;case 9:k=this.lookupNamespaceURI(g.documentElement,f);break g;case 6:case 12:case 10:case 11:break g;default:k=this.lookupNamespaceURI(g.parentNode,f)}}}return k},getXMLDoc:function(){!OpenLayers.Format.XML.document&&!this.xmldom&&(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.WFST.DEFAULTS),c=OpenLayers.Format.WFST["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFST version: "+d.version}return new c(d)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(b){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},getSrsName:function(e,d){var f=d&&d.srsName;f||(f=e&&e.layer?e.layer.projection.getCode():this.srsName);return f},read:function(e,d){d=d||{};OpenLayers.Util.applyDefaults(d,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var f={};e&&this.readNode(e,f,!0);f.features&&"features"===d.output&&(f=f.features);return f},readers:{wfs:{FeatureCollection:function(d,c){c.features=[];this.readChildNodes(d,c)}}},write:function(f,e){var h=this.writeNode("wfs:Transaction",{features:f,options:e}),g=this.schemaLocationAttr();g&&this.setAttributeNS(h,this.namespaces.xsi,"xsi:schemaLocation",g);return OpenLayers.Format.XML.prototype.write.apply(this,[h])},writers:{wfs:{GetFeature:function(f){var e=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:f&&f.handle,outputFormat:f&&f.outputFormat,maxFeatures:f&&f.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(f)}});if("string"==typeof this.featureType){this.writeNode("Query",f,e)}else{for(var h=0,g=this.featureType.length;h<g;h++){f.featureType=this.featureType[h],this.writeNode("Query",f,e)}}return e},Transaction:function(j){var j=j||{},h=j.options||{},o=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:h.handle}}),n,m=j.features;if(m){!0===h.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var l,k,j=0;for(n=m.length;j<n;++j){k=m[j],(l=this.stateName[k.state])&&this.writeNode(l,{feature:k,options:h},o)}!0===h.multi&&this.setGeometryTypes()}if(h.nativeElements){j=0;for(n=h.nativeElements.length;j<n;++j){this.writeNode("wfs:Native",h.nativeElements[j],o)}}return o},Native:function(b){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:b.vendorId,safeToIgnore:b.safeToIgnore},value:b.value})},Insert:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:d&&d.handle}});this.srsName=this.getSrsName(c);this.writeNode("feature:_typeName",c,d);return d},Update:function(f){var e=f.feature,f=f.options,f=this.createElementNSPlus("wfs:Update",{attributes:{handle:f&&f.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&f.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=e.modified;if(null!==this.geometryName&&(!h||void 0!==h.geometry)){this.srsName=this.getSrsName(e),this.writeNode("Property",{name:this.geometryName,value:e.geometry},f)}for(var g in e.attributes){void 0!==e.attributes[g]&&(!h||!h.attributes||h.attributes&&void 0!==h.attributes[g])&&this.writeNode("Property",{name:g,value:e.attributes[g]},f)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[e.fid]}),f);return f},Property:function(d){var c=this.createElementNSPlus("wfs:Property");this.writeNode("Name",d.name,c);null!==d.value&&this.writeNode("Value",d.value,c);return c},Name:function(b){return this.createElementNSPlus("wfs:Name",{value:b})},Value:function(d){var c;d instanceof OpenLayers.Geometry?(c=this.createElementNSPlus("wfs:Value"),d=this.writeNode("feature:_geometry",d).firstChild,c.appendChild(d)):c=this.createElementNSPlus("wfs:Value",{value:d});return c},Delete:function(d){var c=d.feature,d=d.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:d&&d.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[c.fid]}),d);return d}}},schemaLocationAttr:function(f){var f=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},f),e=OpenLayers.Util.extend({},this.schemaLocations);f.schema&&(e[f.featurePrefix]=f.schema);var f=[],h,g;for(g in e){(h=this.namespaces[g])&&f.push(h+" "+e[g])}return f.join(" ")||void 0},setFilterProperty:function(e){if(e.filters){for(var d=0,f=e.filters.length;d<f;++d){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[d])}}else{e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));var c={exceptionReport:null};d.documentElement&&(this.readChildNodes(d,c),null===c.exceptionReport&&(c=(new OpenLayers.Format.OWSCommon).read(d)));return c},readers:{ogc:{ServiceExceptionReport:function(d,c){c.exceptionReport={exceptions:[]};this.readChildNodes(d,c.exceptionReport)},ServiceException:function(e,d){var f={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};d.exceptions.push(f)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(e,d){var f;e?(f=this.version,f||(f=e.getAttribute("version"),f||(f=this.defaultVersion))):f=d&&d.version||this.version||this.defaultVersion;return f},getParser:function(e){var e=e||this.defaultVersion,d=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var f=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+d];if(!f){throw"Can't find a "+this.name+" parser for version "+e+d}this.parser=new f(this.options)}return this.parser},write:function(e,d){this.parser=this.getParser(this.getVersion(null,d));var f=this.parser.write(e,d);return !1===this.stringifyOutput?f:OpenLayers.Format.XML.prototype.write.apply(this,[f])},read:function(g,f){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));var k=this.getVersion(g.documentElement);this.parser=this.getParser(k);var j=this.parser.read(g,f);if(null!==this.errorProperty&&void 0===j[this.errorProperty]){var h=new OpenLayers.Format.OGCExceptionReport;j.error=h.read(g)}j.version=k;return j},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,d,f){this.layer=e;this.lonlat=d;this.data=null!=f?f:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.data=this.lonlat=this.id=this.layer=null;null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null);null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var b=!1;null!=this.layer&&null!=this.layer.map&&(b=this.layer.map.getExtent().containsLonLat(this.lonlat));return b},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){null!=this.lonlat&&(this.popup||(this.popup=new (this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,b)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this);return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,d,f){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,d]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};d&&(this.attributes=OpenLayers.Util.extend(this.attributes,d));this.style=f?f:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null);this.modified=this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(d){var c=!1;this.layer&&this.layer.map&&(c=this.layer.map.getExtent(),d?(d=this.geometry.getBounds(),c=c.intersectsBounds(d)):c=c.toGeometry().intersects(this.geometry));return c},getVisibility:function(){return !(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(f,e,h){var g=!1;this.geometry&&(g=this.geometry.atPoint(f,e,h));return g},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e,d=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),f=this.layer.map.getResolution();this.geometry.move(f*(e.x-d.x),f*(d.y-e.y));this.layer.drawFeature(this);return d}},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b}}else{b==OpenLayers.State.UNKNOWN&&(this.state=b)}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(d,c){OpenLayers.Util.extend(this,c);this.rules=[];c&&c.rules&&this.addRules(c.rules);this.setDefaultStyle(d||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var d=0,c=this.rules.length;d<c;d++){this.rules[d].destroy(),this.rules[d]=null}this.defaultStyle=this.rules=null},createSymbolizer:function(k){for(var j=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),k),q=this.rules,p,o=[],n=!1,m=0,l=q.length;m<l;m++){p=q[m],p.evaluate(k)&&(p instanceof OpenLayers.Rule&&p.elseFilter?o.push(p):(n=!0,this.applySymbolizer(p,j,k)))}if(!1==n&&0<o.length){n=!0;m=0;for(l=o.length;m<l;m++){this.applySymbolizer(o[m],j,k)}}0<q.length&&!1==n&&(j.display="none");null!=j.label&&"string"!==typeof j.label&&(j.label=""+j.label);return j},applySymbolizer:function(f,e,h){var g=h.geometry?this.getSymbolizerPrefix(h.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],f=f.symbolizer[g]||f.symbolizer;!0===this.defaultsPerSymbolizer&&(g=this.defaultStyle,OpenLayers.Util.applyDefaults(f,{pointRadius:g.pointRadius}),(!0===f.stroke||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{strokeWidth:g.strokeWidth,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeDashstyle:g.strokeDashstyle,strokeLinecap:g.strokeLinecap}),(!0===f.fill||!0===f.graphic)&&OpenLayers.Util.applyDefaults(f,{fillColor:g.fillColor,fillOpacity:g.fillOpacity}),!0===f.graphic&&OpenLayers.Util.applyDefaults(f,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset}));return this.createLiterals(OpenLayers.Util.extend(e,f),h)},createLiterals:function(f,e){var h=OpenLayers.Util.extend({},e.attributes||e.data);OpenLayers.Util.extend(h,this.context);for(var g in this.propertyStyles){f[g]=OpenLayers.Style.createLiteral(f[g],h,e,g)}return f},findPropertyStyles:function(){var j={};this.addPropertyStyles(j,this.defaultStyle);for(var h=this.rules,o,n,m=0,l=h.length;m<l;m++){o=h[m].symbolizer;for(var k in o){if(n=o[k],"object"==typeof n){this.addPropertyStyles(j,n)}else{this.addPropertyStyles(j,o);break}}}return j},addPropertyStyles:function(f,e){var h,g;for(g in e){h=e[g],"string"==typeof h&&h.match(/\$\{\w+\}/)&&(f[g]=!0)}return f},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(f){for(var e=OpenLayers.Style.SYMBOLIZER_PREFIXES,h=0,g=e.length;h<g;h++){if(-1!=f.CLASS_NAME.indexOf(e[h])){return e[h]}}},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var d=0,f=this.rules.length;d<f;++d){e.rules.push(this.rules[d].clone())}}e.context=this.context&&OpenLayers.Util.extend({},this.context);d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(f,e,h,g){"string"==typeof f&&-1!=f.indexOf("${")&&(f=OpenLayers.String.format(f,e,[h,g]),f=isNaN(f)||!f?f:parseFloat(f));return f};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b)},destroy:function(){},evaluate:function(){return !0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(b){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},evaluate:function(e){for(var d=0,f=this.fids.length;d<f;d++){if((e.fid||e.id)==this.fids[d]){return !0}}return !1},clone:function(){var b=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(b,this);b.fids=this.fids.slice();return b},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(b){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[b])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var d,f;switch(this.type){case OpenLayers.Filter.Logical.AND:d=0;for(f=this.filters.length;d<f;d++){if(!1==this.filters[d].evaluate(e)){return !1}}return !0;case OpenLayers.Filter.Logical.OR:d=0;for(f=this.filters.length;d<f;d++){if(!0==this.filters[d].evaluate(e)){return !0}}return !1;case OpenLayers.Filter.Logical.NOT:return !this.filters[0].evaluate(e)}},clone:function(){for(var e=[],d=0,f=this.filters.length;d<f;++d){e.push(this.filters[d].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(b){OpenLayers.Filter.prototype.initialize.apply(this,[b]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===b.matchCase&&(this.matchCase=null)},evaluate:function(d){d instanceof OpenLayers.Feature.Vector&&(d=d.attributes);var c=!1,d=d[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()==c.toUpperCase():d==c;break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:c=this.value;c=!this.matchCase&&"string"==typeof d&&"string"==typeof c?d.toUpperCase()!=c.toUpperCase():d!=c;break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:c=RegExp(this.value,"gi").test(d)}return c},value2regex:function(e,d,f){if("."==e){throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")}e=e?e:"*";d=d?d:".";this.value=this.value.replace(RegExp("\\"+(f?f:"!")+"(.|$)","g"),"\\$1");this.value=this.value.replace(RegExp("\\"+d,"g"),".");this.value=this.value.replace(RegExp("\\"+e,"g"),".*");this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+e);return this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+d)},regex2value:function(){var b=this.value,b=b.replace(/!/g,"!!"),b=b.replace(/(\\)?\\\./g,function(d,e){return e?d:"!."}),b=b.replace(/(\\)?\\\*/g,function(d,e){return e?d:"!*"}),b=b.replace(/\\\\/g,"\\");return b=b.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){var c={};this.readers.ogc.Filter.apply(this,[d,c]);return c.filter},readers:{ogc:{_expression:function(e){for(var d="",f=e.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:e=this.readNode(f);e.property?d+="${"+e.property+"}":void 0!==e.value&&(d+=e.value);break;case 3:case 4:d+=f.nodeValue}}return d},Filter:function(e,d){var f={fids:[],filters:[]};this.readChildNodes(e,f);0<f.fids.length?d.filter=new OpenLayers.Filter.FeatureId({fids:f.fids}):0<f.filters.length&&(d.filter=f.filters[0])},FeatureId:function(e,d){var f=e.getAttribute("fid");f&&d.fids.push(f)},And:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,f);d.filters.push(f)},Or:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,f);d.filters.push(f)},Not:function(e,d){var f=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThan:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLessThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsGreaterThanOrEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsBetween:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,f);d.filters.push(f)},Literal:function(d,c){c.value=OpenLayers.String.numericIf(this.getChildValue(d))},PropertyName:function(d,c){c.property=this.getChildValue(d)},LowerBoundary:function(d,c){c.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},UpperBoundary:function(d,c){c.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,d))},Intersects:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(d,c){this.readSpatial(d,c,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(d,c){c.distance=parseInt(this.getChildValue(d));c.distanceUnits=d.getAttribute("units")},Function:function(){}}},readSpatial:function(e,d,f){f=new OpenLayers.Filter.Spatial({type:f});this.readChildNodes(e,f);f.value=f.components[0];delete f.components;d.filters.push(f)},writeOgcExpression:function(e,d){if(e instanceof OpenLayers.Filter.Function){var f=this.writeNode("Function",e,d);d.appendChild(f)}else{this.writeNode("Literal",e,d)}return d},write:function(b){return this.writers.ogc.Filter.apply(this,[b])},writeFeatureIdNodes:function(f,e){for(var h=0,g=f.fids.length;h<g;++h){this.writeNode("FeatureId",f.fids[h],e)}},writers:{ogc:{Filter:function(d){var c=this.createElementNSPlus("ogc:Filter");"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},FeatureId:function(b){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:b}})},And:function(g){for(var f=this.createElementNSPlus("ogc:And"),k,j=0,h=g.filters.length;j<h;++j){k=g.filters[j],"FID"===k.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,k,f):this.writeNode(this.getFilterType(k),k,f)}return f},Or:function(g){for(var f=this.createElementNSPlus("ogc:Or"),k,j=0,h=g.filters.length;j<h;++j){k=g.filters[j],"FID"===k.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,k,f):this.writeNode(this.getFilterType(k),k,f)}return f},Not:function(d){var c=this.createElementNSPlus("ogc:Not"),d=d.filters[0];"FID"===d.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,d,c):this.writeNode(this.getFilterType(d),d,c);return c},PropertyIsLessThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThan:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLessThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsGreaterThanOrEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsBetween:function(d){var c=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",d,c);this.writeNode("LowerBoundary",d,c);this.writeNode("UpperBoundary",d,c);return c},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})},Literal:function(b){return this.createElementNSPlus("ogc:Literal",{value:b})},LowerBoundary:function(d){var c=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(d.lowerBoundary,c);return c},UpperBoundary:function(d){var c=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",d.upperBoundary,c);return c},INTERSECTS:function(b){return this.writeSpatial(b,"Intersects")},WITHIN:function(b){return this.writeSpatial(b,"Within")},CONTAINS:function(b){return this.writeSpatial(b,"Contains")},DWITHIN:function(d){var c=this.writeSpatial(d,"DWithin");this.writeNode("Distance",d,c);return c},Distance:function(b){return this.createElementNSPlus("ogc:Distance",{attributes:{units:b.distanceUnits},value:b.distance})},Function:function(f){for(var e=this.createElementNSPlus("ogc:Function",{attributes:{name:f.name}}),f=f.params,h=0,g=f.length;h<g;h++){this.writeOgcExpression(f[h],e)}return e}}},getFilterType:function(d){var c=this.filterMap[d.type];if(!c){throw"Filter writing not supported for rule type: "+d.type}return c},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(b){b&&(this.bounds=b.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(b){this.getBounds()?this.bounds.extend(b):this.setBounds(b)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(f,e,h){var g=!1;null!=this.getBounds()&&null!=f&&(e=null!=e?e:0,h=null!=h?h:0,g=(new OpenLayers.Bounds(this.bounds.left-e,this.bounds.bottom-h,this.bounds.right+e,this.bounds.top+h)).containsLonLat(f));return g},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(f){var e;if(OpenLayers.Format&&OpenLayers.Format.WKT){var h=OpenLayers.Geometry.fromWKT.format;h||(h=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=h);f=h.read(f);if(f instanceof OpenLayers.Feature.Vector){e=f.geometry}else{if(OpenLayers.Util.isArray(f)){e=f.length;for(var h=Array(e),g=0;g<e;++g){h[g]=f[g].geometry}e=new OpenLayers.Geometry.Collection(h)}}}return e};OpenLayers.Geometry.segmentsIntersect=function(x,w,v){var u=v&&v.point,v=v&&v.tolerance,t=!1,s=x.x1-w.x1,r=x.y1-w.y1,q=x.x2-x.x1,p=x.y2-x.y1,o=w.y2-w.y1,n=w.x2-w.x1,m=o*q-n*p,o=n*r-o*s,r=q*r-p*s;0==m?0==o&&0==r&&(t=!0):(s=o/m,m=r/m,0<=s&&(1>=s&&0<=m&&1>=m)&&(u?(q=x.x1+s*q,m=x.y1+s*p,t=new OpenLayers.Geometry.Point(q,m)):t=!0));if(v){if(t){if(u){x=[x,w];w=0;x:for(;2>w;++w){s=x[w];for(p=1;3>p;++p){if(q=s["x"+p],m=s["y"+p],u=Math.sqrt(Math.pow(q-t.x,2)+Math.pow(m-t.y,2)),u<v){t.x=q;t.y=m;break x}}}}}else{x=[x,w];w=0;x:for(;2>w;++w){q=x[w];m=x[(w+1)%2];for(p=1;3>p;++p){if(s={x:q["x"+p],y:q["y"+p]},r=OpenLayers.Geometry.distanceToSegment(s,m),r.distance<v){t=u?new OpenLayers.Geometry.Point(s.x,s.y):!0;break x}}}}}return t};OpenLayers.Geometry.distanceToSegment=function(v,u){var t=v.x,s=v.y,r=u.x1,q=u.y1,p=u.x2,o=u.y2,n=p-r,m=o-q,l=(n*(t-r)+m*(s-q))/(Math.pow(n,2)+Math.pow(m,2));0>=l||(1<=l?(r=p,q=o):(r+=l*n,q+=l*m));return{distance:Math.sqrt(Math.pow(r-t,2)+Math.pow(q-s,2)),x:r,y:q}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(d,c){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(d);this.y=parseFloat(c)},clone:function(b){null==b&&(b=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(b,this);return b},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(k,j){var q=!(j&&!1===j.edge)&&j&&j.details,p,o,n,m,l;k instanceof OpenLayers.Geometry.Point?(o=this.x,n=this.y,m=k.x,l=k.y,p=Math.sqrt(Math.pow(o-m,2)+Math.pow(n-l,2)),p=!q?p:{x0:o,y0:n,x1:m,y1:l,distance:p}):(p=k.distanceTo(this,j),q&&(p={x0:p.x1,y0:p.y1,x1:p.x0,y1:p.y0,distance:p.distance}));return p},equals:function(d){var c=!1;null!=d&&(c=this.x==d.x&&this.y==d.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(d.x)&&isNaN(d.y));return c},toShortString:function(){return this.x+", "+this.y},move:function(d,c){this.x+=d;this.y+=c;this.clearBounds()},rotate:function(f,e){var f=f*(Math.PI/180),h=this.distanceTo(e),g=f+Math.atan2(this.y-e.y,this.x-e.x);this.x=e.x+h*Math.cos(g);this.y=e.y+h*Math.sin(g);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,d,f){this.x=d.x+e*(void 0==f?1:f)*(this.x-d.x);this.y=d.y+e*(this.y-d.y);this.clearBounds();return this},intersects:function(d){var c=!1;return c="OpenLayers.Geometry.Point"==d.CLASS_NAME?this.equals(d):d.intersects(this)},transform:function(d,c){d&&c&&(OpenLayers.Projection.transform(this,d,c),this.bounds=null);return this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=b&&this.addComponents(b)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;b<c;b++){a.addComponent(this.components[b].clone())}OpenLayers.Util.applyDefaults(a,this);return a},getComponentsString:function(){for(var e=[],d=0,f=this.components.length;d<f;d++){e.push(this.components[d].toShortString())}return e.join(",")},calculateBounds:function(){this.bounds=null;var f=new OpenLayers.Bounds,e=this.components;if(e){for(var h=0,g=e.length;h<g;h++){f.extend(e[h].getBounds())}}null!=f.left&&(null!=f.bottom&&null!=f.right&&null!=f.top)&&this.setBounds(f)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=0,f=e.length;d<f;d++){this.addComponent(e[d])}},addComponent:function(f,e){var h=!1;if(f&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,f.CLASS_NAME))){if(null!=e&&e<this.components.length){var h=this.components.slice(0,e),g=this.components.slice(e,this.components.length);h.push(f);this.components=h.concat(g)}else{this.components.push(f)}f.parent=this;this.clearBounds();h=!0}return h},removeComponents:function(e){var d=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var f=e.length-1;0<=f;--f){d=this.removeComponent(e[f])||d}return d},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();return !0},getLength:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getLength()}return e},getArea:function(){for(var e=0,d=0,f=this.components.length;d<f;d++){e+=this.components[d].getArea()}return e},getGeodesicArea:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicArea(f)}return e},getCentroid:function(r){if(!r){return this.components.length&&this.components[0].getCentroid()}r=this.components.length;if(!r){return !1}for(var q=[],p=[],o=0,n=Number.MAX_VALUE,m,l=0;l<r;++l){m=this.components[l];var k=m.getArea();m=m.getCentroid(!0);!isNaN(k)&&(!isNaN(m.x)&&!isNaN(m.y))&&(q.push(k),o+=k,n=k<n&&0<k?k:n,p.push(m))}r=q.length;if(0===o){for(l=0;l<r;++l){q[l]=1}o=q.length}else{for(l=0;l<r;++l){q[l]/=n}o/=n}for(var j=n=0,l=0;l<r;++l){m=p[l],k=q[l],n+=m.x*k,j+=m.y*k}return new OpenLayers.Geometry.Point(n/o,j/o)},getGeodesicLength:function(f){for(var e=0,h=0,g=this.components.length;h<g;h++){e+=this.components[h].getGeodesicLength(f)}return e},move:function(f,e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g;++h){this.components[h].rotate(f,e)}},resize:function(f,e,h){for(var g=0;g<this.components.length;++g){this.components[g].resize(f,e,h)}return this},distanceTo:function(r,q){for(var p=!(q&&!1===q.edge)&&q&&q.details,o,n,m,l=Number.POSITIVE_INFINITY,k=0,j=this.components.length;k<j&&!(o=this.components[k].distanceTo(r,q),m=p?o.distance:o,m<l&&(l=m,n=o,0==l));++k){}return n},equals:function(f){var e=!0;if(!f||!f.CLASS_NAME||this.CLASS_NAME!=f.CLASS_NAME){e=!1}else{if(!OpenLayers.Util.isArray(f.components)||f.components.length!=this.components.length){e=!1}else{for(var h=0,g=this.components.length;h<g;++h){if(!this.components[h].equals(f.components[h])){e=!1;break}}}}return e},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g;h++){this.components[h].transform(f,e)}this.bounds=null}return this},intersects:function(f){for(var e=!1,h=0,g=this.components.length;h<g&&!(e=f.intersects(this.components[h]));++h){}return e},getVertices:function(f){for(var e=[],h=0,g=this.components.length;h<g;++h){Array.prototype.push.apply(e,this.components[h].getVertices(f))}return e},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(d,c){this.addComponent(d,c)},removePoint:function(b){this.removeComponent(b)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length){for(var d=1,f=this.components.length;d<f;d++){e+=this.components[d-1].distanceTo(this.components[d])}}return e},getGeodesicLength:function(h){var g=this;if(h){var m=new OpenLayers.Projection("EPSG:4326");m.equals(h)||(g=this.clone().transform(h,m))}h=0;if(g.components&&1<g.components.length){for(var l,k=1,j=g.components.length;k<j;k++){m=g.components[k-1],l=g.components[k],h+=OpenLayers.Util.distVincenty({lon:m.x,lat:m.y},{lon:l.x,lat:l.y})}}return 1000*h},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(d){var c=this.components&&2<this.components.length;c&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return c},intersects:function(D){var C=!1,B=D.CLASS_NAME;if("OpenLayers.Geometry.LineString"==B||"OpenLayers.Geometry.LinearRing"==B||"OpenLayers.Geometry.Point"==B){var A=this.getSortedSegments(),D="OpenLayers.Geometry.Point"==B?[{x1:D.x,y1:D.y,x2:D.x,y2:D.y}]:D.getSortedSegments(),z,y,x,w,v,u,t,s=0,r=A.length;D:for(;s<r;++s){B=A[s];z=B.x1;y=B.x2;x=B.y1;w=B.y2;var q=0,p=D.length;for(;q<p;++q){v=D[q];if(v.x1>y){break}if(!(v.x2<z)&&(u=v.y1,t=v.y2,!(Math.min(u,t)>Math.max(x,w))&&!(Math.max(u,t)<Math.min(x,w))&&OpenLayers.Geometry.segmentsIntersect(B,v))){C=!0;break D}}}}else{C=D.intersects(this)}return C},getSortedSegments:function(){for(var g=this.components.length-1,f=Array(g),k,j,h=0;h<g;++h){k=this.components[h],j=this.components[h+1],f[h]=k.x<j.x?{x1:k.x,y1:k.y,x2:j.x,y2:j.y}:{x1:j.x,y1:j.y,x2:k.x,y2:k.y}}return f.sort(function(d,c){return d.x1-c.x1})},splitWithSegment:function(J,I){for(var H=!(I&&!1===I.edge),G=I&&I.tolerance,F=[],E=this.getVertices(),D=[],C=[],B=!1,A,z,y,x={point:!0,tolerance:G},w=null,v=0,u=E.length-2;v<=u;++v){if(G=E[v],D.push(G.clone()),A=E[v+1],z={x1:G.x,y1:G.y,x2:A.x,y2:A.y},z=OpenLayers.Geometry.segmentsIntersect(J,z,x),z instanceof OpenLayers.Geometry.Point&&((y=z.x===J.x1&&z.y===J.y1||z.x===J.x2&&z.y===J.y2||z.equals(G)||z.equals(A)?!0:!1)||H)){z.equals(C[C.length-1])||C.push(z.clone()),!(0===v&&z.equals(G))&&!z.equals(A)&&(B=!0,z.equals(G)||D.push(z),F.push(new OpenLayers.Geometry.LineString(D)),D=[z.clone()])}}B&&(D.push(A.clone()),F.push(new OpenLayers.Geometry.LineString(D)));if(0<C.length){var t=J.x1<J.x2?1:-1,s=J.y1<J.y2?1:-1,w={lines:F,points:C.sort(function(d,c){return t*d.x-t*c.x||s*d.y-s*c.y})}}return w},split:function(N,M){var L=null,K=M&&M.mutual,J,I,H,G;if(N instanceof OpenLayers.Geometry.LineString){var F=this.getVertices(),E,D,C,B,A,z=[];H=[];for(var y=0,x=F.length-2;y<=x;++y){E=F[y];D=F[y+1];C={x1:E.x,y1:E.y,x2:D.x,y2:D.y};G=G||[N];K&&z.push(E.clone());for(var w=0;w<G.length;++w){if(B=G[w].splitWithSegment(C,M)){if(A=B.lines,0<A.length&&(A.unshift(w,1),Array.prototype.splice.apply(G,A),w+=A.length-2),K){for(var v=0,u=B.points.length;v<u;++v){A=B.points[v],A.equals(E)||(z.push(A),H.push(new OpenLayers.Geometry.LineString(z)),z=A.equals(D)?[]:[A.clone()])}}}}}K&&(0<H.length&&0<z.length)&&(z.push(D.clone()),H.push(new OpenLayers.Geometry.LineString(z)))}else{L=N.splitWith(this,M)}G&&1<G.length?I=!0:G=[];H&&1<H.length?J=!0:H=[];if(I||J){L=K?[H,G]:G}return L},splitWith:function(d,c){return d.split(this,c)},getVertices:function(b){return !0===b?[this.components[0],this.components[this.components.length-1]]:!1===b?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(H,G){var F=!(G&&!1===G.edge)&&G&&G.details,E,D={},C=Number.POSITIVE_INFINITY;if(H instanceof OpenLayers.Geometry.Point){for(var B=this.getSortedSegments(),A=H.x,z=H.y,y,x=0,w=B.length;x<w;++x){if(y=B[x],E=OpenLayers.Geometry.distanceToSegment(H,y),E.distance<C){if(C=E.distance,D=E,0===C){break}}else{if(y.x2>A&&(z>y.y1&&z<y.y2||z<y.y1&&z>y.y2)){break}}}D=F?{distance:D.distance,x0:D.x,y0:D.y,x1:A,y1:z}:D.distance}else{if(H instanceof OpenLayers.Geometry.LineString){var B=this.getSortedSegments(),A=H.getSortedSegments(),v,u,t=A.length,s={point:!0},x=0,w=B.length;H:for(;x<w;++x){z=B[x];y=z.x1;u=z.y1;for(var r=0;r<t;++r){if(E=A[r],v=OpenLayers.Geometry.segmentsIntersect(z,E,s)){C=0;D={distance:0,x0:v.x,y0:v.y,x1:v.x,y1:v.y};break H}else{E=OpenLayers.Geometry.distanceToSegment({x:y,y:u},E),E.distance<C&&(C=E.distance,D={distance:C,x0:y,y0:u,x1:E.x,y1:E.y})}}}F||(D=D.distance);0!==C&&z&&(E=H.distanceTo(new OpenLayers.Geometry.Point(z.x2,z.y2),G),x=F?E.distance:E,x<C&&(D=F?{distance:C,x0:E.x1,y0:E.y1,x1:E.x0,y1:E.y0}:x))}else{D=H.distanceTo(this,G),F&&(D={distance:D.distance,x0:D.x1,y0:D.y1,x1:D.x0,y1:D.y0})}}return D},simplify:function(g){if(this&&null!==this){var f=this.getVertices();if(3>f.length){return this}var k=function(w,v,u,t){for(var s=0,r=0,q=v,p;q<u;q++){p=w[v];var e=w[u],c=w[q],c=Math.abs(0.5*(p.x*e.y+e.x*c.y+c.x*p.y-e.x*p.y-c.x*e.y-p.x*c.y));p=Math.sqrt(Math.pow(p.x-e.x,2)+Math.pow(p.y-e.y,2));p=2*(c/p);p>s&&(s=p,r=q)}s>t&&r!=v&&(h.push(r),k(w,v,r,t),k(w,r,u,t))},j=f.length-1,h=[];h.push(0);for(h.push(j);f[0].equals(f[j]);){j--,h.push(j)}k(f,0,j,g);g=[];h.sort(function(d,c){return d-c});for(j=0;j<h.length;j++){g.push(f[h[j]])}return new OpenLayers.Geometry.LineString(g)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(D,C){for(var B=null,A=C&&C.mutual,z,y,x,w,v=[],u=[D],t=0,s=this.components.length;t<s;++t){y=this.components[t];x=!1;for(var r=0;r<u.length;++r){if(z=y.split(u[r],C)){if(A){x=z[0];for(var q=0,p=x.length;q<p;++q){0===q&&v.length?v[v.length-1].addComponent(x[q]):v.push(new OpenLayers.Geometry.MultiLineString([x[q]]))}x=!0;z=z[1]}if(z.length){z.unshift(r,1);Array.prototype.splice.apply(u,z);break}}}x||(v.length?v[v.length-1].addComponent(y.clone()):v=[new OpenLayers.Geometry.MultiLineString(y.clone())])}v&&1<v.length?x=!0:v=[];u&&1<u.length?w=!0:u=[];if(x||w){B=A?[v,u]:u}return B},splitWith:function(B,A){var z=null,y=A&&A.mutual,x,w,v,u,t,s;if(B instanceof OpenLayers.Geometry.LineString){s=[];t=[B];for(var r=0,q=this.components.length;r<q;++r){v=!1;w=this.components[r];for(var p=0;p<t.length;++p){if(x=t[p].split(w,A)){y&&(v=x[0],v.length&&(v.unshift(p,1),Array.prototype.splice.apply(t,v),p+=v.length-2),x=x[1],0===x.length&&(x=[w.clone()]));v=0;for(var o=x.length;v<o;++v){0===v&&s.length?s[s.length-1].addComponent(x[v]):s.push(new OpenLayers.Geometry.MultiLineString([x[v]]))}v=!0}}v||(s.length?s[s.length-1].addComponent(w.clone()):s=[new OpenLayers.Geometry.MultiLineString([w.clone()])])}}else{z=B.split(this)}t&&1<t.length?u=!0:t=[];s&&1<s.length?v=!0:s=[];if(u||v){z=y?[t,s]:s}return z},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(f,e){var h=!1,g=this.components.pop();if(null!=e||!f.equals(g)){h=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]);return h},removeComponent:function(d){var c=this.components&&3<this.components.length;c&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]));return c},move:function(f,e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].move(f,e)}},rotate:function(f,e){for(var h=0,g=this.components.length;h<g-1;++h){this.components[h].rotate(f,e)}},resize:function(g,f,k){for(var j=0,h=this.components.length;j<h-1;++j){this.components[j].resize(g,f,k)}return this},transform:function(f,e){if(f&&e){for(var h=0,g=this.components.length;h<g-1;h++){this.components[h].transform(f,e)}this.bounds=null}return this},getCentroid:function(){if(this.components&&2<this.components.length){for(var g=0,f=0,k=0;k<this.components.length-1;k++){var j=this.components[k],h=this.components[k+1],g=g+(j.x+h.x)*(j.x*h.y-h.x*j.y),f=f+(j.y+h.y)*(j.x*h.y-h.x*j.y)}k=-1*this.getArea();return new OpenLayers.Geometry.Point(g/(6*k),f/(6*k))}return null},getArea:function(){var g=0;if(this.components&&2<this.components.length){for(var f=g=0,k=this.components.length;f<k-1;f++){var j=this.components[f],h=this.components[f+1],g=g+(j.x+h.x)*(h.y-j.y)}g=-g/2}return g},getGeodesicArea:function(h){var g=this;if(h){var m=new OpenLayers.Projection("EPSG:4326");m.equals(h)||(g=this.clone().transform(h,m))}h=0;m=g.components&&g.components.length;if(2<m){for(var l,k,j=0;j<m-1;j++){l=g.components[j],k=g.components[j+1],h+=OpenLayers.Util.rad(k.x-l.x)*(2+Math.sin(OpenLayers.Util.rad(l.y))+Math.sin(OpenLayers.Util.rad(k.y)))}h=40680631590769*h/2}return h},containsPoint:function(v){for(var u=OpenLayers.Number.limitSigDigs,t=u(v.x,14),v=u(v.y,14),s=this.components.length-1,r,q,p,o,n,m=0,l=0;l<s;++l){if(r=this.components[l],p=u(r.x,14),r=u(r.y,14),q=this.components[l+1],o=u(q.x,14),q=u(q.y,14),r==q){if(v==r&&(p<=o&&t>=p&&t<=o||p>=o&&t<=p&&t>=o)){m=-1;break}}else{n=u((v-q)*((o-p)/(q-r))+o,14);if(n==t&&(r<q&&v>=r&&v<=q||r>q&&v<=r&&v>=q)){m=-1;break}n<=t||p!=o&&(n<Math.min(p,o)||n>Math.max(p,o))||(r<q&&v>=r&&v<q||r>q&&v<r&&v>=q)&&++m}}return -1==m?1:!!(m&1)},intersects:function(f){var e=!1;if("OpenLayers.Geometry.Point"==f.CLASS_NAME){e=this.containsPoint(f)}else{if("OpenLayers.Geometry.LineString"==f.CLASS_NAME){e=f.intersects(this)}else{if("OpenLayers.Geometry.LinearRing"==f.CLASS_NAME){e=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[f])}else{for(var h=0,g=f.components.length;h<g&&!(e=f.components[h].intersects(this));++h){}}}}return e},getVertices:function(b){return !0===b?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getArea()),d=1,f=this.components.length;d<f;d++){e-=Math.abs(this.components[d].getArea())}}return e},getGeodesicArea:function(f){var e=0;if(this.components&&0<this.components.length){for(var e=e+Math.abs(this.components[0].getGeodesicArea(f)),h=1,g=this.components.length;h<g;h++){e-=Math.abs(this.components[h].getGeodesicArea(f))}}return e},containsPoint:function(g){var f=this.components.length,k=!1;if(0<f&&(k=this.components[0].containsPoint(g),1!==k&&k&&1<f)){for(var j,h=1;h<f;++h){if(j=this.components[h].containsPoint(g)){k=1===j?1:!1;break}}}return k},intersects:function(g){var f=!1,k,j;if("OpenLayers.Geometry.Point"==g.CLASS_NAME){f=this.containsPoint(g)}else{if("OpenLayers.Geometry.LineString"==g.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==g.CLASS_NAME){k=0;for(j=this.components.length;k<j&&!(f=g.intersects(this.components[k]));++k){}if(!f){k=0;for(j=g.components.length;k<j&&!(f=this.containsPoint(g.components[k]));++k){}}}else{k=0;for(j=g.components.length;k<j&&!(f=this.intersects(g.components[k]));++k){}}}if(!f&&"OpenLayers.Geometry.Polygon"==g.CLASS_NAME){var h=this.components[0];k=0;for(j=h.components.length;k<j&&!(f=g.containsPoint(h.components[k]));++k){}}return f},distanceTo:function(d,c){return c&&!1===c.edge&&this.intersects(d)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[d,c])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(k,j,q,p){var o=Math.PI*(1/q-0.5);p&&(o+=p/180*Math.PI);for(var n,m=[],l=0;l<q;++l){n=o+2*l*Math.PI/q,p=k.x+j*Math.cos(n),n=k.y+j*Math.sin(n),m.push(new OpenLayers.Geometry.Point(p,n))}k=new OpenLayers.Geometry.LinearRing(m);return new OpenLayers.Geometry.Polygon([k])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));for(var f=this.getElementsByTagNameNS(f.documentElement,this.gmlns,this.featureName),e=[],h=0;h<f.length;h++){var g=this.parseFeature(f[h]);g&&e.push(g)}return e},parseFeature:function(r){for(var q="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),p,o,n,m=0;m<q.length;++m){if(p=q[m],o=this.getElementsByTagNameNS(r,this.gmlns,p),0<o.length){if(n=this.parseGeometry[p.toLowerCase()]){n=n.apply(this,[o[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+p)}break}}var l;p=this.getElementsByTagNameNS(r,this.gmlns,"Box");for(m=0;m<p.length;++m){q=p[m],o=this.parseGeometry.box.apply(this,[q]),q=q.parentNode,"boundedBy"===(q.localName||q.nodeName.split(":").pop())?l=o:n=o.toGeometry()}var k;this.extractAttributes&&(k=this.parseAttributes(r));k=new OpenLayers.Feature.Vector(n,k);k.bounds=l;k.gml={featureType:r.firstChild.nodeName.split(":")[1],featureNS:r.firstChild.namespaceURI,featureNSPrefix:r.firstChild.prefix};for(var r=r.firstChild,j;r&&!(1==r.nodeType&&(j=r.getAttribute("fid")||r.getAttribute("id")));){r=r.nextSibling}k.fid=j;return k},parseGeometry:{point:function(e){var d,f;f=[];d=this.getElementsByTagNameNS(e,this.gmlns,"pos");0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.trimSpace,""),f=f.split(this.regExes.splitSpace));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),0<d.length&&(f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),f=f.split(",")));0==f.length&&(d=this.getElementsByTagNameNS(e,this.gmlns,"coord"),0<d.length&&(e=this.getElementsByTagNameNS(d[0],this.gmlns,"X"),d=this.getElementsByTagNameNS(d[0],this.gmlns,"Y"),0<e.length&&0<d.length&&(f=[e[0].firstChild.nodeValue,d[0].firstChild.nodeValue])));2==f.length&&(f[2]=null);return this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2])},multipoint:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Point"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.point.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPoint(e)},linestring:function(r,q){var p,o;o=[];var n=[];p=this.getElementsByTagNameNS(r,this.gmlns,"posList");if(0<p.length){o=this.getChildValue(p[0]);o=o.replace(this.regExes.trimSpace,"");o=o.split(this.regExes.splitSpace);var m=parseInt(p[0].getAttribute("dimension")),l,k,j;for(p=0;p<o.length/m;++p){l=p*m,k=o[l],j=o[l+1],l=2==m?null:o[l+2],this.xy?n.push(new OpenLayers.Geometry.Point(k,j,l)):n.push(new OpenLayers.Geometry.Point(j,k,l))}}if(0==o.length&&(p=this.getElementsByTagNameNS(r,this.gmlns,"coordinates"),0<p.length)){o=this.getChildValue(p[0]);o=o.replace(this.regExes.trimSpace,"");o=o.replace(this.regExes.trimComma,",");m=o.split(this.regExes.splitSpace);for(p=0;p<m.length;++p){o=m[p].split(","),2==o.length&&(o[2]=null),this.xy?n.push(new OpenLayers.Geometry.Point(o[0],o[1],o[2])):n.push(new OpenLayers.Geometry.Point(o[1],o[0],o[2]))}}o=null;0!=n.length&&(o=q?new OpenLayers.Geometry.LinearRing(n):new OpenLayers.Geometry.LineString(n));return o},multilinestring:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LineString"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiLineString(e)},polygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"LinearRing"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.linestring.apply(this,[f[g],!0]))&&e.push(h)}}return new OpenLayers.Geometry.Polygon(e)},multipolygon:function(f){var f=this.getElementsByTagNameNS(f,this.gmlns,"Polygon"),e=[];if(0<f.length){for(var h,g=0;g<f.length;++g){(h=this.parseGeometry.polygon.apply(this,[f[g]]))&&e.push(h)}}return new OpenLayers.Geometry.MultiPolygon(e)},envelope:function(j){var h=[],o,n,m=this.getElementsByTagNameNS(j,this.gmlns,"lowerCorner");if(0<m.length){o=[];0<m.length&&(o=m[0].firstChild.nodeValue,o=o.replace(this.regExes.trimSpace,""),o=o.split(this.regExes.splitSpace));2==o.length&&(o[2]=null);var l=this.xy?new OpenLayers.Geometry.Point(o[0],o[1],o[2]):new OpenLayers.Geometry.Point(o[1],o[0],o[2])}j=this.getElementsByTagNameNS(j,this.gmlns,"upperCorner");if(0<j.length){o=[];0<j.length&&(o=j[0].firstChild.nodeValue,o=o.replace(this.regExes.trimSpace,""),o=o.split(this.regExes.splitSpace));2==o.length&&(o[2]=null);var k=this.xy?new OpenLayers.Geometry.Point(o[0],o[1],o[2]):new OpenLayers.Geometry.Point(o[1],o[0],o[2])}l&&k&&(h.push(new OpenLayers.Geometry.Point(l.x,l.y)),h.push(new OpenLayers.Geometry.Point(k.x,l.y)),h.push(new OpenLayers.Geometry.Point(k.x,k.y)),h.push(new OpenLayers.Geometry.Point(l.x,k.y)),h.push(new OpenLayers.Geometry.Point(l.x,l.y)),h=new OpenLayers.Geometry.LinearRing(h),n=new OpenLayers.Geometry.Polygon([h]));return n},box:function(e){var d=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),f=e=null;0<d.length&&(d=d[0].firstChild.nodeValue,d=d.split(" "),2==d.length&&(e=d[0].split(","),f=d[1].split(",")));if(null!==e&&null!==f){return new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1]))}}},parseAttributes:function(g){for(var f={},g=g.firstChild,k,j,h;g;){if(1==g.nodeType){g=g.childNodes;for(k=0;k<g.length;++k){if(j=g[k],1==j.nodeType){if(h=j.childNodes,1==h.length){if(h=h[0],3==h.nodeType||4==h.nodeType){j=j.prefix?j.nodeName.split(":")[1]:j.nodeName,h=h.nodeValue.replace(this.regExes.trimSpace,""),f[j]=h}}else{f[j.nodeName.split(":").pop()]=null}}}break}g=g.nextSibling}return f},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var d=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),f=0;f<e.length;f++){d.appendChild(this.createFeatureXML(e[f]))}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(h){var g=this.buildGeometryNode(h.geometry),m=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);m.appendChild(g);var g=this.createElementNS(this.gmlns,"gml:"+this.featureName),l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);l.setAttribute("fid",h.fid||h.id);l.appendChild(m);for(var k in h.attributes){var m=this.createTextNode(h.attributes[k]),j=this.createElementNS(this.featureNS,this.featurePrefix+":"+k.substring(k.lastIndexOf(":")+1));j.appendChild(m);l.appendChild(j)}g.appendChild(l);return g},buildGeometryNode:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME;return this.buildGeometry[c.substring(c.lastIndexOf(".")+1).toLowerCase()].apply(this,[d])},buildGeometry:{point:function(d){var c=this.createElementNS(this.gmlns,"gml:Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPoint"),g=g.components,k,j,h=0;h<g.length;h++){k=this.createElementNS(this.gmlns,"gml:pointMember"),j=this.buildGeometry.point.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},linestring:function(d){var c=this.createElementNS(this.gmlns,"gml:LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiLineString"),g=g.components,k,j,h=0;h<g.length;++h){k=this.createElementNS(this.gmlns,"gml:lineStringMember"),j=this.buildGeometry.linestring.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},linearring:function(d){var c=this.createElementNS(this.gmlns,"gml:LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:Polygon"),g=g.components,k,j,h=0;h<g.length;++h){k=0==h?"outerBoundaryIs":"innerBoundaryIs",k=this.createElementNS(this.gmlns,"gml:"+k),j=this.buildGeometry.linearring.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},multipolygon:function(g){for(var f=this.createElementNS(this.gmlns,"gml:MultiPolygon"),g=g.components,k,j,h=0;h<g.length;++h){k=this.createElementNS(this.gmlns,"gml:polygonMember"),j=this.buildGeometry.polygon.apply(this,[g[h]]),k.appendChild(j),f.appendChild(k)}return f},bounds:function(d){var c=this.createElementNS(this.gmlns,"gml:Box");c.appendChild(this.buildCoordinatesNode(d));return c}},buildCoordinatesNode:function(f){var e=this.createElementNS(this.gmlns,"gml:coordinates");e.setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");var h=[];if(f instanceof OpenLayers.Bounds){h.push(f.left+","+f.bottom),h.push(f.right+","+f.top)}else{for(var f=f.components?f.components:[f],g=0;g<f.length;g++){h.push(f[g].x+","+f[g].y)}}h=this.createTextNode(h.join(" "));e.appendChild(h);return e},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.setGeometryTypes();b&&b.featureNS&&this.setNamespace("feature",b.featureNS);this.singleFeatureType=!b||typeof b.featureType==="string"},read:function(f){typeof f=="string"&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));if(f&&f.nodeType==9){f=f.documentElement}var e=[];this.readNode(f,{features:e},true);if(e.length==0){var h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember");if(h.length){for(var f=0,g=h.length;f<g;++f){this.readNode(h[f],{features:e},true)}}else{h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMembers");h.length&&this.readNode(h[0],{features:e},true)}}return e},readNode:function(e,d,f){if(f===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=true}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,d])},readers:{gml:{featureMember:function(d,c){this.readChildNodes(d,c)},featureMembers:function(d,c){this.readChildNodes(d,c)},name:function(d,c){c.name=this.getChildValue(d)},boundedBy:function(e,d){var f={};this.readChildNodes(e,f);if(f.components&&f.components.length>0){d.bounds=f.components[0]}},Point:function(e,d){var f={points:[]};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(f.points[0])},coordinates:function(j,h){for(var o=this.getChildValue(j).replace(this.regExes.trimSpace,""),o=o.replace(this.regExes.trimComma,","),o=o.split(this.regExes.splitSpace),n,m=o.length,l=Array(m),k=0;k<m;++k){n=o[k].split(",");l[k]=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])}h.points=l},coord:function(e,d){var f={};this.readChildNodes(e,f);if(!d.points){d.points=[]}d.points.push(new OpenLayers.Geometry.Point(f.x,f.y,f.z))},X:function(d,c){c.x=this.getChildValue(d)},Y:function(d,c){c.y=this.getChildValue(d)},Z:function(d,c){c.z=this.getChildValue(d)},MultiPoint:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPoint(f.components)]},pointMember:function(d,c){this.readChildNodes(d,c)},LineString:function(e,d){var f={};this.readChildNodes(e,f);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.LineString(f.points))},MultiLineString:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiLineString(f.components)]},lineStringMember:function(d,c){this.readChildNodes(d,c)},Polygon:function(e,d){var f={outer:null,inner:[]};this.readChildNodes(e,f);f.inner.unshift(f.outer);if(!d.components){d.components=[]}d.components.push(new OpenLayers.Geometry.Polygon(f.inner))},LinearRing:function(e,d){var f={};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.LinearRing(f.points)]},MultiPolygon:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.MultiPolygon(f.components)]},polygonMember:function(d,c){this.readChildNodes(d,c)},GeometryCollection:function(e,d){var f={components:[]};this.readChildNodes(e,f);d.components=[new OpenLayers.Geometry.Collection(f.components)]},geometryMember:function(d,c){this.readChildNodes(d,c)}},feature:{"*":function(f,e){var h,g=f.localName||f.nodeName.split(":").pop();e.features?!this.singleFeatureType&&OpenLayers.Util.indexOf(this.featureType,g)!==-1?h="_typeName":g===this.featureType&&(h="_typeName"):f.childNodes.length==0||f.childNodes.length==1&&f.firstChild.nodeType==3?this.extractAttributes&&(h="_attribute"):h="_geometry";h&&this.readers.feature[h].apply(this,[f,e])},_typeName:function(g,f){var k={components:[],attributes:{}};this.readChildNodes(g,k);if(k.name){k.attributes.name=k.name}var j=new OpenLayers.Feature.Vector(k.components[0],k.attributes);if(!this.singleFeatureType){j.type=g.nodeName.split(":").pop();j.namespace=g.namespaceURI}var h=g.getAttribute("fid")||this.getAttributeNS(g,this.namespaces.gml,"id");if(h){j.fid=h}this.internalProjection&&(this.externalProjection&&j.geometry)&&j.geometry.transform(this.externalProjection,this.internalProjection);if(k.bounds){j.bounds=k.bounds}f.features.push(j)},_geometry:function(d,c){if(!this.geometryName){this.geometryName=d.nodeName.split(":").pop()}this.readChildNodes(d,c)},_attribute:function(f,e){var h=f.localName||f.nodeName.split(":").pop(),g=this.getChildValue(f);e.attributes[h]=g}},wfs:{FeatureCollection:function(d,c){this.readChildNodes(d,c)}}},write:function(b){b=this.writeNode("gml:"+(OpenLayers.Util.isArray(b)?"featureMembers":"featureMember"),b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:{featureMember:function(d){var c=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",d,c);return c},MultiPoint:function(f){for(var e=this.createElementNSPlus("gml:MultiPoint"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("pointMember",f[h],e)}return e},pointMember:function(d){var c=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",d,c);return c},MultiLineString:function(f){for(var e=this.createElementNSPlus("gml:MultiLineString"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("lineStringMember",f[h],e)}return e},lineStringMember:function(d){var c=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",d,c);return c},MultiPolygon:function(f){for(var e=this.createElementNSPlus("gml:MultiPolygon"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("polygonMember",f[h],e)}return e},polygonMember:function(d){var c=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",d,c);return c},GeometryCollection:function(f){for(var e=this.createElementNSPlus("gml:GeometryCollection"),h=0,g=f.components.length;h<g;++h){this.writeNode("geometryMember",f.components[h],e)}return e},geometryMember:function(d){var c=this.createElementNSPlus("gml:geometryMember"),d=this.writeNode("feature:_geometry",d);c.appendChild(d.firstChild);return c}},feature:{_typeName:function(f){var e=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:f.fid}});f.geometry&&this.writeNode("feature:_geometry",f.geometry,e);for(var h in f.attributes){var g=f.attributes[h];g!=null&&this.writeNode("feature:_attribute",{name:h,value:g},e)}return e},_geometry:function(d){this.externalProjection&&this.internalProjection&&(d=d.clone().transform(this.internalProjection,this.externalProjection));var c=this.createElementNSPlus("feature:"+this.geometryName),d=this.writeNode("gml:"+this.geometryTypes[d.CLASS_NAME],d,c);this.srsName&&d.setAttribute("srsName",this.srsName);return c},_attribute:function(b){return this.createElementNSPlus("feature:"+b.name,{value:b.value})}},wfs:{FeatureCollection:function(f){for(var e=this.createElementNSPlus("wfs:FeatureCollection"),h=0,g=f.length;h<g;++h){this.writeNode("gml:featureMember",f[h],e)}return e}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(d,c){this.readChildNodes(d,c)},Curve:function(e,d){var f={points:[]};this.readChildNodes(e,f);d.components||(d.components=[]);d.components.push(new OpenLayers.Geometry.LineString(f.points))},segments:function(d,c){this.readChildNodes(d,c)},LineStringSegment:function(e,d){var f={};this.readChildNodes(e,f);f.points&&Array.prototype.push.apply(d.points,f.points)},pos:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),f=this.xy?new OpenLayers.Geometry.Point(f[0],f[1],f[2]):new OpenLayers.Geometry.Point(f[1],f[0],f[2]);d.points=[f]},posList:function(t,s){for(var r=this.getChildValue(t).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),q=parseInt(t.getAttribute("dimension"))||2,p,o,n,m=Array(r.length/q),l=0,k=r.length;l<k;l+=q){p=r[l],o=r[l+1],n=2==q?void 0:r[l+2],m[l/q]=this.xy?new OpenLayers.Geometry.Point(p,o,n):new OpenLayers.Geometry.Point(o,p,n)}s.points=m},Surface:function(d,c){this.readChildNodes(d,c)},patches:function(d,c){this.readChildNodes(d,c)},PolygonPatch:function(d,c){this.readers.gml.Polygon.apply(this,[d,c])},exterior:function(e,d){var f={};this.readChildNodes(e,f);d.outer=f.components[0]},interior:function(e,d){var f={};this.readChildNodes(e,f);d.inner.push(f.components[0])},MultiCurve:function(e,d){var f={components:[]};this.readChildNodes(e,f);0<f.components.length&&(d.components=[new OpenLayers.Geometry.MultiLineString(f.components)])},curveMember:function(d,c){this.readChildNodes(d,c)},MultiSurface:function(e,d){var f={components:[]};this.readChildNodes(e,f);0<f.components.length&&(d.components=[new OpenLayers.Geometry.MultiPolygon(f.components)])},surfaceMember:function(d,c){this.readChildNodes(d,c)},surfaceMembers:function(d,c){this.readChildNodes(d,c)},pointMembers:function(d,c){this.readChildNodes(d,c)},lineStringMembers:function(d,c){this.readChildNodes(d,c)},polygonMembers:function(d,c){this.readChildNodes(d,c)},geometryMembers:function(d,c){this.readChildNodes(d,c)},Envelope:function(f,e){var h={points:Array(2)};this.readChildNodes(f,h);e.components||(e.components=[]);var g=h.points[0],h=h.points[1];e.components.push(new OpenLayers.Bounds(g.x,g.y,h.x,h.y))},lowerCorner:function(e,d){var f={};this.readers.gml.pos.apply(this,[e,f]);d.points[0]=f.points[0]},upperCorner:function(e,d){var f={};this.readers.gml.pos.apply(this,[e,f]);d.points[1]=f.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){b=this.writeNode("gml:"+(OpenLayers.Util.isArray(b)?"featureMembers":"featureMember"),b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(f){for(var e=this.createElementNSPlus("gml:featureMembers"),h=0,g=f.length;h<g;++h){this.writeNode("feature:_typeName",f[h],e)}return e},Point:function(d){var c=this.createElementNSPlus("gml:Point");this.writeNode("pos",d,c);return c},pos:function(b){return this.createElementNSPlus("gml:pos",{value:this.xy?b.x+" "+b.y:b.y+" "+b.x})},LineString:function(d){var c=this.createElementNSPlus("gml:LineString");this.writeNode("posList",d.components,c);return c},Curve:function(d){var c=this.createElementNSPlus("gml:Curve");this.writeNode("segments",d,c);return c},segments:function(d){var c=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",d,c);return c},LineStringSegment:function(d){var c=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",d.components,c);return c},posList:function(g){for(var f=g.length,k=Array(f),j,h=0;h<f;++h){j=g[h],k[h]=this.xy?j.x+" "+j.y:j.y+" "+j.x}return this.createElementNSPlus("gml:posList",{value:k.join(" ")})},Surface:function(d){var c=this.createElementNSPlus("gml:Surface");this.writeNode("patches",d,c);return c},patches:function(d){var c=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",d,c);return c},PolygonPatch:function(f){var e=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",f.components[0],e);for(var h=1,g=f.components.length;h<g;++h){this.writeNode("interior",f.components[h],e)}return e},Polygon:function(f){var e=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",f.components[0],e);for(var h=1,g=f.components.length;h<g;++h){this.writeNode("interior",f.components[h],e)}return e},exterior:function(d){var c=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",d,c);return c},interior:function(d){var c=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",d,c);return c},LinearRing:function(d){var c=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",d.components,c);return c},MultiCurve:function(f){for(var e=this.createElementNSPlus("gml:MultiCurve"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("curveMember",f[h],e)}return e},curveMember:function(d){var c=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",d,c):this.writeNode("LineString",d,c);return c},MultiSurface:function(f){for(var e=this.createElementNSPlus("gml:MultiSurface"),f=f.components||[f],h=0,g=f.length;h<g;++h){this.writeNode("surfaceMember",f[h],e)}return e},surfaceMember:function(d){var c=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",d,c):this.writeNode("Polygon",d,c);return c},Envelope:function(d){var c=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",d,c);this.writeNode("upperCorner",d,c);this.srsName&&c.setAttribute("srsName",this.srsName);return c},lowerCorner:function(b){return this.createElementNSPlus("gml:lowerCorner",{value:this.xy?b.left+" "+b.bottom:b.bottom+" "+b.left})},upperCorner:function(b){return this.createElementNSPlus("gml:upperCorner",{value:this.xy?b.right+" "+b.top:b.top+" "+b.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,d){var f=e.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsNotEqualTo:function(e,d){var f=e.getAttribute("matchCase"),f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===f||"0"===f)});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLike:function(h,g){var m=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(h,m);var l=h.getAttribute("wildCard"),k=h.getAttribute("singleChar"),j=h.getAttribute("escapeChar");m.value2regex(l,k,j);g.filters.push(m)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:d.matchCase}});this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsNotEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:d.matchCase}});this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLike:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:d.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",d,c);this.writeNode("Literal",d.regex2value(),c);return c},BBOX:function(e){var d=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,d);var f=this.writeNode("gml:Envelope",e.value);e.projection&&f.setAttribute("srsName",e.projection);d.appendChild(f);return d},SortBy:function(f){for(var e=this.createElementNSPlus("ogc:SortBy"),h=0,g=f.length;h<g;h++){this.writeNode("ogc:SortProperty",f[h],e)}return e},SortProperty:function(d){var c=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",d,c);this.writeNode("ogc:SortOrder","DESC"==d.order?"DESC":"ASC",c);return c},SortOrder:function(b){return this.createElementNSPlus("ogc:SortOrder",{value:b})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(f,e){var h=this.createElementNSPlus("ogc:"+e);this.writeNode("PropertyName",f,h);if(f.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",f.value,h)}else{var g;g=f.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",f.value).firstChild:this.writeNode("gml:Envelope",f.value);f.projection&&g.setAttribute("srsName",f.projection);h.appendChild(g)}return h},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(d){var c=this.version;c||((d=d.getAttribute("xmlns:ows"))&&"1.1"===d.substring(d.lastIndexOf("/")+1)&&(c="1.1.0"),c||(c=this.defaultVersion));return c},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,d){OpenLayers.Util.applyDefaults(d,this.options);var f={};this.readChildNodes(e,f);return f},readers:{ows:{Exception:function(e,d){var f={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};d.exceptions.push(f);this.readChildNodes(e,f)},ExceptionText:function(e,d){var f=this.getChildValue(e);d.texts.push(f)},ServiceIdentification:function(d,c){c.serviceIdentification={};this.readChildNodes(d,c.serviceIdentification)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c["abstract"]=this.getChildValue(d)},Keywords:function(d,c){c.keywords={};this.readChildNodes(d,c.keywords)},Keyword:function(d,c){c[this.getChildValue(d)]=!0},ServiceType:function(d,c){c.serviceType={codeSpace:d.getAttribute("codeSpace"),value:this.getChildValue(d)}},ServiceTypeVersion:function(d,c){c.serviceTypeVersion=this.getChildValue(d)},Fees:function(d,c){c.fees=this.getChildValue(d)},AccessConstraints:function(d,c){c.accessConstraints=this.getChildValue(d)},ServiceProvider:function(d,c){c.serviceProvider={};this.readChildNodes(d,c.serviceProvider)},ProviderName:function(d,c){c.providerName=this.getChildValue(d)},ProviderSite:function(d,c){c.providerSite=this.getAttributeNS(d,this.namespaces.xlink,"href")},ServiceContact:function(d,c){c.serviceContact={};this.readChildNodes(d,c.serviceContact)},IndividualName:function(d,c){c.individualName=this.getChildValue(d)},PositionName:function(d,c){c.positionName=this.getChildValue(d)},ContactInfo:function(d,c){c.contactInfo={};this.readChildNodes(d,c.contactInfo)},Phone:function(d,c){c.phone={};this.readChildNodes(d,c.phone)},Voice:function(d,c){c.voice=this.getChildValue(d)},Address:function(d,c){c.address={};this.readChildNodes(d,c.address)},DeliveryPoint:function(d,c){c.deliveryPoint=this.getChildValue(d)},City:function(d,c){c.city=this.getChildValue(d)},AdministrativeArea:function(d,c){c.administrativeArea=this.getChildValue(d)},PostalCode:function(d,c){c.postalCode=this.getChildValue(d)},Country:function(d,c){c.country=this.getChildValue(d)},ElectronicMailAddress:function(d,c){c.electronicMailAddress=this.getChildValue(d)},Role:function(d,c){c.role=this.getChildValue(d)},OperationsMetadata:function(d,c){c.operationsMetadata={};this.readChildNodes(d,c.operationsMetadata)},Operation:function(e,d){var f=e.getAttribute("name");d[f]={};this.readChildNodes(e,d[f])},DCP:function(d,c){c.dcp={};this.readChildNodes(d,c.dcp)},HTTP:function(d,c){c.http={};this.readChildNodes(d,c.http)},Get:function(e,d){d.get||(d.get=[]);var f={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,f);d.get.push(f)},Post:function(e,d){d.post||(d.post=[]);var f={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,f);d.post.push(f)},Parameter:function(e,d){d.parameters||(d.parameters={});var f=e.getAttribute("name");d.parameters[f]={};this.readChildNodes(e,d.parameters[f])},Constraint:function(e,d){d.constraints||(d.constraints={});var f=e.getAttribute("name");d.constraints[f]={};this.readChildNodes(e,d.constraints[f])},Value:function(d,c){c[this.getChildValue(d)]=!0},OutputFormat:function(d,c){c.formats.push({value:this.getChildValue(d)});this.readChildNodes(d,c)},WGS84BoundingBox:function(e,d){var f={};f.crs=e.getAttribute("crs");d.BoundingBox?d.BoundingBox.push(f):(d.projection=f.crs,f=d);this.readChildNodes(e,f)},BoundingBox:function(d,c){this.readers.ows.WGS84BoundingBox.apply(this,[d,c])},LowerCorner:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);d.left=f[0];d.bottom=f[1]},UpperCorner:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,""),f=f.replace(this.regExes.trimComma,","),f=f.split(this.regExes.splitSpace);d.right=f[0];d.top=f[1];d.bounds=new OpenLayers.Bounds(d.left,d.bottom,d.right,d.top);delete d.left;delete d.bottom;delete d.right;delete d.top},Language:function(d,c){c.language=this.getChildValue(d)}}},writers:{ows:{BoundingBox:function(d){var c=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:d.projection}});this.writeNode("ows:LowerCorner",d,c);this.writeNode("ows:UpperCorner",d,c);return c},LowerCorner:function(b){return this.createElementNSPlus("ows:LowerCorner",{value:b.bounds.left+" "+b.bounds.bottom})},UpperCorner:function(b){return this.createElementNSPlus("ows:UpperCorner",{value:b.bounds.right+" "+b.bounds.top})},Identifier:function(b){return this.createElementNSPlus("ows:Identifier",{value:b})},Title:function(b){return this.createElementNSPlus("ows:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("ows:Abstract",{value:b})},OutputFormat:function(b){return this.createElementNSPlus("ows:OutputFormat",{value:b})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(d,c){c.success=!1;c.exceptionReport={version:d.getAttribute("version"),language:d.getAttribute("language"),exceptions:[]};this.readChildNodes(d,c.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,[d,c])},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(d,c){c.numberOfFeatures=parseInt(d.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(d,c){c.insertIds=[];c.success=!1;this.readChildNodes(d,c)},TransactionSummary:function(d,c){c.success=!0},InsertResults:function(d,c){this.readChildNodes(d,c)},Feature:function(e,d){var f={fids:[]};this.readChildNodes(e,f);d.insertIds.push(f.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(d){var c=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);d&&this.setAttributes(c,{resultType:d.resultType,startIndex:d.startIndex,count:d.count});return c},Query:function(f){var f=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},f),e=f.featurePrefix,h=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e?e+":":"")+f.featureType,srsName:f.srsName}});f.featureNS&&h.setAttribute("xmlns:"+e,f.featureNS);if(f.propertyNames){for(var e=0,g=f.propertyNames.length;e<g;e++){this.writeNode("wfs:PropertyName",{property:f.propertyNames[e]},h)}}f.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,f.filter),this.writeNode("ogc:Filter",f.filter,h));return h},PropertyName:function(b){return this.createElementNSPlus("wfs:PropertyName",{value:b.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b},mergeWithDefaultFilter:function(b){return b&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]}):b||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,d,f){return OpenLayers.Function.bind(function(){e.apply(this,[d,f])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(b){OpenLayers.Util.extend(this,b)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return !(!window.JSON||!("function"==typeof JSON.parse&&"function"==typeof JSON.stringify))}(),read:function(a,b){var c;if(this.nativeJSON){c=JSON.parse(a,b)}else{try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"===typeof b)){var d=function(a,c){if(c&&"object"===typeof c){for(var e in c){c.hasOwnProperty(e)&&(c[e]=d(e,c[e]))}}return b(a,c)};c=d("",c)}}catch(e){}}this.keepData&&(this.data=c);return c},write:function(g,f){this.pretty=!!f;var k=null,j=typeof g;if(this.serialize[j]){try{k=!this.pretty&&this.nativeJSON?JSON.stringify(g):this.serialize[j].apply(this,[g])}catch(h){OpenLayers.Console.error("Trouble serializing: "+h)}}return k},writeIndent:function(){var d=[];if(this.pretty){for(var c=0;c<this.level;++c){d.push(this.indent)}}return d.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(h){if(null==h){return"null"}if(h.constructor==Date){return this.serialize.date.apply(this,[h])}if(h.constructor==Array){return this.serialize.array.apply(this,[h])}var g=["{"];this.level+=1;var m,l,k,j=!1;for(m in h){h.hasOwnProperty(m)&&(l=OpenLayers.Format.JSON.prototype.write.apply(this,[m,this.pretty]),k=OpenLayers.Format.JSON.prototype.write.apply(this,[h[m],this.pretty]),null!=l&&null!=k&&(j&&g.push(","),g.push(this.writeNewline(),this.writeIndent(),l,":",this.writeSpace(),k),j=!0))}this.level-=1;g.push(this.writeNewline(),this.writeIndent(),"}");return g.join("")},array:function(g){var f,k=["["];this.level+=1;for(var j=0,h=g.length;j<h;++j){f=OpenLayers.Format.JSON.prototype.write.apply(this,[g[j],this.pretty]),null!=f&&(0<j&&k.push(","),k.push(this.writeNewline(),this.writeIndent(),f))}this.level-=1;k.push(this.writeNewline(),this.writeIndent(),"]");return k.join("")},string:function(d){var c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(d)?'"'+d.replace(/([\x00-\x1f\\"])/g,function(b,g){var f=c[g];if(f){return f}f=g.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"':'"'+d+'"'},number:function(b){return isFinite(b)?""+b:"null"},"boolean":function(b){return""+b},date:function(d){function c(b){return 10>b?"0"+b:b}return'"'+d.getFullYear()+"-"+c(d.getMonth()+1)+"-"+c(d.getDate())+"T"+c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(v,u,t){var u=u?u:"FeatureCollection",s=null,r=null;if(r="string"==typeof v?OpenLayers.Format.JSON.prototype.read.apply(this,[v,t]):v){if("string"!=typeof r.type){OpenLayers.Console.error("Bad GeoJSON - no type: "+v)}else{if(this.isValidType(r,u)){switch(u){case"Geometry":try{s=this.parseGeometry(r)}catch(q){OpenLayers.Console.error(q)}break;case"Feature":try{s=this.parseFeature(r),s.type="Feature"}catch(p){OpenLayers.Console.error(p)}break;case"FeatureCollection":switch(s=[],r.type){case"Feature":try{s.push(this.parseFeature(r))}catch(o){s=null,OpenLayers.Console.error(o)}break;case"FeatureCollection":v=0;for(u=r.features.length;v<u;++v){try{s.push(this.parseFeature(r.features[v]))}catch(n){s=null,OpenLayers.Console.error(n)}}break;default:try{var m=this.parseGeometry(r);s.push(new OpenLayers.Feature.Vector(m))}catch(l){s=null,OpenLayers.Console.error(l)}}}}}}else{OpenLayers.Console.error("Bad JSON: "+v)}return s},isValidType:function(e,d){var f=!1;switch(d){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):f=!0;break;case"FeatureCollection":f=!0;break;default:e.type==d?f=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+d)}return f},parseFeature:function(g){var f,k,j;k=g.properties?g.properties:{};j=g.geometry&&g.geometry.bbox||g.bbox;try{f=this.parseGeometry(g.geometry)}catch(h){throw h}f=new OpenLayers.Feature.Vector(f,k);j&&(f.bounds=OpenLayers.Bounds.fromArray(j));g.id&&(f.fid=g.id);return f},parseGeometry:function(g){if(null==g){return null}var f,k=!1;if("GeometryCollection"==g.type){if(!OpenLayers.Util.isArray(g.geometries)){throw"GeometryCollection must have geometries array: "+g}f=g.geometries.length;for(var k=Array(f),j=0;j<f;++j){k[j]=this.parseGeometry.apply(this,[g.geometries[j]])}f=new OpenLayers.Geometry.Collection(k);k=!0}else{if(!OpenLayers.Util.isArray(g.coordinates)){throw"Geometry must have coordinates array: "+g}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type}try{f=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates])}catch(h){throw h}}this.internalProjection&&(this.externalProjection&&!k)&&f.transform(this.externalProjection,this.internalProjection);return f},parseCoords:{point:function(b){if(!1==this.ignoreExtraDims&&2!=b.length){throw"Only 2D points are supported: "+b}return new OpenLayers.Geometry.Point(b[0],b[1])},multipoint:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.point.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiPoint(g)},linestring:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.point.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.LineString(g)},multilinestring:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.linestring.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiLineString(g)},polygon:function(j){for(var h=[],o,n,m=0,l=j.length;m<l;++m){try{n=this.parseCoords.linestring.apply(this,[j[m]])}catch(k){throw k}o=new OpenLayers.Geometry.LinearRing(n.components);h.push(o)}return new OpenLayers.Geometry.Polygon(h)},multipolygon:function(h){for(var g=[],m=null,l=0,k=h.length;l<k;++l){try{m=this.parseCoords.polygon.apply(this,[h[l]])}catch(j){throw j}g.push(m)}return new OpenLayers.Geometry.MultiPolygon(g)},box:function(b){if(2!=b.length){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])])}},write:function(h,g){var m={type:null};if(OpenLayers.Util.isArray(h)){m.type="FeatureCollection";var l=h.length;m.features=Array(l);for(var k=0;k<l;++k){var j=h[k];if(!j instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+j}m.features[k]=this.extract.feature.apply(this,[j])}}else{0==h.CLASS_NAME.indexOf("OpenLayers.Geometry")?m=this.extract.geometry.apply(this,[h]):h instanceof OpenLayers.Feature.Vector&&(m=this.extract.feature.apply(this,[h]),h.layer&&h.layer.projection&&(m.crs=this.createCRSObject(h)))}return OpenLayers.Format.JSON.prototype.write.apply(this,[m,g])},createCRSObject:function(d){var d=d.layer.projection.toString(),c={};d.match(/epsg:/i)&&(d=parseInt(d.substring(d.indexOf(":")+1)),c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}});return c},extract:{feature:function(d){var c=this.extract.geometry.apply(this,[d.geometry]),c={type:"Feature",properties:d.attributes,geometry:c};null!=d.fid&&(c.id=d.fid);return c},geometry:function(d){if(null==d){return null}this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c=d.CLASS_NAME.split(".")[2],d=this.extract[c.toLowerCase()].apply(this,[d]);return"Collection"==c?{type:"GeometryCollection",geometries:d}:{type:c,coordinates:d}},point:function(b){return[b.x,b.y]},multipoint:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},linestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e},multilinestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},polygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.linestring.apply(this,[f.components[h]]))}return e},multipolygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.polygon.apply(this,[f.components[h]]))}return e},collection:function(f){for(var e=f.components.length,h=Array(e),g=0;g<e;++g){h[g]=this.extract.geometry.apply(this,[f.components[g]])}return h}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(d){d=d||{};this.params={};this.pendingRequests={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);this.format||(this.format=new OpenLayers.Format.GeoJSON);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return c.write(b,e)}}},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.applyDefaults(e,this.options);e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.createRequest(e.url,e.params,OpenLayers.Function.bind(function(a){d.data=a;this.handleRead(d,e)},this));d.priv=f;return d},createRequest:function(f,e,h){var h=OpenLayers.Protocol.Script.register(h),g=OpenLayers.String.format(this.callbackTemplate,{id:h}),e=OpenLayers.Util.extend({},e);e[this.callbackKey]=this.callbackPrefix+g;f=OpenLayers.Util.urlAppend(f,OpenLayers.Util.getParameterString(e));e=document.createElement("script");e.type="text/javascript";e.src=f;e.id="OpenLayers_Protocol_Script_"+h;this.pendingRequests[e.id]=e;document.getElementsByTagName("head")[0].appendChild(e);return e},destroyRequest:function(b){OpenLayers.Protocol.Script.unregister(b.id.split("_").pop());delete this.pendingRequests[b.id];b.parentNode&&b.parentNode.removeChild(b)},handleRead:function(d,c){this.handleResponse(d,c)},handleResponse:function(d,c){c.callback&&(d.data?(d.features=this.parseFeatures(d.data),d.code=OpenLayers.Protocol.Response.SUCCESS):d.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(d.priv),c.callback.call(c.scope,d))},parseFeatures:function(b){return this.format.read(b)},abort:function(d){if(d){this.destroyRequest(d.priv)}else{for(var c in this.pendingRequests){this.destroyRequest(this.pendingRequests[c])}}},destroy:function(){this.abort();delete this.params;delete this.format;OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"});(function(){var d=OpenLayers.Protocol.Script,c=0;d.registry={};d.register=function(b){var a="c"+ ++c;d.registry[a]=function(){b.apply(this,arguments)};return a};d.unregister=function(a){delete d.registry[a]}})();OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.controls=[];this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var d,c=this.controls.length-1;0<=c;c--){d=this.controls[c],d.events&&d.events.un({activate:this.iconOn,deactivate:this.iconOff}),d.panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate()}!0===this.saveState&&(this.defaultControl=null);this.redraw();return !0}return !1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,d=0,f=this.controls.length;d<f;d++){e=this.controls[d],this.activeState[e.id]=e.deactivate()}this.redraw();return !0}return !1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick);this.addControlsToMap(this.controls);return this.div},redraw:function(){for(var d=this.div.childNodes.length-1;0<=d;d--){this.div.removeChild(this.div.childNodes[d])}this.div.innerHTML="";if(this.active){for(var d=0,c=this.controls.length;d<c;d++){this.div.appendChild(this.controls[d].panel_div)}}},activateControl:function(f){if(!this.active){return !1}if(f.type==OpenLayers.Control.TYPE_BUTTON){f.trigger()}else{if(f.type==OpenLayers.Control.TYPE_TOGGLE){f.active?f.deactivate():f.activate()}else{if(this.allowDepress&&f.active){f.deactivate()}else{for(var e,h=0,g=this.controls.length;h<g;h++){e=this.controls[h],e!=f&&(e.type===OpenLayers.Control.TYPE_TOOL||null==e.type)&&e.deactivate()}f.activate()}}}},addControls:function(g){OpenLayers.Util.isArray(g)||(g=[g]);this.controls=this.controls.concat(g);for(var f=0,k=g.length;f<k;f++){var j=g[f],h=this.createControlMarkup(j);OpenLayers.Element.addClass(h,j.displayClass+"ItemInactive");OpenLayers.Element.addClass(h,"olButton");""!=j.title&&!h.title&&(h.title=j.title);j.panel_div=h}this.map&&(this.addControlsToMap(g),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(f){for(var e,h=0,g=f.length;h<g;h++){e=f[h],!0===e.autoActivate?(e.autoActivate=!1,this.map.addControl(e),e.autoActivate=!0):(this.map.addControl(e),e.deactivate()),e.events.on({activate:this.iconOn,deactivate:this.iconOff})}},iconOn:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var b=this.panel_div;b.className=b.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(e){for(var d=this.controls,e=e.buttonElement,f=d.length-1;0<=f;--f){if(d[f].panel_div===e){this.activateControl(d[f]);break}}},getControlsBy:function(e,d){var f="function"==typeof d.test;return OpenLayers.Array.filter(this.controls,function(a){return a[e]==d||f&&d.test(a[e])})},getControlsByName:function(b){return this.getControlsBy("name",b)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(f,e,h,g){OpenLayers.Layer.prototype.initialize.apply(this,[f,g]);this.url=e;this.params||(this.params=OpenLayers.Util.extend({},h))},destroy:function(){this.params=this.url=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setUrl:function(b){this.url=b},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);b=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return b},redraw:function(b){return b?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(g,f){for(var k=1,j=0,h=g.length;j<h;j++){k*=g.charCodeAt(j)*this.URL_HASH_FACTOR,k-=Math.floor(k)}return f[Math.floor(k*f.length)]},getFullRequestString:function(h,g){var m=g||this.url,l=OpenLayers.Util.extend({},this.params),l=OpenLayers.Util.extend(l,h),k=OpenLayers.Util.getParameterString(l);OpenLayers.Util.isArray(m)&&(m=this.selectUrl(k,m));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(m)),j;for(j in l){j.toUpperCase() in k&&delete l[j]}k=OpenLayers.Util.getParameterString(l);return OpenLayers.Util.urlAppend(m,k)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(h,g,m,l,k,j){this.layer=h;this.position=g.clone();this.setBounds(m);this.url=l;k&&(this.size=k.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,j);this.events=new OpenLayers.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=this.eventListeners=null},draw:function(d){d||this.clear();var c=this.shouldDraw();c&&!d&&(c=!1!==this.events.triggerEvent("beforedraw"));return c},shouldDraw:function(){var e=!1,d=this.layer.maxExtent;if(d){var f=this.layer.map,f=f.baseLayer.wrapDateLine&&f.getMaxExtent();this.bounds.intersectsBounds(d,{inclusive:!1,worldBounds:f})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var d=this.layer.map.getMaxExtent(),f=this.layer.map.getResolution(),e=e.wrapDateLine(d,{leftTolerance:f,rightTolerance:f})}this.bounds=e},moveTo:function(e,d,f){null==f&&(f=!0);this.setBounds(e);this.position=d.clone();f&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(h,g,m,l,k,j){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=l;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null);this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);b?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload();return b},renderTile:function(){this.layer.div.appendChild(this.getTile());if(this.layer.async){var b=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(a){b==this.asyncRequestId&&(this.url=a,this.initImage())},this)}else{this.url=this.layer.getURL(this.bounds),this.initImage()}},positionTile:function(){var d=this.getTile().style,c=this.frame?this.size:this.layer.getImageSize(this.bounds);d.left=this.position.x+"%";d.top=this.position.y+"%";d.width=c.w+"%";d.height=c.h+"%"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var d=this.imgDiv;if(d){OpenLayers.Event.stopObservingElement(d);var c=this.getTile();c.parentNode===this.layer.div&&this.layer.div.removeChild(c);this.setImgSrc();!0===this.layerAlphaHack&&(d.style.filter="");OpenLayers.Element.removeClass(d,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img");this.imgDiv.className="olTileImage";this.imgDiv.galleryImg="no";var e=this.imgDiv.style;if(this.frame){var d=0,f=0;this.layer.gutter&&(d=100*(this.layer.gutter/this.layer.tileSize.w),f=100*(this.layer.gutter/this.layer.tileSize.h));e.left=-d+"%";e.top=-f+"%";e.width=2*d+100+"%";e.height=2*f+100+"%"}e.visibility="hidden";e.opacity=0;1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%");this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var d=this.getImage();if(this.url&&d.getAttribute("src")==this.url){this.onImageLoad()}else{var c=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(d);OpenLayers.Event.observe(d,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(d,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)},this);d.getAttribute("src")==this.blankImageUrl?c():(OpenLayers.Event.observe(d,"load",c),OpenLayers.Event.observe(d,"error",c),this.crossOriginKeyword&&d.removeAttribute("crossorigin"),d.src=this.blankImageUrl)}},setImgSrc:function(d){var c=this.imgDiv;c.style.visibility="hidden";c.style.opacity=0;d&&(this.crossOriginKeyword&&("data:"!==d.substr(0,5)?c.setAttribute("crossorigin",this.crossOriginKeyword):c.removeAttribute("crossorigin")),c.src=d)},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var b;this.frame?(b=this.frame.cloneNode(!1),b.appendChild(this.imgDiv)):b=this.imgDiv;this.imgDiv=null;return b}},onImageLoad:function(){var e=this.imgDiv;OpenLayers.Event.stopObservingElement(e);e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");if(7>parseFloat(navigator.appVersion.split("MSIE")[1])&&this.layer&&this.layer.div){var d=document.createElement("span");d.style.display="none";var f=this.layer.div;f.appendChild(d);window.setTimeout(function(){d.parentNode===f&&d.parentNode.removeChild(d)},0)}!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var b=this.imgDiv;null!=b.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(b,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var b=document.createElement("canvas");b.width=this.size.w;b.height=this.size.h;this.canvasContext=b.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(f,e,h,g){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this.tileQueue=[];null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid");OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(true);this.moveTimerId=null},this))},setMap:function(b){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,b);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null);this.clearTileQueue();null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer();this.clearGrid();this.tileSize=this.grid=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){this.clearTileQueue();if(this.grid){for(var g=0,f=this.grid.length;g<f;g++){for(var k=this.grid[g],j=0,h=k.length;j<h;j++){this.destroyTile(k[j])}}this.grid=[];this.gridResolution=null}},clone:function(b){null==b&&(b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];b.gridResolution=null;b.backBuffer=null;b.backBufferTimerId=null;b.tileQueue=[];b.tileQueueId=null;b.loading=!1;b.moveTimerId=null;return b},moveTo:function(j,h,o){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);j=j||this.map.getExtent();if(null!=j){var n=!this.grid.length||h,m=this.getTilesBounds(),l=this.map.getResolution(),k=this.getServerResolution(l);if(this.singleTile){if(n||!o&&!m.containsBounds(j)){h&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),(!h||"resize"===this.transitionEffect)&&this.applyBackBuffer(k),this.initSingleTile(j)}}else{(n=n||!m.intersectsBounds(j,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),l!==k?(j=this.map.calculateBounds(null,k),n&&this.transformDiv(k/l)):(this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%"),n)?(h&&"resize"===this.transitionEffect&&this.applyBackBuffer(k),this.initGriddedTiles(j)):this.moveGriddedTiles()}}},getTileData:function(v){var u=null,t=v.lon,s=v.lat,r=this.grid.length;if(this.map&&r){var q=this.map.getResolution(),v=this.tileSize.w,p=this.tileSize.h,o=this.grid[0][0].bounds,n=o.left,o=o.top;if(t<n&&this.map.baseLayer.wrapDateLine){var m=this.map.getMaxExtent().getWidth(),l=Math.ceil((n-t)/m),t=t+m*l}t=(t-n)/(q*v);s=(o-s)/(q*p);q=Math.floor(t);n=Math.floor(s);0<=n&&n<r&&(r=this.grid[n][q])&&(u={tile:r,i:Math.floor((t-q)*v),j:Math.floor((s-n)*p)})}return u},queueTileDraw:function(b){b=b.object;~OpenLayers.Util.indexOf(this.tileQueue,b)||this.tileQueue.push(b);this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div));return !1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId);this.tileQueueId=null;this.tileQueue=[]},destroyTile:function(b){this.removeTileMonitoringHooks(b);b.destroy()},getServerResolution:function(e){e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var d,f;for(d=this.serverResolutions.length-1;0<=d;d--){if(f=this.serverResolutions[d],f>e){e=f;break}}if(-1===d){throw"no appropriate resolution in serverResolutions"}}return e},getServerZoom:function(){var b=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoomForResolution(b)+(this.zoomOffset||0)},transformDiv:function(f){this.div.style.width=100*f+"%";this.div.style.height=100*f+"%";var e=this.map.getSize(),h=parseInt(this.map.layerContainerDiv.style.left,10),g=(parseInt(this.map.layerContainerDiv.style.top,10)-e.h/2)*(f-1);this.div.style.left=(h-e.w/2)*(f-1)+"%";this.div.style.top=g+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(f){null!==this.backBufferTimerId&&this.removeBackBuffer();var e=this.backBuffer;if(!e){e=this.createBackBuffer();if(!e){return}this.div.insertBefore(e,this.div.firstChild);this.backBuffer=e;var h=this.grid[0][0].bounds;this.backBufferLonLat={lon:h.left,lat:h.top};this.backBufferResolution=this.gridResolution}var h=e.style,g=this.backBufferResolution/f;h.width=100*g+"%";h.height=100*g+"%";f=this.getViewPortPxFromLonLat(this.backBufferLonLat,f);h=parseInt(this.map.layerContainerDiv.style.left,10);g=parseInt(this.map.layerContainerDiv.style.top,10);e.style.left=Math.round(f.x-h)+"%";e.style.top=Math.round(f.y-g)+"%"},createBackBuffer:function(){var h;if(0<this.grid.length){h=document.createElement("div");h.id=this.div.id+"_bb";h.className="olBackBuffer";h.style.position="absolute";h.style.width="100%";h.style.height="100%";for(var g=0,m=this.grid.length;g<m;g++){for(var l=0,k=this.grid[g].length;l<k;l++){var j=this.grid[g][l].createBackBuffer();j&&(j.style.top=g*this.tileSize.h+"%",j.style.left=l*this.tileSize.w+"%",h.appendChild(j))}}}return h},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(b){this.singleTile&&(b=this.map.getSize(),b.h=parseInt(b.h*this.ratio),b.w=parseInt(b.w*this.ratio));OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b])},getTilesBounds:function(){var e=null,d=this.grid.length;if(d){var e=this.grid[d-1][0].bounds,d=this.grid[0].length*e.getWidth(),f=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+d,e.bottom+f)}return e},initSingleTile:function(e){this.clearTileQueue();var d=e.getCenterLonLat(),f=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio,d=new OpenLayers.Bounds(d.lon-f/2,d.lat-e/2,d.lon+f/2,d.lat+e/2),f=this.map.getLayerPxFromLonLat({lon:d.left,lat:d.top});this.grid.length||(this.grid[0]=[]);(e=this.grid[0][0])?e.moveTo(d,f):(e=this.addTile(d,f),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e);this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(j,h,o){var n=o*this.tileSize.w,o=o*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/n)-this.buffer,m=-(m/n-l)*this.tileSize.w,l=h.lon+l*n,j=j.top-(h.lat+o),k=Math.ceil(j/o)+this.buffer;return{tilelon:n,tilelat:o,tileoffsetlon:l,tileoffsetlat:h.lat+k*o,tileoffsetx:m,tileoffsety:-(k-j/o)*this.tileSize.h}},getTileOrigin:function(){var d=this.tileOrigin;if(!d){var d=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],d=new OpenLayers.LonLat(d[c[0]],d[c[1]])}return d},initGriddedTiles:function(P){this.clearTileQueue();var O=this.map.getSize(),N=Math.ceil(O.h/this.tileSize.h)+Math.max(1,2*this.buffer),O=Math.ceil(O.w/this.tileSize.w)+Math.max(1,2*this.buffer),M=this.getTileOrigin(),L=this.getServerResolution(),M=this.calculateGridLayout(P,M,L),L=Math.round(M.tileoffsetx),K=Math.round(M.tileoffsety),J=M.tileoffsetlon,I=M.tileoffsetlat,H=M.tilelon,G=M.tilelat,F=L,E=J,D=0,C=parseInt(this.map.layerContainerDiv.style.left),B=parseInt(this.map.layerContainerDiv.style.top),M=[],A=this.map.getCenter();do{var z=this.grid[D++];z||(z=[],this.grid.push(z));var J=E,L=F,y=0;do{var x=new OpenLayers.Bounds(J,I,J+H,I+G),w=L,w=w-C,v=K,v=v-B,v=new OpenLayers.Pixel(w,v);(w=z[y++])?w.moveTo(x,v,!1):(w=this.addTile(x,v),this.addTileMonitoringHooks(w),z.push(w));x=x.getCenterLonLat();M.push({tile:w,distance:Math.pow(x.lon-A.lon,2)+Math.pow(x.lat-A.lat,2)});J+=H;L+=this.tileSize.w}while(J<=P.right+H*this.buffer||y<O);I-=G;K+=this.tileSize.h}while(I>=P.bottom-G*this.buffer||D<N);this.removeExcessTiles(D,y);this.gridResolution=this.getServerResolution();M.sort(function(d,c){return d.distance-c.distance});P=0;for(N=M.length;P<N;++P){M[P].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(e,d){var f=new this.tileClass(this,d,e,null,this.tileSize,this.tileOptions);f.events.register("beforedraw",this,this.queueTileDraw);return f},addTileMonitoringHooks:function(b){b.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart"));this.events.triggerEvent("tileloadstart",{tile:b});this.numLoadingTiles++};b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded",{tile:b});0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))};b.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:b})};b.events.on({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,loaderror:b.onLoadError,scope:this})},moveGriddedTiles:function(h){if(!h&&!OpenLayers.Animation.isNative){null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay)}else{for(var h=this.buffer||1,g=this.getResolutionScale();;){var m=this.grid[0][0].position.x*g+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),l=this.grid[0][0].position.y*g+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top),k=this.tileSize.w*g,j=this.tileSize.h*g;if(m>-k*(h-1)){this.shiftColumn(!0)}else{if(m<-k*h){this.shiftColumn(!1)}else{if(l>-j*(h-1)){this.shiftRow(!0)}else{if(l<-j*h){this.shiftRow(!1)}else{break}}}}}}},shiftRow:function(t){for(var s=this.grid,r=s[t?0:this.grid.length-1],q=this.getServerResolution(),p=t?-this.tileSize.h:this.tileSize.h,q=q*-p,o=t?s.pop():s.shift(),n=0,m=r.length;n<m;n++){var l=r[n],k=l.bounds.clone(),l=l.position.clone();k.bottom+=q;k.top+=q;l.y+=p;o[n].moveTo(k,l)}t?s.unshift(o):s.push(o)},shiftColumn:function(r){for(var q=r?-this.tileSize.w:this.tileSize.w,p=this.getServerResolution()*q,o=0,n=this.grid.length;o<n;o++){var m=this.grid[o],l=m[r?0:m.length-1],k=l.bounds.clone(),l=l.position.clone();k.left+=p;k.right+=p;l.x+=q;var j=r?this.grid[o].pop():this.grid[o].shift();j.moveTo(k,l);r?m.unshift(j):m.push(j)}},removeExcessTiles:function(h,g){for(var m,l;this.grid.length>h;){var k=this.grid.pop();m=0;for(l=k.length;m<l;m++){var j=k[m];this.destroyTile(j)}}m=0;for(l=this.grid.length;m<l;m++){for(;this.grid[m].length>g;){k=this.grid[m],j=k.pop(),this.destroyTile(j)}}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(g){var f=this.maxExtent,k=this.getResolution(),j=k*this.tileSize.w,k=k*this.tileSize.h,h=this.getLonLatFromViewPortPx(g),g=f.left+j*Math.floor((h.lon-f.left)/j),f=f.bottom+k*Math.floor((h.lat-f.bottom)/k);return new OpenLayers.Bounds(g,f,g+j,f+k)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(d){this.request=new OpenLayers.Format.ArcXML.Request;this.response=new OpenLayers.Format.ArcXML.Response;if(d){if("feature"==d.requesttype){this.request.get_image=null;var c=this.request.get_feature.query;this.addCoordSys(c.featurecoordsys,d.featureCoordSys);this.addCoordSys(c.filtercoordsys,d.filterCoordSys);d.polygon?(c.isspatial=!0,c.spatialfilter.polygon=d.polygon):d.envelope&&(c.isspatial=!0,c.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(c.spatialfilter.envelope,d.envelope))}else{"image"==d.requesttype?(this.request.get_feature=null,c=this.request.get_image.properties,this.parseEnvelope(c.envelope,d.envelope),this.addLayers(c.layerlist,d.layers),this.addImageSize(c.imagesize,d.tileSize),this.addCoordSys(c.featurecoordsys,d.featureCoordSys),this.addCoordSys(c.filtercoordsys,d.filterCoordSys)):this.request=null}}OpenLayers.Format.XML.prototype.initialize.apply(this,[d])},parseEnvelope:function(d,c){c&&4==c.length&&(d.minx=c[0],d.miny=c[1],d.maxx=c[2],d.maxy=c[3])},addLayers:function(f,e){for(var h=0,g=e.length;h<g;h++){f.push(e[h])}},addImageSize:function(d,c){null!==c&&(d.width=c.w,d.height=c.h,d.printwidth=c.w,d.printheight=c.h)},addCoordSys:function(d,c){"string"==typeof c?(d.id=parseInt(c),d.string=c):"object"==typeof c&&null!==c.proj&&(d.id=c.proj.srsProjNumber,d.string=c.proj.srsCode)},iserror:function(d){var c=null;d?(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]),d=d.documentElement.getElementsByTagName("ERROR"),c=null!==d&&0<d.length):c=""!==this.response.error;return c},read:function(g){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));var f=null;g&&g.documentElement&&(f="ARCXML"==g.documentElement.nodeName?g.documentElement:g.documentElement.getElementsByTagName("ARCXML")[0]);if(!f||"parsererror"===f.firstChild.nodeName){var k,j;try{k=g.firstChild.nodeValue,j=g.firstChild.childNodes[1].firstChild.nodeValue}catch(h){}throw {message:"Error parsing the ArcXML request",error:k,source:j}}return this.parseResponse(f)},write:function(k){k||(k=this.request);var j=this.createElementNS("","ARCXML");j.setAttribute("version","1.1");var q=this.createElementNS("","REQUEST");if(null!=k.get_image){var p=this.createElementNS("","GET_IMAGE");q.appendChild(p);var o=this.createElementNS("","PROPERTIES");p.appendChild(o);k=k.get_image.properties;null!=k.featurecoordsys&&(p=this.createElementNS("","FEATURECOORDSYS"),o.appendChild(p),0===k.featurecoordsys.id?p.setAttribute("string",k.featurecoordsys.string):p.setAttribute("id",k.featurecoordsys.id));null!=k.filtercoordsys&&(p=this.createElementNS("","FILTERCOORDSYS"),o.appendChild(p),0===k.filtercoordsys.id?p.setAttribute("string",k.filtercoordsys.string):p.setAttribute("id",k.filtercoordsys.id));null!=k.envelope&&(p=this.createElementNS("","ENVELOPE"),o.appendChild(p),p.setAttribute("minx",k.envelope.minx),p.setAttribute("miny",k.envelope.miny),p.setAttribute("maxx",k.envelope.maxx),p.setAttribute("maxy",k.envelope.maxy));p=this.createElementNS("","IMAGESIZE");o.appendChild(p);p.setAttribute("height",k.imagesize.height);p.setAttribute("width",k.imagesize.width);if(k.imagesize.height!=k.imagesize.printheight||k.imagesize.width!=k.imagesize.printwidth){p.setAttribute("printheight",k.imagesize.printheight),p.setArrtibute("printwidth",k.imagesize.printwidth)}null!=k.background&&(p=this.createElementNS("","BACKGROUND"),o.appendChild(p),p.setAttribute("color",k.background.color.r+","+k.background.color.g+","+k.background.color.b),null!==k.background.transcolor&&p.setAttribute("transcolor",k.background.transcolor.r+","+k.background.transcolor.g+","+k.background.transcolor.b));if(null!=k.layerlist&&0<k.layerlist.length){p=this.createElementNS("","LAYERLIST");o.appendChild(p);for(o=0;o<k.layerlist.length;o++){var n=this.createElementNS("","LAYERDEF");p.appendChild(n);n.setAttribute("id",k.layerlist[o].id);n.setAttribute("visible",k.layerlist[o].visible);if("object"==typeof k.layerlist[o].query){var m=k.layerlist[o].query;if(0>m.where.length){continue}var l=null,l="boolean"==typeof m.spatialfilter&&m.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");l.setAttribute("where",m.where);"number"==typeof m.accuracy&&0<m.accuracy&&l.setAttribute("accuracy",m.accuracy);"number"==typeof m.featurelimit&&2000>m.featurelimit&&l.setAttribute("featurelimit",m.featurelimit);"string"==typeof m.subfields&&"#ALL#"!=m.subfields&&l.setAttribute("subfields",m.subfields);"string"==typeof m.joinexpression&&0<m.joinexpression.length&&l.setAttribute("joinexpression",m.joinexpression);"string"==typeof m.jointables&&0<m.jointables.length&&l.setAttribute("jointables",m.jointables);n.appendChild(l)}"object"==typeof k.layerlist[o].renderer&&this.addRenderer(n,k.layerlist[o].renderer)}}}else{if(null!=k.get_feature&&(p=this.createElementNS("","GET_FEATURES"),p.setAttribute("outputmode","newxml"),p.setAttribute("checkesc","true"),k.get_feature.geometry?p.setAttribute("geometry",k.get_feature.geometry):p.setAttribute("geometry","false"),k.get_feature.compact&&p.setAttribute("compact",k.get_feature.compact),"number"==k.get_feature.featurelimit&&p.setAttribute("featurelimit",k.get_feature.featurelimit),p.setAttribute("globalenvelope","true"),q.appendChild(p),null!=k.get_feature.layer&&0<k.get_feature.layer.length&&(o=this.createElementNS("","LAYER"),o.setAttribute("id",k.get_feature.layer),p.appendChild(o)),k=k.get_feature.query,null!=k)){o=null,o=k.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),p.appendChild(o),"number"==typeof k.accuracy&&o.setAttribute("accuracy",k.accuracy),null!=k.featurecoordsys&&(p=this.createElementNS("","FEATURECOORDSYS"),0==k.featurecoordsys.id?p.setAttribute("string",k.featurecoordsys.string):p.setAttribute("id",k.featurecoordsys.id),o.appendChild(p)),null!=k.filtercoordsys&&(p=this.createElementNS("","FILTERCOORDSYS"),0===k.filtercoordsys.id?p.setAttribute("string",k.filtercoordsys.string):p.setAttribute("id",k.filtercoordsys.id),o.appendChild(p)),0<k.buffer&&(p=this.createElementNS("","BUFFER"),p.setAttribute("distance",k.buffer),o.appendChild(p)),k.isspatial&&(p=this.createElementNS("","SPATIALFILTER"),p.setAttribute("relation",k.spatialfilter.relation),o.appendChild(p),k.spatialfilter.envelope?(n=this.createElementNS("","ENVELOPE"),n.setAttribute("minx",k.spatialfilter.envelope.minx),n.setAttribute("miny",k.spatialfilter.envelope.miny),n.setAttribute("maxx",k.spatialfilter.envelope.maxx),n.setAttribute("maxy",k.spatialfilter.envelope.maxy),p.appendChild(n)):"object"==typeof k.spatialfilter.polygon&&p.appendChild(this.writePolygonGeometry(k.spatialfilter.polygon))),null!=k.where&&0<k.where.length&&o.setAttribute("where",k.where)}}j.appendChild(q);return OpenLayers.Format.XML.prototype.write.apply(this,[j])},addGroupRenderer:function(f,e){var h=this.createElementNS("","GROUPRENDERER");f.appendChild(h);for(var g=0;g<e.length;g++){this.addRenderer(h,e[g])}},addRenderer:function(e,d){if(OpenLayers.Util.isArray(d)){this.addGroupRenderer(e,d)}else{var f=this.createElementNS("",d.type.toUpperCase()+"RENDERER");e.appendChild(f);"VALUEMAPRENDERER"==f.tagName?this.addValueMapRenderer(f,d):"VALUEMAPLABELRENDERER"==f.tagName?this.addValueMapLabelRenderer(f,d):"SIMPLELABELRENDERER"==f.tagName?this.addSimpleLabelRenderer(f,d):"SCALEDEPENDENTRENDERER"==f.tagName&&this.addScaleDependentRenderer(f,d)}},addScaleDependentRenderer:function(d,c){("string"==typeof c.lower||"number"==typeof c.lower)&&d.setAttribute("lower",c.lower);("string"==typeof c.upper||"number"==typeof c.upper)&&d.setAttribute("upper",c.upper);this.addRenderer(d,c.renderer)},addValueMapLabelRenderer:function(v,u){v.setAttribute("lookupfield",u.lookupfield);v.setAttribute("labelfield",u.labelfield);if("object"==typeof u.exacts){for(var t=0,s=u.exacts.length;t<s;t++){var r=u.exacts[t],q=this.createElementNS("","EXACT");"string"==typeof r.value&&q.setAttribute("value",r.value);"string"==typeof r.label&&q.setAttribute("label",r.label);"string"==typeof r.method&&q.setAttribute("method",r.method);v.appendChild(q);if("object"==typeof r.symbol){var p=null;"text"==r.symbol.type&&(p=this.createElementNS("","TEXTSYMBOL"));if(null!=p){for(var o=this.fontStyleKeys,n=0,m=o.length;n<m;n++){var l=o[n];r.symbol[l]&&p.setAttribute(l,r.symbol[l])}q.appendChild(p)}}}}},addValueMapRenderer:function(j,h){j.setAttribute("lookupfield",h.lookupfield);if("object"==typeof h.ranges){for(var o=0,n=h.ranges.length;o<n;o++){var m=h.ranges[o],l=this.createElementNS("","RANGE");l.setAttribute("lower",m.lower);l.setAttribute("upper",m.upper);j.appendChild(l);if("object"==typeof m.symbol){var k=null;"simplepolygon"==m.symbol.type&&(k=this.createElementNS("","SIMPLEPOLYGONSYMBOL"));null!=k&&("string"==typeof m.symbol.boundarycolor&&k.setAttribute("boundarycolor",m.symbol.boundarycolor),"string"==typeof m.symbol.fillcolor&&k.setAttribute("fillcolor",m.symbol.fillcolor),"number"==typeof m.symbol.filltransparency&&k.setAttribute("filltransparency",m.symbol.filltransparency),l.appendChild(k))}}}else{if("object"==typeof h.exacts){o=0;for(n=h.exacts.length;o<n;o++){m=h.exacts[o],l=this.createElementNS("","EXACT"),"string"==typeof m.value&&l.setAttribute("value",m.value),"string"==typeof m.label&&l.setAttribute("label",m.label),"string"==typeof m.method&&l.setAttribute("method",m.method),j.appendChild(l),"object"==typeof m.symbol&&(k=null,"simplemarker"==m.symbol.type&&(k=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=k&&("string"==typeof m.symbol.antialiasing&&k.setAttribute("antialiasing",m.symbol.antialiasing),"string"==typeof m.symbol.color&&k.setAttribute("color",m.symbol.color),"string"==typeof m.symbol.outline&&k.setAttribute("outline",m.symbol.outline),"string"==typeof m.symbol.overlap&&k.setAttribute("overlap",m.symbol.overlap),"string"==typeof m.symbol.shadow&&k.setAttribute("shadow",m.symbol.shadow),"number"==typeof m.symbol.transparency&&k.setAttribute("transparency",m.symbol.transparency),"string"==typeof m.symbol.usecentroid&&k.setAttribute("usecentroid",m.symbol.usecentroid),"number"==typeof m.symbol.width&&k.setAttribute("width",m.symbol.width),l.appendChild(k)))}}}},addSimpleLabelRenderer:function(k,j){k.setAttribute("field",j.field);for(var q="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),p=0,o=q.length;p<o;p++){var n=q[p];j[n]&&k.setAttribute(n,j[n])}if("text"==j.symbol.type){var m=j.symbol,l=this.createElementNS("","TEXTSYMBOL");k.appendChild(l);q=this.fontStyleKeys;p=0;for(o=q.length;p<o;p++){n=q[p],m[n]&&l.setAttribute(n,j[n])}}},writePolygonGeometry:function(t){if(!(t instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+t.CLASS_NAME+" object.",geometry:t}}for(var s=this.createElementNS("","POLYGON"),r=0,q=t.components.length;r<q;r++){for(var p=t.components[r],o=this.createElementNS("","RING"),n=0,m=p.components.length;n<m;n++){var l=p.components[n],k=this.createElementNS("","POINT");k.setAttribute("x",l.x);k.setAttribute("y",l.y);o.appendChild(k)}s.appendChild(o)}return s},parseResponse:function(t){"string"==typeof t&&(t=(new OpenLayers.Format.XML).read(t));var s=new OpenLayers.Format.ArcXML.Response,r=t.getElementsByTagName("ERROR");if(null!=r&&0<r.length){s.error=this.getChildValue(r,"Unknown error.")}else{r=t.getElementsByTagName("RESPONSE");if(null==r||0==r.length){return s.error="No RESPONSE tag found in ArcXML response.",s}var q=r[0].firstChild.nodeName;"#text"==q&&(q=r[0].firstChild.nextSibling.nodeName);if("IMAGE"==q){r=t.getElementsByTagName("ENVELOPE"),t=t.getElementsByTagName("OUTPUT"),null==r||0==r.length?s.error="No ENVELOPE tag found in ArcXML response.":null==t||0==t.length?s.error="No OUTPUT tag found in ArcXML response.":(r=this.parseAttributes(r[0]),q=this.parseAttributes(t[0]),s.image="string"==typeof q.type?{envelope:r,output:{type:q.type,data:this.getChildValue(t[0])}}:{envelope:r,output:q})}else{if("FEATURES"==q){if(t=r[0].getElementsByTagName("FEATURES"),r=t[0].getElementsByTagName("FEATURECOUNT"),s.features.featurecount=r[0].getAttribute("count"),0<s.features.featurecount){r=t[0].getElementsByTagName("ENVELOPE");s.features.envelope=this.parseAttributes(r[0],"number");t=t[0].getElementsByTagName("FEATURE");for(r=0;r<t.length;r++){for(var q=new OpenLayers.Feature.Vector,p=t[r].getElementsByTagName("FIELD"),o=0;o<p.length;o++){var n=p[o].getAttribute("name"),m=p[o].getAttribute("value");q.attributes[n]=m}p=t[r].getElementsByTagName("POLYGON");if(0<p.length){p=p[0].getElementsByTagName("RING");o=[];for(n=0;n<p.length;n++){m=[];m.push(this.parsePointGeometry(p[n]));for(var l=p[n].getElementsByTagName("HOLE"),k=0;k<l.length;k++){m.push(this.parsePointGeometry(l[k]))}o.push(new OpenLayers.Geometry.Polygon(m))}q.geometry=1==o.length?o[0]:new OpenLayers.Geometry.MultiPolygon(o)}s.features.feature.push(q)}}}else{s.error="Unidentified response type."}}}return s},parseAttributes:function(f,e){for(var h={},g=0;g<f.attributes.length;g++){h[f.attributes[g].nodeName]="number"==e?parseFloat(f.attributes[g].nodeValue):f.attributes[g].nodeValue}return h},parsePointGeometry:function(f){var e=[],h=f.getElementsByTagName("COORDS");if(0<h.length){f=this.getChildValue(h[0]);f=f.split(/;/);for(h=0;h<f.length;h++){var g=f[h].split(/ /);e.push(new OpenLayers.Geometry.Point(g[0],g[1]))}}else{if(f=f.getElementsByTagName("POINT"),0<f.length){for(h=0;h<f.length;h++){e.push(new OpenLayers.Geometry.Point(parseFloat(f[h].getAttribute("x")),parseFloat(f[h].getAttribute("y"))))}}}return new OpenLayers.Geometry.LinearRing(e)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.ProxyHost="";OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(g,f){var k=0!==g.indexOf("http"),j=!k&&g.match(this.URL_SPLIT_REGEX);if(j){var h=window.location,k=j[1]==h.protocol&&j[3]==h.hostname,j=j[4],h=h.port;if(80!=j&&""!=j||"80"!=h&&""!=h){k=k&&j==h}}k||(f?g="function"==typeof f?f(g):f+encodeURIComponent(g):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:g}));return g},issue:function(k){var j=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),k=OpenLayers.Util.applyDefaults(k,j),j=!1,q;for(q in k.headers){k.headers.hasOwnProperty(q)&&"x-requested-with"===q.toLowerCase()&&(j=!0)}!1===j&&(k.headers["X-Requested-With"]="XMLHttpRequest");var p=new OpenLayers.Request.XMLHttpRequest,o=OpenLayers.Util.urlAppend(k.url,OpenLayers.Util.getParameterString(k.params||{})),o=OpenLayers.Request.makeSameOrigin(o,k.proxy);p.open(k.method,o,k.async,k.user,k.password);for(var n in k.headers){p.setRequestHeader(n,k.headers[n])}var m=this.events,l=this;p.onreadystatechange=function(){p.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==m.triggerEvent("complete",{request:p,config:k,requestUrl:o})&&l.runCallbacks({request:p,config:k,requestUrl:o})};!1===k.async?p.send(k.data):window.setTimeout(function(){0!==p.readyState&&p.send(k.data)},0);return p},runCallbacks:function(h){var g=h.request,m=h.config,l=m.scope?OpenLayers.Function.bind(m.callback,m.scope):m.callback,k;m.success&&(k=m.scope?OpenLayers.Function.bind(m.success,m.scope):m.success);var j;m.failure&&(j=m.scope?OpenLayers.Function.bind(m.failure,m.scope):m.failure);"file:"==OpenLayers.Util.createUrlObject(m.url).protocol&&g.responseText&&(g.status=200);l(g);if(!g.status||200<=g.status&&300>g.status){this.events.triggerEvent("success",h),k&&k(g)}if(g.status&&(200>g.status||300<=g.status)){this.events.triggerEvent("failure",h),j&&j(g)}},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b)},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};"CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers)||(b.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(b)},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b)},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b)},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b)}};OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(e,d,f){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:f.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(f,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,d,this.params,f]);if(this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format)){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}null===this.options.layers&&(this.options.layers=[])},getURL:function(d){var c="",d=this.adjustBounds(d),d=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:d.toArray(),tileSize:this.tileSize})),d=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:d.write(),async:!1});if(null!=d){c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}c=this.getUrlOrImage((new OpenLayers.Format.ArcXML).read(c).image.output)}return c},getURLasync:function(e,d,f){e=this.adjustBounds(e);e=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:e.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:e.write(),callback:function(b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}b=(new OpenLayers.Format.ArcXML).read(c);d.call(f,this.getUrlOrImage(b.image.output))},scope:this})},getUrlOrImage:function(d){var c="";d.url?c=d.url:d.data&&(c="data:image/"+d.type+";base64,"+d.data);return c},setLayerQuery:function(e,d){for(var f=0;f<this.options.layers.length;f++){if(e==this.options.layers[f].id){this.options.layers[f].query=d;return}}this.options.layers.push({id:e,visible:!0,query:d})},getFeatureInfo:function(k,j,q){var p=q.buffer||1,o=q.callback||function(){},n=q.scope||window,m={};OpenLayers.Util.extend(m,this.options);m.requesttype="feature";k instanceof OpenLayers.LonLat?(m.polygon=null,m.envelope=[k.lon-p,k.lat-p,k.lon+p,k.lat+p]):k instanceof OpenLayers.Geometry.Polygon&&(m.envelope=null,m.polygon=k);var l=new OpenLayers.Format.ArcXML(m);OpenLayers.Util.extend(l.request.get_feature,q);l.request.get_feature.layer=j.id;"number"==typeof j.query.accuracy?l.request.get_feature.query.accuracy=j.query.accuracy:(k=this.map.getCenter(),q=this.map.getViewPortPxFromLonLat(k),q.x++,q=this.map.getLonLatFromPixel(q),l.request.get_feature.query.accuracy=q.lon-k.lon);l.request.get_feature.query.where=j.query.where;l.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:l.write(),callback:function(b){b=l.parseResponse(b.responseText);l.iserror()?o.call(n,null):o.call(n,b.features)}})},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(d,c){c.exceptionReport={version:d.getAttribute("version"),language:d.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(d,c.exceptionReport)},AllowedValues:function(d,c){c.allowedValues={};this.readChildNodes(d,c.allowedValues)},AnyValue:function(d,c){c.anyValue=!0},DataType:function(d,c){c.dataType=this.getChildValue(d)},Range:function(d,c){c.range={};this.readChildNodes(d,c.range)},MinimumValue:function(d,c){c.minValue=this.getChildValue(d)},MaximumValue:function(d,c){c.maxValue=this.getChildValue(d)},Identifier:function(d,c){c.identifier=this.getChildValue(d)},SupportedCRS:function(d,c){c.supportedCRS=this.getChildValue(d)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(d){var c=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":d.closure}});this.writeNode("ows:MinimumValue",d.minValue,c);this.writeNode("ows:MaximumValue",d.maxValue,c);return c},MinimumValue:function(b){return this.createElementNSPlus("ows:MinimumValue",{value:b})},MaximumValue:function(b){return this.createElementNSPlus("ows:MaximumValue",{value:b})},Value:function(b){return this.createElementNSPlus("ows:Value",{value:b})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(b){b=this.writeNode("wcs:GetCoverage",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(d){var c=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:d.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("wcs:DomainSubset",d.domainSubset,c);this.writeNode("wcs:Output",d.output,c);return c},DomainSubset:function(d){var c=this.createElementNSPlus("wcs:DomainSubset",{});this.writeNode("ows:BoundingBox",d.boundingBox,c);d.temporalSubset&&this.writeNode("wcs:TemporalSubset",d.temporalSubset,c);return c},TemporalSubset:function(f){for(var e=this.createElementNSPlus("wcs:TemporalSubset",{}),h=0,g=f.timePeriods.length;h<g;++h){this.writeNode("wcs:TimePeriod",f.timePeriods[h],e)}return e},TimePeriod:function(d){var c=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",d.begin,c);this.writeNode("wcs:EndPosition",d.end,c);d.resolution&&this.writeNode("wcs:TimeResolution",d.resolution,c);return c},BeginPosition:function(b){return this.createElementNSPlus("wcs:BeginPosition",{value:b})},EndPosition:function(b){return this.createElementNSPlus("wcs:EndPosition",{value:b})},TimeResolution:function(b){return this.createElementNSPlus("wcs:TimeResolution",{value:b})},Output:function(d){var c=this.createElementNSPlus("wcs:Output",{attributes:{format:d.format,store:d.store}});d.gridCRS&&this.writeNode("wcs:GridCRS",d.gridCRS,c);return c},GridCRS:function(d){var c=this.createElementNSPlus("wcs:GridCRS",{});this.writeNode("wcs:GridBaseCRS",d.baseCRS,c);d.type&&this.writeNode("wcs:GridType",d.type,c);d.origin&&this.writeNode("wcs:GridOrigin",d.origin,c);this.writeNode("wcs:GridOffsets",d.offsets,c);d.CS&&this.writeNode("wcs:GridCS",d.CS,c);return c},GridBaseCRS:function(b){return this.createElementNSPlus("wcs:GridBaseCRS",{value:b})},GridOrigin:function(b){return this.createElementNSPlus("wcs:GridOrigin",{value:b})},GridType:function(b){return this.createElementNSPlus("wcs:GridType",{value:b})},GridOffsets:function(b){return this.createElementNSPlus("wcs:GridOffsets",{value:b})},GridCS:function(b){return this.createElementNSPlus("wcs:GridCS",{value:b})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){},write:function(d){var c;window.ActiveXObject?this.xmldom=c=new ActiveXObject("Microsoft.XMLDOM"):c=document.implementation.createDocument("","",null);d=this.writeNode("wps:Execute",d,c);this.setAttributeNS(d,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[d])},writers:{wps:{Execute:function(d){var c=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("wps:DataInputs",d.dataInputs,c);this.writeNode("wps:ResponseForm",d.responseForm,c);return c},ResponseForm:function(d){var c=this.createElementNSPlus("wps:ResponseForm",{});d.rawDataOutput&&this.writeNode("wps:RawDataOutput",d.rawDataOutput,c);d.responseDocument&&this.writeNode("wps:ResponseDocument",d.responseDocument,c);return c},ResponseDocument:function(d){var c=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:d.storeExecuteResponse,lineage:d.lineage,status:d.status}});d.output&&this.writeNode("wps:Output",d.output,c);return c},Output:function(d){var c=this.createElementNSPlus("wps:Output",{attributes:{asReference:d.asReference}});this.writeNode("ows:Identifier",d.identifier,c);this.writeNode("ows:Title",d.title,c);this.writeNode("ows:Abstract",d["abstract"],c);return c},RawDataOutput:function(d){var c=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:d.mimeType}});this.writeNode("ows:Identifier",d.identifier,c);return c},DataInputs:function(f){for(var e=this.createElementNSPlus("wps:DataInputs",{}),h=0,g=f.length;h<g;++h){this.writeNode("wps:Input",f[h],e)}return e},Input:function(d){var c=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",d.identifier,c);d.title&&this.writeNode("ows:Title",d.title,c);d.data&&this.writeNode("wps:Data",d.data,c);d.reference&&this.writeNode("wps:Reference",d.reference,c);return c},Data:function(d){var c=this.createElementNSPlus("wps:Data",{});d.literalData?this.writeNode("wps:LiteralData",d.literalData,c):d.complexData&&this.writeNode("wps:ComplexData",d.complexData,c);return c},LiteralData:function(b){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:b.uom},value:b.value})},ComplexData:function(e){var d=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),f=e.value;"string"===typeof f?d.appendChild(this.getXMLDoc().createCDATASection(e.value)):d.appendChild(f);return d},Reference:function(d){var c=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:d.mimeType,"xlink:href":d.href,method:d.method,encoding:d.encoding,schema:d.schema}});d.body&&this.writeNode("wps:Body",d.body,c);return c},Body:function(d){var c=this.createElementNSPlus("wps:Body",{});d.wcs?this.writeNode("wcs:GetCoverage",d.wcs,c):d.wfs?(this.featureType=d.wfs.featureType,this.version=d.wfs.version,this.writeNode("wfs:GetFeature",d.wfs,c)):this.writeNode("wps:Execute",d,c);return c}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(b){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.position=this.buttons=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var d={w:18,h:18},f=new OpenLayers.Pixel(e.x+d.w/2,e.y);this._addButton("panup","north-mini.png",f,d);e.y=f.y+d.h;this._addButton("panleft","west-mini.png",e,d);this._addButton("panright","east-mini.png",e.add(d.w,0),d);this._addButton("pandown","south-mini.png",f.add(0,2*d.h),d);this._addButton("zoomin","zoom-plus-mini.png",f.add(0,3*d.h+5),d);this._addButton("zoomworld","zoom-world-mini.png",f.add(0,4*d.h+5),d);this._addButton("zoomout","zoom-minus-mini.png",f.add(0,5*d.h+5),d);return this.div},_addButton:function(f,e,h,g){e=OpenLayers.Util.getImageLocation(e);h=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,h,g,e,"absolute");h.style.cursor="pointer";this.div.appendChild(h);h.action=f;h.className="olButton";this.buttons.push(h);return h},_removeButton:function(b){this.div.removeChild(b);OpenLayers.Util.removeItem(this.buttons,b)},removeButtons:function(){for(var b=this.buttons.length-1;0<=b;--b){this._removeButton(this.buttons[b])}},onButtonClick:function(b){switch(b.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(b){return this.slideRatio?this.map.getSize()[b]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(b){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar());this.draw()},draw:function(f){OpenLayers.Control.prototype.draw.apply(this,arguments);f=this.position.clone();this.buttons=[];var e={w:18,h:18};if(this.panIcons){var h=new OpenLayers.Pixel(f.x+e.w/2,f.y),g=e.w;this.zoomWorldIcon&&(h=new OpenLayers.Pixel(f.x+e.w,f.y));this._addButton("panup","north-mini.png",h,e);f.y=h.y+e.h;this._addButton("panleft","west-mini.png",f,e);this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",f.add(e.w,0),e),g*=2);this._addButton("panright","east-mini.png",f.add(g,0),e);this._addButton("pandown","south-mini.png",h.add(0,2*e.h),e);this._addButton("zoomin","zoom-plus-mini.png",h.add(0,3*e.h+5),e);h=this._addZoomBar(h.add(0,4*e.h+5));this._addButton("zoomout","zoom-minus-mini.png",h,e)}else{this._addButton("zoomin","zoom-plus-mini.png",f,e),h=this._addZoomBar(f.add(0,e.h)),this._addButton("zoomout","zoom-minus-mini.png",h,e),this.zoomWorldIcon&&(h=h.add(0,e.h+3),this._addButton("zoomworld","zoom-world-mini.png",h,e))}return this.div},_addZoomBar:function(g){var f=OpenLayers.Util.getImageLocation("slider.png"),k=this.id+"_"+this.map.id,j=this.map.getNumZoomLevels()-1-this.map.getZoom(),j=OpenLayers.Util.createAlphaImageDiv(k,g.add(-1,j*this.zoomStopHeight),{w:20,h:9},f,"absolute");j.style.cursor="move";this.slider=j;this.sliderEvents=new OpenLayers.Events(this,j,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var h={w:this.zoomStopWidth,h:this.zoomStopHeight*this.map.getNumZoomLevels()},f=OpenLayers.Util.getImageLocation("zoombar.png"),k=null;OpenLayers.Util.alphaHack()?(k=this.id+"_"+this.map.id,k=OpenLayers.Util.createAlphaImageDiv(k,g,{w:h.w,h:this.zoomStopHeight},f,"absolute",null,"crop"),k.style.height=h.h+"px"):k=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,g,h,f);k.style.cursor="pointer";k.className="olButton";this.zoombarDiv=k;this.div.appendChild(k);this.startTop=parseInt(k.style.top);this.div.appendChild(j);this.map.events.register("zoomend",this,this.moveZoomBar);return g=g.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(d){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(d.buttonElement===this.zoombarDiv){var c=d.buttonXY.y/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){c=Math.floor(c)}c=this.map.getNumZoomLevels()-1-c;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(c)}},passEventToSlider:function(b){this.sliderEvents.handleBrowserEvent(b)},zoomBarDown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=b.xy.clone(),this.zoomStart=b.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(b)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var d=this.mouseDragStart.y-e.xy.y,f=OpenLayers.Util.pagePosition(this.zoombarDiv);0<e.clientY-f[1]&&e.clientY-f[1]<parseInt(this.zoombarDiv.style.height)-2&&(this.slider.style.top=parseInt(this.slider.style.top)-d+"px",this.mouseDragStart=e.xy.clone());this.deltaY=this.zoomStart.y-e.xy.y;OpenLayers.Event.stop(e)}},zoomBarUp:function(d){if((OpenLayers.Event.isLeftClick(d)||"touchend"===d.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var c=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(c+=this.deltaY/this.zoomStopHeight,c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)):(c+=this.deltaY/this.zoomStopHeight,c=Math.max(Math.round(c),0));this.map.zoomTo(c);this.zoomStart=this.mouseDragStart=null;this.deltaY=0;OpenLayers.Event.stop(d)}},moveZoomBar:function(){this.slider.style.top=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wfs:{WFS_Capabilities:function(d,c){this.readChildNodes(d,c)},FeatureTypeList:function(d,c){c.featureTypeList={featureTypes:[]};this.readChildNodes(d,c.featureTypeList)},FeatureType:function(e,d){var f={};this.readChildNodes(e,f);d.featureTypes.push(f)},Name:function(e,d){var f=this.getChildValue(e);f&&(f=f.split(":"),d.name=f.pop(),0<f.length&&(d.featureNS=this.lookupNamespaceURI(e,f[0])))},Title:function(e,d){var f=this.getChildValue(e);f&&(d.title=f)},Abstract:function(e,d){var f=this.getChildValue(e);f&&(d["abstract"]=f)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(e,d){var f=this.getChildValue(e);f&&(d.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(g,f,k,j,h){this.url=f;this.maxExtent=this.extent=k;this.size=j;OpenLayers.Layer.prototype.initialize.apply(this,[g,h]);this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null);OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions()));return b=OpenLayers.Layer.prototype.clone.apply(this,[b])},setMap:function(b){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w);OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(g,f,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var j=null==this.tile;if(f||j){this.setTileSize();var h=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});j?(this.tile=new OpenLayers.Tile.Image(this,h,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=h.clone());this.tile.draw()}},setTileSize:function(){var d=this.extent.getWidth()/this.map.getResolution(),c=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(d,c)},addTileMonitoringHooks:function(b){b.onLoadStart=function(){this.events.triggerEvent("loadstart")};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.events.triggerEvent("loadend")};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd)},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this})},setUrl:function(b){this.url=b;this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;this.active=!1},destroy:function(){this.deactivate();this.options=this.layer=null},setLayer:function(b){this.layer=b},activate:function(){return !this.active?this.active=!0:!1},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(b){OpenLayers.Strategy.prototype.initialize.apply(this,[b]);this.events=new OpenLayers.Events(this)},activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b&&this.auto){if("number"===typeof this.auto){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1000*this.auto)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.auto&&("number"===typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this}));return b},triggerSave:function(d){var c=d.feature;(c.state===OpenLayers.State.INSERT||c.state===OpenLayers.State.UPDATE||c.state===OpenLayers.State.DELETE)&&this.save([d.feature])},save:function(k){k||(k=this.layer.features);this.events.triggerEvent("start",{features:k});var j=this.layer.projection,q=this.layer.map.getProjectionObject();if(!q.equals(j)){for(var p=k.length,o=Array(p),n,m,l=0;l<p;++l){n=k[l],m=n.clone(),m.fid=n.fid,m.state=n.state,n.url&&(m.url=n.url),m._original=n,m.geometry.transform(q,j),o[l]=m}k=o}this.layer.protocol.commit(k,{callback:this.onCommit,scope:this})},onCommit:function(r){var q={response:r};if(r.success()){for(var p=r.reqFeatures,o,n=[],m=r.insertIds||[],l=0,k=0,j=p.length;k<j;++k){if(o=p[k],o=o._original||o,r=o.state){r==OpenLayers.State.DELETE?n.push(o):r==OpenLayers.State.INSERT&&(o.fid=m[l],++l),o.state=null}}0<n.length&&this.layer.destroyFeatures(n);this.events.triggerEvent("success",q)}else{this.events.triggerEvent("fail",q)}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(b){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(t){"string"==typeof t&&(t=OpenLayers.Format.XML.prototype.read.apply(this,[t]));var s=[];if(this.extractTracks){for(var r=t.getElementsByTagName("trk"),q=0,p=r.length;q<p;q++){var o={};this.extractAttributes&&(o=this.parseAttributes(r[q]));for(var n=this.getElementsByTagNameNS(r[q],r[q].namespaceURI,"trkseg"),m=0,l=n.length;m<l;m++){var k=this.extractSegment(n[m],"trkpt");s.push(new OpenLayers.Feature.Vector(k,o))}}}if(this.extractRoutes){p=t.getElementsByTagName("rte");r=0;for(q=p.length;r<q;r++){o={},this.extractAttributes&&(o=this.parseAttributes(p[r])),n=this.extractSegment(p[r],"rtept"),s.push(new OpenLayers.Feature.Vector(n,o))}}if(this.extractWaypoints){t=t.getElementsByTagName("wpt");r=0;for(p=t.length;r<p;r++){o={},this.extractAttributes&&(o=this.parseAttributes(t[r])),q=new OpenLayers.Geometry.Point(t[r].getAttribute("lon"),t[r].getAttribute("lat")),s.push(new OpenLayers.Feature.Vector(q,o))}}if(this.internalProjection&&this.externalProjection){o=0;for(t=s.length;o<t;o++){s[o].geometry.transform(this.externalProjection,this.internalProjection)}}return s},extractSegment:function(h,g){for(var m=this.getElementsByTagNameNS(h,h.namespaceURI,g),l=[],k=0,j=m.length;k<j;k++){l.push(new OpenLayers.Geometry.Point(m[k].getAttribute("lon"),m[k].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(l)},parseAttributes:function(f){for(var e={},f=f.firstChild,h,g;f;){if(1==f.nodeType&&f.firstChild&&(h=f.firstChild,3==h.nodeType||4==h.nodeType)){g=f.prefix?f.nodeName.split(":")[1]:f.nodeName,"trkseg"!=g&&"rtept"!=g&&(e[g]=h.nodeValue)}f=f.nextSibling}return e},write:function(g,f){var g=OpenLayers.Util.isArray(g)?g:[g],k=this.createElementNS(this.namespaces.gpx,"gpx");k.setAttribute("version","1.1");k.setAttribute("creator",this.creator);this.setAttributes(k,{"xsi:schemaLocation":this.schemaLocation});f&&"object"==typeof f&&k.appendChild(this.buildMetadataNode(f));for(var j=0,h=g.length;j<h;j++){k.appendChild(this.buildFeatureNode(g[j]))}return OpenLayers.Format.XML.prototype.write.apply(this,[k])},buildMetadataNode:function(h){for(var g=["name","desc","author"],m=this.createElementNSPlus("gpx:metadata"),l=0;l<g.length;l++){var k=g[l];if(h[k]){var j=this.createElementNSPlus("gpx:"+k);j.appendChild(this.createTextNode(h[k]));m.appendChild(j)}}return m},buildFeatureNode:function(f){var e=f.geometry,e=e.clone();this.internalProjection&&this.externalProjection&&e.transform(this.internalProjection,this.externalProjection);if("OpenLayers.Geometry.Point"==e.CLASS_NAME){var h=this.buildWptNode(e);this.appendAttributesNode(h,f);return h}h=this.createElementNSPlus("gpx:trk");this.appendAttributesNode(h,f);for(var f=this.buildTrkSegNode(e),f=OpenLayers.Util.isArray(f)?f:[f],e=0,g=f.length;e<g;e++){h.appendChild(f[e])}return h},buildTrkSegNode:function(g){var f,k,j,h;if("OpenLayers.Geometry.LineString"==g.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==g.CLASS_NAME){f=this.createElementNSPlus("gpx:trkseg");k=0;for(j=g.components.length;k<j;k++){h=g.components[k],f.appendChild(this.buildTrkPtNode(h))}return f}f=[];k=0;for(j=g.components.length;k<j;k++){f.push(this.buildTrkSegNode(g.components[k]))}return f},buildTrkPtNode:function(d){var c=this.createElementNSPlus("gpx:trkpt");c.setAttribute("lon",d.x);c.setAttribute("lat",d.y);return c},buildWptNode:function(d){var c=this.createElementNSPlus("gpx:wpt");c.setAttribute("lon",d.x);c.setAttribute("lat",d.y);return c},appendAttributesNode:function(e,d){var f=this.createElementNSPlus("gpx:name");f.appendChild(this.createTextNode(d.attributes.name||d.id));e.appendChild(f);f=this.createElementNSPlus("gpx:desc");f.appendChild(this.createTextNode(d.attributes.description||this.defaultDesc));e.appendChild(f)},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(e,d){var f=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);if("1.1.1"==f||"1.1.0"==f){f="1.1"}return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(b){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[b])},read:function(k){"string"==typeof k&&(k=OpenLayers.Format.XML.prototype.read.apply(this,[k]));for(var k=k.documentElement.childNodes,j=[],q,p,o=0;o<k.length;++o){if(q=k[o],p=q.nodeName,"LayerDescription"==p){p=q.getAttribute("name");var n="",m="",l="";q.getAttribute("owsType")?(n=q.getAttribute("owsType"),m=q.getAttribute("owsURL")):""!=q.getAttribute("wfs")?(n="WFS",m=q.getAttribute("wfs")):""!=q.getAttribute("wcs")&&(n="WCS",m=q.getAttribute("wcs"));q=q.getElementsByTagName("Query");0<q.length&&((l=q[0].getAttribute("typeName"))||(l=q[0].getAttribute("typename")));j.push({layerName:p,owsType:n,owsURL:m,typeName:l})}}return j},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,d,f){if(f&&f.sphericalMercator||this.sphericalMercator){f=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},f)}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,d||this.url,{},f])},clone:function(b){null==b&&(b=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var d=this.getXYZ(d),c=this.url;OpenLayers.Util.isArray(c)&&(c=this.selectUrl(""+d.x+d.y+d.z,c));return OpenLayers.String.format(c,d)},getXYZ:function(f){var e=this.getServerResolution(),h=Math.round((f.left-this.maxExtent.left)/(e*this.tileSize.w)),f=Math.round((this.maxExtent.top-f.top)/(e*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var g=Math.pow(2,e),h=(h%g+g)%g}return{x:h,y:f,z:e}},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(e,d,f){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(d,c){this.container=OpenLayers.Util.getElement(d);OpenLayers.Util.extend(this,c)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return !1},setExtent:function(e,d){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var f=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/f);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(f)}d&&(this.resolution=null);return !0},setSize:function(b){this.size=b.clone();this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(j,h){null==h&&(h=j.style);if(j.geometry){var o=j.geometry.getBounds();if(o){var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());o.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(o,n):h={display:"none"};o=this.drawGeometry(j.geometry,h,j.id);if("none"!=h.display&&h.label&&!1!==o){n=j.geometry.getCentroid();if(h.labelXOffset||h.labelYOffset){var m=isNaN(h.labelXOffset)?0:h.labelXOffset,l=isNaN(h.labelYOffset)?0:h.labelYOffset,k=this.getResolution();n.move(m*k,l*k)}this.drawText(j.id,h,n)}else{this.removeText(j.id)}return o}}},calculateFeatureDx:function(e,d){this.featureDx=0;if(d){var f=d.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/f)*f}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(f){OpenLayers.Util.isArray(f)||(f=[f]);for(var e=0,h=f.length;e<h;++e){var g=f[e];this.eraseGeometry(g.geometry,g.id);this.removeText(g.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(d){var c=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);!1===d.stroke&&(delete c.strokeWidth,delete c.strokeColor);!1===d.fill&&delete c.fillColor;OpenLayers.Util.extend(c,d);return c},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return !1},eraseGeometry:function(d,c){this.eraseFeatures(this.features[c][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(d){this.size=d.clone();var c=this.root;c.style.width=d.w+"px";c.style.height=d.h+"px";c.width=d.w;c.height=d.h;this.resolution=null;this.hitDetection&&(c=this.hitCanvas,c.style.width=d.w+"px",c.style.height=d.h+"px",c.width=d.w,c.height=d.h)},drawFeature:function(f,e){var h;if(f.geometry){e=this.applyDefaultSymbolizer(e||f.style);h=f.geometry.getBounds();var g;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(g=this.map.getMaxExtent());g=h&&h.intersectsBounds(this.extent,{worldBounds:g});(h="none"!==e.display&&!!h&&g)?this.features[f.id]=[f,e]:delete this.features[f.id];this.pendingRedraw=!0}this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1);return h},drawGeometry:function(f,e,h){var g=f.CLASS_NAME;if("OpenLayers.Geometry.Collection"==g||"OpenLayers.Geometry.MultiPoint"==g||"OpenLayers.Geometry.MultiLineString"==g||"OpenLayers.Geometry.MultiPolygon"==g){for(g=0;g<f.components.length;g++){this.drawGeometry(f.components[g],e,h)}}else{switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(f,e,h);break;case"OpenLayers.Geometry.LineString":this.drawLineString(f,e,h);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(f,e,h);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(f,e,h)}}},drawExternalGraphic:function(r,q,p){var o=new Image;q.graphicTitle&&(o.title=q.graphicTitle);var n=q.graphicWidth||q.graphicHeight,m=q.graphicHeight||q.graphicWidth,n=n?n:2*q.pointRadius,m=m?m:2*q.pointRadius,l=void 0!=q.graphicXOffset?q.graphicXOffset:-(0.5*n),k=void 0!=q.graphicYOffset?q.graphicYOffset:-(0.5*m),j=q.graphicOpacity||q.fillOpacity;o.onload=OpenLayers.Function.bind(function(){if(this.features[p]){var c=this.getLocalXY(r),e=c[0],c=c[1];if(!isNaN(e)&&!isNaN(c)){var e=e+l|0,c=c+k|0,d=this.canvas;d.globalAlpha=j;var a=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(o,e*a,c*a,n*a,m*a);if(this.hitDetection){this.setHitContextStyle("fill",p);this.hitContext.fillRect(e,c,n,m)}}}},this);o.src=q.externalGraphic},drawNamedSymbol:function(k,j,q){var p,o,n,m;n=Math.PI/180;var l=OpenLayers.Renderer.symbol[j.graphicName];if(!l){throw Error(j.graphicName+" is not a valid symbol name")}if(l.length&&!(2>l.length)&&(k=this.getLocalXY(k),o=k[0],m=k[1],!isNaN(o)&&!isNaN(m))){this.canvas.lineCap="round";this.canvas.lineJoin="round";this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round");if(j.graphicName in this.cachedSymbolBounds){p=this.cachedSymbolBounds[j.graphicName]}else{p=new OpenLayers.Bounds;for(k=0;k<l.length;k+=2){p.extend(new OpenLayers.LonLat(l[k],l[k+1]))}this.cachedSymbolBounds[j.graphicName]=p}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(o,m);this.hitDetection&&this.hitContext.translate(o,m);k=n*j.rotation;isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k));n=2*j.pointRadius/Math.max(p.getWidth(),p.getHeight());this.canvas.scale(n,n);this.hitDetection&&this.hitContext.scale(n,n);k=p.getCenterLonLat().lon;p=p.getCenterLonLat().lat;this.canvas.translate(-k,-p);this.hitDetection&&this.hitContext.translate(-k,-p);m=j.strokeWidth;j.strokeWidth=m/n;if(!1!==j.fill){this.setCanvasStyle("fill",j);this.canvas.beginPath();for(k=0;k<l.length;k+=2){p=l[k],o=l[k+1],0==k&&this.canvas.moveTo(p,o),this.canvas.lineTo(p,o)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",q,j);this.hitContext.beginPath();for(k=0;k<l.length;k+=2){p=l[k],o=l[k+1],0==k&&this.canvas.moveTo(p,o),this.hitContext.lineTo(p,o)}this.hitContext.closePath();this.hitContext.fill()}}if(!1!==j.stroke){this.setCanvasStyle("stroke",j);this.canvas.beginPath();for(k=0;k<l.length;k+=2){p=l[k],o=l[k+1],0==k&&this.canvas.moveTo(p,o),this.canvas.lineTo(p,o)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",q,j,n);this.hitContext.beginPath();for(k=0;k<l.length;k+=2){p=l[k],o=l[k+1],0==k&&this.hitContext.moveTo(p,o),this.hitContext.lineTo(p,o)}this.hitContext.closePath();this.hitContext.stroke()}}j.strokeWidth=m;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}},setCanvasStyle:function(d,c){"fill"===d?(this.canvas.globalAlpha=c.fillOpacity,this.canvas.fillStyle=c.fillColor):"stroke"===d?(this.canvas.globalAlpha=c.strokeOpacity,this.canvas.strokeStyle=c.strokeColor,this.canvas.lineWidth=c.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(d){d=Number(d.split("_").pop())+1;16777216<=d&&(this.hitOverflow=d-16777215,d=d%16777216+1);var d="000000"+d.toString(16),c=d.length;return d="#"+d.substring(c-6,c)},setHitContextStyle:function(f,e,h,g){e=this.featureIdToHex(e);"fill"==f?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==f?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"===typeof g?this.hitContext.lineWidth=h.strokeWidth+2:isNaN(g)||(this.hitContext.lineWidth=h.strokeWidth+2/g)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(h,g,m){if(!1!==g.graphic){if(g.externalGraphic){this.drawExternalGraphic(h,g,m)}else{if(g.graphicName&&"circle"!=g.graphicName){this.drawNamedSymbol(h,g,m)}else{var l=this.getLocalXY(h),h=l[0],l=l[1];if(!isNaN(h)&&!isNaN(l)){var k=2*Math.PI,j=g.pointRadius;!1!==g.fill&&(this.setCanvasStyle("fill",g),this.canvas.beginPath(),this.canvas.arc(h,l,j,0,k,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",m,g),this.hitContext.beginPath(),this.hitContext.arc(h,l,j,0,k,!0),this.hitContext.fill()));!1!==g.stroke&&(this.setCanvasStyle("stroke",g),this.canvas.beginPath(),this.canvas.arc(h,l,j,0,k,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",m,g),this.hitContext.beginPath(),this.hitContext.arc(h,l,j,0,k,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}}}},drawLineString:function(e,d,f){d=OpenLayers.Util.applyDefaults({fill:!1},d);this.drawLinearRing(e,d,f)},drawLinearRing:function(e,d,f){!1!==d.fill&&(this.setCanvasStyle("fill",d),this.renderPath(this.canvas,e,d,f,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",f,d),this.renderPath(this.hitContext,e,d,f,"fill")));!1!==d.stroke&&(this.setCanvasStyle("stroke",d),this.renderPath(this.canvas,e,d,f,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",f,d),this.renderPath(this.hitContext,e,d,f,"stroke")));this.setCanvasStyle("reset")},renderPath:function(h,g,m,l,k){g=g.components;m=g.length;h.beginPath();var l=this.getLocalXY(g[0]),j=l[1];if(!isNaN(l[0])&&!isNaN(j)){h.moveTo(l[0],l[1]);for(l=1;l<m;++l){j=this.getLocalXY(g[l]),h.lineTo(j[0],j[1])}"fill"===k?h.fill():h.stroke()}},drawPolygon:function(g,f,k){var g=g.components,j=g.length;this.drawLinearRing(g[0],f,k);for(var h=1;h<j;++h){this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},f),k),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(g[h],OpenLayers.Util.applyDefaults({fill:!1},f),k)}},drawText:function(t,s){var r=this.getLocalXY(t);this.setCanvasStyle("reset");this.canvas.fillStyle=s.fontColor;this.canvas.globalAlpha=s.fontOpacity||1;var q=[s.fontStyle?s.fontStyle:"normal","normal",s.fontWeight?s.fontWeight:"normal",s.fontSize?s.fontSize:"1em",s.fontFamily?s.fontFamily:"sans-serif"].join(" "),p=s.label.split("\n"),o=p.length;if(this.canvas.fillText){this.canvas.font=q;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[s.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[s.labelAlign[1]]||"middle";var n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[1]];null==n&&(n=-0.5);q=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;r[1]+=q*n*(o-1);for(n=0;n<o;n++){s.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=s.labelOutlineColor,this.canvas.lineWidth=s.labelOutlineWidth,this.canvas.strokeText(p[n],r[0],r[1]+q*n+1),this.canvas.restore()),this.canvas.fillText(p[n],r[0],r[1]+q*n)}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=q;var m=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[0]];null==m&&(m=-0.5);n=OpenLayers.Renderer.Canvas.LABEL_FACTOR[s.labelAlign[1]];null==n&&(n=-0.5);q=this.canvas.mozMeasureText("xx");r[1]+=q*(1+n*o);for(n=0;n<o;n++){var l=r[0]+m*this.canvas.mozMeasureText(p[n]),k=r[1]+n*q;this.canvas.translate(l,k);this.canvas.mozDrawText(p[n]);this.canvas.translate(-l,-k)}}}this.setCanvasStyle("reset")},getLocalXY:function(e){var d=this.getResolution(),f=this.extent;return[(e.x-this.featureDx)/d+-f.left/d,f.top/d-e.y/d]},clear:function(){var d=this.root.height,c=this.root.width;this.canvas.clearRect(0,0,c,d);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,c,d)},getFeatureIdFromEvent:function(e){var d;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(e.x|0,e.y|0,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers.Feature.Vector_"+(e-1+this.hitOverflow);try{d=this.features[e][0]}catch(f){}}return d},eraseFeatures:function(d){OpenLayers.Util.isArray(d)||(d=[d]);for(var c=0;c<d.length;++c){delete this.features[d[c].id]}this.redraw()},redraw:function(){if(!this.locked){var h=this.root.height,g=this.root.width;this.canvas.clearRect(0,0,g,h);this.hitDetection&&this.hitContext.clearRect(0,0,g,h);var h=[],m,l,k=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent(),j;for(j in this.features){this.features.hasOwnProperty(j)&&(g=this.features[j][0],m=g.geometry,this.calculateFeatureDx(m.getBounds(),k),l=this.features[j][1],this.drawGeometry(m,l,g.id),l.label&&h.push([g,l]))}g=0;for(m=h.length;g<m;++g){j=h[g],this.drawText(j[0].geometry.getCentroid(),j[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(e){for(var d={interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")},d=OpenLayers.Util.extend(d,e),f={},e=0;e<d.interestingTagsExclude.length;e++){f[d.interestingTagsExclude[e]]=!0}d.interestingTagsExclude=f;f={};for(e=0;e<d.areaTags.length;e++){f[d.areaTags[e]]=!0}d.areaTags=f;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[d])},read:function(t){"string"==typeof t&&(t=OpenLayers.Format.XML.prototype.read.apply(this,[t]));for(var s=this.getNodes(t),r=this.getWays(t),t=Array(r.length),q=0;q<r.length;q++){for(var p=Array(r[q].nodes.length),o=this.isWayArea(r[q])?1:0,n=0;n<r[q].nodes.length;n++){var m=s[r[q].nodes[n]],l=new OpenLayers.Geometry.Point(m.lon,m.lat);l.osm_id=parseInt(r[q].nodes[n]);p[n]=l;m.used=!0}m=null;m=o?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(p)):new OpenLayers.Geometry.LineString(p);this.internalProjection&&this.externalProjection&&m.transform(this.externalProjection,this.internalProjection);p=new OpenLayers.Feature.Vector(m,r[q].tags);p.osm_id=parseInt(r[q].id);p.fid="way."+p.osm_id;t[q]=p}for(var k in s){m=s[k];if(!m.used||this.checkTags){r=null;if(this.checkTags){r=this.getTags(m.node,!0);if(m.used&&!r[1]){continue}r=r[0]}else{r=this.getTags(m.node)}p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m.lon,m.lat),r);this.internalProjection&&this.externalProjection&&p.geometry.transform(this.externalProjection,this.internalProjection);p.osm_id=parseInt(k);p.fid="node."+p.osm_id;t.push(p)}m.node=null}return t},getNodes:function(g){for(var g=g.getElementsByTagName("node"),f={},k=0;k<g.length;k++){var j=g[k],h=j.getAttribute("id");f[h]={lat:j.getAttribute("lat"),lon:j.getAttribute("lon"),node:j}}return f},getWays:function(h){for(var h=h.getElementsByTagName("way"),g=[],m=0;m<h.length;m++){var l=h[m],k={id:l.getAttribute("id")};k.tags=this.getTags(l);l=l.getElementsByTagName("nd");k.nodes=Array(l.length);for(var j=0;j<l.length;j++){k.nodes[j]=l[j].getAttribute("ref")}g.push(k)}return g},getTags:function(j,h){for(var o=j.getElementsByTagName("tag"),n={},m=!1,l=0;l<o.length;l++){var k=o[l].getAttribute("k");n[k]=o[l].getAttribute("v");h&&(this.interestingTagsExclude[k]||(m=!0))}return h?[n,m]:n},isWayArea:function(f){var e=!1,h=!1;f.nodes[0]==f.nodes[f.nodes.length-1]&&(e=!0);if(this.checkTags){for(var g in f.tags){if(this.areaTags[g]){h=!0;break}}}return e&&(this.checkTags?h:!0)},write:function(g){OpenLayers.Util.isArray(g)||(g=[g]);this.osm_id=1;this.created_nodes={};var f=this.createElementNS(null,"osm");f.setAttribute("version","0.5");f.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var k=g.length-1;0<=k;k--){for(var j=this.createFeatureNodes(g[k]),h=0;h<j.length;h++){f.appendChild(j[h])}}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFeatureNodes:function(e){var d=[],f=e.geometry.CLASS_NAME,f=f.substring(f.lastIndexOf(".")+1),f=f.toLowerCase();(f=this.createXML[f])&&(d=f.apply(this,[e]));return d},createXML:{point:function(g){var f=null,k=g.geometry?g.geometry:g;this.internalProjection&&this.externalProjection&&(k=k.clone(),k.transform(this.internalProjection,this.externalProjection));var j=!1;g.osm_id?(f=g.osm_id,this.created_nodes[f]&&(j=!0)):(f=-this.osm_id,this.osm_id++);var h=j?this.created_nodes[f]:this.createElementNS(null,"node");this.created_nodes[f]=h;h.setAttribute("id",f);h.setAttribute("lon",k.x);h.setAttribute("lat",k.y);g.attributes&&this.serializeTags(g,h);this.setState(g,h);return j?[]:[h]},linestring:function(j){var h,o=[],n=j.geometry;j.osm_id?h=j.osm_id:(h=-this.osm_id,this.osm_id++);var m=this.createElementNS(null,"way");m.setAttribute("id",h);for(h=0;h<n.components.length;h++){var l=this.createXML.point.apply(this,[n.components[h]]);if(l.length){var l=l[0],k=l.getAttribute("id");o.push(l)}else{k=n.components[h].osm_id,l=this.created_nodes[k]}this.setState(j,l);l=this.createElementNS(null,"nd");l.setAttribute("ref",k);m.appendChild(l)}this.serializeTags(j,m);o.push(m);return o},polygon:function(d){var c=OpenLayers.Util.extend({area:"yes"},d.attributes),c=new OpenLayers.Feature.Vector(d.geometry.components[0],c);c.osm_id=d.osm_id;return this.createXML.linestring.apply(this,[c])}},serializeTags:function(f,e){for(var h in f.attributes){var g=this.createElementNS(null,"tag");g.setAttribute("k",h);g.setAttribute("v",f.attributes[h]);e.appendChild(g)}},setState:function(e,d){if(e.state){var f=null;switch(e.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:f="delete"}f&&d.setAttribute("action",f)}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,d,f){OpenLayers.Util.extend(this,f);this.control=e;this.callbacks=d;(e=this.map||e.map)&&this.setMap(e);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(b){this.map=b},checkModifiers:function(b){return null==this.keyMask?!0:((b.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(b.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(b.altKey?OpenLayers.Handler.MOD_ALT:0))==this.keyMask},activate:function(){if(this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.register(e[d],this[e[d]])}return this.active=!0},deactivate:function(){if(!this.active){return !1}for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,d=0,f=e.length;d<f;d++){this[e[d]]&&this.unregister(e[d],this[e[d]])}this.active=!1;return !0},callback:function(d,c){d&&this.callbacks[d]&&this.callbacks[d].apply(this.control,c)},register:function(d,c){this.map.events.registerPriority(d,this,c);this.map.events.registerPriority(d,this,this.setEvent)},unregister:function(d,c){this.map.events.unregister(d,this,c);this.map.events.unregister(d,this,this.setEvent)},setEvent:function(b){this.evt=b;return !0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(f,e,h){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var g=this;this._docMove=function(b){g.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})};this._docUp=function(b){g.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(d){var c=!0;this.dragging=!1;this.checkModifiers(d)&&(OpenLayers.Event.isLeftClick(d)||OpenLayers.Event.isSingleTouch(d))?(this.started=!0,this.last=this.start=d.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(d),this.callback("down",[d.xy]),OpenLayers.Event.stop(d),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,c=!this.stopDown):(this.started=!1,this.last=this.start=null);return c},dragmove:function(b){this.lastMoveEvt=b;if(this.started&&!this.timeoutId&&(b.xy.x!=this.last.x||b.xy.y!=this.last.y)){!0===this.documentDrag&&this.documentEvents&&(b.element===document?(this.adjustXY(b),this.setEvent(b)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(b),this.callback("move",[b.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=b.xy}return !0},dragend:function(d){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(d),this.removeDocumentEvents());var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(d);this.callback("up",[d.xy]);c&&this.callback("done",[d.xy]);document.onselectstart=this.oldOnselectstart}return !0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(b){return this.dragstart(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this}));return this.dragstart(b)},mousemove:function(b){return this.dragmove(b)},touchmove:function(b){return this.dragmove(b)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(b){return this.dragend(b)},touchend:function(b){b.xy=this.last;return this.dragend(b)},mouseout:function(d){if(this.started&&OpenLayers.Util.mouseLeft(d,this.map.viewPortDiv)){if(!0===this.documentDrag){this.addDocumentEvents()}else{var c=this.start!=this.last;this.dragging=this.started=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(d);this.callback("out",[]);c&&this.callback("done",[d.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return !0},click:function(){return this.start==this.last},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=this.touch=!1,this.last=this.start=null,b=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"));return b},adjustXY:function(d){var c=OpenLayers.Util.pagePosition(this.map.viewPortDiv);d.xy.x-=c[0];d.xy.y-=c[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(f,e,h,g){OpenLayers.Handler.prototype.initialize.apply(this,[f,h,g]);this.layer=e},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));return OpenLayers.Event.isMultiTouch(b)?!0:this.mousedown(b)},touchmove:function(b){OpenLayers.Event.stop(b)},mousedown:function(b){if(OpenLayers.Event.isLeftClick(b)||OpenLayers.Event.isSingleTouch(b)){this.down=b.xy}return this.handle(b)?!this.stopDown:!0},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:!0},click:function(b){return this.handle(b)?!this.stopClick:!0},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return !0}this.handle(b);return !0},dblclick:function(b){return !this.handle(b)},geometryTypeMatches:function(b){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)},handle:function(g){this.feature&&!this.feature.layer&&(this.feature=null);var f=g.type,k=!1,j=!!this.feature,h="click"==f||"dblclick"==f||"touchstart"==f;if((this.feature=this.layer.getFeatureFromEvent(g))&&!this.feature.layer){this.feature=null}this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);this.feature?("touchstart"===f&&OpenLayers.Event.stop(g),g=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(j&&g?(this.lastFeature&&this.triggerCallback(f,"out",[this.lastFeature]),this.triggerCallback(f,"in",[this.feature])):(!j||h)&&this.triggerCallback(f,"in",[this.feature]),this.lastFeature=this.feature,k=!0):(this.lastFeature&&(j&&g||h)&&this.triggerCallback(f,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(j||h)&&this.triggerCallback(f,"out",[this.lastFeature]);return k},triggerCallback:function(e,d,f){(d=this.EVENTMAP[e][d])&&("click"==e&&this.up&&this.down?Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(d,f):this.callback(d,f))},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),b=!0);return b},handleMapEvents:function(b){("removelayer"==b.type||"order"==b.property)&&this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;b>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(b):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.layer=d;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(b){this.handlers.feature.touch&&(!this.over&&this.overFeature(b))&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(b){this.handlers.feature.touch&&this.over&&(this.outFeature(b),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(d){var c=!1;this.handlers.drag.dragging?this.over=this.feature.id==d.id?!0:!1:(this.feature=d,this.handlers.drag.activate(),this.over=c=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(d));return c},downFeature:function(b){this.lastPixel=b;this.onStart(this.feature,b)},moveFeature:function(d){var c=this.map.getResolution();this.feature.geometry.move(c*(d.x-this.lastPixel.x),c*(this.lastPixel.y-d.y));this.layer.drawFeature(this.feature);this.lastPixel=d;this.onDrag(this.feature,d)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(b){this.onComplete(this.feature,b)},outFeature:function(b){this.handlers.drag.dragging?this.feature.id==b.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(b),this.feature=null)},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(b){this.handlers.drag.setMap(b);this.handlers.feature.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,d){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e}else{if("object"==typeof e){for(var f in e){if(e[f] instanceof OpenLayers.Style){this.styles[f]=e[f]}else{if("object"==typeof e[f]){this.styles[f]=new OpenLayers.Style(e[f])}else{this.styles["default"]=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}}}}}OpenLayers.Util.extend(this,d)},destroy:function(){for(var b in this.styles){this.styles[b].destroy()}this.styles=null},createSymbolizer:function(e,d){e||(e=new OpenLayers.Feature.Vector);this.styles[d]||(d="default");e.renderIntent=d;var f={};this.extendDefault&&"default"!=d&&(f=this.styles["default"].createSymbolizer(e));return OpenLayers.Util.extend(f,this.styles[d].createSymbolizer(e))},addUniqueValueRules:function(h,g,m,l){var k=[],j;for(j in m){k.push(new OpenLayers.Rule({symbolizer:m[j],context:l,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:g,value:j})}))}this.styles[h].addRules(k)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(f,e){OpenLayers.Layer.prototype.initialize.apply(this,arguments);(!this.renderer||!this.renderer.supported())&&this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null,this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var h=0,g=this.strategies.length;h<g;h++){this.strategies[h].setLayer(this)}}},destroy:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoDestroy&&e.destroy()}this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null);this.destroyFeatures();this.unrenderedFeatures=this.selectedFeatures=this.features=null;this.renderer&&this.renderer.destroy();this.drawn=this.geometryType=this.renderer=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(g){null==g&&(g=new OpenLayers.Layer.Vector(this.name,this.getOptions()));for(var g=OpenLayers.Layer.prototype.clone.apply(this,[g]),f=this.features,k=f.length,j=Array(k),h=0;h<k;++h){j[h]=f[h].clone()}g.features=j;return g},refresh:function(b){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",b)},assignRenderer:function(){for(var e=0,d=this.renderers.length;e<d;e++){var f=this.renderers[e];if((f="function"==typeof f?f:OpenLayers.Renderer[f])&&f.prototype.supported()){this.renderer=new f(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(d){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var c=this.map.getSize();c.w*=this.ratio;c.h*=this.ratio;this.renderer.setSize(c)}else{this.map.removeLayer(this)}},afterAdd:function(){if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.activate()}}},removeMap:function(){this.drawn=!1;if(this.strategies){var e,d,f;d=0;for(f=this.strategies.length;d<f;d++){e=this.strategies[d],e.autoActivate&&e.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var b=this.map.getSize();b.w*=this.ratio;b.h*=this.ratio;this.renderer.setSize(b)},moveTo:function(h,g,o){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!o){var k=this.map.layerContainerDiv.style.left;if(k.length==0){if(typeof console!="undefined"){console.warn("map.layerContainerDiv.style.left is empty and set to 0")}k=0}var j=this.map.layerContainerDiv.style.top;if(j.length==0){if(typeof console!="undefined"){console.warn("map.layerContainerDiv.style.top is empty and set to 0")}j=0}this.renderer.root.style.visibility="hidden";var n=this.map.getSize(),m=n.w,n=n.h,m=m/2*this.ratio-m/2,n=n/2*this.ratio-n/2,m=m+parseInt(k,10),m=-Math.round(m),n=n+parseInt(j,10),n=-Math.round(n);this.div.style.left=m+"px";this.div.style.top=n+"px";n=this.renderer.setExtent(this.map.getExtent().scale(this.ratio),g);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!g&&n){for(var l in this.unrenderedFeatures){m=this.unrenderedFeatures[l],this.drawFeature(m)}}}if(!this.drawn||g||!n){this.drawn=!0;l=0;for(n=this.features.length;l<n;l++){this.renderer.locked=l!==n-1,m=this.features[l],this.drawFeature(m)}}},display:function(d){OpenLayers.Layer.prototype.display.apply(this,arguments);var c=this.div.style.display;c!=this.renderer.root.style.display&&(this.renderer.root.style.display=c)},addFeatures:function(j,h){OpenLayers.Util.isArray(j)||(j=[j]);var o=!h||!h.silent;if(o){var n={features:j};if(!1===this.events.triggerEvent("beforefeaturesadded",n)){return}j=n.features}for(var n=[],m=0,l=j.length;m<l;m++){this.renderer.locked=m!=j.length-1?!0:!1;var k=j[m];if(this.geometryType&&!(k.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}k.layer=this;!k.style&&this.style&&(k.style=OpenLayers.Util.extend({},this.style));if(o){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:k})){continue}this.preFeatureInsert(k)}n.push(k);this.features.push(k);this.drawFeature(k);o&&(this.events.triggerEvent("featureadded",{feature:k}),this.onFeatureInsert(k))}o&&this.events.triggerEvent("featuresadded",{features:n})},removeFeatures:function(g,f){if(g&&0!==g.length){if(g===this.features){return this.removeAllFeatures(f)}OpenLayers.Util.isArray(g)||(g=[g]);g===this.selectedFeatures&&(g=g.slice());var k=!f||!f.silent;k&&this.events.triggerEvent("beforefeaturesremoved",{features:g});for(var j=g.length-1;0<=j;j--){this.renderer.locked=0!=j&&g[j-1].geometry?!0:!1;var h=g[j];delete this.unrenderedFeatures[h.id];k&&this.events.triggerEvent("beforefeatureremoved",{feature:h});this.features=OpenLayers.Util.removeItem(this.features,h);h.layer=null;h.geometry&&this.renderer.eraseFeatures(h);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,h)&&OpenLayers.Util.removeItem(this.selectedFeatures,h);k&&this.events.triggerEvent("featureremoved",{feature:h})}k&&this.events.triggerEvent("featuresremoved",{features:g})}},removeAllFeatures:function(f){var f=!f||!f.silent,e=this.features;f&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var h,g=e.length-1;0<=g;g--){h=e[g],f&&this.events.triggerEvent("beforefeatureremoved",{feature:h}),h.layer=null,f&&this.events.triggerEvent("featureremoved",{feature:h})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];f&&this.events.triggerEvent("featuresremoved",{features:e})},destroyFeatures:function(e,d){void 0==e&&(e=this.features);if(e){this.removeFeatures(e,d);for(var f=e.length-1;0<=f;f--){e[f].destroy()}}},drawFeature:function(e,d){if(this.drawn){if("object"!=typeof d){!d&&e.state===OpenLayers.State.DELETE&&(d="delete");var f=d||e.renderIntent;(d=e.style||this.style)||(d=this.styleMap.createSymbolizer(e,f))}f=this.renderer.drawFeature(e,d);!1===f||null===f?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(b){this.renderer.eraseFeatures(b)},getFeatureFromEvent:function(d){if(!this.renderer){throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var c=null;(d=this.renderer.getFeatureIdFromEvent(d))&&(c="string"===typeof d?this.getFeatureById(d):d);return c},getFeatureBy:function(g,f){for(var k=null,j=0,h=this.features.length;j<h;++j){if(this.features[j][g]==f){k=this.features[j];break}}return k},getFeatureById:function(b){return this.getFeatureBy("id",b)},getFeatureByFid:function(b){return this.getFeatureBy("fid",b)},getFeaturesByAttribute:function(h,g){var m,l,k=this.features.length,j=[];for(m=0;m<k;m++){(l=this.features[m])&&l.attributes&&l.attributes[h]===g&&j.push(l)}return j},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var g=null,f=this.features;if(f&&0<f.length){for(var k=null,j=0,h=f.length;j<h;j++){if(k=f[j].geometry){null===g&&(g=new OpenLayers.Bounds),g.extend(k.getBounds())}}}return g},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(f){for(var e=this.layers,h,g=0;g<e.length;g++){if(h=e[g].getFeatureFromEvent(f)){return h}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var d,c=0;c<this.map.layers.length;++c){d=this.map.layers[c],-1!=OpenLayers.Util.indexOf(this.layers,d)&&d.renderer.moveRoot(this.renderer)}},resetRoots:function(){for(var d,c=0;c<this.layers.length;++c){d=this.layers[c],this.renderer&&d.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(d.renderer)}},handleChangeLayer:function(d){var c=d.layer;"order"==d.property&&-1!=OpenLayers.Util.indexOf(this.layers,c)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);null===this.scope&&(this.scope=this);this.initLayer(e);var f={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(f.over=this.overFeature,f.out=this.outFeature);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(b){OpenLayers.Util.isArray(b)?(this.layers=b,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b})):this.layer=b},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer);OpenLayers.Control.prototype.destroy.apply(this,arguments);this.layers&&this.layer.destroy()},activate:function(){this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate());return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer));return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(h){for(var g=this.layers||[this.layer],m,l,k=0;k<g.length;++k){m=g[k];for(var j=m.selectedFeatures.length-1;0<=j;--j){l=m.selectedFeatures[j],(!h||h.except!=l)&&this.unselect(l)}}},clickFeature:function(b){this.hover||(-1<OpenLayers.Util.indexOf(b.layer.selectedFeatures,b)?this.toggleSelect()?this.unselect(b):this.multipleSelect()||this.unselectAll({except:b}):(this.multipleSelect()||this.unselectAll({except:b}),this.select(b)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(d){var c=d.layer;this.hover&&(this.highlightOnly?this.highlight(d):-1==OpenLayers.Util.indexOf(c.selectedFeatures,d)&&this.select(d))},outFeature:function(d){if(this.hover){if(this.highlightOnly){if(d._lastHighlighter==this.id){if(d._prevHighlighter&&d._prevHighlighter!=this.id){delete d._lastHighlighter;var c=this.map.getControl(d._prevHighlighter);c&&c.highlight(d)}else{this.unhighlight(d)}}}else{this.unselect(d)}}},highlight:function(d){var c=d.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:d})&&(d._prevHighlighter=d._lastHighlighter,d._lastHighlighter=this.id,c.drawFeature(d,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:d}))},unhighlight:function(d){var c=d.layer;void 0==d._prevHighlighter?delete d._lastHighlighter:(d._prevHighlighter!=this.id&&(d._lastHighlighter=d._prevHighlighter),delete d._prevHighlighter);c.drawFeature(d,d.style||d.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:d})},select:function(e){var d=this.onBeforeSelect.call(this.scope,e),f=e.layer;!1!==d&&(d=f.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==d&&(f.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=f.selectedFeatures[0]),f.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(d){var c=d.layer;this.unhighlight(d);OpenLayers.Util.removeItem(c.selectedFeatures,d);c.events.triggerEvent("featureunselected",{feature:d});this.onUnselect.call(this.scope,d)},selectBox:function(k){if(k instanceof OpenLayers.Bounds){var j=this.map.getLonLatFromPixel({x:k.left,y:k.bottom}),k=this.map.getLonLatFromPixel({x:k.right,y:k.top}),j=new OpenLayers.Bounds(j.lon,j.lat,k.lon,k.lat);this.multipleSelect()||this.unselectAll();k=this.multiple;this.multiple=!0;var q=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:q});for(var p,o=0;o<q.length;++o){p=q[o];for(var n=0,m=p.features.length;n<m;++n){var l=p.features[n];l.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,l.geometry.CLASS_NAME))&&j.toGeometry().intersects(l.geometry)&&-1==OpenLayers.Util.indexOf(p.selectedFeatures,l)&&this.select(l)}}this.multiple=k;this.events.triggerEvent("boxselectionend",{layers:q})}},setMap:function(b){this.handlers.feature.setMap(b);this.box&&this.handlers.box.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(d){var c=this.active;this.unselectAll();this.deactivate();this.layers&&(this.layer.destroy(),this.layers=null);this.initLayer(d);this.handlers.feature.layer=this.layer;c&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}return !0}return !1},deactivate:function(){var d=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var d=0,c=this.KEY_EVENTS.length;d<c;d++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[d],this.eventListener)}d=!0}return d},handleKeyEvent:function(b){this.checkModifiers(b)&&this.callback(b.type,[b])},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(f,e){e=e||{};this.layer=f;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,e.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[e]);OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var h=this,g={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};!1===this.standalone&&(this.selectControl=new OpenLayers.Control.SelectFeature(f,g));this.dragControl=new OpenLayers.Control.DragFeature(f,{geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(d,c){h.dragStart.apply(h,[d,c])},onDrag:function(d,c){h.dragVertex.apply(h,[d,c])},onComplete:function(b){h.dragComplete.apply(h,[b])},featureCallbacks:{over:function(b){(h.standalone!==true||b._sketch||h.feature===b)&&h.dragControl.overFeature.apply(h.dragControl,[b])}}});this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress})}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var d=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0});this.layer.removeFeatures(this.virtualVertices,{silent:!0});this.vertices=[];this.dragControl.deactivate();var c=(d=this.feature)&&d.geometry&&d.layer;!1===this.standalone?(c&&this.selectControl.unselect.apply(this.selectControl,[d]),this.selectControl.deactivate()):c&&this.unselectFeature(d);this.handlers.keyboard.deactivate();d=!0}return d},beforeSelectFeature:function(b){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:b})},selectFeature:function(d){if(!this.standalone||!1!==this.beforeSelectFeature(d)){this.feature=d,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature)}var c=d.modified;if(d.geometry&&(!c||!c.geometry)){this._originalGeometry=d.geometry.clone()}},unselectFeature:function(b){this.layer.removeFeatures(this.vertices,{silent:!0});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:!0});this.virtualVertices=[];this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);this.feature=null;this.dragControl.deactivate();this.onModificationEnd(b);this.layer.events.triggerEvent("afterfeaturemodified",{feature:b,modified:this.modified});this.modified=!1},dragStart:function(d,c){if(d!=this.feature&&(!d.geometry.parent&&d!=this.dragHandle&&d!=this.radiusHandle)&&(!1===this.standalone&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),null==this.geometryTypes||-1!=OpenLayers.Util.indexOf(this.geometryTypes,d.geometry.CLASS_NAME))){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[d]),this.dragControl.overFeature.apply(this.dragControl,[d]),this.dragControl.lastPixel=c,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=c,this.dragControl.handlers.drag.last=c}},dragVertex:function(d,c){this.modified=!0;"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=d&&(this.feature=d),this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c})):(d._index?(d.geometry.parent.addComponent(d.geometry,d._index),delete d._index,OpenLayers.Util.removeItem(this.virtualVertices,d),this.vertices.push(d)):d==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):d!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:d.geometry,feature:this.feature,pixel:c}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent));this.layer.drawFeature(d)},dragComplete:function(){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var b=this.feature;b.modified=OpenLayers.Util.extend(b.modified,{geometry:this._originalGeometry});delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature);0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]);0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]);this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null);this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null);this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(d){var c=d.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,c)&&(c=this.dragControl.feature)&&-1!=OpenLayers.Util.indexOf(this.vertices,c)&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:d.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}},collectVertices:function(){function d(k){var j,h,b;if("OpenLayers.Geometry.Point"==k.CLASS_NAME){h=new OpenLayers.Feature.Vector(k),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)}else{b=k.components.length;"OpenLayers.Geometry.LinearRing"==k.CLASS_NAME&&(b-=1);for(j=0;j<b;++j){h=k.components[j],"OpenLayers.Geometry.Point"==h.CLASS_NAME?(h=new OpenLayers.Feature.Vector(h),h._sketch=!0,h.renderIntent=c.vertexRenderIntent,c.vertices.push(h)):d(h)}if(c.createVertices&&"OpenLayers.Geometry.MultiPoint"!=k.CLASS_NAME){j=0;for(b=k.components.length;j<b-1;++j){h=k.components[j];var a=k.components[j+1];"OpenLayers.Geometry.Point"==h.CLASS_NAME&&"OpenLayers.Geometry.Point"==a.CLASS_NAME&&(h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((h.x+a.x)/2,(h.y+a.y)/2),null,c.virtualStyle),h.geometry.parent=k,h._index=j+1,h._sketch=!0,c.virtualVertices.push(h))}}}}this.vertices=[];this.virtualVertices=[];var c=this;d.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:!0});this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,d=e.getBounds().getCenterLonLat(),d=new OpenLayers.Geometry.Point(d.lon,d.lat),f=new OpenLayers.Feature.Vector(d);d.move=function(a,g){OpenLayers.Geometry.Point.prototype.move.call(this,a,g);e.move(a,g)};f._sketch=!0;this.dragHandle=f;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var j=this.feature.geometry,h=j.getBounds(),o=h.getCenterLonLat(),n=new OpenLayers.Geometry.Point(o.lon,o.lat),h=new OpenLayers.Geometry.Point(h.right,h.bottom),o=new OpenLayers.Feature.Vector(h),m=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,l=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,k=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;h.move=function(d,r){OpenLayers.Geometry.Point.prototype.move.call(this,d,r);var g=this.x-n.x,f=this.y-n.y,e=g-d,a=f-r;if(k){var q=Math.atan2(a,e),q=Math.atan2(f,g)-q,q=q*(180/Math.PI);j.rotate(q,n)}if(m){var p;l?(f/=a,p=g/e/f):(e=Math.sqrt(e*e+a*a),f=Math.sqrt(g*g+f*f)/e);j.resize(f,n,p)}};o._sketch=!0;this.radiusHandle=o;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(b){this.standalone||this.selectControl.setMap(b);this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(b){b=OpenLayers.Util.applyDefaults({sphericalMercator:!0},b);OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[b.name||"Bing "+(b.type||this.type),null,b]);this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var d=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),d="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(d),c=document.createElement("script");c.type="text/javascript";c.src=d;c.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],d=e.imageUrl.replace("{quadkey}","${quadkey}"),d=d.replace("{culture}",this.culture);this.url=[];for(var f=0;f<e.imageUrlSubdomains.length;++f){this.url.push(d.replace("{subdomain}",e.imageUrlSubdomains[f]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0)},getURL:function(j){if(this.url){for(var h=this.getXYZ(j),j=h.x,o=h.y,h=h.z,n=[],m=h;0<m;--m){var l="0",k=1<<m-1;0!=(j&k)&&l++;0!=(o&k)&&(l++,l++);n.push(l)}n=n.join("");j=this.selectUrl(""+j+o+h,this.url);return OpenLayers.String.format(j,{quadkey:n})}},updateAttribution:function(){var x=this.metadata;if(x.resourceSets&&this.map&&this.map.center){var w=x.resourceSets[0].resources[0],v=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),w=w.imageryProviders,u=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),t="",s,r,q,p,o,n,m;r=0;for(q=w.length;r<q;++r){s=w[r];p=0;for(o=s.coverageAreas.length;p<o;++p){m=s.coverageAreas[p],n=OpenLayers.Bounds.fromArray(m.bbox,!0),v.intersectsBounds(n)&&(u<=m.zoomMax&&u>=m.zoomMin)&&(t+=s.attribution+" ")}}this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:x.brandLogoUri,copyrights:t});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);this.updateAttribution();this.map.events.register("moveend",this,this.updateAttribution)},clone:function(b){null==b&&(b=new OpenLayers.Layer.Bing(this.options));return b=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});OpenLayers.Layer.Bing.processMetadata=function(b){this.metadata=b;this.initLayer();b=document.getElementById(this._callbackId);b.parentNode.removeChild(b);window[this._callbackId]=void 0;delete this._callbackId};OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(b){b=b||{};OpenLayers.Layer.Vector.prototype.initialize.apply(this,[b.name,b])},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);b.events.register("moveend",this,this.onMoveEnd)},removeMap:function(b){b.events.unregister("moveend",this,this.onMoveEnd);OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(b){this.ratio=b;this.updateGrid(!0)},setMaxFeatures:function(b){this.maxFeatures=b;this.updateGrid(!0)},setSpacing:function(d,c){this.dx=d;this.dy=c||d;this.updateGrid(!0)},setOrigin:function(b){this.origin=b;this.updateGrid(!0)},getOrigin:function(){this.origin||(this.origin=this.map.getExtent().getCenterLonLat());return this.origin},setRotation:function(b){this.rotation=b;this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var d=this.map.getExtent();if(this.rotation){var c=this.getOrigin(),c=new OpenLayers.Geometry.Point(c.lon,c.lat),d=d.toGeometry();d.rotate(-this.rotation,c);d=d.getBounds()}return d},updateGrid:function(t){if(t||this.invalidBounds()){var s=this.getViewBounds(),r=this.getOrigin(),t=new OpenLayers.Geometry.Point(r.lon,r.lat),q=s.getWidth(),p=s.getHeight(),o=q/p,n=Math.sqrt(this.dx*this.dy*this.maxFeatures/o),q=Math.min(q*this.ratio,n*o),p=Math.min(p*this.ratio,n),s=s.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(s.lon-q/2,s.lat-p/2,s.lon+q/2,s.lat+p/2);for(var s=Math.floor(p/this.dy),q=Math.floor(q/this.dx),p=r.lon+this.dx*Math.ceil((this.gridBounds.left-r.lon)/this.dx),r=r.lat+this.dy*Math.ceil((this.gridBounds.bottom-r.lat)/this.dy),n=Array(s*q),m,l=0;l<q;++l){for(var o=p+l*this.dx,k=0;k<s;++k){m=r+k*this.dy,m=new OpenLayers.Geometry.Point(o,m),this.rotation&&m.rotate(this.rotation,t),n[l*s+k]=new OpenLayers.Feature.Vector(m)}}this.destroyFeatures(this.features,{silent:!0});this.addFeatures(n,{silent:!0})}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:!0,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(k){if(this.map&&this.checkModifiers(k)){for(var j=!1,q=!1,p=!1,o=OpenLayers.Event.element(k);null!=o&&!p&&!j;){if(!j){try{var n=o.currentStyle?o.currentStyle.overflow:document.defaultView.getComputedStyle(o,null).getPropertyValue("overflow"),j=n&&"auto"==n||"scroll"==n}catch(m){}}if(!q){for(var p=0,l=this.map.layers.length;p<l;p++){if(o==this.map.layers[p].div||o==this.map.layers[p].pane){q=!0;break}}}p=o==this.map.div;o=o.parentNode}!j&&p&&(q&&((j=0,k||(k=window.event),k.wheelDelta?(j=k.wheelDelta/120,window.opera&&9.2>window.opera.version()&&(j=-j)):k.detail&&(j=-k.detail/3),this.delta+=j,this.interval)?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(k)},this),this.interval)):this.wheelZoom(k)),OpenLayers.Event.stop(k))}},wheelZoom:function(d){var c=this.delta;this.delta=0;c&&(this.mousePosition&&(d.xy=this.mousePosition),d.xy||(d.xy=this.map.getPixelFromLonLat(this.map.getCenter())),0>c?this.callback("down",[d,this.cumulative?c:-1]):this.callback("up",[d,this.cumulative?c:1]))},mousemove:function(b){this.mousePosition=b.xy},activate:function(d){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var c=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",c);OpenLayers.Event.observe(window,"mousewheel",c);OpenLayers.Event.observe(document,"mousewheel",c);return !0}return !1},deactivate:function(d){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var c=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",c);OpenLayers.Event.stopObserving(window,"mousewheel",c);OpenLayers.Event.stopObserving(document,"mousewheel",c);return !0}return !1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(b){OpenLayers.Util.extend(this,b)},clone:function(){return new (eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(b){this.symbolizer={};OpenLayers.Util.extend(this,b);this.symbolizers&&delete this.symbolizer;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b in this.symbolizer){this.symbolizer[b]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(f){var e=this.getContext(f),h=!0;if(this.minScaleDenominator||this.maxScaleDenominator){var g=f.layer.map.getScale()}this.minScaleDenominator&&(h=g>=OpenLayers.Style.createLiteral(this.minScaleDenominator,e));h&&this.maxScaleDenominator&&(h=g<OpenLayers.Style.createLiteral(this.maxScaleDenominator,e));h&&this.filter&&(h="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(f):this.filter.evaluate(e));return h},getContext:function(d){var c=this.context;c||(c=d.attributes||d.data);"function"==typeof this.context&&(c=this.context(d));return c},clone:function(){var f=OpenLayers.Util.extend({},this);if(this.symbolizers){var e=this.symbolizers.length;f.symbolizers=Array(e);for(var h=0;h<e;++h){f.symbolizers[h]=this.symbolizers[h].clone()}}else{f.symbolizer={};for(var g in this.symbolizer){e=this.symbolizer[g],h=typeof e,"object"===h?f.symbolizer[g]=OpenLayers.Util.extend({},e):"string"===h&&(f.symbolizer[g]=e)}}f.filter=this.filter&&this.filter.clone();f.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(f)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var d=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var f=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(f=this.value.toGeometry());e.geometry.intersects(f)&&(d=!0)}break;default:throw Error("evaluate is not implemented for this filter type.")}return d},clone:function(){var b=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(b)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(b){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[b])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.outer=f.components[0]},innerBoundaryIs:function(e,d){var f={};this.readChildNodes(e,f);d.inner.push(f.components[0])},Box:function(f,e){var h={};this.readChildNodes(f,h);e.components||(e.components=[]);var g=h.points[0],h=h.points[1];e.components.push(new OpenLayers.Bounds(g.x,g.y,h.x,h.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(b){b=this.writeNode(OpenLayers.Util.isArray(b)?"wfs:FeatureCollection":"gml:featureMember",b);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(d){var c=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[d],c);return c},coordinates:function(g){for(var f=g.length,k=Array(f),j,h=0;h<f;++h){j=g[h],k[h]=this.xy?j.x+","+j.y:j.y+","+j.x,void 0!=j.z&&(k[h]+=","+j.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==f?k[0]:k.join(" ")})},LineString:function(d){var c=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",d.components,c);return c},Polygon:function(e){var d=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],d);for(var f=1;f<e.components.length;++f){this.writeNode("innerBoundaryIs",e.components[f],d)}return d},outerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",d,c);return c},innerBoundaryIs:function(d){var c=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",d,c);return c},LinearRing:function(d){var c=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",d.components,c);return c},Box:function(d){var c=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:d.left,y:d.bottom},{x:d.right,y:d.top}],c);this.srsName&&c.setAttribute("srsName",this.srsName);return c}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(b){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[b])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsNotEqualTo:function(e,d){var f=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,f);d.filters.push(f)},PropertyIsLike:function(h,g){var m=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(h,m);var l=h.getAttribute("wildCard"),k=h.getAttribute("singleChar"),j=h.getAttribute("escape");m.value2regex(l,k,j);g.filters.push(m)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsNotEqualTo:function(d){var c=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",d,c);this.writeOgcExpression(d.value,c);return c},PropertyIsLike:function(d){var c=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",d,c);this.writeNode("Literal",d.regex2value(),c);return c},BBOX:function(e){var d=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,d);var f=this.writeNode("gml:Box",e.value,d);e.projection&&f.setAttribute("srsName",e.projection);return d}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(f,e){var h=this.createElementNSPlus("ogc:"+e);this.writeNode("PropertyName",f,h);if(f.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",f.value,h)}else{var g;g=f.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",f.value).firstChild:this.writeNode("gml:Box",f.value);f.projection&&g.setAttribute("srsName",f.projection);h.appendChild(g)}return h},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(b){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[b]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[b])},readNode:function(d,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[d,c])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(d,c){c.insertIds=[];c.success=!1;this.readChildNodes(d,c)},InsertResult:function(e,d){var f={fids:[]};this.readChildNodes(e,f);d.insertIds.push(f.fids[0])},TransactionResult:function(d,c){this.readChildNodes(d,c)},Status:function(d,c){this.readChildNodes(d,c)},SUCCESS:function(d,c){c.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(f){var f=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},f),e=f.featurePrefix,h=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e?e+":":"")+f.featureType}});f.srsNameInQuery&&f.srsName&&h.setAttribute("srsName",f.srsName);f.featureNS&&h.setAttribute("xmlns:"+e,f.featureNS);if(f.propertyNames){for(var e=0,g=f.propertyNames.length;e<g;e++){this.writeNode("ogc:PropertyName",{property:f.propertyNames[e]},h)}}f.filter&&(this.setFilterProperty(f.filter),this.writeNode("ogc:Filter",f.filter,h));return h}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(g){this.exists(g)&&this.remove(g);var f=g.id;this.determineZIndex(g);for(var k=-1,j=this.order.length,h;1<j-k;){h=parseInt((k+j)/2),0<this.compare(this,g,OpenLayers.Util.getElement(this.order[h]))?k=h:j=h}this.order.splice(j,0,f);this.indices[f]=this.getZIndex(g);return this.getNextElement(j)},remove:function(d){var d=d.id,c=OpenLayers.Util.indexOf(this.order,d);0<=c&&(this.order.splice(c,1),delete this.indices[d],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(b){return null!=this.indices[b.id]},getZIndex:function(b){return b._style.graphicZIndex},determineZIndex:function(d){var c=d._style.graphicZIndex;null==c?(c=this.maxZIndex,d._style.graphicZIndex=c):c>this.maxZIndex&&(this.maxZIndex=c)},getNextElement:function(d){d+=1;if(d<this.order.length){var c=OpenLayers.Util.getElement(this.order[d]);void 0==c&&(c=this.getNextElement(d));return c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(f,e,h){var e=f.getZIndex(e),g=0;h&&(f=f.getZIndex(h),g=e-f);return g},Z_ORDER_DRAWING_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0==e&&(e=1);return e},Z_ORDER_Y_ORDER:function(e,d,f){e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,d,f);f&&0===e&&(d=f._boundsBottom-d._boundsBottom,e=0===d?1:d);return e}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(d,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(c&&(c.zIndexing||c.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(c.yOrdering)}},destroy:function(){this.clear();this.xmlns=this.root=this.rendererRoot=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var d,c=this.vectorRoot;if(c){for(;d=c.firstChild;){c.removeChild(d)}}if(c=this.textRoot){for(;d=c.firstChild;){c.removeChild(d)}}this.indexer&&this.indexer.clear()},setExtent:function(h,g){var m=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),l=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var k,j=h.getWidth()/this.map.getExtent().getWidth(),h=h.scale(1/j),j=this.map.getMaxExtent();j.right>h.left&&j.right<h.right?k=!0:j.left>h.left&&j.left<h.right&&(k=!1);if(k!==this.rightOfDateLine||g){m=!1,this.xOffset=!0===k?j.getWidth()/l:0}this.rightOfDateLine=k}return m},getNodeType:function(){},drawGeometry:function(h,g,m){var l=h.CLASS_NAME,k=!0;if("OpenLayers.Geometry.Collection"==l||"OpenLayers.Geometry.MultiPoint"==l||"OpenLayers.Geometry.MultiLineString"==l||"OpenLayers.Geometry.MultiPolygon"==l){for(var l=0,j=h.components.length;l<j;l++){k=this.drawGeometry(h.components[l],g,m)&&k}return k}l=k=!1;"none"!=g.display&&(g.backgroundGraphic?this.redrawBackgroundNode(h.id,h,g,m):l=!0,k=this.redrawNode(h.id,h,g,m));if(!1==k&&(g=document.getElementById(h.id))){g._style.backgroundGraphic&&(l=!0),g.parentNode.removeChild(g)}l&&(g=document.getElementById(h.id+this.BACKGROUND_ID_SUFFIX))&&g.parentNode.removeChild(g);return k},redrawNode:function(f,e,h,g){h=this.applyDefaultSymbolizer(h);f=this.nodeFactory(f,this.getNodeType(e,h));f._featureId=g;f._boundsBottom=e.getBounds().bottom;f._geometryClass=e.CLASS_NAME;f._style=h;e=this.drawGeometryNode(f,e,h);if(!1===e){return !1}f=e.node;this.indexer?(h=this.indexer.insert(f))?this.vectorRoot.insertBefore(f,h):this.vectorRoot.appendChild(f):f.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(f);this.postDraw(f);return e.complete},redrawBackgroundNode:function(e,d,f){f=OpenLayers.Util.extend({},f);f.externalGraphic=f.backgroundGraphic;f.graphicXOffset=f.backgroundXOffset;f.graphicYOffset=f.backgroundYOffset;f.graphicZIndex=f.backgroundGraphicZIndex;f.graphicWidth=f.backgroundWidth||f.graphicWidth;f.graphicHeight=f.backgroundHeight||f.graphicHeight;f.backgroundGraphic=null;f.backgroundXOffset=null;f.backgroundYOffset=null;f.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,d,f,null)},drawGeometryNode:function(g,f,k){var k=k||g._style,j={isFilled:void 0===k.fill?!0:k.fill,isStroked:void 0===k.stroke?!!k.strokeWidth:k.stroke},h;switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===k.graphic&&(j.isFilled=!1,j.isStroked=!1);h=this.drawPoint(g,f);break;case"OpenLayers.Geometry.LineString":j.isFilled=!1;h=this.drawLineString(g,f);break;case"OpenLayers.Geometry.LinearRing":h=this.drawLinearRing(g,f);break;case"OpenLayers.Geometry.Polygon":h=this.drawPolygon(g,f);break;case"OpenLayers.Geometry.Rectangle":h=this.drawRectangle(g,f)}g._options=j;return !1!=h?{node:this.setStyle(g,k,j,f),complete:h}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(d){var c=document.getElementById(d+this.LABEL_ID_SUFFIX);c&&this.textRoot.removeChild(c);(d=document.getElementById(d+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(d)},getFeatureIdFromEvent:function(e){var d=e.target,f=d&&d.correspondingUseElement;return(f?f:d||e.srcElement)._featureId},eraseGeometry:function(f,e){if("OpenLayers.Geometry.MultiPoint"==f.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==f.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==f.CLASS_NAME||"OpenLayers.Geometry.Collection"==f.CLASS_NAME){for(var h=0,g=f.components.length;h<g;h++){this.eraseGeometry(f.components[h],e)}}else{if((h=OpenLayers.Util.getElement(f.id))&&h.parentNode){if(h.geometry&&(h.geometry.destroy(),h.geometry=null),h.parentNode.removeChild(h),this.indexer&&this.indexer.remove(h),h._style.backgroundGraphic){(h=OpenLayers.Util.getElement(f.id+this.BACKGROUND_ID_SUFFIX))&&h.parentNode&&h.parentNode.removeChild(h)}}}},nodeFactory:function(e,d){var f=OpenLayers.Util.getElement(e);f?this.nodeTypeCompare(f,d)||(f.parentNode.removeChild(f),f=this.nodeFactory(e,d)):f=this.createNode(d,e);return f},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(d){var c=this.root;d.root.parentNode==this.rendererRoot&&(c=d.root);c.parentNode.removeChild(c);d.rendererRoot.appendChild(c)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(b){return"circle"!=b&&!!b},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){var e=e||window.location.href,d=OpenLayers.Util.getParameters(e),f=e.indexOf("#");0<f&&(e="?"+e.substring(f+1,e.length),OpenLayers.Util.extend(d,OpenLayers.Util.getParameters(e)));return d},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,h=this.map.controls.length;e<h;e++){var g=this.map.controls[e];if(g!=this&&"OpenLayers.Control.ArgParser"==g.CLASS_NAME){g.displayProjection!=this.displayProjection&&(this.displayProjection=g.displayProjection);break}}if(e==this.map.controls.length&&(e=this.getParameters(),e.layers&&(this.layers=e.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),e.lat&&e.lon)){this.center=new OpenLayers.LonLat(parseFloat(e.lon),parseFloat(e.lat)),e.zoom&&(this.zoom=parseFloat(e.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter()}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var f=0,e=this.layers.length;f<e;f++){var h=this.map.layers[f],g=this.layers.charAt(f);"B"==g?this.map.setBaseLayer(h):("T"==g||"F"==g)&&h.setVisibility("T"==g)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(e,d,f){null!==e&&"object"==typeof e&&!OpenLayers.Util.isElement(e)?(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[e]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element))):(OpenLayers.Control.prototype.initialize.apply(this,[f]),this.element=OpenLayers.Util.getElement(e),this.base=d||document.location.href)},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null);this.map&&this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var e=0,h=this.map.controls.length;e<h;e++){var g=this.map.controls[e];if(g.CLASS_NAME==this.argParserClass.CLASS_NAME){g.displayProjection!=this.displayProjection&&(this.displayProjection=g.displayProjection);break}}e==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);!this.element&&!this.anchor&&(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element));this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var d=this.anchor?"#":"?",c=this.base;-1!=c.indexOf(d)&&(c=c.substring(0,c.indexOf(d)));c+=d+OpenLayers.Util.getParameterString(this.createParams());this.anchor&&!this.element?window.location.href=c:this.element.href=c},createParams:function(g,f,k){var g=g||this.map.getCenter(),j=OpenLayers.Util.getParameters(this.base);if(g){j.zoom=f||this.map.getZoom();f=g.lat;g=g.lon;this.displayProjection&&(f=OpenLayers.Projection.transform({x:g,y:f},this.map.getProjectionObject(),this.displayProjection),g=f.x,f=f.y);j.lat=Math.round(100000*f)/100000;j.lon=Math.round(100000*g)/100000;k=k||this.map.layers;j.layers="";g=0;for(f=k.length;g<f;g++){var h=k[g];j.layers=h.isBaseLayer?j.layers+(h==this.map.baseLayer?"B":"0"):j.layers+(h.getVisibility()?"T":"F")}}return j},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(f,e,h){var g=[];g.push(f,e,{},h);OpenLayers.Layer.Grid.prototype.initialize.apply(this,g)},clone:function(b){null==b&&(b=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var e=this.adjustBounds(e),d=this.getServerResolution(),f=Math.round((e.left-this.tileOrigin.lon)/(d*this.tileSize.w)),e=Math.round((e.bottom-this.tileOrigin.lat)/(d*this.tileSize.h)),f=this.serviceVersion+"/"+this.layername+"/"+this.getServerZoom()+"/"+f+"/"+e+"."+this.type,e=this.url;OpenLayers.Util.isArray(e)&&(e=this.selectUrl(f,e));return e+f},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(!0==this.layer.visibility||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return !0}return !1},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return b},load:function(d){var c=this.layer;c.events.triggerEvent("loadstart");c.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,c.map.getProjectionObject()),filter:c.filter},d));c.events.un({visibilitychanged:this.load,scope:this})},merge:function(j,h){var o=this.layer;o.destroyFeatures();var n=h.features;if(n&&0<n.length){if(!j.equals(o.projection)){for(var m,l=0,k=n.length;l<k;++l){(m=n[l].geometry)&&m.transform(o.projection,j)}}o.addFeatures(n)}o.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var f=OpenLayers.Control.prototype.draw.apply(this),e=this.getOrCreateLinks(f),h=e.zoomIn,e=e.zoomOut,g=this.map.events;e.parentNode!==f&&(g=this.events,g.attachToElement(e.parentNode));g.register("buttonclick",this,this.onZoomClick);this.zoomInLink=h;this.zoomOutLink=e;return f},getOrCreateLinks:function(e){var d=document.getElementById(this.zoomInId),f=document.getElementById(this.zoomOutId);d||(d=document.createElement("a"),d.href="#zoomIn",d.appendChild(document.createTextNode(this.zoomInText)),d.className="olControlZoomIn",e.appendChild(d));OpenLayers.Element.addClass(d,"olButton");f||(f=document.createElement("a"),f.href="#zoomOut",f.appendChild(document.createTextNode(this.zoomOutText)),f.className="olControlZoomOut",e.appendChild(f));OpenLayers.Element.addClass(f,"olButton");return{zoomIn:d,zoomOut:f}},onZoomClick:function(b){b=b.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick);delete this.zoomInLink;delete this.zoomOutLink;OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(r,q){if(2>r.length){throw Error("At least two point features have to be added to create a line from")}for(var p=Array(r.length-1),o,n,m,l=0,k=r.length;l<k;l++){o=r[l];if(m=o.geometry){if("OpenLayers.Geometry.Point"!=m.CLASS_NAME){throw new TypeError("Only features with point geometries are supported.")}}else{m=o.lonlat,m=new OpenLayers.Geometry.Point(m.lon,m.lat)}if(0<l){o=null!=this.dataFrom?r[l+this.dataFrom].data||r[l+this.dataFrom].attributes:null;var j=null!=this.styleFrom?r[l+this.styleFrom].style:null;n=new OpenLayers.Geometry.LineString([n,m]);p[l-1]=new OpenLayers.Feature.Vector(n,o,j)}n=m}this.addFeatures(p,q)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;OpenLayers.Layer.PointTrack.TARGET_NODE=0;OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Protocol.WFS=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.WFS.DEFAULTS),c=OpenLayers.Protocol.WFS["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported WFS version: "+d.version}return new c(d)};OpenLayers.Protocol.WFS.fromWMSLayer=function(f,e){var h,g;h=f.params.LAYERS;h=(OpenLayers.Util.isArray(h)?h[0]:h).split(":");1<h.length&&(g=h[0]);h=h.pop();g={url:f.url,featureType:h,featurePrefix:g,srsName:f.projection&&f.projection.getCode()||f.map&&f.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(e,g))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(d,c){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(d){if(d!=this.opacity){this.opacity=d;for(var d=0,c=this.markers.length;d<c;d++){this.markers[d].setOpacity(this.opacity)}}},moveTo:function(g,f,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(f||!this.drawn){for(var j=0,h=this.markers.length;j<h;j++){this.drawMarker(this.markers[j])}this.drawn=!0}},addMarker:function(b){this.markers.push(b);1>this.opacity&&b.setOpacity(this.opacity);this.map&&this.map.getExtent()&&(b.map=this.map,this.drawMarker(b))},removeMarker:function(b){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,b),b.erase())},clearMarkers:function(){if(null!=this.markers){for(;0<this.markers.length;){this.removeMarker(this.markers[0])}}},drawMarker:function(d){var c=this.map.getLayerPxFromLonLat(d.lonlat);null==c?d.display(!1):d.isDrawn()?d.icon&&d.icon.moveTo(c):this.div.appendChild(d.draw(c))},getDataExtent:function(){var e=null;if(this.markers&&0<this.markers.length){for(var e=new OpenLayers.Bounds,d=0,f=this.markers.length;d<f;d++){e.extend(this.markers[d].lonlat)}}return e},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(d,c){this.direction=d;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[c])},trigger:function(){var b=OpenLayers.Function.bind(function(c){return this.slideRatio?this.map.getSize()[c]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-b("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,b("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-b("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(b("w"),0)}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Format.CSWGetDomain=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Format.CSWGetDomain.DEFAULTS),c=OpenLayers.Format.CSWGetDomain["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSWGetDomain version: "+d.version}return new c(d)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{csw:{GetDomainResponse:function(d,c){this.readChildNodes(d,c)},DomainValues:function(h,g){OpenLayers.Util.isArray(g.DomainValues)||(g.DomainValues=[]);for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}this.readChildNodes(h,l);g.DomainValues.push(l)},PropertyName:function(d,c){c.PropertyName=this.getChildValue(d)},ParameterName:function(d,c){c.ParameterName=this.getChildValue(d)},ListOfValues:function(d,c){OpenLayers.Util.isArray(c.ListOfValues)||(c.ListOfValues=[]);this.readChildNodes(d,c.ListOfValues)},Value:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.push({Value:l})},ConceptualScheme:function(d,c){c.ConceptualScheme={};this.readChildNodes(d,c.ConceptualScheme)},Name:function(d,c){c.Name=this.getChildValue(d)},Document:function(d,c){c.Document=this.getChildValue(d)},Authority:function(d,c){c.Authority=this.getChildValue(d)},RangeOfValues:function(d,c){c.RangeOfValues={};this.readChildNodes(d,c.RangeOfValues)},MinValue:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.MinValue=l},MaxValue:function(h,g){for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]=m[k].nodeValue}l.value=this.getChildValue(h);g.MaxValue=l}}},write:function(b){b=this.writeNode("csw:GetDomain",b);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(d){var c=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});if(d.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",d.PropertyName||this.PropertyName,c)}else{if(d.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",d.ParameterName||this.ParameterName,c)}}this.readChildNodes(c,d);return c},PropertyName:function(b){return this.createElementNSPlus("csw:PropertyName",{value:b})},ParameterName:function(b){return this.createElementNSPlus("csw:ParameterName",{value:b})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(b){return(new OpenLayers.Format.ArcXML).read(b).features.feature}});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.layer&&this.setLayer(this.options.layer);b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer);this.geoToleranceCache={}},setLayer:function(b){this.active?(this.deactivate(),this.layer=b,this.activate()):this.layer=b},setTargets:function(f){this.targets=[];if(f&&f.length){for(var e,h=0,g=f.length;h<g;++h){e=f[h],e instanceof OpenLayers.Layer.Vector?this.addTargetLayer(e):this.addTarget(e)}}},addTargetLayer:function(b){this.addTarget({layer:b})},addTarget:function(b){b=OpenLayers.Util.applyDefaults(b,this.defaults);b.nodeTolerance=b.nodeTolerance||b.tolerance;b.vertexTolerance=b.vertexTolerance||b.tolerance;b.edgeTolerance=b.edgeTolerance||b.tolerance;this.targets.push(b)},removeTargetLayer:function(e){for(var d,f=this.targets.length-1;0<=f;--f){d=this.targets[f],d.layer===e&&this.removeTarget(d)}},removeTarget:function(b){return OpenLayers.Util.removeItem(this.targets,b)},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b&&this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this});this.point=this.feature=null;return b},onSketchModified:function(b){this.feature=b.feature;this.considerSnapping(b.vertex,b.vertex)},onVertexModified:function(d){this.feature=d.feature;var c=this.layer.map.getLonLatFromViewPortPx(d.pixel);this.considerSnapping(d.vertex,new OpenLayers.Geometry.Point(c.lon,c.lat))},considerSnapping:function(k,j){for(var q={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},p=!1,o,n,m=0,l=this.targets.length;m<l;++m){if(n=this.targets[m],o=this.testTarget(n,j)){if(this.greedy){q=o;q.target=n;p=!0;break}else{if(o.rank<q.rank||o.rank===q.rank&&o.dist<q.dist){q=o,q.target=n,p=!0}}}}p&&(!1!==this.events.triggerEvent("beforesnap",{point:k,x:q.x,y:q.y,distance:q.dist,layer:q.target.layer,snapType:this.precedence[q.rank]})?(k.x=q.x,k.y=q.y,this.point=k,this.events.triggerEvent("snap",{point:k,snapType:this.precedence[q.rank],layer:q.target.layer,distance:q.dist})):p=!1);this.point&&!p&&(k.x=j.x,k.y=j.y,this.point=null,this.events.triggerEvent("unsnap",{point:k}))},testTarget:function(P,O){var N=this.layer.map.getResolution();if("minResolution" in P&&N<P.minResolution||"maxResolution" in P&&N>=P.maxResolution){return null}for(var N={node:this.getGeoTolerance(P.nodeTolerance,N),vertex:this.getGeoTolerance(P.vertexTolerance,N),edge:this.getGeoTolerance(P.edgeTolerance,N)},M=Math.max(N.node,N.vertex,N.edge),L={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},K=!1,J=P.layer.features,I,H,G,F,E,D,C=this.precedence.length,B=new OpenLayers.LonLat(O.x,O.y),A=0,z=J.length;A<z;++A){if(I=J[A],I!==this.feature&&(!I._sketch&&I.state!==OpenLayers.State.DELETE&&(!P.filter||P.filter.evaluate(I)))&&I.atPoint(B,M,M)){for(var y=0,x=Math.min(L.rank+1,C);y<x;++y){if(H=this.precedence[y],P[H]){if("edge"===H){if(G=I.geometry.distanceTo(O,{details:!0}),E=G.distance,E<=N[H]&&E<L.dist){L={rank:y,dist:E,x:G.x0,y:G.y0};K=!0;break}}else{G=I.geometry.getVertices("node"===H);D=!1;for(var w=0,v=G.length;w<v;++w){if(F=G[w],E=F.distanceTo(O),E<=N[H]&&(y<L.rank||y===L.rank&&E<L.dist)){L={rank:y,dist:E,x:F.x,y:F.y},D=K=!0}}if(D){break}}}}}}return K?L:null},getGeoTolerance:function(e,d){d!==this.resolution&&(this.resolution=d,this.geoToleranceCache={});var f=this.geoToleranceCache[e];void 0===f&&(f=e*d,this.geoToleranceCache[e]=f);return f},destroy:function(){this.active&&this.deactivate();delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Date={toISOString:function(){if("toISOString" in Date.prototype){return function(c){return c.toISOString()}}var b=function(e,g){for(var f=e+"";f.length<g;){f="0"+f}return f};return function(a){return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(j){var h;if((j=j.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/))&&(j[1]||j[7])){h=parseInt(j[1],10)||0;var o=parseInt(j[2],10)-1||0,n=parseInt(j[3],10)||1;h=new Date(Date.UTC(h,o,n));if(o=j[7]){var n=parseInt(j[4],10),m=parseInt(j[5],10),l=parseFloat(j[6]),k=l|0,l=Math.round(1000*(l-k));h.setUTCHours(n,m,k,l);"Z"!==o&&(o=parseInt(o,10),j=parseInt(j[8],10)||0,h=new Date(h.getTime()+-1000*(60*60*o+60*j)))}}else{h=new Date("invalid")}return h}};(function(){function r(){this._object=m&&!j?new m:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function q(){return new r}function p(b){q.onreadystatechange&&q.onreadystatechange.apply(b);b.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function o(z){try{z.responseText=z._object.responseText}catch(y){}try{var x;var w=z._object,v=w.responseXML,u=w.responseText;k&&(u&&v&&!v.documentElement&&w.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/))&&(v=new window.ActiveXObject("Microsoft.XMLDOM"),v.async=!1,v.validateOnParse=!1,v.loadXML(u));x=v&&(k&&0!=v.parseError||!v.documentElement||v.documentElement&&"parsererror"==v.documentElement.tagName)?null:v;z.responseXML=x}catch(t){}try{z.status=z._object.status}catch(s){}try{z.statusText=z._object.statusText}catch(h){}}function n(b){b._object.onreadystatechange=new window.Function}var m=window.XMLHttpRequest,l=!!window.controllers,k=window.document.all&&!window.opera,j=k&&window.navigator.userAgent.match(/MSIE 7.0/);q.prototype=r.prototype;l&&m.wrapped&&(q.wrapped=m.wrapped);q.UNSENT=0;q.OPENED=1;q.HEADERS_RECEIVED=2;q.LOADING=3;q.DONE=4;q.prototype.readyState=q.UNSENT;q.prototype.responseText="";q.prototype.responseXML=null;q.prototype.status=0;q.prototype.statusText="";q.prototype.priority="NORMAL";q.prototype.onreadystatechange=null;q.onreadystatechange=null;q.onopen=null;q.onsend=null;q.onabort=null;q.prototype.open=function(c,g,d,b,t){delete this._headers;arguments.length<3&&(d=true);this._async=d;var s=this,h=this.readyState,e;if(k&&d){e=function(){if(h!=q.DONE){n(s);s.abort()}};window.attachEvent("onunload",e)}q.onopen&&q.onopen.apply(this,arguments);arguments.length>4?this._object.open(c,g,d,b,t):arguments.length>3?this._object.open(c,g,d,b):this._object.open(c,g,d);this.readyState=q.OPENED;p(this);this._object.onreadystatechange=function(){if(!l||d){s.readyState=s._object.readyState;o(s);if(s._aborted){s.readyState=q.UNSENT}else{if(s.readyState==q.DONE){delete s._data;n(s);k&&d&&window.detachEvent("onunload",e)}h!=s.readyState&&p(s);h=s.readyState}}}};q.prototype.send=function(b){q.onsend&&q.onsend.apply(this,arguments);arguments.length||(b=null);if(b&&b.nodeType){b=window.XMLSerializer?(new window.XMLSerializer).serializeToString(b):b.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=b;b:{this._object.send(this._data);if(l&&!this._async){this.readyState=q.OPENED;for(o(this);this.readyState<q.DONE;){this.readyState++;p(this);if(this._aborted){break b}}}}};q.prototype.abort=function(){q.onabort&&q.onabort.apply(this,arguments);if(this.readyState>q.UNSENT){this._aborted=true}this._object.abort();n(this);this.readyState=q.UNSENT;delete this._data};q.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};q.prototype.getResponseHeader=function(b){return this._object.getResponseHeader(b)};q.prototype.setRequestHeader=function(d,c){if(!this._headers){this._headers={}}this._headers[d]=c;return this._object.setRequestHeader(d,c)};q.prototype.addEventListener=function(g,f,t){for(var s=0,h;h=this._listeners[s];s++){if(h[0]==g&&h[1]==f&&h[2]==t){return}}this._listeners.push([g,f,t])};q.prototype.removeEventListener=function(g,f,t){for(var s=0,h;h=this._listeners[s];s++){if(h[0]==g&&h[1]==f&&h[2]==t){break}}h&&this._listeners.splice(s,1)};q.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};e.type=="readystatechange"&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var d=0,f;f=this._listeners[d];d++){f[0]==e.type&&!f[2]&&(f[1].handleEvent||f[1]).apply(this,[e])}};q.prototype.toString=function(){return"[object XMLHttpRequest]"};q.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(d,c){c||(c=[]);d.__func=this;d.__func(c[0],c[1],c[2],c[3],c[4]);delete d.__func});OpenLayers.Request.XMLHttpRequest=q})();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(b){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(b){this.features=[];this.styles={};this.fetched={};return this.parseData(b,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(j,h){"string"==typeof j&&(j=OpenLayers.Format.XML.prototype.read.apply(this,[j]));for(var o=["Link","NetworkLink","Style","StyleMap","Placemark"],n=0,m=o.length;n<m;++n){var l=o[n],k=this.getElementsByTagNameNS(j,"*",l);if(0!=k.length){switch(l.toLowerCase()){case"link":case"networklink":this.parseLinks(k,h);break;case"style":this.extractStyles&&this.parseStyles(k,h);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(k,h);break;case"placemark":this.parseFeatures(k,h)}}}return this.features},parseLinks:function(h,g){if(g.depth>=this.maxDepth){return !1}var m=OpenLayers.Util.extend({},g);m.depth++;for(var l=0,k=h.length;l<k;l++){var j=this.parseProperty(h[l],"*","href");j&&!this.fetched[j]&&(this.fetched[j]=!0,(j=this.fetchLink(j))&&this.parseData(j,m))}},fetchLink:function(b){if(b=OpenLayers.Request.GET({url:b,async:!1})){return b.responseText}},parseStyles:function(g,f){for(var k=0,j=g.length;k<j;k++){var h=this.parseStyle(g[k]);h&&(this.styles[(f.styleBaseUrl||"")+"#"+h.id]=h)}},parseKmlColor:function(d){var c=null;d&&(d=d.match(this.regExes.kmlColor))&&(c={color:"#"+d[4]+d[3]+d[2],opacity:parseInt(d[1],16)/255});return c},parseStyle:function(z){for(var y={},x=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],w,v,u=0,t=x.length;u<t;++u){if(w=x[u],v=this.getElementsByTagNameNS(z,"*",w)[0]){switch(w.toLowerCase()){case"linestyle":w=this.parseProperty(v,"*","color");if(w=this.parseKmlColor(w)){y.strokeColor=w.color,y.strokeOpacity=w.opacity}(w=this.parseProperty(v,"*","width"))&&(y.strokeWidth=w);break;case"polystyle":w=this.parseProperty(v,"*","color");if(w=this.parseKmlColor(w)){y.fillOpacity=w.opacity,y.fillColor=w.color}"0"==this.parseProperty(v,"*","fill")&&(y.fillColor="none");"0"==this.parseProperty(v,"*","outline")&&(y.strokeWidth="0");break;case"iconstyle":var s=parseFloat(this.parseProperty(v,"*","scale")||1);w=32*s;var r=32*s,q=this.getElementsByTagNameNS(v,"*","Icon")[0];if(q){var p=this.parseProperty(q,"*","href");if(p){var o=this.parseProperty(q,"*","w"),n=this.parseProperty(q,"*","h");OpenLayers.String.startsWith(p,"http://maps.google.com/mapfiles/kml")&&(!o&&!n)&&(n=o=64,s/=2);o=o||n;n=n||o;o&&(w=parseInt(o)*s);n&&(r=parseInt(n)*s);if(n=p.match(this.regExes.kmlIconPalette)){o=n[1],n=n[2],p=this.parseProperty(q,"*","x"),q=this.parseProperty(q,"*","y"),p="http://maps.google.com/mapfiles/kml/pal"+o+"/icon"+(8*(q?7-q/32:7)+(p?p/32:0))+n}y.graphicOpacity=1;y.externalGraphic=p}}if(v=this.getElementsByTagNameNS(v,"*","hotSpot")[0]){p=parseFloat(v.getAttribute("x")),q=parseFloat(v.getAttribute("y")),o=v.getAttribute("xunits"),"pixels"==o?y.graphicXOffset=-p*s:"insetPixels"==o?y.graphicXOffset=-w+p*s:"fraction"==o&&(y.graphicXOffset=-w*p),v=v.getAttribute("yunits"),"pixels"==v?y.graphicYOffset=-r+q*s+1:"insetPixels"==v?y.graphicYOffset=-(q*s)+1:"fraction"==v&&(y.graphicYOffset=-r*(1-q)+1)}y.graphicWidth=w;y.graphicHeight=r;break;case"balloonstyle":(v=OpenLayers.Util.getXmlNodeValue(v))&&(y.balloonStyle=v.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":if(w=this.parseProperty(v,"*","color"),w=this.parseKmlColor(w)){y.fontColor=w.color,y.fontOpacity=w.opacity}}}}!y.strokeColor&&y.fillColor&&(y.strokeColor=y.fillColor);if((z=z.getAttribute("id"))&&y){y.id=z}return y},parseStyleMaps:function(t,s){for(var r=0,q=t.length;r<q;r++){for(var p=t[r],o=this.getElementsByTagNameNS(p,"*","Pair"),p=p.getAttribute("id"),n=0,m=o.length;n<m;n++){var l=o[n],k=this.parseProperty(l,"*","key");(l=this.parseProperty(l,"*","styleUrl"))&&"normal"==k&&(this.styles[(s.styleBaseUrl||"")+"#"+p]=this.styles[(s.styleBaseUrl||"")+l])}}},parseFeatures:function(k,j){for(var q=[],p=0,o=k.length;p<o;p++){var n=k[p],m=this.parseFeature.apply(this,[n]);if(m){this.extractStyles&&(m.attributes&&m.attributes.styleUrl)&&(m.style=this.getStyle(m.attributes.styleUrl,j));if(this.extractStyles){var l=this.getElementsByTagNameNS(n,"*","Style")[0];if(l&&(l=this.parseStyle(l))){m.style=OpenLayers.Util.extend(m.style,l)}}if(this.extractTracks){if((n=this.getElementsByTagNameNS(n,this.namespaces.gx,"Track"))&&0<n.length){m={features:[],feature:m},this.readNode(n[0],m),0<m.features.length&&q.push.apply(q,m.features)}}else{q.push(m)}}else{throw"Bad Placemark: "+p}}this.features=this.features.concat(q)},readers:{kml:{when:function(d,c){c.whens.push(OpenLayers.Date.parse(this.getChildValue(d)))},_trackPointAttribute:function(e,d){var f=e.nodeName.split(":").pop();d.attributes[f].push(this.getChildValue(e))}},gx:{Track:function(t,s){var r={whens:[],points:[],angles:[]};if(this.trackAttributes){var q;r.attributes={};for(var p=0,o=this.trackAttributes.length;p<o;++p){q=this.trackAttributes[p],r.attributes[q]=[],q in this.readers.kml||(this.readers.kml[q]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(t,r);if(r.whens.length!==r.points.length){throw Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:coord ("+r.points.length+") elements.")}var n=0<r.angles.length;if(n&&r.whens.length!==r.angles.length){throw Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:angles ("+r.angles.length+") elements.")}for(var m,l,p=0,o=r.whens.length;p<o;++p){m=s.feature.clone();m.fid=s.feature.fid||s.feature.id;l=r.points[p];m.geometry=l;"z" in l&&(m.attributes.altitude=l.z);this.internalProjection&&this.externalProjection&&m.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes){l=0;for(var k=this.trackAttributes.length;l<k;++l){m.attributes[q]=r.attributes[this.trackAttributes[l]][p]}}m.attributes.when=r.whens[p];m.attributes.trackId=s.feature.id;n&&(l=r.angles[p],m.attributes.heading=parseFloat(l[0]),m.attributes.tilt=parseFloat(l[1]),m.attributes.roll=parseFloat(l[2]));s.features.push(m)}},coord:function(f,e){var h=this.getChildValue(f).replace(this.regExes.trimSpace,"").split(/\s+/),g=new OpenLayers.Geometry.Point(h[0],h[1]);2<h.length&&(g.z=parseFloat(h[2]));e.points.push(g)},angles:function(e,d){var f=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);d.angles.push(f)}}},parseFeature:function(k){for(var j=["MultiGeometry","Polygon","LineString","Point"],q,p,o,n=0,m=j.length;n<m;++n){if(q=j[n],this.internalns=k.namespaceURI?k.namespaceURI:this.kmlns,p=this.getElementsByTagNameNS(k,this.internalns,q),0<p.length){if(j=this.parseGeometry[q.toLowerCase()]){o=j.apply(this,[p[0]]),this.internalProjection&&this.externalProjection&&o.transform(this.externalProjection,this.internalProjection)}else{throw new TypeError("Unsupported geometry type: "+q)}break}}var l;this.extractAttributes&&(l=this.parseAttributes(k));q=new OpenLayers.Feature.Vector(o,l);k=k.getAttribute("id")||k.getAttribute("name");null!=k&&(q.fid=k);return q},getStyle:function(f,e){var h=OpenLayers.Util.removeTail(f),g=OpenLayers.Util.extend({},e);g.depth++;g.styleBaseUrl=h;!this.styles[f]&&!OpenLayers.String.startsWith(f,"#")&&g.depth<=this.maxDepth&&!this.fetched[h]&&(h=this.fetchLink(h))&&this.parseData(h,g);return OpenLayers.Util.extend({},this.styles[f])},parseGeometry:{point:function(e){var d=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),e=[];if(0<d.length){var f=d[0].firstChild.nodeValue,f=f.replace(this.regExes.removeSpace,""),e=f.split(",")}d=null;if(1<e.length){2==e.length&&(e[2]=null),d=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{throw"Bad coordinate string: "+f}return d},linestring:function(r,q){var p=this.getElementsByTagNameNS(r,this.internalns,"coordinates"),o=null;if(0<p.length){for(var p=this.getChildValue(p[0]),p=p.replace(this.regExes.trimSpace,""),p=p.replace(this.regExes.trimComma,","),o=p.split(this.regExes.splitSpace),n=o.length,m=Array(n),l,k,j=0;j<n;++j){if(l=o[j].split(","),k=l.length,1<k){2==l.length&&(l[2]=null),m[j]=new OpenLayers.Geometry.Point(l[0],l[1],l[2])}else{throw"Bad LineString point coordinates: "+o[j]}}if(n){o=q?new OpenLayers.Geometry.LinearRing(m):new OpenLayers.Geometry.LineString(m)}else{throw"Bad LineString coordinates: "+p}}return o},polygon:function(g){var g=this.getElementsByTagNameNS(g,this.internalns,"LinearRing"),f=g.length,k=Array(f);if(0<f){for(var j=0,h=g.length;j<h;++j){if(f=this.parseGeometry.linestring.apply(this,[g[j],!0])){k[j]=f}else{throw"Bad LinearRing geometry: "+j}}}return new OpenLayers.Geometry.Polygon(k)},multigeometry:function(h){for(var g,m=[],l=h.childNodes,k=0,j=l.length;k<j;++k){h=l[k],1==h.nodeType&&(g=this.parseGeometry[(h.prefix?h.nodeName.split(":")[1]:h.nodeName).toLowerCase()])&&m.push(g.apply(this,[h]))}return new OpenLayers.Geometry.Collection(m)}},parseAttributes:function(j){var h={},o=j.getElementsByTagName("ExtendedData");o.length&&(h=this.parseExtendedData(o[0]));for(var n,m,l,j=j.childNodes,o=0,k=j.length;o<k;++o){if(n=j[o],1==n.nodeType&&(m=n.childNodes,1<=m.length&&3>=m.length)){switch(m.length){case 1:l=m[0];break;case 2:l=m[0];m=m[1];l=3==l.nodeType||4==l.nodeType?l:m;break;default:l=m[1]}if(3==l.nodeType||4==l.nodeType){if(n=n.prefix?n.nodeName.split(":")[1]:n.nodeName,l=OpenLayers.Util.getXmlNodeValue(l)){l=l.replace(this.regExes.trimSpace,""),h[n]=l}}}}return h},parseExtendedData:function(r){var q={},p,o,n,m,l=r.getElementsByTagName("Data");p=0;for(o=l.length;p<o;p++){n=l[p];m=n.getAttribute("name");var k={},j=n.getElementsByTagName("value");j.length&&(k.value=this.getChildValue(j[0]));this.kvpAttributes?q[m]=k.value:(n=n.getElementsByTagName("displayName"),n.length&&(k.displayName=this.getChildValue(n[0])),q[m]=k)}r=r.getElementsByTagName("SimpleData");p=0;for(o=r.length;p<o;p++){k={},n=r[p],m=n.getAttribute("name"),k.value=this.getChildValue(n),this.kvpAttributes?q[m]=k.value:(k.displayName=m,q[m]=k)}return q},parseProperty:function(g,f,k){var j,g=this.getElementsByTagNameNS(g,f,k);try{j=OpenLayers.Util.getXmlNodeValue(g[0])}catch(h){j=null}return j},write:function(g){OpenLayers.Util.isArray(g)||(g=[g]);for(var f=this.createElementNS(this.kmlns,"kml"),k=this.createFolderXML(),j=0,h=g.length;j<h;++j){k.appendChild(this.createPlacemarkXML(g[j]))}f.appendChild(k);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var d=this.createElementNS(this.kmlns,"name"),f=this.createTextNode(this.foldersName);d.appendChild(f);e.appendChild(d)}this.foldersDesc&&(d=this.createElementNS(this.kmlns,"description"),f=this.createTextNode(this.foldersDesc),d.appendChild(f),e.appendChild(d));return e},createPlacemarkXML:function(f){var e=this.createElementNS(this.kmlns,"name");e.appendChild(this.createTextNode(f.style&&f.style.label?f.style.label:f.attributes.name||f.id));var h=this.createElementNS(this.kmlns,"description");h.appendChild(this.createTextNode(f.attributes.description||this.placemarksDesc));var g=this.createElementNS(this.kmlns,"Placemark");null!=f.fid&&g.setAttribute("id",f.fid);g.appendChild(e);g.appendChild(h);e=this.buildGeometryNode(f.geometry);g.appendChild(e);f.attributes&&(f=this.buildExtendedData(f.attributes))&&g.appendChild(f);return g},buildGeometryNode:function(e){var d=e.CLASS_NAME,d=this.buildGeometry[d.substring(d.lastIndexOf(".")+1).toLowerCase()],f=null;d&&(f=d.apply(this,[e]));return f},buildGeometry:{point:function(d){var c=this.createElementNS(this.kmlns,"Point");c.appendChild(this.buildCoordinatesNode(d));return c},multipoint:function(b){return this.buildGeometry.collection.apply(this,[b])},linestring:function(d){var c=this.createElementNS(this.kmlns,"LineString");c.appendChild(this.buildCoordinatesNode(d));return c},multilinestring:function(b){return this.buildGeometry.collection.apply(this,[b])},linearring:function(d){var c=this.createElementNS(this.kmlns,"LinearRing");c.appendChild(this.buildCoordinatesNode(d));return c},polygon:function(h){for(var g=this.createElementNS(this.kmlns,"Polygon"),h=h.components,m,l,k=0,j=h.length;k<j;++k){m=0==k?"outerBoundaryIs":"innerBoundaryIs",m=this.createElementNS(this.kmlns,m),l=this.buildGeometry.linearring.apply(this,[h[k]]),m.appendChild(l),g.appendChild(m)}return g},multipolygon:function(b){return this.buildGeometry.collection.apply(this,[b])},collection:function(g){for(var f=this.createElementNS(this.kmlns,"MultiGeometry"),k,j=0,h=g.components.length;j<h;++j){(k=this.buildGeometryNode.apply(this,[g.components[j]]))&&f.appendChild(k)}return f}},buildCoordinatesNode:function(h){var g=this.createElementNS(this.kmlns,"coordinates"),m;if(m=h.components){for(var l=m.length,k=Array(l),j=0;j<l;++j){h=m[j],k[j]=this.buildCoordinates(h)}m=k.join(" ")}else{m=this.buildCoordinates(h)}m=this.createTextNode(m);g.appendChild(m);return g},buildCoordinates:function(b){this.internalProjection&&this.externalProjection&&(b=b.clone(),b.transform(this.internalProjection,this.externalProjection));return b.x+","+b.y},buildExtendedData:function(h){var g=this.createElementNS(this.kmlns,"ExtendedData"),m;for(m in h){if(h[m]&&"name"!=m&&"description"!=m&&"styleUrl"!=m){var l=this.createElementNS(this.kmlns,"Data");l.setAttribute("name",m);var k=this.createElementNS(this.kmlns,"value");if("object"==typeof h[m]){if(h[m].value&&k.appendChild(this.createTextNode(h[m].value)),h[m].displayName){var j=this.createElementNS(this.kmlns,"displayName");j.appendChild(this.getXMLDoc().createCDATASection(h[m].displayName));l.appendChild(j)}}else{k.appendChild(this.createTextNode(h[m]))}l.appendChild(k);g.appendChild(l)}}return this.isSimpleContent(g)?null:g},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(h,g,m,l,k,j){null==h&&(h=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=h;this.lonlat=g;this.contentSize=null!=m?m:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=l&&(this.contentHTML=l);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden");h=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(h,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);k&&this.addCloseBox(j);this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv));this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(b){null==b&&null!=this.lonlat&&null!=this.map&&(b=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME&&(this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=c&&(this.contentDiv._oldOverflow=c,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var c=this.contentDiv._oldOverflow;c&&(this.contentDiv.style.overflow=c,this.contentDiv._oldOverflow=null)}));this.moveTo(b);!this.autoSize&&!this.size&&this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);b&&this.moveTo(b)}},moveTo:function(b){null!=b&&null!=this.div&&(this.div.style.left=b.x+"px",this.div.style.top=b.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(g){this.size=g.clone();var f=this.getContentDivPadding(),k=f.left+f.right,j=f.top+f.bottom;this.fixPadding();k+=this.padding.left+this.padding.right;j+=this.padding.top+this.padding.bottom;if(this.closeDiv){var h=parseInt(this.closeDiv.style.width),k=k+(h+f.right)}this.size.w+=k;this.size.h+=j;"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=f.left+f.right,this.contentSize.h+=f.bottom+f.top);null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px");null!=this.contentDiv&&(this.contentDiv.style.width=g.w+"px",this.contentDiv.style.height=g.h+"px")},updateSize:function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",f=this.map?this.map.div:document.body,k=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:f}),j=this.getSafeContentSize(k),h=null;j.equals(k)?h=k:(k={w:j.w<k.w?j.w:null,h:j.h<k.h?j.h:null},k.w&&k.h?h=j:(g=OpenLayers.Util.getRenderedDimensions(g,k,{displayClass:this.contentDisplayClass,containerElement:f}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&g.equals(j)&&(j=OpenLayers.Util.getScrollbarWidth(),k.w?g.h+=j:g.w+=j),h=this.getSafeContentSize(g)));this.setSize(h)},setBackgroundColor:function(b){void 0!=b&&(this.backgroundColor=b);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(b){void 0!=b&&(this.opacity=b);null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(b){void 0!=b&&(this.border=b);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(b){null!=b&&(this.contentHTML=b);null!=this.contentDiv&&(null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML)&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var g=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad))},f=this.contentDiv.getElementsByTagName("img"),k=0,j=f.length;k<j;k++){var h=f[k];if(0==h.width||0==h.height){h._onImgLoad=OpenLayers.Function.bind(g,{popup:this,img:h}),OpenLayers.Event.observe(h,"load",h._onImgLoad)}}},getSafeContentSize:function(g){var g=g.clone(),f=this.getContentDivPadding(),k=f.left+f.right,j=f.top+f.bottom;this.fixPadding();k+=this.padding.left+this.padding.right;j+=this.padding.top+this.padding.bottom;if(this.closeDiv){var h=parseInt(this.closeDiv.style.width),k=k+(h+f.right)}this.minSize&&(g.w=Math.max(g.w,this.minSize.w-k),g.h=Math.max(g.h,this.minSize.h-j));this.maxSize&&(g.w=Math.min(g.w,this.maxSize.w-k),g.h=Math.min(g.h,this.maxSize.h-j));if(this.map&&this.map.size){h=f=0;if(this.keepInMap&&!this.panMapIfOutOfView){switch(h=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":f=h.x;h=this.map.size.h-h.y;break;case"tl":f=this.map.size.w-h.x;h=this.map.size.h-h.y;break;case"bl":f=this.map.size.w-h.x;h=h.y;break;case"br":f=h.x;h=h.y;break;default:f=h.x,h=this.map.size.h-h.y}}j=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-j-h;g.w=Math.min(g.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-k-f);g.h=Math.min(g.h,j)}return g},getContentDivPadding:function(){var b=this._contentDivPadding;if(!b&&(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=b=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode==document.body)){document.body.removeChild(this.div),this.div.style.display=""}return b},addCloseBox:function(d){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var c=this.getContentDivPadding();this.closeDiv.style.right=c.right+"px";this.closeDiv.style.top=c.top+"px";this.groupDiv.appendChild(this.closeDiv);d=d||function(b){this.hide();OpenLayers.Event.stop(b)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(d,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(d,this))},panIntoView:function(){var e=this.map.getSize(),d=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),f=d.clone();d.x<this.map.paddingForPopups.left?f.x=this.map.paddingForPopups.left:d.x+this.size.w>e.w-this.map.paddingForPopups.right&&(f.x=e.w-this.map.paddingForPopups.right-this.size.w);d.y<this.map.paddingForPopups.top?f.y=this.map.paddingForPopups.top:d.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(f.y=e.h-this.map.paddingForPopups.bottom-this.size.h);this.map.pan(d.x-f.x,d.y-f.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(b){OpenLayers.Event.stop(b,!0)},scope:this})},onmousedown:function(b){this.mousedown=!0;OpenLayers.Event.stop(b,!0)},onmousemove:function(b){this.mousedown&&OpenLayers.Event.stop(b,!0)},onmouseup:function(b){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(b,!0))},onclick:function(b){OpenLayers.Event.stop(b,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(b){OpenLayers.Event.stop(b,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(j,h,o,n,m,l,k){OpenLayers.Popup.prototype.initialize.apply(this,[j,h,o,n,l,k]);this.anchor=null!=m?m:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(d){var c=this.relativePosition;this.relativePosition=this.calculateRelativePosition(d);d=this.calculateNewPx(d);OpenLayers.Popup.prototype.moveTo.apply(this,Array(d));this.relativePosition!=c&&this.updateRelativePosition()},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);this.lonlat&&this.map&&this.moveTo(this.map.getLayerPxFromLonLat(this.lonlat))},calculateRelativePosition:function(b){b=this.map.getLonLatFromLayerPx(b);b=this.map.getExtent().determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(b)},updateRelativePosition:function(){},calculateNewPx:function(e){var e=e.offset(this.anchor.offset),d=this.size||this.contentSize,f="t"==this.relativePosition.charAt(0);e.y+=f?-d.h:this.anchor.size.h;f="l"==this.relativePosition.charAt(1);e.x+=f?-d.w:this.anchor.size.w;return e},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,d,f){this.rgb={r:e,g:d,b:f}},setRed:function(b){this.rgb.r=b},setGreen:function(b){this.rgb.g=b},setBlue:function(b){this.rgb.b=b},setHue:function(d){var c=this.asHSB();c.h=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},setSaturation:function(d){var c=this.asHSB();c.s=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},setBrightness:function(d){var c=this.asHSB();c.b=d;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},darken:function(d){var c=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,Math.max(c.b-d,0))},brighten:function(d){var c=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,Math.min(c.b+d,1))},blend:function(b){this.rgb.r=Math.floor((this.rgb.r+b.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+b.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+b.rgb.b)/2)},isBright:function(){this.asHSB();return 0.5<this.asHSB().b},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length){for(var d=e,e="#",f=1;4>f;f++){e+=d.charAt(f)+d.charAt(f)}}0==e.indexOf("#")&&(e=e.substring(1));d=e.substring(0,2);f=e.substring(2,4);e=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(d,16),parseInt(f,16),parseInt(e,16))};OpenLayers.Rico.Color.createColorFromBackground=function(d){var c=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(d),"backgroundColor");return"transparent"==c&&d.parentNode?OpenLayers.Rico.Color.createColorFromBackground(d.parentNode):null==c?new OpenLayers.Rico.Color(255,255,255):0==c.indexOf("rgb(")?(d=c.substring(4,c.length-1).split(","),new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))):0==c.indexOf("#")?OpenLayers.Rico.Color.createFromHex(c):new OpenLayers.Rico.Color(255,255,255)};OpenLayers.Rico.Color.HSBtoRGB=function(r,q,p){var o=0,n=0,m=0;if(0==q){m=n=o=parseInt(255*p+0.5)}else{var r=6*(r-Math.floor(r)),l=r-Math.floor(r),k=p*(1-q),j=p*(1-q*l),q=p*(1-q*(1-l));switch(parseInt(r)){case 0:o=255*p+0.5;n=255*q+0.5;m=255*k+0.5;break;case 1:o=255*j+0.5;n=255*p+0.5;m=255*k+0.5;break;case 2:o=255*k+0.5;n=255*p+0.5;m=255*q+0.5;break;case 3:o=255*k+0.5;n=255*j+0.5;m=255*p+0.5;break;case 4:o=255*q+0.5;n=255*k+0.5;m=255*p+0.5;break;case 5:o=255*p+0.5,n=255*k+0.5,m=255*j+0.5}}return{r:parseInt(o),g:parseInt(n),b:parseInt(m)}};OpenLayers.Rico.Color.RGBtoHSB=function(k,j,q){var p,o=k>j?k:j;q>o&&(o=q);var n=k<j?k:j;q<n&&(n=q);p=0!=o?(o-n)/o:0;if(0==p){k=0}else{var m=(o-k)/(o-n),l=(o-j)/(o-n),q=(o-q)/(o-n),k=(k==o?q-l:j==o?2+m-q:4+l-m)/6;0>k&&(k+=1)}return{h:k,s:p,b:o/255}};OpenLayers.Console.warn("OpenLayers.Rico is deprecated");OpenLayers.Rico=OpenLayers.Rico||{};OpenLayers.Rico.Corner={round:function(f,e){f=OpenLayers.Util.getElement(f);this._setOptions(e);var h=this.options.color;"fromElement"==this.options.color&&(h=this._background(f));var g=this.options.bgColor;"fromParent"==this.options.bgColor&&(g=this._background(f.offsetParent));this._roundCornersImpl(f,h,g)},changeColor:function(f,e){f.style.backgroundColor=e;for(var h=f.parentNode.getElementsByTagName("span"),g=0;g<h.length;g++){h[g].style.backgroundColor=e}},changeOpacity:function(g,f){var k="alpha(opacity="+100*f+")";g.style.opacity=f;g.style.filter=k;for(var j=g.parentNode.getElementsByTagName("span"),h=0;h<j.length;h++){j[h].style.opacity=f,j[h].style.filter=k}},reRound:function(e,d){var f=e.parentNode.childNodes[2];e.parentNode.removeChild(e.parentNode.childNodes[0]);e.parentNode.removeChild(f);this.round(e.parentNode,d)},_roundCornersImpl:function(e,d,f){this.options.border&&this._renderBorder(e,f);this._isTopRounded()&&this._roundTopCorners(e,d,f);this._isBottomRounded()&&this._roundBottomCorners(e,d,f)},_renderBorder:function(e,d){var f="1px solid "+this._borderColor(d);e.innerHTML="<div "+("style='border-left: "+f+";"+("border-right: "+f)+"'")+">"+e.innerHTML+"</div>"},_roundTopCorners:function(g,f,k){for(var j=this._createCorner(k),h=0;h<this.options.numSlices;h++){j.appendChild(this._createCornerSlice(f,k,h,"top"))}g.style.paddingTop=0;g.insertBefore(j,g.firstChild)},_roundBottomCorners:function(g,f,k){for(var j=this._createCorner(k),h=this.options.numSlices-1;0<=h;h--){j.appendChild(this._createCornerSlice(f,k,h,"bottom"))}g.style.paddingBottom=0;g.appendChild(j)},_createCorner:function(d){var c=document.createElement("div");c.style.backgroundColor=this._isTransparent()?"transparent":d;return c},_createCornerSlice:function(h,g,m,l){var k=document.createElement("span"),j=k.style;j.backgroundColor=h;j.display="block";j.height="1px";j.overflow="hidden";j.fontSize="1px";h=this._borderColor(h,g);this.options.border&&0==m?(j.borderTopStyle="solid",j.borderTopWidth="1px",j.borderLeftWidth="0px",j.borderRightWidth="0px",j.borderBottomWidth="0px",j.height="0px",j.borderColor=h):h&&(j.borderColor=h,j.borderStyle="solid",j.borderWidth="0px 1px");!this.options.compact&&m==this.options.numSlices-1&&(j.height="2px");this._setMargin(k,m,l);this._setBorder(k,m,l);return k},_setOptions:function(b){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1};OpenLayers.Util.extend(this.options,b||{});this.options.numSlices=this.options.compact?2:4;this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")||0<=this.options.corners.indexOf("tl")&&0<=this.options.corners.indexOf("tr")?"":0<=this.options.corners.indexOf("tl")?"left":0<=this.options.corners.indexOf("tr")?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")||0<=this.options.corners.indexOf("bl")&&0<=this.options.corners.indexOf("br")?"":0<=this.options.corners.indexOf("bl")?"left":0<=this.options.corners.indexOf("br")?"right":""},_borderColor:function(d,c){return"transparent"==d?c:this.options.border?this.options.border:this.options.blend?this._blend(c,d):""},_setMargin:function(e,d,f){d=this._marginSize(d);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(e.style.marginLeft=d+"px",e.style.marginRight="0px"):"right"==f?(e.style.marginRight=d+"px",e.style.marginLeft="0px"):(e.style.marginLeft=d+"px",e.style.marginRight=d+"px")},_setBorder:function(e,d,f){d=this._borderSize(d);f="top"==f?this._whichSideTop():this._whichSideBottom();"left"==f?(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth="0px"):"right"==f?(e.style.borderRightWidth=d+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth=d+"px");!1!=this.options.border&&(e.style.borderLeftWidth=d+"px",e.style.borderRightWidth=d+"px")},_marginSize:function(g){if(this._isTransparent()){return 0}var f=[5,3,2,1],k=[3,2,1,0],j=[2,1],h=[1,0];return this.options.compact&&this.options.blend?h[g]:this.options.compact?j[g]:this.options.blend?k[g]:f[g]},_borderSize:function(g){var f=[5,3,2,1],k=[2,1,1,1],j=[1,0],h=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?j[g]:this.options.blend?k[g]:this.options.border?h[g]:this._isTransparent()?f[g]:0},_hasString:function(d){for(var c=1;c<arguments.length;c++){if(0<=d.indexOf(arguments[c])){return !0}}return !1},_blend:function(e,d){var f=OpenLayers.Rico.Color.createFromHex(e);f.blend(OpenLayers.Rico.Color.createFromHex(d));return f},_background:function(d){try{return OpenLayers.Rico.Color.createColorFromBackground(d).asHex()}catch(c){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(b){return 1==b.childNodes.length&&3==b.childNodes[0].nodeType}};OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(j,h,o,n,m,l,k){OpenLayers.Console.warn("AnchoredBubble is deprecated");this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(b){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(b){void 0!=b&&(this.backgroundColor=b);null!=this.div&&null!=this.contentDiv&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(b){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,b);null!=this.div&&null!=this.groupDiv&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var b={corners:this.getCornersToRound(this.relativePosition),color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,b),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,b),this.rounded=!0)},getCornersToRound:function(){var d=["tl","tr","bl","br"],c=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(d,c);return d.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!b.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),params:e.params,headers:e.headers,data:f});return d},setFeatureType:function(b){this.featureType=b;this.format.featureType=b},setGeometryName:function(b){this.geometryName=b;this.format.geometryName=b},handleRead:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(f=this.parseResponse(f,d.readOptions))&&!1!==f.success?(d.readOptions&&"object"==d.readOptions.output?OpenLayers.Util.extend(e,f):e.features=f,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=f):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseResponse:function(f,e){var h=f.responseXML;if(!h||!h.documentElement){h=f.responseText}if(!h||0>=h.length){return null}h=null!==this.readFormat?this.readFormat.read(h):this.format.read(h,e);if(!this.featureNS){var g=this.readFormat||this.format;this.featureNS=g.featureNS;g.autoConfig=!1;this.geometryName||this.setGeometryName(g.geometryName)}return h},commit:function(e,d){d=OpenLayers.Util.extend({},d);OpenLayers.Util.applyDefaults(d,this.options);var f=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});f.priv=OpenLayers.Request.POST({url:d.url,headers:d.headers,data:this.format.write(e,d),callback:this.createCallback(this.handleCommit,f,d)});return f},handleCommit:function(f,e){if(e.callback){var h=f.priv,g=h.responseXML;if(!g||!g.documentElement){g=h.responseText}h=this.format.read(g)||{};f.insertIds=h.insertIds||[];h.success?f.code=OpenLayers.Protocol.Response.SUCCESS:(f.code=OpenLayers.Protocol.Response.FAILURE,f.error=h);e.callback.call(e.scope,f)}},filterDelete:function(g,f){f=OpenLayers.Util.extend({},f);OpenLayers.Util.applyDefaults(f,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var k=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),j=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(f.featureNS?this.featurePrefix+":":"")+f.featureType}});f.featureNS&&j.setAttribute("xmlns:"+this.featurePrefix,f.featureNS);var h=this.format.writeNode("ogc:Filter",g);j.appendChild(h);k.appendChild(j);k=OpenLayers.Format.XML.prototype.write.apply(this.format,[k]);return OpenLayers.Request.POST({url:this.url,callback:f.callback||function(){},data:k})},abort:function(b){b&&b.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,d,f){if(!f||!f.layerOptions||!f.layerOptions.styleMap){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return !1}var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return !0},createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return !1}this.cancel();null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;this.touch=!1;return !0},destroyFeature:function(b){this.layer&&(b||!this.persist)&&this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var b=this.layer;b&&1<b.features.length&&this.layer.features[0].destroy()},finalize:function(b){this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(b?"cancel":"done",[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(!0)},click:function(b){OpenLayers.Event.stop(b);return !1},dblclick:function(b){OpenLayers.Event.stop(b);return !1},modifyFeature:function(b){this.point||this.createFeature(b);b=this.layer.getLonLatFromViewPortPx(b);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var b=this.point&&this.point.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPoint([b]));return b},geometryClone:function(){var b=this.getGeometry();return b&&b.clone()},mousedown:function(b){return this.down(b)},touchstart:function(b){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=b.xy;return this.down(b)},mousemove:function(b){return this.move(b)},touchmove:function(b){this.lastTouchPx=b.xy;return this.move(b)},mouseup:function(b){return this.up(b)},touchend:function(b){b.xy=this.lastTouchPx;return this.up(b)},down:function(b){this.mouseDown=!0;this.lastDown=b.xy;this.touch||this.modifyFeature(b.xy);this.stoppedDown=this.stopDown;return !this.stopDown},move:function(b){!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy);return !0},up:function(b){this.mouseDown=!1;this.stoppedDown=this.stopDown;return this.checkModifiers(b)&&(!this.lastUp||!this.lastUp.equals(b.xy))&&this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(b.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=b.xy,this.finalize(),!this.stopUp):!0},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(f,e,h){var g=!0;null!=h&&f&&e&&f.distanceTo(e)>h&&(g=!1);return g},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(b){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,b);this.line=null},destroyPersistedFeature:function(){var b=this.layer;b&&2<b.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(b){this.layer.removeFeatures([this.point]);b=this.layer.getLonLatFromViewPortPx(b);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(d,c){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(d,c),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,d){var f=this.line.geometry.components[this.getCurrentPointIndex()-1];f&&(!isNaN(f.x)&&!isNaN(f.y))&&this.insertXY(f.x+e,f.y+d)},insertDirectionLength:function(f,e){var f=f*(Math.PI/180),h=e*Math.cos(f),g=e*Math.sin(f);this.insertDeltaXY(h,g)},insertDeflectionLength:function(f,e){var h=this.getCurrentPointIndex()-1;if(0<h){var g=this.line.geometry.components[h],h=this.line.geometry.components[h-1];this.insertDirectionLength(180*Math.atan2(g.y-h.y,g.x-h.x)/Math.PI+f,e)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,d=e.components,f=this.getCurrentPointIndex()-1,d=d[f];if(e=e.removeComponent(d)){this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var b=this.redoStack&&this.redoStack.pop();b&&(this.line.geometry.addComponent(b,this.getCurrentPointIndex()),this.drawFeature());return !!b},freehandMode:function(b){return this.freehandToggle&&b[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,d){this.line||this.createFeature(e);var f=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=f.lon;this.point.geometry.y=f.lat;this.callback("modify",[this.point.geometry,this.getSketch(),d]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var b=this.line&&this.line.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiLineString([b]));return b},touchstart:function(b){if(this.timerId&&this.passesTolerance(this.lastTouchPx,b.xy,this.doubleTouchTolerance)){return this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1}this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,b)},down:function(d){var c=this.stopDown;this.freehandMode(d)&&(c=!0,this.touch&&(this.modifyFeature(d.xy,!!this.lastUp),OpenLayers.Event.stop(d)));!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,d.xy,this.pixelTolerance))&&this.modifyFeature(d.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=d.xy;this.stoppedDown=c;return !c},move:function(b){if(this.stoppedDown&&this.freehandMode(b)){return this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(b.xy),!1}!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(b.xy,!!this.lastUp);return !0},up:function(b){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(b.xy))){this.stoppedDown&&this.freehandMode(b)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(b.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(b.xy),this.lastUp=b.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())}this.stoppedDown=this.stopDown;this.mouseDown=!1;return !this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]);this.removePoint();this.finalize()},dblclick:function(b){this.freehandMode(b)||this.finishGeometry();return !1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Spherical=OpenLayers.Spherical||{};OpenLayers.Spherical.DEFAULT_RADIUS=6378137;OpenLayers.Spherical.computeDistanceBetween=function(g,f,k){var k=k||OpenLayers.Spherical.DEFAULT_RADIUS,j=Math.sin(Math.PI*(f.lon-g.lon)/360),h=Math.sin(Math.PI*(f.lat-g.lat)/360),g=h*h+j*j*Math.cos(Math.PI*g.lat/180)*Math.cos(Math.PI*f.lat/180);return 2*k*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))};OpenLayers.Spherical.computeHeading=function(f,e){var h=Math.sin(Math.PI*(f.lon-e.lon)/180)*Math.cos(Math.PI*e.lat/180),g=Math.cos(Math.PI*f.lat/180)*Math.sin(Math.PI*e.lat/180)-Math.sin(Math.PI*f.lat/180)*Math.cos(Math.PI*e.lat/180)*Math.cos(Math.PI*(f.lon-e.lon)/180);return 180*Math.atan2(h,g)/Math.PI};OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var d,f=this.layers||e.layers;for(d=f.length-1;0<=d;--d){this.addLayer({layer:f[d]})}if(!this.layers){e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(b){b.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(d){if(this.active&&(d=d.tile,d instanceof OpenLayers.Tile.Image&&!d.crossOriginKeyword&&"data:"!==d.url.substr(0,5))){var c=OpenLayers.Request.makeSameOrigin(d.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[c]=d.url;d.url=c}},cache:function(f){if(this.active&&window.localStorage&&(f=f.tile,f instanceof OpenLayers.Tile.Image&&"data:"!==f.url.substr(0,5))){try{var e=f.getCanvasContext();if(e){var h=OpenLayers.Control.CacheWrite.urlMap;window.localStorage.setItem("olCache_"+(h[f.url]||f.url),e.canvas.toDataURL(this.imageFormat));delete h[f.url]}}catch(g){(e=g.name||g.message)&&this.quotaRegEx.test(e)?this.events.triggerEvent("cachefull",{tile:f}):OpenLayers.Console.error(g.toString())}}},destroy:function(){if(this.layers||this.map){var d,c=this.layers||this.map.layers;for(d=c.length-1;0<=d;--d){this.removeLayer({layer:c[d]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var d,c;for(d=window.localStorage.length-1;0<=d;--d){c=window.localStorage.key(d),"olCache_"===c.substr(0,8)&&window.localStorage.removeItem(c)}}};OpenLayers.Control.CacheWrite.urlMap={};OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(f,e){var h=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(e&&e.map){if(this.context=h,e.map instanceof OpenLayers.Map){h=this.mergeContextToMap(h,e.map)}else{var g=e.map;if(OpenLayers.Util.isElement(g)||"string"==typeof g){g={div:g}}h=this.contextToMap(h,g)}}return h},getLayerFromContext:function(h){var g,m,l={queryable:h.queryable,visibility:h.visibility,maxExtent:h.maxExtent,metadata:OpenLayers.Util.applyDefaults(h.metadata,{styles:h.styles,formats:h.formats,"abstract":h["abstract"],dataURL:h.dataURL}),numZoomLevels:h.numZoomLevels,units:h.units,isBaseLayer:h.isBaseLayer,opacity:h.opacity,displayInLayerSwitcher:h.displayInLayerSwitcher,singleTile:h.singleTile,tileSize:h.tileSize?new OpenLayers.Size(h.tileSize.width,h.tileSize.height):void 0,minScale:h.minScale||h.maxScaleDenominator,maxScale:h.maxScale||h.minScaleDenominator,srs:h.srs,dimensions:h.dimensions,metadataURL:h.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(l,this.layerOptions);var k={layers:h.name,transparent:h.transparent,version:h.version};if(h.formats&&0<h.formats.length){k.format=h.formats[0].value;g=0;for(m=h.formats.length;g<m;g++){var j=h.formats[g];if(!0==j.current){k.format=j.value;break}}}if(h.styles&&0<h.styles.length){g=0;for(m=h.styles.length;g<m;g++){if(j=h.styles[g],!0==j.current){j.href?k.sld=j.href:j.body?k.sld_body=j.body:k.styles=j.name;break}}}this.layerParams&&OpenLayers.Util.applyDefaults(k,this.layerParams);g=null;m=h.service;m==OpenLayers.Format.Context.serviceTypes.WFS?(l.strategies=[new OpenLayers.Strategy.BBOX],l.protocol=new OpenLayers.Protocol.WFS({url:h.url,featurePrefix:h.name.split(":")[0],featureType:h.name.split(":").pop()}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):m==OpenLayers.Format.Context.serviceTypes.KML?(l.strategies=[new OpenLayers.Strategy.Fixed],l.protocol=new OpenLayers.Protocol.HTTP({url:h.url,format:new OpenLayers.Format.KML}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):m==OpenLayers.Format.Context.serviceTypes.GML?(l.strategies=[new OpenLayers.Strategy.Fixed],l.protocol=new OpenLayers.Protocol.HTTP({url:h.url,format:new OpenLayers.Format.GML}),g=new OpenLayers.Layer.Vector(h.title||h.name,l)):h.features?(g=new OpenLayers.Layer.Vector(h.title||h.name,l),g.addFeatures(h.features)):!0!==h.categoryLayer&&(g=new OpenLayers.Layer.WMS(h.title||h.name,h.url,k,l));return g},getLayersFromContext:function(g){for(var f=[],k=0,j=g.length;k<j;k++){var h=this.getLayerFromContext(g[k]);null!==h&&f.push(h)}return f},contextToMap:function(e,d){d=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},d);d.maxExtent&&(d.maxResolution=d.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);d.metadata={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};var f=new OpenLayers.Map(d);f.addLayers(this.getLayersFromContext(e.layersContext));f.setCenter(e.bounds.getCenterLonLat(),f.getZoomForExtent(e.bounds,!0));return f},mergeContextToMap:function(d,c){c.addLayers(this.getLayersFromContext(d.layersContext));return c},write:function(d,c){d=this.toContext(d);return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(h){var g=this.getParser(),m={queryable:h.queryable,visibility:h.visibility,name:h.params.LAYERS,title:h.name,"abstract":h.metadata["abstract"],dataURL:h.metadata.dataURL,metadataURL:h.metadataURL,server:{version:h.params.VERSION,url:h.url},maxExtent:h.maxExtent,transparent:h.params.TRANSPARENT,numZoomLevels:h.numZoomLevels,units:h.units,isBaseLayer:h.isBaseLayer,opacity:1==h.opacity?void 0:h.opacity,displayInLayerSwitcher:h.displayInLayerSwitcher,singleTile:h.singleTile,tileSize:h.singleTile||!h.tileSize?void 0:{width:h.tileSize.w,height:h.tileSize.h},minScale:h.options.resolutions||h.options.scales||h.options.maxResolution||h.options.minScale?h.minScale:void 0,maxScale:h.options.resolutions||h.options.scales||h.options.minResolution||h.options.maxScale?h.maxScale:void 0,formats:[],styles:[],srs:h.srs,dimensions:h.dimensions};h.metadata.servertitle&&(m.server.title=h.metadata.servertitle);if(h.metadata.formats&&0<h.metadata.formats.length){for(var l=0,k=h.metadata.formats.length;l<k;l++){var j=h.metadata.formats[l];m.formats.push({value:j.value,current:j.value==h.params.FORMAT})}}else{m.formats.push({value:h.params.FORMAT,current:!0})}if(h.metadata.styles&&0<h.metadata.styles.length){l=0;for(k=h.metadata.styles.length;l<k;l++){g=h.metadata.styles[l],g.current=g.href==h.params.SLD||g.body==h.params.SLD_BODY||g.name==h.params.STYLES?!0:!1,m.styles.push(g)}}else{m.styles.push({href:h.params.SLD,body:h.params.SLD_BODY,name:h.params.STYLES||g.defaultStyleName,title:g.defaultStyleTitle,current:!0})}return m},toContext:function(g){var f={},k=g.layers;if("OpenLayers.Map"==g.CLASS_NAME){var j=g.metadata||{};f.size=g.getSize();f.bounds=g.getExtent();f.projection=g.projection;f.title=g.title;f.keywords=j.keywords;f["abstract"]=j["abstract"];f.logo=j.logo;f.descriptionURL=j.descriptionURL;f.contactInformation=j.contactInformation;f.maxExtent=g.maxExtent}else{OpenLayers.Util.applyDefaults(f,g),void 0!=f.layers&&delete f.layers}void 0==f.layersContext&&(f.layersContext=[]);if(void 0!=k&&OpenLayers.Util.isArray(k)){g=0;for(j=k.length;g<j;g++){var h=k[g];h instanceof OpenLayers.Layer.WMS&&f.layersContext.push(this.layerToContext(h))}}return f},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(d){var c=null;if(null==d){c=this.namespaces[this.defaultPrefix]}else{for(c in this.namespaces){if(this.namespaces[c]==d){break}}}return c},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d=d.documentElement;this.rootPrefix=d.prefix;var c={version:d.getAttribute("version")};this.runChildNodes(c,d);return c},runChildNodes:function(k,j){for(var q=j.childNodes,p,o,n,m=0,l=q.length;m<l;++m){p=q[m],1==p.nodeType&&(o=this.getNamespacePrefix(p.namespaceURI),n=p.nodeName.split(":").pop(),(o=this["read_"+o+"_"+n])&&o.apply(this,[k,p]))}},read_wmc_General:function(d,c){this.runChildNodes(d,c)},read_wmc_BoundingBox:function(d,c){d.projection=c.getAttribute("SRS");d.bounds=new OpenLayers.Bounds(c.getAttribute("minx"),c.getAttribute("miny"),c.getAttribute("maxx"),c.getAttribute("maxy"))},read_wmc_LayerList:function(d,c){d.layersContext=[];this.runChildNodes(d,c)},read_wmc_Layer:function(e,d){var f={visibility:"1"!=d.getAttribute("hidden"),queryable:"1"==d.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(f,d);e.layersContext.push(f)},read_wmc_Extension:function(d,c){this.runChildNodes(d,c)},read_ol_units:function(d,c){d.units=this.getChildValue(c)},read_ol_maxExtent:function(e,d){var f=new OpenLayers.Bounds(d.getAttribute("minx"),d.getAttribute("miny"),d.getAttribute("maxx"),d.getAttribute("maxy"));e.maxExtent=f},read_ol_transparent:function(d,c){d.transparent=this.getChildValue(c)},read_ol_numZoomLevels:function(d,c){d.numZoomLevels=parseInt(this.getChildValue(c))},read_ol_opacity:function(d,c){d.opacity=parseFloat(this.getChildValue(c))},read_ol_singleTile:function(d,c){d.singleTile="true"==this.getChildValue(c)},read_ol_tileSize:function(e,d){var f={width:d.getAttribute("width"),height:d.getAttribute("height")};e.tileSize=f},read_ol_isBaseLayer:function(d,c){d.isBaseLayer="true"==this.getChildValue(c)},read_ol_displayInLayerSwitcher:function(d,c){d.displayInLayerSwitcher="true"==this.getChildValue(c)},read_wmc_Server:function(d,c){d.version=c.getAttribute("version");d.url=this.getOnlineResource_href(c);d.metadata.servertitle=c.getAttribute("title")},read_wmc_FormatList:function(d,c){this.runChildNodes(d,c)},read_wmc_Format:function(e,d){var f={value:this.getChildValue(d)};"1"==d.getAttribute("current")&&(f.current=!0);e.formats.push(f)},read_wmc_StyleList:function(d,c){this.runChildNodes(d,c)},read_wmc_Style:function(e,d){var f={};this.runChildNodes(f,d);"1"==d.getAttribute("current")&&(f.current=!0);e.styles.push(f)},read_wmc_SLD:function(d,c){this.runChildNodes(d,c)},read_sld_StyledLayerDescriptor:function(e,d){var f=OpenLayers.Format.XML.prototype.write.apply(this,[d]);e.body=f},read_sld_FeatureTypeStyle:function(e,d){var f=OpenLayers.Format.XML.prototype.write.apply(this,[d]);e.body=f},read_wmc_OnlineResource:function(d,c){d.href=this.getAttributeNS(c,this.namespaces.xlink,"href")},read_wmc_Name:function(e,d){var f=this.getChildValue(d);f&&(e.name=f)},read_wmc_Title:function(e,d){var f=this.getChildValue(d);f&&(e.title=f)},read_wmc_MetadataURL:function(d,c){d.metadataURL=this.getOnlineResource_href(c)},read_wmc_KeywordList:function(d,c){d.keywords=[];this.runChildNodes(d.keywords,c)},read_wmc_Keyword:function(d,c){d.push(this.getChildValue(c))},read_wmc_Abstract:function(e,d){var f=this.getChildValue(d);f&&(e["abstract"]=f)},read_wmc_LogoURL:function(d,c){d.logo={width:c.getAttribute("width"),height:c.getAttribute("height"),format:c.getAttribute("format"),href:this.getOnlineResource_href(c)}},read_wmc_DescriptionURL:function(d,c){d.descriptionURL=this.getOnlineResource_href(c)},read_wmc_ContactInformation:function(e,d){var f={};this.runChildNodes(f,d);e.contactInformation=f},read_wmc_ContactPersonPrimary:function(e,d){var f={};this.runChildNodes(f,d);e.personPrimary=f},read_wmc_ContactPerson:function(e,d){var f=this.getChildValue(d);f&&(e.person=f)},read_wmc_ContactOrganization:function(e,d){var f=this.getChildValue(d);f&&(e.organization=f)},read_wmc_ContactPosition:function(e,d){var f=this.getChildValue(d);f&&(e.position=f)},read_wmc_ContactAddress:function(e,d){var f={};this.runChildNodes(f,d);e.contactAddress=f},read_wmc_AddressType:function(e,d){var f=this.getChildValue(d);f&&(e.type=f)},read_wmc_Address:function(e,d){var f=this.getChildValue(d);f&&(e.address=f)},read_wmc_City:function(e,d){var f=this.getChildValue(d);f&&(e.city=f)},read_wmc_StateOrProvince:function(e,d){var f=this.getChildValue(d);f&&(e.stateOrProvince=f)},read_wmc_PostCode:function(e,d){var f=this.getChildValue(d);f&&(e.postcode=f)},read_wmc_Country:function(e,d){var f=this.getChildValue(d);f&&(e.country=f)},read_wmc_ContactVoiceTelephone:function(e,d){var f=this.getChildValue(d);f&&(e.phone=f)},read_wmc_ContactFacsimileTelephone:function(e,d){var f=this.getChildValue(d);f&&(e.fax=f)},read_wmc_ContactElectronicMailAddress:function(e,d){var f=this.getChildValue(d);f&&(e.email=f)},read_wmc_DataURL:function(d,c){d.dataURL=this.getOnlineResource_href(c)},read_wmc_LegendURL:function(e,d){var f={width:d.getAttribute("width"),height:d.getAttribute("height"),format:d.getAttribute("format"),href:this.getOnlineResource_href(d)};e.legend=f},read_wmc_DimensionList:function(d,c){d.dimensions={};this.runChildNodes(d.dimensions,c)},read_wmc_Dimension:function(f,e){var h={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units")||"",unitSymbol:e.getAttribute("unitSymbol")||"",userValue:e.getAttribute("userValue")||"",nearestValue:"1"===e.getAttribute("nearestValue"),multipleValues:"1"===e.getAttribute("multipleValues"),current:"1"===e.getAttribute("current"),"default":e.getAttribute("default")||""},g=this.getChildValue(e);h.values=g.split(",");f[h.name]=h},write:function(e,d){var f=this.createElementDefaultNS("ViewContext");this.setAttributes(f,{version:this.VERSION,id:d&&"string"==typeof d.id?d.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);f.appendChild(this.write_wmc_General(e));f.appendChild(this.write_wmc_LayerList(e));return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createElementDefaultNS:function(e,d,f){e=this.createElementNS(this.namespaces[this.defaultPrefix],e);d&&e.appendChild(this.createTextNode(d));f&&this.setAttributes(e,f);return e},setAttributes:function(f,e){var h,g;for(g in e){h=e[g].toString(),h.match(/[A-Z]/)?this.setAttributeNS(f,null,g,h):f.setAttribute(g,h)}},write_wmc_General:function(e){var d=this.createElementDefaultNS("General");e.size&&d.appendChild(this.createElementDefaultNS("Window",null,{width:e.size.w,height:e.size.h}));var f=e.bounds;d.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:f.left.toPrecision(18),miny:f.bottom.toPrecision(18),maxx:f.right.toPrecision(18),maxy:f.top.toPrecision(18),SRS:e.projection}));d.appendChild(this.createElementDefaultNS("Title",e.title));e.keywords&&d.appendChild(this.write_wmc_KeywordList(e.keywords));e["abstract"]&&d.appendChild(this.createElementDefaultNS("Abstract",e["abstract"]));e.logo&&d.appendChild(this.write_wmc_URLType("LogoURL",e.logo.href,e.logo));e.descriptionURL&&d.appendChild(this.write_wmc_URLType("DescriptionURL",e.descriptionURL));e.contactInformation&&d.appendChild(this.write_wmc_ContactInformation(e.contactInformation));d.appendChild(this.write_ol_MapExtension(e));return d},write_wmc_KeywordList:function(f){for(var e=this.createElementDefaultNS("KeywordList"),h=0,g=f.length;h<g;h++){e.appendChild(this.createElementDefaultNS("Keyword",f[h]))}return e},write_wmc_ContactInformation:function(d){var c=this.createElementDefaultNS("ContactInformation");d.personPrimary&&c.appendChild(this.write_wmc_ContactPersonPrimary(d.personPrimary));d.position&&c.appendChild(this.createElementDefaultNS("ContactPosition",d.position));d.contactAddress&&c.appendChild(this.write_wmc_ContactAddress(d.contactAddress));d.phone&&c.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",d.phone));d.fax&&c.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",d.fax));d.email&&c.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",d.email));return c},write_wmc_ContactPersonPrimary:function(d){var c=this.createElementDefaultNS("ContactPersonPrimary");d.person&&c.appendChild(this.createElementDefaultNS("ContactPerson",d.person));d.organization&&c.appendChild(this.createElementDefaultNS("ContactOrganization",d.organization));return c},write_wmc_ContactAddress:function(d){var c=this.createElementDefaultNS("ContactAddress");d.type&&c.appendChild(this.createElementDefaultNS("AddressType",d.type));d.address&&c.appendChild(this.createElementDefaultNS("Address",d.address));d.city&&c.appendChild(this.createElementDefaultNS("City",d.city));d.stateOrProvince&&c.appendChild(this.createElementDefaultNS("StateOrProvince",d.stateOrProvince));d.postcode&&c.appendChild(this.createElementDefaultNS("PostCode",d.postcode));d.country&&c.appendChild(this.createElementDefaultNS("Country",d.country));return c},write_ol_MapExtension:function(e){var d=this.createElementDefaultNS("Extension");if(e=e.maxExtent){var f=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(f,{minx:e.left.toPrecision(18),miny:e.bottom.toPrecision(18),maxx:e.right.toPrecision(18),maxy:e.top.toPrecision(18)});d.appendChild(f)}return d},write_wmc_LayerList:function(f){for(var e=this.createElementDefaultNS("LayerList"),h=0,g=f.layersContext.length;h<g;++h){e.appendChild(this.write_wmc_Layer(f.layersContext[h]))}return e},write_wmc_Layer:function(d){var c=this.createElementDefaultNS("Layer",null,{queryable:d.queryable?"1":"0",hidden:d.visibility?"0":"1"});c.appendChild(this.write_wmc_Server(d));c.appendChild(this.createElementDefaultNS("Name",d.name));c.appendChild(this.createElementDefaultNS("Title",d.title));d["abstract"]&&c.appendChild(this.createElementDefaultNS("Abstract",d["abstract"]));d.dataURL&&c.appendChild(this.write_wmc_URLType("DataURL",d.dataURL));d.metadataURL&&c.appendChild(this.write_wmc_URLType("MetadataURL",d.metadataURL));return c},write_wmc_LayerExtension:function(h){var g=this.createElementDefaultNS("Extension"),m=h.maxExtent,l=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(l,{minx:m.left.toPrecision(18),miny:m.bottom.toPrecision(18),maxx:m.right.toPrecision(18),maxy:m.top.toPrecision(18)});g.appendChild(l);h.tileSize&&!h.singleTile&&(m=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(m,h.tileSize),g.appendChild(m));for(var m="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),k=0,j=m.length;k<j;++k){(l=this.createOLPropertyNode(h,m[k]))&&g.appendChild(l)}return g},createOLPropertyNode:function(e,d){var f=null;null!=e[d]&&(f=this.createElementNS(this.namespaces.ol,"ol:"+d),f.appendChild(this.createTextNode(e[d].toString())));return f},write_wmc_Server:function(e){var e=e.server,d=this.createElementDefaultNS("Server"),f={service:"OGC:WMS",version:e.version};e.title&&(f.title=e.title);this.setAttributes(d,f);d.appendChild(this.write_wmc_OnlineResource(e.url));return d},write_wmc_URLType:function(f,e,h){f=this.createElementDefaultNS(f);f.appendChild(this.write_wmc_OnlineResource(e));if(h){for(var e=["width","height","format"],g=0;g<e.length;g++){e[g] in h&&f.setAttribute(e[g],h[e[g]])}}return f},write_wmc_DimensionList:function(h){var g=this.createElementDefaultNS("DimensionList"),m;for(m in h.dimensions){var l={},k=h.dimensions[m],j;for(j in k){l[j]="boolean"==typeof k[j]?Number(k[j]):k[j]}k="";l.values&&(k=l.values.join(","),delete l.values);g.appendChild(this.createElementDefaultNS("Dimension",k,l))}return g},write_wmc_FormatList:function(g){for(var f=this.createElementDefaultNS("FormatList"),k=0,j=g.formats.length;k<j;k++){var h=g.formats[k];f.appendChild(this.createElementDefaultNS("Format",h.value,h.current&&!0==h.current?{current:"1"}:null))}return f},write_wmc_StyleList:function(j){var h=this.createElementDefaultNS("StyleList");if((j=j.styles)&&OpenLayers.Util.isArray(j)){for(var o,n=0,m=j.length;n<m;n++){var l=j[n],k=this.createElementDefaultNS("Style",null,l.current&&!0==l.current?{current:"1"}:null);l.href?(o=this.createElementDefaultNS("SLD"),l.name&&o.appendChild(this.createElementDefaultNS("Name",l.name)),l.title&&o.appendChild(this.createElementDefaultNS("Title",l.title)),l.legend&&o.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)),l=this.write_wmc_OnlineResource(l.href),o.appendChild(l),k.appendChild(o)):l.body?(o=this.createElementDefaultNS("SLD"),l.name&&o.appendChild(this.createElementDefaultNS("Name",l.name)),l.title&&o.appendChild(this.createElementDefaultNS("Title",l.title)),l.legend&&o.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)),l=OpenLayers.Format.XML.prototype.read.apply(this,[l.body]).documentElement,o.ownerDocument&&o.ownerDocument.importNode&&(l=o.ownerDocument.importNode(l,!0)),o.appendChild(l),k.appendChild(o)):(k.appendChild(this.createElementDefaultNS("Name",l.name)),k.appendChild(this.createElementDefaultNS("Title",l.title)),l["abstract"]&&k.appendChild(this.createElementDefaultNS("Abstract",l["abstract"])),l.legend&&k.appendChild(this.write_wmc_URLType("LegendURL",l.legend.href,l.legend)));h.appendChild(k)}}return h},write_wmc_OnlineResource:function(d){var c=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(c,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(c,this.namespaces.xlink,"xlink:href",d);return c},getOnlineResource_href:function(d){var c={},d=d.getElementsByTagName("OnlineResource");0<d.length&&this.read_wmc_OnlineResource(c,d[0]);return c.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);b={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,b),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,b)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var f=[];if(this.map&&this.map.layers){for(var e=0,h=this.map.layers.length;e<h;e++){var g=this.map.layers[e];g.attribution&&g.getVisibility()&&-1===OpenLayers.Util.indexOf(f,g.attribution)&&f.push(g.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:f.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(b){OpenLayers.Util.extend(this,b)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(b){this.points.unshift({xy:b,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(h){for(var g,m=(new Date).getTime(),l=0,k=this.points.length,j;l<k;l++){j=this.points[l];if(m-j.tick>this.delay){break}g=j}if(g&&(l=(new Date).getTime()-g.tick,m=Math.sqrt(Math.pow(h.x-g.xy.x,2)+Math.pow(h.y-g.xy.y,2)),l=m/l,!(0==l||l<this.threshold))){return m=Math.asin((h.y-g.xy.y)/m),g.xy.x<=h.x&&(m=Math.PI-m),{speed:l,theta:m}}},move:function(k,j){var q=k.speed,p=Math.cos(k.theta),o=-Math.sin(k.theta),n=(new Date).getTime(),m=0,l=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var d=(new Date).getTime()-n,f=-this.deceleration*Math.pow(d,2)/2+q*d,e=f*p,f=f*o,c,b;c=!1;0>=-this.deceleration*d+q&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,c=!0);d=e-m;b=f-l;m=e;l=f;j(d,b,c)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(e,d,f){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[e,f]);this.location=d;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(e,d,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(t){var s=t.responseXML;if(!s||!s.documentElement){s=OpenLayers.Format.XML.prototype.read(t.responseText)}if(this.useFeedTitle){t=null;try{t=s.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(r){t=s.getElementsByTagName("title")[0].firstChild.nodeValue}t&&this.setName(t)}t={};OpenLayers.Util.extend(t,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(t.externalProjection=this.projection,t.internalProjection=this.map.getProjectionObject());for(var s=(new OpenLayers.Format.GeoRSS(t)).read(s),t=0,q=s.length;t<q;t++){var p={},o=s[t];if(o.geometry){var n=o.attributes.title?o.attributes.title:"Untitled",m=o.attributes.description?o.attributes.description:"No description.",l=o.attributes.link?o.attributes.link:"",o=o.geometry.getBounds().getCenterLonLat();p.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone();p.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(n||m){p.title=n;p.description=m;var k='<div class="olLayerGeoRSSClose">[x]</div>',k=k+'<div class="olLayerGeoRSSTitle">';l&&(k+='<a class="link" href="'+l+'" target="_blank">');k+=n;l&&(k+="</a>");k+="</div>";k+='<div style="" class="olLayerGeoRSSDescription">';k+=m;k+="</div>";p.popupContentHTML=k}o=new OpenLayers.Feature(this,o,p);this.features.push(o);p=o.createMarker();p.events.register("click",o,this.markerClick);this.addMarker(p)}}this.events.triggerEvent("loadend")},markerClick:function(f){var e=this==this.layer.selectedFeature;this.layer.selectedFeature=!e?this:null;for(var h=0,g=this.layer.map.popups.length;h<g;h++){this.layer.map.removePopup(this.layer.map.popups[h])}e||(e=this.createPopup(),OpenLayers.Event.observe(e.div,"click",OpenLayers.Function.bind(function(){for(var d=0,c=this.layer.map.popups.length;d<c;d++){this.layer.map.removePopup(this.layer.map.popups[d])}},this)),this.layer.map.addPopup(e));OpenLayers.Event.stop(f)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(b){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(e,d){var d=OpenLayers.Util.applyDefaults(d,this.options),f={namedLayers:!0===d.namedLayersAsArray?[]:{}};this.readChildNodes(e,f);return f},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(d,c){c.version=d.getAttribute("version");this.readChildNodes(d,c)},Name:function(d,c){c.name=this.getChildValue(d)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c.description=this.getChildValue(d)},NamedLayer:function(g,f){var k={userStyles:[],namedStyles:[]};this.readChildNodes(g,k);for(var j=0,h=k.userStyles.length;j<h;++j){k.userStyles[j].layerName=k.name}OpenLayers.Util.isArray(f.namedLayers)?f.namedLayers.push(k):f.namedLayers[k.name]=k},NamedStyle:function(d,c){c.namedStyles.push(this.getChildName(d.firstChild))},UserStyle:function(e,d){var f={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(e,f);this.multipleSymbolizers?(delete f.defaultsPerSymbolizer,f=new OpenLayers.Style2(f)):f=new OpenLayers.Style(this.defaultSymbolizer,f);d.userStyles.push(f)},IsDefault:function(d,c){"1"==this.getChildValue(d)&&(c.isDefault=!0)},FeatureTypeStyle:function(e,d){++this.featureTypeCounter;var f={rules:this.multipleSymbolizers?d.rules:[]};this.readChildNodes(e,f);this.multipleSymbolizers||(d.rules=f.rules)},Rule:function(e,d){var f;this.multipleSymbolizers&&(f={symbolizers:[]});f=new OpenLayers.Rule(f);this.readChildNodes(e,f);d.rules.push(f)},ElseFilter:function(d,c){c.elseFilter=!0},MinScaleDenominator:function(d,c){c.minScaleDenominator=parseFloat(this.getChildValue(d))},MaxScaleDenominator:function(d,c){c.maxScaleDenominator=parseFloat(this.getChildValue(d))},TextSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Text(f))):d.symbolizer.Text=OpenLayers.Util.applyDefaults(f,d.symbolizer.Text)},LabelPlacement:function(d,c){this.readChildNodes(d,c)},PointPlacement:function(h,g){var m={};this.readChildNodes(h,m);m.labelRotation=m.rotation;delete m.rotation;var l,k=g.labelAnchorPointX,j=g.labelAnchorPointY;k<=1/3?l="l":k>1/3&&k<2/3?l="c":k>=2/3&&(l="r");j<=1/3?l+="b":j>1/3&&j<2/3?l+="m":j>=2/3&&(l+="t");m.labelAlign=l;OpenLayers.Util.applyDefaults(g,m)},AnchorPoint:function(d,c){this.readChildNodes(d,c)},AnchorPointX:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelAnchorPointX=f)},AnchorPointY:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelAnchorPointY=f)},Displacement:function(d,c){this.readChildNodes(d,c)},DisplacementX:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelXOffset=f)},DisplacementY:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelYOffset=f)},LinePlacement:function(d,c){this.readChildNodes(d,c)},PerpendicularOffset:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.labelPerpendicularOffset=f)},Label:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.label=f)},Font:function(d,c){this.readChildNodes(d,c)},Halo:function(e,d){var f={};this.readChildNodes(e,f);d.haloRadius=f.haloRadius;d.haloColor=f.fillColor;d.haloOpacity=f.fillOpacity},Radius:function(e,d){var f=this.readers.ogc._expression.call(this,e);null!=f&&(d.haloRadius=f)},RasterSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Raster(f))):d.symbolizer.Raster=OpenLayers.Util.applyDefaults(f,d.symbolizer.Raster)},Geometry:function(d,c){c.geometry={};this.readChildNodes(d,c.geometry)},ColorMap:function(d,c){c.colorMap=[];this.readChildNodes(d,c.colorMap)},ColorMapEntry:function(f,e){var h=f.getAttribute("quantity"),g=f.getAttribute("opacity");e.push({color:f.getAttribute("color"),quantity:null!==h?parseFloat(h):void 0,label:f.getAttribute("label")||void 0,opacity:null!==g?parseFloat(g):void 0})},LineSymbolizer:function(e,d){var f={};this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Line(f))):d.symbolizer.Line=OpenLayers.Util.applyDefaults(f,d.symbolizer.Line)},PolygonSymbolizer:function(e,d){var f={fill:!1,stroke:!1};this.multipleSymbolizers||(f=d.symbolizer.Polygon||f);this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Polygon(f))):d.symbolizer.Polygon=f},PointSymbolizer:function(e,d){var f={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(f=d.symbolizer.Point||f);this.readChildNodes(e,f);this.multipleSymbolizers?(f.zIndex=this.featureTypeCounter,d.symbolizers.push(new OpenLayers.Symbolizer.Point(f))):d.symbolizer.Point=f},Stroke:function(d,c){c.stroke=!0;this.readChildNodes(d,c)},Fill:function(d,c){c.fill=!0;this.readChildNodes(d,c)},CssParameter:function(f,e){var h=f.getAttribute("name"),g=this.cssMap[h];e.label&&("fill"===h?g="fontColor":"fill-opacity"===h&&(g="fontOpacity"));g&&(h=this.readers.ogc._expression.call(this,f))&&(e[g]=h)},Graphic:function(k,j){j.graphic=!0;var q={};this.readChildNodes(k,q);for(var p="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),o,n,m=0,l=p.length;m<l;++m){o=p[m],n=q[o],void 0!=n&&(j[o]=n)}void 0!=q.opacity&&(j.graphicOpacity=q.opacity);void 0!=q.size&&(isNaN(q.size/2)?j.graphicWidth=q.size:j.pointRadius=q.size/2);void 0!=q.href&&(j.externalGraphic=q.href);void 0!=q.rotation&&(j.rotation=q.rotation)},ExternalGraphic:function(d,c){this.readChildNodes(d,c)},Mark:function(d,c){this.readChildNodes(d,c)},WellKnownName:function(d,c){c.graphicName=this.getChildValue(d)},Opacity:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.opacity=f)},Size:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.size=f)},Rotation:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.rotation=f)},OnlineResource:function(d,c){c.href=this.getAttributeNS(d,this.namespaces.xlink,"href")},Format:function(d,c){c.graphicFormat=this.getChildValue(d)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(e){var d=null,f;for(f in this.cssMap){if(this.cssMap[f]==e){d=f;break}}return d},getGraphicFormat:function(e){var d,f;for(f in this.graphicFormats){if(this.graphicFormats[f].test(e)){d=f;break}}return d||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(b){return this.writers.sld.StyledLayerDescriptor.apply(this,[b])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(k,j){var q=this.createElementNSPlus(k),p="string"==typeof j?j.split("${"):[j];q.appendChild(this.createTextNode(p[0]));for(var o,n,m=1,l=p.length;m<l;m++){o=p[m],n=o.indexOf("}"),0<n?(this.writeNode("ogc:PropertyName",{property:o.substring(0,n)},q),q.appendChild(this.createTextNode(o.substring(++n)))):q.appendChild(this.createTextNode("${"+o))}return q},StyledLayerDescriptor:function(f){var e=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});e.setAttribute("xmlns:ogc",this.namespaces.ogc);e.setAttribute("xmlns:gml",this.namespaces.gml);f.name&&this.writeNode("Name",f.name,e);f.title&&this.writeNode("Title",f.title,e);f.description&&this.writeNode("Abstract",f.description,e);if(OpenLayers.Util.isArray(f.namedLayers)){for(var h=0,g=f.namedLayers.length;h<g;++h){this.writeNode("NamedLayer",f.namedLayers[h],e)}}else{for(h in f.namedLayers){this.writeNode("NamedLayer",f.namedLayers[h],e)}}return e},Name:function(b){return this.createElementNSPlus("sld:Name",{value:b})},Title:function(b){return this.createElementNSPlus("sld:Title",{value:b})},Abstract:function(b){return this.createElementNSPlus("sld:Abstract",{value:b})},NamedLayer:function(f){var e=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",f.name,e);if(f.namedStyles){for(var h=0,g=f.namedStyles.length;h<g;++h){this.writeNode("NamedStyle",f.namedStyles[h],e)}}if(f.userStyles){h=0;for(g=f.userStyles.length;h<g;++h){this.writeNode("UserStyle",f.userStyles[h],e)}}return e},NamedStyle:function(d){var c=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",d,c);return c},UserStyle:function(z){var y=this.createElementNSPlus("sld:UserStyle");z.name&&this.writeNode("Name",z.name,y);z.title&&this.writeNode("Title",z.title,y);z.description&&this.writeNode("Abstract",z.description,y);z.isDefault&&this.writeNode("IsDefault",z.isDefault,y);if(this.multipleSymbolizers&&z.rules){for(var x={"0":[]},w=[0],v,u,t,s,r,q=0,p=z.rules.length;q<p;++q){if(v=z.rules[q],v.symbolizers){u={};for(var o=0,n=v.symbolizers.length;o<n;++o){t=v.symbolizers[o],s=t.zIndex,s in u||(r=v.clone(),r.symbolizers=[],u[s]=r),u[s].symbolizers.push(t.clone())}for(s in u){s in x||(w.push(s),x[s]=[]),x[s].push(u[s])}}else{x[0].push(v.clone())}}w.sort();q=0;for(p=w.length;q<p;++q){v=x[w[q]],0<v.length&&(r=z.clone(),r.rules=x[w[q]],this.writeNode("FeatureTypeStyle",r,y))}}else{this.writeNode("FeatureTypeStyle",z,y)}return y},IsDefault:function(b){return this.createElementNSPlus("sld:IsDefault",{value:b?"1":"0"})},FeatureTypeStyle:function(f){for(var e=this.createElementNSPlus("sld:FeatureTypeStyle"),h=0,g=f.rules.length;h<g;++h){this.writeNode("Rule",f.rules[h],e)}return e},Rule:function(j){var h=this.createElementNSPlus("sld:Rule");j.name&&this.writeNode("Name",j.name,h);j.title&&this.writeNode("Title",j.title,h);j.description&&this.writeNode("Abstract",j.description,h);j.elseFilter?this.writeNode("ElseFilter",null,h):j.filter&&this.writeNode("ogc:Filter",j.filter,h);void 0!=j.minScaleDenominator&&this.writeNode("MinScaleDenominator",j.minScaleDenominator,h);void 0!=j.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",j.maxScaleDenominator,h);var o,n;if(this.multipleSymbolizers&&j.symbolizers){for(var m=0,l=j.symbolizers.length;m<l;++m){n=j.symbolizers[m],o=n.CLASS_NAME.split(".").pop(),this.writeNode(o+"Symbolizer",n,h)}}else{for(var l=OpenLayers.Style.SYMBOLIZER_PREFIXES,m=0,k=l.length;m<k;++m){o=l[m],(n=j.symbolizer[o])&&this.writeNode(o+"Symbolizer",n,h)}}return h},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(b){return this.createElementNSPlus("sld:MinScaleDenominator",{value:b})},MaxScaleDenominator:function(b){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:b})},LineSymbolizer:function(d){var c=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",d,c);return c},Stroke:function(d){var c=this.createElementNSPlus("sld:Stroke");void 0!=d.strokeColor&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeColor"},c);void 0!=d.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeOpacity"},c);void 0!=d.strokeWidth&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeWidth"},c);void 0!=d.strokeDashstyle&&"solid"!==d.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeDashstyle"},c);void 0!=d.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:d,key:"strokeLinecap"},c);return c},CssParameter:function(b){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(b.key)},value:b.symbolizer[b.key]})},TextSymbolizer:function(d){var c=this.createElementNSPlus("sld:TextSymbolizer");null!=d.label&&this.writeNode("Label",d.label,c);(null!=d.fontFamily||null!=d.fontSize||null!=d.fontWeight||null!=d.fontStyle)&&this.writeNode("Font",d,c);(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign||null!=d.labelXOffset||null!=d.labelYOffset||null!=d.labelRotation||null!=d.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",d,c);(null!=d.haloRadius||null!=d.haloColor||null!=d.haloOpacity)&&this.writeNode("Halo",d,c);(null!=d.fontColor||null!=d.fontOpacity)&&this.writeNode("Fill",{fillColor:d.fontColor,fillOpacity:d.fontOpacity},c);return c},LabelPlacement:function(d){var c=this.createElementNSPlus("sld:LabelPlacement");(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign||null!=d.labelXOffset||null!=d.labelYOffset||null!=d.labelRotation)&&null==d.labelPerpendicularOffset&&this.writeNode("PointPlacement",d,c);null!=d.labelPerpendicularOffset&&this.writeNode("LinePlacement",d,c);return c},LinePlacement:function(d){var c=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",d.labelPerpendicularOffset,c);return c},PerpendicularOffset:function(b){return this.createElementNSPlus("sld:PerpendicularOffset",{value:b})},PointPlacement:function(d){var c=this.createElementNSPlus("sld:PointPlacement");(null!=d.labelAnchorPointX||null!=d.labelAnchorPointY||null!=d.labelAlign)&&this.writeNode("AnchorPoint",d,c);(null!=d.labelXOffset||null!=d.labelYOffset)&&this.writeNode("Displacement",d,c);null!=d.labelRotation&&this.writeNode("Rotation",d.labelRotation,c);return c},AnchorPoint:function(g){var f=this.createElementNSPlus("sld:AnchorPoint"),k=g.labelAnchorPointX,j=g.labelAnchorPointY;null!=k&&this.writeNode("AnchorPointX",k,f);null!=j&&this.writeNode("AnchorPointY",j,f);if(null==k&&null==j){var h=g.labelAlign.substr(0,1),g=g.labelAlign.substr(1,1);"l"===h?k=0:"c"===h?k=0.5:"r"===h&&(k=1);"b"===g?j=0:"m"===g?j=0.5:"t"===g&&(j=1);this.writeNode("AnchorPointX",k,f);this.writeNode("AnchorPointY",j,f)}return f},AnchorPointX:function(b){return this.createElementNSPlus("sld:AnchorPointX",{value:b})},AnchorPointY:function(b){return this.createElementNSPlus("sld:AnchorPointY",{value:b})},Displacement:function(d){var c=this.createElementNSPlus("sld:Displacement");null!=d.labelXOffset&&this.writeNode("DisplacementX",d.labelXOffset,c);null!=d.labelYOffset&&this.writeNode("DisplacementY",d.labelYOffset,c);return c},DisplacementX:function(b){return this.createElementNSPlus("sld:DisplacementX",{value:b})},DisplacementY:function(b){return this.createElementNSPlus("sld:DisplacementY",{value:b})},Font:function(d){var c=this.createElementNSPlus("sld:Font");d.fontFamily&&this.writeNode("CssParameter",{symbolizer:d,key:"fontFamily"},c);d.fontSize&&this.writeNode("CssParameter",{symbolizer:d,key:"fontSize"},c);d.fontWeight&&this.writeNode("CssParameter",{symbolizer:d,key:"fontWeight"},c);d.fontStyle&&this.writeNode("CssParameter",{symbolizer:d,key:"fontStyle"},c);return c},Label:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Label",b)},Halo:function(d){var c=this.createElementNSPlus("sld:Halo");d.haloRadius&&this.writeNode("Radius",d.haloRadius,c);(d.haloColor||d.haloOpacity)&&this.writeNode("Fill",{fillColor:d.haloColor,fillOpacity:d.haloOpacity},c);return c},Radius:function(b){return this.createElementNSPlus("sld:Radius",{value:b})},RasterSymbolizer:function(d){var c=this.createElementNSPlus("sld:RasterSymbolizer");d.geometry&&this.writeNode("Geometry",d.geometry,c);d.opacity&&this.writeNode("Opacity",d.opacity,c);d.colorMap&&this.writeNode("ColorMap",d.colorMap,c);return c},Geometry:function(d){var c=this.createElementNSPlus("sld:Geometry");d.property&&this.writeNode("ogc:PropertyName",d,c);return c},ColorMap:function(f){for(var e=this.createElementNSPlus("sld:ColorMap"),h=0,g=f.length;h<g;++h){this.writeNode("ColorMapEntry",f[h],e)}return e},ColorMapEntry:function(d){var c=this.createElementNSPlus("sld:ColorMapEntry");c.setAttribute("color",d.color);void 0!==d.opacity&&c.setAttribute("opacity",parseFloat(d.opacity));void 0!==d.quantity&&c.setAttribute("quantity",parseFloat(d.quantity));void 0!==d.label&&c.setAttribute("label",d.label);return c},PolygonSymbolizer:function(d){var c=this.createElementNSPlus("sld:PolygonSymbolizer");!1!==d.fill&&this.writeNode("Fill",d,c);!1!==d.stroke&&this.writeNode("Stroke",d,c);return c},Fill:function(d){var c=this.createElementNSPlus("sld:Fill");d.fillColor&&this.writeNode("CssParameter",{symbolizer:d,key:"fillColor"},c);null!=d.fillOpacity&&this.writeNode("CssParameter",{symbolizer:d,key:"fillOpacity"},c);return c},PointSymbolizer:function(d){var c=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",d,c);return c},Graphic:function(d){var c=this.createElementNSPlus("sld:Graphic");void 0!=d.externalGraphic?this.writeNode("ExternalGraphic",d,c):this.writeNode("Mark",d,c);void 0!=d.graphicOpacity&&this.writeNode("Opacity",d.graphicOpacity,c);void 0!=d.pointRadius?this.writeNode("Size",2*d.pointRadius,c):void 0!=d.graphicWidth&&this.writeNode("Size",d.graphicWidth,c);void 0!=d.rotation&&this.writeNode("Rotation",d.rotation,c);return c},ExternalGraphic:function(d){var c=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",d.externalGraphic,c);this.writeNode("Format",d.graphicFormat||this.getGraphicFormat(d.externalGraphic),c);return c},Mark:function(d){var c=this.createElementNSPlus("sld:Mark");d.graphicName&&this.writeNode("WellKnownName",d.graphicName,c);!1!==d.fill&&this.writeNode("Fill",d,c);!1!==d.stroke&&this.writeNode("Stroke",d,c);return c},WellKnownName:function(b){return this.createElementNSPlus("sld:WellKnownName",{value:b})},Opacity:function(b){return this.createElementNSPlus("sld:Opacity",{value:b})},Size:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Size",b)},Rotation:function(b){return this.createElementNSPlus("sld:Rotation",{value:b})},OnlineResource:function(b){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":b}})},Format:function(b){return this.createElementNSPlus("sld:Format",{value:b})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(g,f,k,j){var h=[],k=OpenLayers.Util.upperCaseObject(k);1.3<=parseFloat(k.VERSION)&&!k.EXCEPTIONS&&(k.EXCEPTIONS="INIMAGE");h.push(g,f,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){if(null==j||!j.isBaseLayer){this.isBaseLayer=!1}"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},reverseAxisOrder:function(){var b=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&!(!this.yx[b]&&!OpenLayers.Projection.defaults[b].yx)},getURL:function(f){var f=this.adjustBounds(f),e=this.getImageSize(),h={},g=this.reverseAxisOrder();h.BBOX=this.encodeBBOX?f.toBBOX(null,g):f.toArray(g);h.WIDTH=e.w;h.HEIGHT=e.h;return this.getFullRequestString(h)},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},getFullRequestString:function(e,d){var f=this.map.getProjectionObject(),f=this.projection&&this.projection.equals(f)?this.projection.getCode():f.getCode(),f="none"==f?null:f;1.3<=parseFloat(this.params.VERSION)?this.params.CRS=f:this.params.SRS=f;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_sld_MinScaleDenominator:function(e,d){var f=parseFloat(this.getChildValue(d));0<f&&(e.maxScale=f)},read_sld_MaxScaleDenominator:function(d,c){d.minScale=parseFloat(this.getChildValue(c))},read_wmc_SRS:function(d,c){"srs" in d||(d.srs={});d.srs[this.getChildValue(c)]=!0},write_wmc_Layer:function(f){var e=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[f]);if(f.maxScale){var h=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");h.appendChild(this.createTextNode(f.maxScale.toPrecision(16)));e.appendChild(h)}f.minScale&&(h=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),h.appendChild(this.createTextNode(f.minScale.toPrecision(16))),e.appendChild(h));if(f.srs){for(var g in f.srs){e.appendChild(this.createElementDefaultNS("SRS",g))}}e.appendChild(this.write_wmc_FormatList(f));e.appendChild(this.write_wmc_StyleList(f));f.dimensions&&e.appendChild(this.write_wmc_DimensionList(f));e.appendChild(this.write_wmc_LayerExtension(f));return e},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"});OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(e,d){OpenLayers.Util.applyDefaults(d,this.options);var f={};this.readChildNodes(e,f);return f},readers:{xls:{XLS:function(d,c){c.version=d.getAttribute("version");this.readChildNodes(d,c)},Response:function(d,c){this.readChildNodes(d,c)},GeocodeResponse:function(d,c){c.responseLists=[];this.readChildNodes(d,c)},GeocodeResponseList:function(e,d){var f={features:[],numberOfGeocodedAddresses:parseInt(e.getAttribute("numberOfGeocodedAddresses"))};d.responseLists.push(f);this.readChildNodes(e,f)},GeocodedAddress:function(e,d){var f=new OpenLayers.Feature.Vector;d.features.push(f);this.readChildNodes(e,f);f.geometry=f.components[0]},GeocodeMatchCode:function(d,c){c.attributes.matchCode={accuracy:parseFloat(d.getAttribute("accuracy")),matchType:d.getAttribute("matchType")}},Address:function(e,d){var f={countryCode:e.getAttribute("countryCode"),addressee:e.getAttribute("addressee"),street:[],place:[]};d.attributes.address=f;this.readChildNodes(e,f)},freeFormAddress:function(d,c){c.freeFormAddress=this.getChildValue(d)},StreetAddress:function(d,c){this.readChildNodes(d,c)},Building:function(d,c){c.building={number:d.getAttribute("number"),subdivision:d.getAttribute("subdivision"),buildingName:d.getAttribute("buildingName")}},Street:function(d,c){c.street.push(this.getChildValue(d))},Place:function(d,c){c.place[d.getAttribute("type")]=this.getChildValue(d)},PostalCode:function(d,c){c.postalCode=this.getChildValue(d)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(b){return this.writers.xls.XLS.apply(this,[b])},writers:{xls:{XLS:function(d){var c=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});this.writeNode("RequestHeader",d.header,c);this.writeNode("Request",d,c);return c},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(d){var c=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:d.requestID||"",version:this.VERSION}});this.writeNode("GeocodeRequest",d.addresses,c);return c},GeocodeRequest:function(f){for(var e=this.createElementNSPlus("xls:GeocodeRequest"),h=0,g=f.length;h<g;h++){this.writeNode("Address",f[h],e)}return e},Address:function(d){var c=this.createElementNSPlus("xls:Address",{attributes:{countryCode:d.countryCode}});d.freeFormAddress?this.writeNode("freeFormAddress",d.freeFormAddress,c):(d.street&&this.writeNode("StreetAddress",d,c),d.municipality&&this.writeNode("Municipality",d.municipality,c),d.countrySubdivision&&this.writeNode("CountrySubdivision",d.countrySubdivision,c),d.postalCode&&this.writeNode("PostalCode",d.postalCode,c));return c},freeFormAddress:function(b){return this.createElementNSPlus("freeFormAddress",{value:b})},StreetAddress:function(f){var e=this.createElementNSPlus("xls:StreetAddress");f.building&&this.writeNode(e,"Building",f.building);f=f.street;OpenLayers.Util.isArray(f)||(f=[f]);for(var h=0,g=f.length;h<g;h++){this.writeNode("Street",f[h],e)}return e},Building:function(b){return this.createElementNSPlus("xls:Building",{attributes:{number:b.number,subdivision:b.subdivision,buildingName:b.buildingName}})},Street:function(b){return this.createElementNSPlus("xls:Street",{value:b})},Municipality:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:b})},CountrySubdivision:function(b){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:b})},PostalCode:function(b){return this.createElementNSPlus("xls:PostalCode",{value:b})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(b){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,d,f){e+=f?0:this.translationParameters.x;d+=f?0:this.translationParameters.y;return e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL},setExtent:function(g,f){var k=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),j=this.getResolution(),h=-g.left/j,j=g.top/j;if(f){return this.left=h,this.top=j,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0}(h=this.translate(h-this.left+this.xOffset,j-this.top))||this.setExtent(g,!0);return k&&h},translate:function(e,d){if(this.inValidRange(e,d,!0)){var f="";if(e||d){f="translate("+e+","+d+")"}this.root.setAttributeNS(null,"transform",f);this.translationParameters={x:e,y:d};return !0}return !1},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,d){var f=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":f=d.externalGraphic?"image":this.isComplexSymbol(d.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":f="rect";break;case"OpenLayers.Geometry.LineString":f="polyline";break;case"OpenLayers.Geometry.LinearRing":f="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="path"}return f},setStyle:function(t,s,r){var s=s||t._style,r=r||t._options,q=parseFloat(t.getAttributeNS(null,"r")),p=1,o;if("OpenLayers.Geometry.Point"==t._geometryClass&&q){t.style.visibility="";if(!1===s.graphic){t.style.visibility="hidden"}else{if(s.externalGraphic){o=this.getPosition(t);s.graphicTitle&&(t.setAttributeNS(null,"title",s.graphicTitle),q=t.getElementsByTagName("title"),0<q.length?q[0].firstChild.textContent=s.graphicTitle:(q=this.nodeFactory(null,"title"),q.textContent=s.graphicTitle,t.appendChild(q)));s.graphicWidth&&s.graphicHeight&&t.setAttributeNS(null,"preserveAspectRatio","none");var q=s.graphicWidth||s.graphicHeight,n=s.graphicHeight||s.graphicWidth,q=q?q:2*s.pointRadius,n=n?n:2*s.pointRadius,m=void 0!=s.graphicYOffset?s.graphicYOffset:-(0.5*n),l=s.graphicOpacity||s.fillOpacity;t.setAttributeNS(null,"x",(o.x+(void 0!=s.graphicXOffset?s.graphicXOffset:-(0.5*q))).toFixed());t.setAttributeNS(null,"y",(o.y+m).toFixed());t.setAttributeNS(null,"width",q);t.setAttributeNS(null,"height",n);t.setAttributeNS(this.xlinkns,"href",s.externalGraphic);t.setAttributeNS(null,"style","opacity: "+l);t.onclick=OpenLayers.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(s.graphicName)){var q=3*s.pointRadius,n=2*q,k=this.importSymbol(s.graphicName);o=this.getPosition(t);p=3*this.symbolMetrics[k.id][0]/n;m=t.parentNode;l=t.nextSibling;m&&m.removeChild(t);t.firstChild&&t.removeChild(t.firstChild);t.appendChild(k.firstChild.cloneNode(!0));t.setAttributeNS(null,"viewBox",k.getAttributeNS(null,"viewBox"));t.setAttributeNS(null,"width",n);t.setAttributeNS(null,"height",n);t.setAttributeNS(null,"x",o.x-q);t.setAttributeNS(null,"y",o.y-q);l?m.insertBefore(t,l):m&&m.appendChild(t)}else{t.setAttributeNS(null,"r",s.pointRadius)}}}q=s.rotation;if((void 0!==q||void 0!==t._rotation)&&o){t._rotation=q,q|=0,"svg"!==t.nodeName?t.setAttributeNS(null,"transform","rotate("+q+" "+o.x+" "+o.y+")"):(o=this.symbolMetrics[k.id],t.firstChild.setAttributeNS(null,"transform","rotate("+q+" "+o[1]+" "+o[2]+")"))}}r.isFilled?(t.setAttributeNS(null,"fill",s.fillColor),t.setAttributeNS(null,"fill-opacity",s.fillOpacity)):t.setAttributeNS(null,"fill","none");r.isStroked?(t.setAttributeNS(null,"stroke",s.strokeColor),t.setAttributeNS(null,"stroke-opacity",s.strokeOpacity),t.setAttributeNS(null,"stroke-width",s.strokeWidth*p),t.setAttributeNS(null,"stroke-linecap",s.strokeLinecap||"round"),t.setAttributeNS(null,"stroke-linejoin","round"),s.strokeDashstyle&&t.setAttributeNS(null,"stroke-dasharray",this.dashStyle(s,p))):t.setAttributeNS(null,"stroke","none");s.pointerEvents&&t.setAttributeNS(null,"pointer-events",s.pointerEvents);null!=s.cursor&&t.setAttributeNS(null,"cursor",s.cursor);return t},dashStyle:function(f,e){var h=f.strokeWidth*e,g=f.strokeDashstyle;switch(g){case"solid":return"none";case"dot":return[1,4*h].join();case"dash":return[4*h,4*h].join();case"dashdot":return[4*h,4*h,1,4*h].join();case"longdash":return[8*h,4*h].join();case"longdashdot":return[8*h,4*h,1,4*h].join();default:return OpenLayers.String.trim(g).replace(/\s+/g,",")}},createNode:function(e,d){var f=document.createElementNS(this.xmlns,e);d&&f.setAttributeNS(null,"id",d);return f},nodeTypeCompare:function(d,c){return c==d.nodeName},createRenderRoot:function(){var b=this.nodeFactory(this.container.id+"_svgRoot","svg");b.style.display="block";return b},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g")},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b},drawPoint:function(d,c){return this.drawCircle(d,c,1)},drawCircle:function(g,f,k){var j=this.getResolution(),h=(f.x-this.featureDx)/j+this.left,f=this.top-f.y/j;return this.inValidRange(h,f)?(g.setAttributeNS(null,"cx",h),g.setAttributeNS(null,"cy",f),g.setAttributeNS(null,"r",k),g):!1},drawLineString:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawLinearRing:function(e,d){var f=this.getComponentsString(d.components);return f.path?(e.setAttributeNS(null,"points",f.path),f.complete?e:null):!1},drawPolygon:function(r,q){for(var p="",o=!0,n=!0,m,l,k=0,j=q.components.length;k<j;k++){p+=" M",m=this.getComponentsString(q.components[k].components," "),(l=m.path)?(p+=" "+l,n=m.complete&&n):o=!1}return o?(r.setAttributeNS(null,"d",p+" z"),r.setAttributeNS(null,"fill-rule","evenodd"),n?r:null):!1},drawRectangle:function(g,f){var k=this.getResolution(),j=(f.x-this.featureDx)/k+this.left,h=this.top-f.y/k;return this.inValidRange(j,h)?(g.setAttributeNS(null,"x",j),g.setAttributeNS(null,"y",h),g.setAttributeNS(null,"width",f.width/k),g.setAttributeNS(null,"height",f.height/k),g):!1},drawText:function(x,w,v){var u=!!w.labelOutlineWidth;if(u){var t=OpenLayers.Util.extend({},w);t.fontColor=t.labelOutlineColor;t.fontStrokeColor=t.labelOutlineColor;t.fontStrokeWidth=w.labelOutlineWidth;delete t.labelOutlineWidth;this.drawText(x,t,v)}var s=this.getResolution(),t=(v.x-this.featureDx)/s+this.left,r=v.y/s-this.top,u=u?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,s=this.nodeFactory(x+u,"text");s.setAttributeNS(null,"x",t);s.setAttributeNS(null,"y",-r);w.fontColor&&s.setAttributeNS(null,"fill",w.fontColor);w.fontStrokeColor&&s.setAttributeNS(null,"stroke",w.fontStrokeColor);w.fontStrokeWidth&&s.setAttributeNS(null,"stroke-width",w.fontStrokeWidth);w.fontOpacity&&s.setAttributeNS(null,"opacity",w.fontOpacity);w.fontFamily&&s.setAttributeNS(null,"font-family",w.fontFamily);w.fontSize&&s.setAttributeNS(null,"font-size",w.fontSize);w.fontWeight&&s.setAttributeNS(null,"font-weight",w.fontWeight);w.fontStyle&&s.setAttributeNS(null,"font-style",w.fontStyle);!0===w.labelSelect?(s.setAttributeNS(null,"pointer-events","visible"),s._featureId=x):s.setAttributeNS(null,"pointer-events","none");r=w.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;s.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[r[0]]||"middle");!0===OpenLayers.IS_GECKO&&s.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[r[1]]||"central");for(var q=w.label.split("\n"),p=q.length;s.childNodes.length>p;){s.removeChild(s.lastChild)}for(var o=0;o<p;o++){var n=this.nodeFactory(x+u+"_tspan_"+o,"tspan");!0===w.labelSelect&&(n._featureId=x,n._geometry=v,n._geometryClass=v.CLASS_NAME);!1===OpenLayers.IS_GECKO&&n.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[r[1]]||"-35%");n.setAttribute("x",t);if(0==o){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[r[1]];null==m&&(m=-0.5);n.setAttribute("dy",m*(p-1)+"em")}else{n.setAttribute("dy","1em")}n.textContent=""===q[o]?" ":q[o];n.parentNode||s.appendChild(n)}s.parentNode||this.textRoot.appendChild(s)},getComponentsString:function(k,j){for(var q=[],p=!0,o=k.length,n=[],m,l=0;l<o;l++){m=k[l],q.push(m),(m=this.getShortString(m))?n.push(m):(0<l&&this.getShortString(k[l-1])&&n.push(this.clipLine(k[l],k[l-1])),l<o-1&&this.getShortString(k[l+1])&&n.push(this.clipLine(k[l],k[l+1])),p=!1)}return{path:n.join(j||","),complete:p}},clipLine:function(r,q){if(q.equals(r)){return""}var p=this.getResolution(),o=this.MAX_PIXEL-this.translationParameters.x,n=this.MAX_PIXEL-this.translationParameters.y,m=(q.x-this.featureDx)/p+this.left,l=this.top-q.y/p,k=(r.x-this.featureDx)/p+this.left,p=this.top-r.y/p,j;if(k<-o||k>o){j=(p-l)/(k-m),k=0>k?-o:o,p=l+(k-m)*j}if(p<-n||p>n){j=(k-m)/(p-l),p=0>p?-n:n,k=m+(p-l)*j}return k+","+p},getShortString:function(e){var d=this.getResolution(),f=(e.x-this.featureDx)/d+this.left,e=this.top-e.y/d;return this.inValidRange(f,e)?f+","+e:!1},getPosition:function(b){return{x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))}},importSymbol:function(r){this.defs||(this.defs=this.createDefs());var q=this.container.id+"-"+r,p=document.getElementById(q);if(null!=p){return p}var o=OpenLayers.Renderer.symbol[r];if(!o){throw Error(r+" is not a valid symbol name")}var r=this.nodeFactory(q,"symbol"),n=this.nodeFactory(null,"polygon");r.appendChild(n);for(var p=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),m=[],l,k,j=0;j<o.length;j+=2){l=o[j],k=o[j+1],p.left=Math.min(p.left,l),p.bottom=Math.min(p.bottom,k),p.right=Math.max(p.right,l),p.top=Math.max(p.top,k),m.push(l,",",k)}n.setAttributeNS(null,"points",m.join(" "));o=p.getWidth();n=p.getHeight();r.setAttributeNS(null,"viewBox",[p.left-o,p.bottom-n,3*o,3*n].join(" "));this.symbolMetrics[q]=[Math.max(o,n),p.getCenterLonLat().lon,p.getCenterLonLat().lat];this.defs.appendChild(r);return r},getFeatureIdFromEvent:function(d){var c=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);c||(c=d.target,c=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0);return c},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(b){b.preventDefault&&b.preventDefault()};OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(e,d){var f=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);"0.3.0"===f&&(f=this.defaultVersion);return f},toContext:function(d){var c={};"OpenLayers.Map"==d.CLASS_NAME&&(c.bounds=d.getExtent(),c.maxExtent=d.maxExtent,c.projection=d.projection,c.size=d.getSize(),c.layers=d.layers);return c},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(h){if(h.layersContext){for(var g=0,m=h.layersContext.length;g<m;g++){var l=h.layersContext[g],k=[],j=h.title||"";h.metadata&&h.metadata.nestingPath&&(k=h.metadata.nestingPath.slice());""!=j&&k.push(j);l.metadata.nestingPath=k;l.layersContext&&this.setNestingPath(l)}}},decomposeNestingPath:function(d){var c=[];if(OpenLayers.Util.isArray(d)){for(d=d.slice();0<d.length;){c.push(d.slice()),d.pop()}c.reverse()}return c},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);this.setNestingPath({layersContext:c.layersContext});d=[];this.processLayer(d,c);delete c.layersContext;c.layersContext=d;return c},processLayer:function(g,f){if(f.layersContext){for(var k=0,j=f.layersContext.length;k<j;k++){var h=f.layersContext[k];g.push(h);h.layersContext&&this.processLayer(g,h)}}},write:function(e,d){this.nestingLayerLookup={};d=d||{};OpenLayers.Util.applyDefaults(d,e);var f=this.writeNode("OWSContext",d);this.nestingLayerLookup=null;this.setAttributeNS(f,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[f])},readers:{kml:{Document:function(d,c){c.features=(new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0})).read(d)}},owc:{OWSContext:function(d,c){this.readChildNodes(d,c)},General:function(d,c){this.readChildNodes(d,c)},ResourceList:function(d,c){this.readChildNodes(d,c)},Layer:function(e,d){var f={metadata:{},visibility:"1"!=e.getAttribute("hidden"),queryable:"1"==e.getAttribute("queryable"),opacity:null!=e.getAttribute("opacity")?parseFloat(e.getAttribute("opacity")):null,name:e.getAttribute("name"),categoryLayer:null==e.getAttribute("name"),formats:[],styles:[]};d.layersContext||(d.layersContext=[]);d.layersContext.push(f);this.readChildNodes(e,f)},InlineGeometry:function(f,e){e.features=[];var h=this.getElementsByTagNameNS(f,this.namespaces.gml,"featureMember"),g;1<=h.length&&(g=h[0]);g&&g.firstChild&&(h=g.firstChild.nextSibling?g.firstChild.nextSibling:g.firstChild,this.setNamespace("feature",h.namespaceURI),this.featureType=h.localName||h.nodeName.split(":").pop(),this.readChildNodes(f,e))},Server:function(d,c){if(!c.service&&!c.version||c.service!=OpenLayers.Format.Context.serviceTypes.WMS){c.service=d.getAttribute("service"),c.version=d.getAttribute("version"),this.readChildNodes(d,c)}},Name:function(d,c){c.name=this.getChildValue(d);this.readChildNodes(d,c)},Title:function(d,c){c.title=this.getChildValue(d);this.readChildNodes(d,c)},StyleList:function(d,c){this.readChildNodes(d,c.styles)},Style:function(e,d){var f={};d.push(f);this.readChildNodes(e,f)},LegendURL:function(e,d){var f={};d.legend=f;this.readChildNodes(e,f)},OnlineResource:function(d,c){c.url=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(d){var c=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:d.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",d,c);this.writeNode("ResourceList",d,c);return c},General:function(d){var c=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",d,c);this.writeNode("ows:Title",d.title||"OpenLayers OWSContext",c);return c},ResourceList:function(h){for(var g=this.createElementNSPlus("ResourceList"),m=0,l=h.layers.length;m<l;m++){var k=h.layers[m],j=this.decomposeNestingPath(k.metadata.nestingPath);this.writeNode("_Layer",{layer:k,subPaths:j},g)}return g},Server:function(d){var c=this.createElementNSPlus("Server",{attributes:{version:d.version,service:d.service}});this.writeNode("OnlineResource",d,c);return c},OnlineResource:function(b){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":b.url}})},InlineGeometry:function(f){var e=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",f.getDataExtent(),e);for(var h=0,g=f.features.length;h<g;h++){this.writeNode("gml:featureMember",f.features[h],e)}return e},StyleList:function(f){for(var e=this.createElementNSPlus("StyleList"),h=0,g=f.length;h<g;h++){this.writeNode("Style",f[h],e)}return e},Style:function(d){var c=this.createElementNSPlus("Style");this.writeNode("Name",d,c);this.writeNode("Title",d,c);d.legend&&this.writeNode("LegendURL",d,c);return c},Name:function(b){return this.createElementNSPlus("Name",{value:b.name})},Title:function(b){return this.createElementNSPlus("Title",{value:b.title})},LegendURL:function(d){var c=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",d.legend,c);return c},_WMS:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:d.params.LAYERS,queryable:d.queryable?"1":"0",hidden:d.visibility?"0":"1",opacity:d.hasOwnProperty("opacity")?d.opacity:null}});this.writeNode("ows:Title",d.name,c);this.writeNode("ows:OutputFormat",d.params.FORMAT,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:d.params.VERSION,url:d.url},c);d.metadata.styles&&0<d.metadata.styles.length&&this.writeNode("StyleList",d.metadata.styles,c);return c},_Layer:function(f){var e,h,g;e=f.layer;h=f.subPaths;g=null;0<h.length?(e=h[0].join("/"),h=e.lastIndexOf("/"),g=this.nestingLayerLookup[e],h=0<h?e.substring(h+1,e.length):e,g||(g=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",h,g),this.nestingLayerLookup[e]=g),f.subPaths.shift(),this.writeNode("_Layer",f,g)):(e instanceof OpenLayers.Layer.WMS?g=this.writeNode("_WMS",e):e instanceof OpenLayers.Layer.Vector&&(e.protocol instanceof OpenLayers.Protocol.WFS.v1?g=this.writeNode("_WFS",e):e.protocol instanceof OpenLayers.Protocol.HTTP?e.protocol.format instanceof OpenLayers.Format.GML?(e.protocol.format.version="2.1.2",g=this.writeNode("_GML",e)):e.protocol.format instanceof OpenLayers.Format.KML&&(e.protocol.format.version="2.2",g=this.writeNode("_KML",e)):(this.setNamespace("feature",this.featureNS),g=this.writeNode("_InlineGeometry",e))),e.options.maxScale&&this.writeNode("sld:MinScaleDenominator",e.options.maxScale,g),e.options.minScale&&this.writeNode("sld:MaxScaleDenominator",e.options.minScale,g),this.nestingLayerLookup[e.name]=g);return g},_WFS:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:d.protocol.featurePrefix+":"+d.protocol.featureType,hidden:d.visibility?"0":"1"}});this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:d.protocol.version,url:d.protocol.url},c);return c},_InlineGeometry:function(d){var c=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:d.visibility?"0":"1"}});this.writeNode("ows:Title",d.name,c);this.writeNode("InlineGeometry",d,c);return c},_GML:function(d){var c=this.createElementNSPlus("Layer");this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:d.protocol.url,version:d.protocol.format.version},c);return c},_KML:function(d){var c=this.createElementNSPlus("Layer");this.writeNode("ows:Title",d.name,c);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:d.protocol.format.version,url:d.protocol.url},c);return c}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(d){var c=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",d,c);return c}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible");this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(d){var c=parseInt(Math.log(d)/Math.log(10)),c=Math.pow(10,c),d=parseInt(d/c);return(5<d?5:2<d?2:1)*c},update:function(){var t=this.map.getResolution();if(t){var s=this.map.getUnits(),r=OpenLayers.INCHES_PER_UNIT,q=this.maxWidth*t*r[s],p=1;!0===this.geodesic&&(p=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth/(q/r.km),q*=p);var o,n;100000<q?(o=this.topOutUnits,n=this.bottomOutUnits):(o=this.topInUnits,n=this.bottomInUnits);var m=q/r[o],l=q/r[n],q=this.getBarLen(m),k=this.getBarLen(l),m=q/r[s]*r[o],l=k/r[s]*r[n],s=m/t/p,t=l/t/p;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(t)+"px",this.eBottom.innerHTML=k+" "+n);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(s)+"px",this.eTop.innerHTML=q+" "+o)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(f,e,h,g){this.url=f;this.size=e||{w:20,h:20};this.offset=h||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=g;f=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(f)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(b){null!=b&&(this.size=b);this.draw()},setUrl:function(b){null!=b&&(this.url=b);this.draw()},draw:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(b);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,b)},moveTo:function(b){null!=b&&(this.px=b);null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(b){this.imageDiv.style.display=b?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,d){this.lonlat=e;var f=d?d:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=f:(this.icon.url=f.url,this.icon.size=f.size,this.icon.offset=f.offset,this.icon.calculateOffset=f.calculateOffset);this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(b){return this.icon.draw(b)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(b){null!=b&&null!=this.icon&&this.icon.moveTo(b);this.lonlat=this.map.getLonLatFromLayerPx(b)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsLonLat(this.lonlat));return b},inflate:function(b){this.icon&&this.icon.setSize({w:this.icon.size.w*b,h:this.icon.size.h*b})},setOpacity:function(b){this.icon.setOpacity(b)},setUrl:function(b){this.icon.setUrl(b)},display:function(b){this.icon.display(b)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(f,e,h,g){this.layername=h;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[f,e,{},g]);this.extension=this.format.split("/")[1].toLowerCase();this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(b){null==b&&(b=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(h){function g(f,e){for(var f=""+f,o=[],n=0;n<e;++n){o.push("0")}return o.join("").substring(0,e-f.length)+f}var m=this.getServerResolution(),l=this.maxExtent,k=this.tileSize,j=Math.round((h.left-l.left)/(m*k.w)),h=Math.round((h.bottom-l.bottom)/(m*k.h)),m=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,m):this.map.getZoom(),j=[this.layername,g(m,2),g(parseInt(j/1000000),3),g(parseInt(j/1000)%1000,3),g(parseInt(j)%1000,3),g(parseInt(h/1000000),3),g(parseInt(h/1000)%1000,3),g(parseInt(h)%1000,3)+"."+this.extension].join("/"),m=this.url;OpenLayers.Util.isArray(m)&&(m=this.selectUrl(j,m));m="/"==m.charAt(m.length-1)?m:m+"/";return m+j},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(f){var f=this.adjustBounds(f),e=this.map.getResolution(),h=Math.round(10000*this.map.getScale())/10000,g=Math.round(f.left/e);return this.getFullRequestString({t:-Math.round(f.top/e),l:g,s:h})},calculateGridLayout:function(h,g,m){var g=m*this.tileSize.w,m=m*this.tileSize.h,l=h.left,k=Math.floor(l/g)-this.buffer,l=-(l/g-k)*this.tileSize.w,k=k*g,h=h.top,j=Math.ceil(h/m)+this.buffer;return{tilelon:g,tilelat:m,tileoffsetlon:k,tileoffsetlat:j*m,tileoffsetx:l,tileoffsety:-(j-h/m+1)*this.tileSize.h}},clone:function(b){null==b&&(b=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions()));b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);null!=this.tileSize&&(b.tileSize=this.tileSize.clone());b.grid=[];return b},getTileBounds:function(f){var e=this.getResolution(),h=e*this.tileSize.w,e=e*this.tileSize.h,g=this.getLonLatFromViewPortPx(f),f=h*Math.floor(g.lon/h),g=e*Math.floor(g.lat/e);return new OpenLayers.Bounds(f,g,f+h,g+e)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.layer=d;this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"});this.createBox();this.createControl()},activate:function(){var b=!1;OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),b=!0);return b},setMap:function(b){this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(g,f){var f=OpenLayers.Util.applyDefaults(f,{rotation:0,scale:1,ratio:1}),k=this.rotation,j=this.center;OpenLayers.Util.extend(this,f);if(!1!==this.events.triggerEvent("beforesetfeature",{feature:g})){this.feature=g;this.activate();this._setfeature=!0;var h=this.feature.geometry.getBounds();this.box.move(h.getCenterLonLat());this.box.geometry.rotate(-k,j);this._angle=0;this.rotation?(k=g.geometry.clone(),k.rotate(-this.rotation,this.center),k=new OpenLayers.Feature.Vector(k.getBounds().toGeometry()),k.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(k.geometry.getBounds().getCenterLonLat()),k=k.geometry.components[0].components[0].getBounds().getCenterLonLat()):k=new OpenLayers.LonLat(h.left,h.bottom);this.handles[0].move(k);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:g})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var z=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(a,d){z._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);z.center.move(a,d);delete z._moving};for(var y=function(d,c){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(d,c);this._handle.geometry.move(d,c)},x=function(e,d,f){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(e,d,f);this._handle.geometry.resize(e,d,f)},w=function(d,c){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(d,c);this._handle.geometry.rotate(d,c)},v=function(I,H){var G=this.x,F=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,I,H);if(!z._moving){var E=z.dragControl.handlers.drag.evt,D=!(!z._setfeature&&z.preserveAspectRatio)&&!(E&&E.shiftKey),C=new OpenLayers.Geometry.Point(G,F),E=z.center;this.rotate(-z.rotation,E);C.rotate(-z.rotation,E);var B=this.x-E.x,A=this.y-E.y,m=B-(this.x-C.x),a=A-(this.y-C.y);z.irregular&&!z._setfeature&&(B-=(this.x-C.x)/2,A-=(this.y-C.y)/2);this.x=G;this.y=F;C=1;D?(A=0.00001>Math.abs(a)?1:A/a,C=(0.00001>Math.abs(m)?1:B/m)/A):(m=Math.sqrt(m*m+a*a),A=Math.sqrt(B*B+A*A)/m);z._moving=!0;z.box.geometry.rotate(-z.rotation,E);delete z._moving;z.box.geometry.resize(A,E,C);z.box.geometry.rotate(z.rotation,E);z.transformFeature({scale:A,ratio:C});z.irregular&&!z._setfeature&&(B=E.clone(),B.x+=0.00001>Math.abs(G-E.x)?0:this.x-G,B.y+=0.00001>Math.abs(F-E.y)?0:this.y-F,z.box.geometry.move(this.x-G,this.y-F),z.transformFeature({center:B}))}},u=function(a,C){var B=this.x,A=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,a,C);if(!z._moving){var m=z.dragControl.handlers.drag.evt,m=m&&m.shiftKey?45:1,l=z.center,k=this.x-l.x,j=this.y-l.y;this.x=B;this.y=A;B=Math.atan2(j-C,k-a);B=Math.atan2(j,k)-B;B*=180/Math.PI;z._angle=(z._angle+B)%360;B=z.rotation%m;if(Math.abs(z._angle)>=m||0!==B){B=Math.round(z._angle/m)*m-B,z._angle=0,z.box.geometry.rotate(B,l),z.transformFeature({rotation:B})}}},t=Array(8),s=Array(4),r,q,p,o="sw s se e ne n nw w".split(" "),n=0;8>n;++n){r=this.box.geometry.components[n],q=new OpenLayers.Feature.Vector(r.clone(),{role:o[n]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==n%2&&(p=new OpenLayers.Feature.Vector(r.clone(),{role:o[n]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),p.geometry.move=u,r._rotationHandle=p,s[n/2]=p),r.move=y,r.resize=x,r.rotate=w,q.geometry.move=v,r._handle=q,t[n]=q}this.rotationHandles=s;this.handles=t},createControl:function(){var b=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(a){this.feature===b.feature&&(this.feature=b.box);OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(a){a===b.box&&b.transformFeature({center:b.center})},onStart:function(a){var f=!b.geometryTypes||-1!==OpenLayers.Util.indexOf(b.geometryTypes,a.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(b.handles,a),e=e+OpenLayers.Util.indexOf(b.rotationHandles,a);a!==b.feature&&(a!==b.box&&-2==e&&f)&&b.setFeature(a)},onComplete:function(){b.events.triggerEvent("transformcomplete",{feature:b.feature})}})},drawHandles:function(){for(var d=this.layer,c=0;8>c;++c){this.rotate&&0===c%2&&d.drawFeature(this.rotationHandles[c/2],this.rotationHandleSymbolizer),d.drawFeature(this.handles[c],this.renderIntent)}},transformFeature:function(g){if(!this._setfeature){this.scale*=g.scale||1;this.ratio*=g.ratio||1;var f=this.rotation;this.rotation=(this.rotation+(g.rotation||0))%360;if(!1!==this.events.triggerEvent("beforetransform",g)){var k=this.feature,j=k.geometry,h=this.center;j.rotate(-f,h);g.scale||g.ratio?j.resize(g.scale,h,g.ratio):g.center&&k.move(g.center.getBounds().getCenterLonLat());j.rotate(this.rotation,h);this.layer.drawFeature(k);k.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",g)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){for(var d,c=0;8>c;++c){d=this.box.geometry.components[c],d._handle.destroy(),d._handle=null,d._rotationHandle&&d._rotationHandle.destroy(),d._rotationHandle=null}this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null;this.box.destroy();this.layer=this.box=null;this.dragControl.destroy();this.dragControl=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,d,f){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(b){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(b)},startBox:function(){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(h){var g=this.dragHandler.start.x,m=this.dragHandler.start.y,l=Math.abs(g-h.x),k=Math.abs(m-h.y),j=this.getBoxOffsets();this.zoomBox.style.width=l+j.width+1+"px";this.zoomBox.style.height=k+j.height+1+"px";this.zoomBox.style.left=(h.x<g?g-l-j.left:g-j.left)+"px";this.zoomBox.style.top=(h.y<m?m-k-j.top:m-j.top)+"px"},endBox:function(g){var f;if(5<Math.abs(this.dragHandler.start.x-g.x)||5<Math.abs(this.dragHandler.start.y-g.y)){var k=this.dragHandler.start;f=Math.min(k.y,g.y);var j=Math.max(k.y,g.y),h=Math.min(k.x,g.x),g=Math.max(k.x,g.x);f=new OpenLayers.Bounds(h,j,g,f)}else{f=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[f])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.boxOffsets=this.zoomBox=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var g=document.createElement("div");g.style.position="absolute";g.style.border="1px solid black";g.style.width="3px";document.body.appendChild(g);var f=3==g.clientWidth;document.body.removeChild(g);var g=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),k=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),j=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),h=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:g,right:k,top:j,bottom:h,width:!1===f?g+k:0,height:!1===f?j+h:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(h){if(h instanceof OpenLayers.Bounds){var g;if(this.out){g=Math.abs(h.right-h.left);var m=Math.abs(h.top-h.bottom);g=Math.min(this.map.size.h/m,this.map.size.w/g);var m=this.map.getExtent(),l=this.map.getLonLatFromPixel(h.getCenterPixel()),h=l.lon-m.getWidth()/2*g,k=l.lon+m.getWidth()/2*g,j=l.lat-m.getHeight()/2*g;g=l.lat+m.getHeight()/2*g;g=new OpenLayers.Bounds(h,j,k,g)}else{g=this.map.getLonLatFromPixel({x:h.left,y:h.bottom}),m=this.map.getLonLatFromPixel({x:h.right,y:h.top}),g=new OpenLayers.Bounds(g.lon,g.lat,m.lon,m.lat)}m=this.map.getZoom();this.map.zoomToExtent(g);m==this.map.getZoom()&&!0==this.alwaysZoom&&this.map.zoomTo(m+(this.out?-1:1))}else{this.out?this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()+1)}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var b={interval:this.kineticInterval};"object"===typeof this.enableKinetic&&(b=OpenLayers.Util.extend(b,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(b)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(b){this.kinetic&&this.kinetic.update(b);this.panned=!0;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var d=null;this.kinetic&&(d=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!d,animate:!1});if(d){var f=this;this.kinetic.move(d,function(g,c,h){f.map.pan(g,c,{dragging:!h,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(b){this.touch||(this.unregisterMouseListeners(),this.touch=!0);this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},touchmove:function(b){this.last=this.getEventInfo(b);return !0},touchend:function(b){this.down&&(b.xy=this.last.xy,b.lastTouches=this.last.touches,this.handleSingle(b),this.down=null);return !0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(b){this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return !0},mouseup:function(d){var c=!0;this.checkModifiers(d)&&(this.control.handleRightClicks&&OpenLayers.Event.isRightClick(d))&&(c=this.rightclick(d));return c},rightclick:function(b){if(this.passesTolerance(b)){if(null!=this.rightclickTimerId){return this.clearTimer(),this.callback("dblrightclick",[b]),!this.stopDouble}b=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);b=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(b,this.delay)}return !this.stopSingle},delayedRightCall:function(b){this.rightclickTimerId=null;b&&this.callback("rightclick",[b])},click:function(b){this.last||(this.last=this.getEventInfo(b));this.handleSingle(b);return !this.stopSingle},dblclick:function(b){this.handleDouble(b);return !this.stopDouble},handleDouble:function(b){this.passesDblclickTolerance(b)&&(this["double"]&&this.callback("dblclick",[b]),this.clearTimer())},handleSingle:function(b){this.passesTolerance(b)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(b),this.handleDouble(b)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(b),this.queuePotentialClick(this.single?OpenLayers.Util.extend({},b):null)))},queuePotentialClick:function(b){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)},passesTolerance:function(e){var d=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(d=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length){for(var e=0,f=this.down.touches.length;e<f;++e){if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){d=!1;break}}}return d},getTouchDistance:function(d,c){return Math.sqrt(Math.pow(d.clientX-c.clientX,2)+Math.pow(d.clientY-c.clientY,2))},passesDblclickTolerance:function(){var b=!0;this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null);null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(b){this.timerId=null;b&&this.callback("click",[b])},getEventInfo:function(g){var f;if(g.touches){var k=g.touches.length;f=Array(k);for(var j,h=0;h<k;h++){j=g.touches[h],f[h]={clientX:j.clientX,clientY:j.clientY}}}return{xy:g.xy,touches:f}},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,this.touch=!1,b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom+1)},defaultDblRightClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom-1)},wheelChange:function(j,h){var o=this.map.getZoom(),n=this.map.getZoom()+Math.round(h),n=Math.max(n,0),n=Math.min(n,this.map.getNumZoomLevels());if(n!==o){var m=this.map.getSize(),o=m.w/2-j.xy.x,m=j.xy.y-m.h/2,l=this.map.baseLayer.getResolutionForZoom(n),k=this.map.getLonLatFromPixel(j.xy);this.map.setCenter(new OpenLayers.LonLat(k.lon+o*l,k.lat+m*l),n)}},wheelUp:function(d,c){this.wheelChange(d,c||1)},wheelDown:function(d,c){this.wheelChange(d,c||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(e,d,f){OpenLayers.Control.prototype.initialize.apply(this,[f]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(g,c){this.layer.events.triggerEvent("sketchmodified",{vertex:g,feature:c})},create:function(g,c){this.layer.events.triggerEvent("sketchstarted",{vertex:g,feature:c})}},this.callbacks);this.layer=e;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions});"multi" in this.handlerOptions||(this.handlerOptions.multi=this.multi);if(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})})}this.handler=new d(this,this.callbacks,this.handlerOptions)},drawFeature:function(b){b=new OpenLayers.Feature.Vector(b);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertXY(d,c)},insertDeltaXY:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeltaXY(d,c)},insertDirectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDirectionLength(d,c)},insertDeflectionLength:function(d,c){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(d,c)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(b){b=this.layer.getLonLatFromViewPortPx(b);b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(b);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(g){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){for(var f=this.point.geometry,k=this.control.layer.features,j,h=k.length-1;0<=h;--h){if(j=k[h].geometry,(j instanceof OpenLayers.Geometry.Polygon||j instanceof OpenLayers.Geometry.MultiPolygon)&&j.intersects(f)){f=k[h];this.control.layer.removeFeatures([f],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);f.geometry.addComponent(this.line.geometry);this.polygon=f;this.drawingHole=!0;break}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(d){var d=d.vertex,c=this.line.geometry.components;this.polygon.geometry.intersects(d)||(c=c[c.length-3],d.x=c.x,d.y=c.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var j=this.line.geometry,h=0!==j.getArea();if(h){for(var o=this.polygon.geometry.components,n=o.length-2;0<=n;--n){if(j.intersects(o[n])){h=!1;break}}if(h){n=o.length-2;j:for(;0<n;--n){for(var m=o[n].components,l=0,k=m.length;l<k;++l){if(j.containsPoint(m[l])){h=!1;break j}}}}}h?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(j);this.restoreFeature();return !1},cancel:function(){this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0));return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(b){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;b||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(b){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,b);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var b=this.polygon&&this.polygon.geometry;b&&this.multi&&(b=new OpenLayers.Geometry.MultiPolygon([b]));return b},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(d,c){OpenLayers.Control.Panel.prototype.initialize.apply(this,[c]);this.addControls([new OpenLayers.Control.Navigation]);this.addControls([new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})])},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update());return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});return b},update:function(d){var c=this.getMapBounds();if(null!==c&&(d&&d.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(c))){this.calculateBounds(c),this.resolution=this.layer.map.getResolution(),this.triggerRead(d)}},getMapBounds:function(){if(null===this.layer.map){return null}var b=this.layer.map.getExtent();b&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(b=b.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection));return b},invalidBounds:function(b){b||(b=this.getMapBounds());b=!this.bounds||!this.bounds.containsBounds(b);!b&&this.resFactor&&(b=this.resolution/this.layer.map.getResolution(),b=b>=this.resFactor||b<=1/this.resFactor);return b},calculateBounds:function(e){e||(e=this.getMapBounds());var d=e.getCenterLonLat(),f=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(d.lon-f/2,d.lat-e/2,d.lon+f/2,d.lat+e/2)},triggerRead:function(b){this.response&&!(b&&!0===b.noAbort)&&(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},b))},createFilter:function(){var b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});this.layer.filter&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,b]}));return b},merge:function(h){this.layer.destroyFeatures();if((h=h.features)&&0<h.length){var g=this.layer.projection,m=this.layer.map.getProjectionObject();if(!m.equals(g)){for(var l,k=0,j=h.length;k<j;++k){(l=h[k].geometry)&&l.transform(g,m)}}this.layer.addFeatures(h)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(h,g,m,l,k,j){this.lzd=m;this.zoomLevels=l;m=[];m.push(h,g,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,m);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var b=this.map.getZoom();this.map.getMaxExtent();return b-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(g){var g=this.adjustBounds(g),f=this.getZoom(),k=this.map.getMaxExtent(),j=this.lzd/Math.pow(2,this.getZoom()),h=Math.floor((g.left-k.left)/j),g=Math.floor((g.bottom-k.bottom)/j);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:f,X:h,Y:g}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Protocol.CSW=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.CSW.DEFAULTS),c=OpenLayers.Protocol.CSW["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported CSW version: "+d.version}return new c(d)};OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(r,q){var p,o={layer:!0,matrixSet:!0},n;for(n in o){if(!(n in q)){throw Error("Missing property '"+n+"' in layer configuration.")}}o=r.contents;n=o.tileMatrixSets[q.matrixSet];for(var m,l=0,k=o.layers.length;l<k;++l){if(o.layers[l].identifier===q.layer){m=o.layers[l];break}}if(m&&n){for(var j,l=0,k=m.styles.length;l<k&&!(j=m.styles[l],j.isDefault);++l){}p=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(q,{url:"REST"===q.requestEncoding&&m.resourceUrl?m.resourceUrl.tile.template:r.operationsMetadata.GetTile.dcp.http.get[0].url,name:m.title,style:j.identifier,matrixIds:n.matrixIds,tileFullExtent:n.bounds}))}return p},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var d,c=OpenLayers.Layer.Google.cache[this.map.id];c?(d=c.mapObject,++c.count):(c=this.map.viewPortDiv,d=document.createElement("div"),d.id=this.map.id+"_GMapContainer",d.style.position="absolute",d.style.width="100%",d.style.height="100%",c.appendChild(d),c=this.map.getCenter(),d=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),c={mapObject:d,count:1},OpenLayers.Layer.Google.cache[this.map.id]=c,this.repositionListener=google.maps.event.addListenerOnce(d,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this)));this.mapObject=d;this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var g=this.mapObject.getDiv().firstChild;if(!g||3>g.childNodes.length){return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1}for(var f=OpenLayers.Layer.Google.cache[this.map.id],k=this.map.viewPortDiv,j=g.children.length-1;0<=j;--j){if(1000001==g.children[j].style.zIndex){var h=g.children[j];k.appendChild(h);h.style.zIndex="1100";h.style.bottom="";h.className="olLayerGoogleCopyright olLayerGoogleV3";h.style.display="";f.termsOfUse=h}1000000==g.children[j].style.zIndex&&(h=g.children[j],k.appendChild(h),h.style.zIndex="1100",h.style.bottom="",h.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",h.style.display="",f.poweredBy=h);10000002==g.children[j].style.zIndex&&k.appendChild(g.children[j])}this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}else{var d=OpenLayers.Layer.Google.cache[this.map.id];if(!d.resized){var c=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(c.mapObject,"resize");c.moveTo(c.map.getCenter(),c.map.getZoom());delete d.resized})}d.resized=!0}},setGMapVisibility:function(h){var g=OpenLayers.Layer.Google.cache[this.map.id];if(g){for(var m=this.type,l=this.map.layers,k,j=l.length-1;0<=j;--j){if(k=l[j],k instanceof OpenLayers.Layer.Google&&!0===k.visibility&&!0===k.inRange){m=k.type;h=!0;break}}l=this.mapObject.getDiv();!0===h?(this.mapObject.setMapTypeId(m),l.style.left="",g.termsOfUse&&g.termsOfUse.style&&(g.termsOfUse.style.left="",g.termsOfUse.style.display="",g.poweredBy.style.display=""),g.displayed=this.id):(delete g.displayed,l.style.left="-9999px",g.termsOfUse&&g.termsOfUse.style&&(g.termsOfUse.style.display="none",g.termsOfUse.style.left="-9999px",g.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(d){var c=null;null!=d&&(c=this.sphericalMercator?this.inverseMercator(d.bottom,d.left):new OpenLayers.LonLat(d.bottom,d.left),d=this.sphericalMercator?this.inverseMercator(d.top,d.right):new OpenLayers.LonLat(d.top,d.right),c=new google.maps.LatLngBounds(new google.maps.LatLng(c.lat,c.lon),new google.maps.LatLng(d.lat,d.lon)));return c},getMapObjectLonLatFromMapObjectPixel:function(g){var f=this.map.getSize(),k=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),j=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),h=this.map.getResolution(),g=new OpenLayers.LonLat(k+(g.x-f.w/2)*h,j-(g.y-f.h/2)*h);this.wrapDateLine&&(g=g.wrapDateLine(this.maxExtent));return this.getMapObjectLonLatFromLonLat(g.lon,g.lat)},getMapObjectPixelFromMapObjectLonLat:function(f){var e=this.getLongitudeFromMapObjectLonLat(f),f=this.getLatitudeFromMapObjectLonLat(f),h=this.map.getResolution(),g=this.map.getExtent();return this.getMapObjectPixelFromXY(1/h*(e-g.left),1/h*(g.top-f))},setMapObjectCenter:function(e,d){if(!1===this.animationEnabled&&d!=this.mapObject.zoom){var f=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){f.style.visibility=""});f.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:d})},getMapObjectZoomFromMapObjectBounds:function(b){return this.mapObject.getBoundsZoomLevel(b)},getMapObjectLonLatFromLonLat:function(e,d){var f;this.sphericalMercator?(f=this.inverseMercator(e,d),f=new google.maps.LatLng(f.lat,f.lon)):f=new google.maps.LatLng(d,e);return f},getMapObjectPixelFromXY:function(d,c){return new google.maps.Point(d,c)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener);this.repositionTimer&&window.clearTimeout(this.repositionTimer);OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}};OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wps:{ProcessDescriptions:function(d,c){c.processDescriptions={};this.readChildNodes(d,c.processDescriptions)},ProcessDescription:function(e,d){var f={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion"),statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,f);d[f.identifier]=f},DataInputs:function(d,c){c.dataInputs=[];this.readChildNodes(d,c.dataInputs)},ProcessOutputs:function(d,c){c.processOutputs=[];this.readChildNodes(d,c.processOutputs)},Output:function(e,d){var f={};this.readChildNodes(e,f);d.push(f)},ComplexOutput:function(d,c){c.complexOutput={};this.readChildNodes(d,c.complexOutput)},Input:function(e,d){var f={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,f);d.push(f)},BoundingBoxData:function(d,c){c.boundingBoxData={};this.readChildNodes(d,c.boundingBoxData)},CRS:function(d,c){c.CRSs||(c.CRSs={});c.CRSs[this.getChildValue(d)]=!0},LiteralData:function(d,c){c.literalData={};this.readChildNodes(d,c.literalData)},ComplexData:function(d,c){c.complexData={};this.readChildNodes(d,c.complexData)},Default:function(d,c){c["default"]={};this.readChildNodes(d,c["default"])},Supported:function(d,c){c.supported={};this.readChildNodes(d,c.supported)},Format:function(e,d){var f={};this.readChildNodes(e,f);d.formats||(d.formats={});d.formats[f.mimeType]=!0},MimeType:function(d,c){c.mimeType=this.getChildValue(d)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{csw:{GetRecordsResponse:function(e,d){d.records=[];this.readChildNodes(e,d);var f=this.getAttributeNS(e,"","version");""!=f&&(d.version=f)},RequestId:function(d,c){c.RequestId=this.getChildValue(d)},SearchStatus:function(e,d){d.SearchStatus={};var f=this.getAttributeNS(e,"","timestamp");""!=f&&(d.SearchStatus.timestamp=f)},SearchResults:function(h,g){this.readChildNodes(h,g);for(var m=h.attributes,l={},k=0,j=m.length;k<j;++k){l[m[k].name]="numberOfRecordsMatched"==m[k].name||"numberOfRecordsReturned"==m[k].name||"nextRecord"==m[k].name?parseInt(m[k].nodeValue):m[k].nodeValue}g.SearchResults=l},SummaryRecord:function(e,d){var f={type:"SummaryRecord"};this.readChildNodes(e,f);d.records.push(f)},BriefRecord:function(e,d){var f={type:"BriefRecord"};this.readChildNodes(e,f);d.records.push(f)},DCMIRecord:function(e,d){var f={type:"DCMIRecord"};this.readChildNodes(e,f);d.records.push(f)},Record:function(e,d){var f={type:"Record"};this.readChildNodes(e,f);d.records.push(f)},"*":function(e,d){var f=e.localName||e.nodeName.split(":").pop();d[f]=this.getChildValue(e)}},geonet:{info:function(e,d){var f={};this.readChildNodes(e,f);d.gninfo=f}},dc:{"*":function(j,h){var o=j.localName||j.nodeName.split(":").pop();OpenLayers.Util.isArray(h[o])||(h[o]=[]);for(var n={},m=j.attributes,l=0,k=m.length;l<k;++l){n[m[l].name]=m[l].nodeValue}n.value=this.getChildValue(j);""!=n.value&&h[o].push(n)}},dct:{"*":function(e,d){var f=e.localName||e.nodeName.split(":").pop();OpenLayers.Util.isArray(d[f])||(d[f]=[]);d[f].push(this.getChildValue(e))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(d,c){c.bounds&&(c.BoundingBox=[{crs:c.projection,value:[c.bounds.left,c.bounds.bottom,c.bounds.right,c.bounds.top]}],delete c.projection,delete c.bounds);OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(b){b=this.writeNode("csw:GetRecords",b);b.setAttribute("xmlns:gmd",this.namespaces.gmd);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(g){g||(g={});var f=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:g.requestId||this.requestId,resultType:g.resultType||this.resultType,outputFormat:g.outputFormat||this.outputFormat,outputSchema:g.outputSchema||this.outputSchema,startPosition:g.startPosition||this.startPosition,maxRecords:g.maxRecords||this.maxRecords}});if(g.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",g.DistributedSearch||this.DistributedSearch,f)}var k=g.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(k)&&0<k.length){for(var j=0,h=k.length;j<h;j++){this.writeNode("csw:ResponseHandler",k[j],f)}}this.writeNode("Query",g.Query||this.Query,f);return f},DistributedSearch:function(b){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:b.hopCount}})},ResponseHandler:function(b){return this.createElementNSPlus("csw:ResponseHandler",{value:b.value})},Query:function(g){g||(g={});var f=this.createElementNSPlus("csw:Query",{attributes:{typeNames:g.typeNames||"csw:Record"}}),k=g.ElementName;if(OpenLayers.Util.isArray(k)&&0<k.length){for(var j=0,h=k.length;j<h;j++){this.writeNode("csw:ElementName",k[j],f)}}else{this.writeNode("csw:ElementSetName",g.ElementSetName||{value:"summary"},f)}g.Constraint&&this.writeNode("csw:Constraint",g.Constraint,f);g.SortBy&&this.writeNode("ogc:SortBy",g.SortBy,f);return f},ElementName:function(b){return this.createElementNSPlus("csw:ElementName",{value:b.value})},ElementSetName:function(b){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:b.typeNames},value:b.value})},Constraint:function(e){var d=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var f=new OpenLayers.Format.Filter({version:e.version});d.appendChild(f.write(e.Filter))}else{e.CqlText&&(e=this.createElementNSPlus("CqlText",{value:e.CqlText.value}),d.appendChild(e))}return d}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(e,d,f){this.bounds=e;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div);this.setBorder(d,f)},destroy:function(){this.div=this.bounds=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(d,c){d||(d="red");c||(c=2);this.div.style.border=c+"px solid "+d},draw:function(d,c){OpenLayers.Util.modifyDOMElement(this.div,null,d,c);return this.div},onScreen:function(){var b=!1;this.map&&(b=this.map.getExtent().containsBounds(this.bounds,!0,!0));return b},display:function(b){this.div.style.display=b?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(b){b=b||{};!1!==b.extractStyles&&(b.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5});OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(v){for(var v=v.split("\n"),u,t=[],s=0;s<v.length-1;s++){var r=v[s].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=r.charAt(0)){if(u){for(var r=r.split("\t"),q=new OpenLayers.Geometry.Point(0,0),p={},o=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,n=!1,m=0;m<r.length;m++){if(r[m]){if("point"==u[m]){n=r[m].split(","),q.y=parseFloat(n[0]),q.x=parseFloat(n[1]),n=!0}else{if("lat"==u[m]){q.y=parseFloat(r[m]),n=!0}else{if("lon"==u[m]){q.x=parseFloat(r[m]),n=!0}else{if("title"==u[m]){p.title=r[m]}else{if("image"==u[m]||"icon"==u[m]&&o){o.externalGraphic=r[m]}else{if("iconSize"==u[m]&&o){var l=r[m].split(",");o.graphicWidth=parseFloat(l[0]);o.graphicHeight=parseFloat(l[1])}else{"iconOffset"==u[m]&&o?(l=r[m].split(","),o.graphicXOffset=parseFloat(l[0]),o.graphicYOffset=parseFloat(l[1])):"description"==u[m]?p.description=r[m]:"overflow"==u[m]?p.overflow=r[m]:p[u[m]]=r[m]}}}}}}}}n&&(this.internalProjection&&this.externalProjection&&q.transform(this.externalProjection,this.internalProjection),r=new OpenLayers.Feature.Vector(q,p,o),t.push(r))}else{u=r.split("\t")}}}return t},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(d,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){!this.loaded&&null!=this.location&&(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:function(){this.events.triggerEvent("loadend")},scope:this}),this.loaded=!0)},moveTo:function(e,d,f){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);this.visibility&&!this.loaded&&this.loadText()},parseData:function(k){var k=k.responseText,j={};OpenLayers.Util.extend(j,this.formatOptions);this.map&&!this.projection.equals(this.map.getProjectionObject())&&(j.externalProjection=this.projection,j.internalProjection=this.map.getProjectionObject());for(var k=(new OpenLayers.Format.Text(j)).read(k),j=0,q=k.length;j<q;j++){var p={},o=k[j],n,m,l;n=new OpenLayers.LonLat(o.geometry.x,o.geometry.y);o.style.graphicWidth&&o.style.graphicHeight&&(m=new OpenLayers.Size(o.style.graphicWidth,o.style.graphicHeight));void 0!==o.style.graphicXOffset&&void 0!==o.style.graphicYOffset&&(l=new OpenLayers.Pixel(o.style.graphicXOffset,o.style.graphicYOffset));null!=o.style.externalGraphic?p.icon=new OpenLayers.Icon(o.style.externalGraphic,m,l):(p.icon=OpenLayers.Marker.defaultIcon(),null!=m&&p.icon.setSize(m));null!=o.attributes.title&&null!=o.attributes.description&&(p.popupContentHTML="<h2>"+o.attributes.title+"</h2><p>"+o.attributes.description+"</p>");p.overflow=o.attributes.overflow||"auto";p=new OpenLayers.Feature(this,n,p);this.features.push(p);n=p.createMarker();null!=o.attributes.title&&null!=o.attributes.description&&n.events.register("click",p,this.markerClick);this.addMarker(n)}this.events.triggerEvent("loadend")},markerClick:function(f){var e=this==this.layer.selectedFeature;this.layer.selectedFeature=!e?this:null;for(var h=0,g=this.layer.map.popups.length;h<g;h++){this.layer.map.removePopup(this.layer.map.popups[h])}e||this.layer.map.addPopup(this.createPopup());OpenLayers.Event.stop(f)},clearFeatures:function(){if(null!=this.features){for(;0<this.features.length;){var b=this.features[0];OpenLayers.Util.removeItem(this.features,b);b.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,d,f){if(!f||!f.layerOptions||!f.layerOptions.styleMap){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,d,f]);this.options=f?f:{}},setOptions:function(b){OpenLayers.Util.extend(this.options,b);OpenLayers.Util.extend(this,b)},activate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,b=!0);return b},down:function(b){this.fixedRadius=!!this.radius;b=this.layer.getLonLatFromViewPortPx(b.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}this.persist&&this.clear();this.feature=new OpenLayers.Feature.Vector;this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:!0});this.layer.drawFeature(this.feature,this.style)},move:function(d){var c=this.layer.getLonLatFromViewPortPx(d.xy),c=new OpenLayers.Geometry.Point(c.lon,c.lat);this.irregular?(d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,d)):this.fixedRadius?this.origin=c:(this.calculateAngle(c,d),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));this.modifyGeometry();this.irregular&&(d=c.x-this.origin.x,c=c.y-this.origin.y,this.feature.geometry.resize(1,this.origin,0==c?d/(this.radius*Math.sqrt(2)):d/c),this.feature.geometry.move(d/2,c/2));this.layer.drawFeature(this.feature,this.style)},up:function(b){this.finalize();this.start==this.last&&this.callback("done",[b.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-0.5);this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180));this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var f,e,h=this.feature.geometry.components[0];h.components.length!=this.sides+1&&(this.createGeometry(),h=this.feature.geometry.components[0]);for(var g=0;g<this.sides;++g){e=h.components[g],f=this.angle+2*g*Math.PI/this.sides,e.x=this.origin.x+this.radius*Math.cos(f),e.y=this.origin.y+this.radius*Math.sin(f),e.clearBounds()}},calculateAngle:function(f,e){var h=Math.atan2(f.y-this.origin.y,f.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!e[this.snapToggle]){var g=Math.PI/180*this.snapAngle;this.angle=Math.round(h/g)*g}else{this.angle=h}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(b){this.callbacks[b]&&this.callbacks[b].apply(this.control,[this.feature.geometry.clone()]);!this.persist&&("done"==b||"cancel"==b)&&this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})}));this.handler=new d(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var b in this.layerCache){delete this.layerCache[b]}for(b in this.wfsCache){delete this.wfsCache[b]}OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(b){this.setVisibility(b.object.getVisibility())},createSelectionLayer:function(d){var c;if(this.layerCache[d.id]){c=this.layerCache[d.id]}else{c=new OpenLayers.Layer.WMS(d.name,d.url,d.params,OpenLayers.Util.applyDefaults(this.layerOptions,d.getOptions()));this.layerCache[d.id]=c;if(!1===this.layerOptions.displayInLayerSwitcher){d.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:c})}this.map.addLayer(c)}return c},createSLD:function(t,s,r){for(var q={version:"1.0.0",namedLayers:{}},p=(""+t.params.LAYERS).split(","),o=0,n=p.length;o<n;o++){var m=p[o];q.namedLayers[m]={name:m,userStyles:[]};var l=this.selectionSymbolizer,k=r[o];0<=k.type.indexOf("Polygon")?l={Polygon:this.selectionSymbolizer.Polygon}:0<=k.type.indexOf("LineString")?l={Line:this.selectionSymbolizer.Line}:0<=k.type.indexOf("Point")&&(l={Point:this.selectionSymbolizer.Point});q.namedLayers[m].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:s[o],maxScaleDenominator:t.options.minScale})]})}return(new OpenLayers.Format.SLD({srsName:this.map.getProjection()})).write(q)},parseDescribeLayer:function(g){var f=new OpenLayers.Format.WMSDescribeLayer,k=g.responseXML;if(!k||!k.documentElement){k=g.responseText}for(var g=f.read(k),f=[],k=null,j=0,h=g.length;j<h;j++){"WFS"==g[j].owsType&&(f.push(g[j].typeName),k=g[j].owsURL)}OpenLayers.Request.GET({url:k,params:{SERVICE:"WFS",TYPENAME:f.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(e){var d=new OpenLayers.Format.WFSDescribeFeatureType,l=e.responseXML;if(!l||!l.documentElement){l=e.responseText}this.control.wfsCache[this.layer.id]=d.read(l);this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(r){for(var q=[],r=this.wfsCache[r.id],p=0,o=r.featureTypes.length;p<o;p++){for(var n=r.featureTypes[p].properties,m=0,l=n.length;m<l;m++){var k=n[m],j=k.type;(0<=j.indexOf("LineString")||0<=j.indexOf("GeometryAssociationType")||0<=j.indexOf("GeometryPropertyType")||0<=j.indexOf("Point")||0<=j.indexOf("Polygon"))&&q.push(k)}}return q},activate:function(){var f=OpenLayers.Control.prototype.activate.call(this);if(f){for(var e=0,h=this.layers.length;e<h;e++){var g=this.layers[e];g&&!this.wfsCache[g.id]&&OpenLayers.Request.GET({url:g.url,params:{SERVICE:"WMS",VERSION:g.params.VERSION,LAYERS:g.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:g,control:this}})}}return f},deactivate:function(){var h=OpenLayers.Control.prototype.deactivate.call(this);if(h){for(var g=0,m=this.layers.length;g<m;g++){var l=this.layers[g];if(l&&!0===this.clearOnDeactivate){var k=this.layerCache,j=k[l.id];j&&(l.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:j}),j.destroy(),delete k[l.id])}}}return h},setLayers:function(b){this.active?(this.deactivate(),this.layers=b,this.activate()):this.layers=b},createFilter:function(e,d){var f=null;this.handler instanceof OpenLayers.Handler.RegularPolygon?f=!0===this.handler.irregular?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e.name,value:d.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Polygon?f=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Path?f=0<=e.type.indexOf("Point")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:d}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):this.handler instanceof OpenLayers.Handler.Click&&(f=0<=e.type.indexOf("Polygon")?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:e.name,value:d}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:e.name,distance:0.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:d}));return f},select:function(b){this._queue=function(){for(var r=0,q=this.layers.length;r<q;r++){for(var p=this.layers[r],o=this.getGeometryAttributes(p),n=[],m=0,l=o.length;m<l;m++){var k=o[m];if(null!==k){if(!(b instanceof OpenLayers.Geometry)){var a=this.map.getLonLatFromPixel(b.xy);b=new OpenLayers.Geometry.Point(a.lon,a.lat)}k=this.createFilter(k,b);null!==k&&n.push(k)}}m=this.createSelectionLayer(p);o=this.createSLD(p,n,o);this.events.triggerEvent("selected",{layer:p,filters:n});m.mergeNewParams({SLD_BODY:o});delete this._queue}};this.applySelection()},applySelection:function(){for(var e=!0,d=0,f=this.layers.length;d<f;d++){if(!this.wfsCache[this.layers[d].id]){e=!1;break}}e&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(d,c){OpenLayers.Control.prototype.initialize.apply(this,[c]);this.element=OpenLayers.Util.getElement(d)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element));this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var b;if(!0===this.geodesic){if(!this.map.getUnits()){return}b=OpenLayers.INCHES_PER_UNIT;b=(this.map.getGeodesicPixelSize().w||0.000001)*b.km*OpenLayers.DOTS_PER_INCH}else{b=this.map.getScale()}b&&(b=9500<=b&&950000>=b?Math.round(b/1000)+"K":950000<=b?Math.round(b/1000000)+"M":Math.round(b),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:b}))},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(null==g||null==g.isBaseLayer){this.isBaseLayer="true"!=this.transparent&&!0!=this.transparent}g&&null!=g.useOverlay&&(this.useOverlay=g.useOverlay);this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var d;d=e.getCenterLonLat();var f=this.map.getSize();this.singleTile?(e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:f.h*this.ratio,setdisplaywidth:f.w*this.ratio,setviewcenterx:d.lon,setviewcentery:d.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(d={},d=OpenLayers.Util.extend(d,e),d.operation="GETVISIBLEMAPEXTENT",d.version="1.0.0",d.session=this.params.session,d.mapName=this.params.mapName,d.format="text/xml",d=this.getFullRequestString(d),OpenLayers.Request.GET({url:d,async:!1})),d=this.getFullRequestString(e)):(f=this.map.getResolution(),d=Math.floor((e.left-this.maxExtent.left)/f),d=Math.round(d/this.tileSize.w),e=Math.floor((this.maxExtent.top-e.top)/f),e=Math.round(e/this.tileSize.h),d=this.useHttpTile?this.getImageFilePath({tilecol:d,tilerow:e,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:d,tilerow:e,scaleindex:this.resolutions.length-this.map.zoom-1}));return d},getFullRequestString:function(j,h){var o=null==h?this.url:h;"object"==typeof o&&(o=o[Math.floor(Math.random()*o.length)]);var n=o,m=OpenLayers.Util.extend({},this.params),m=OpenLayers.Util.extend(m,j),l=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(o)),k;for(k in m){k.toUpperCase() in l&&delete m[k]}m=OpenLayers.Util.getParameterString(m);m=m.replace(/,/g,"+");""!=m&&(l=o.charAt(o.length-1),n="&"==l||"?"==l?n+m:-1==o.indexOf("?")?n+("?"+m):n+("&"+m));return n},getImageFilePath:function(g,f){var k=null==f?this.url:f;"object"==typeof k&&(k=k[Math.floor(Math.random()*k.length)]);var j="",h="";0>g.tilerow&&(j="-");j=0==g.tilerow?j+"0":j+Math.floor(Math.abs(g.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder;0>g.tilecol&&(h="-");h=0==g.tilecol?h+"0":h+Math.floor(Math.abs(g.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;j="/S"+Math.floor(g.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+j+"/C"+h+"/"+g.tilerow%this.params.tileRowsPerFolder+"_"+g.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;this.params.querystring&&(j+="?"+this.params.querystring);return k+j},calculateGridLayout:function(j,h,o){var n=o*this.tileSize.w,o=o*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/n)-this.buffer,j=h.lat-j.top+o,k=Math.floor(j/o)-this.buffer;return{tilelon:n,tilelat:o,tileoffsetlon:h.lon+l*n,tileoffsetlat:h.lat-o*k,tileoffsetx:-(m/n-l)*this.tileSize.w,tileoffsety:(k-j/o)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);var f={done:this.measureComplete,point:this.measurePartial};this.immediate&&(f.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(f,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(b){(this.immediate=b)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,d){var f=this.active;f&&this.deactivate();this.handler=new e(this,this.callbacks,d);f&&this.activate()},measureComplete:function(b){this.cancelDelay();this.measure(b,"measure")},measurePartial:function(d,c){this.cancelDelay();c=c.clone();this.handler.freehandMode(this.handler.evt)?this.measure(c,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(c,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,d,f){f&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(d.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(f,e){var h,g;-1<f.CLASS_NAME.indexOf("LineString")?(h=this.getBestLength(f),g=1):(h=this.getBestArea(f),g=2);this.events.triggerEvent(e,{measure:h[0],units:h[1],order:g,geometry:f})},getBestArea:function(h){for(var g=this.displaySystemUnits[this.displaySystem],m,l,k=0,j=g.length;k<j&&!(m=g[k],l=this.getArea(h,m),1<l);++k){}return[l,m]},getArea:function(g,f){var k,j;this.geodesic?(k=g.getGeodesicArea(this.map.getProjectionObject()),j="m"):(k=g.getArea(),j=this.map.getUnits());var h=OpenLayers.INCHES_PER_UNIT[f];h&&(k*=Math.pow(OpenLayers.INCHES_PER_UNIT[j]/h,2));return k},getBestLength:function(h){for(var g=this.displaySystemUnits[this.displaySystem],m,l,k=0,j=g.length;k<j&&!(m=g[k],l=this.getLength(h,m),1<l);++k){}return[l,m]},getLength:function(g,f){var k,j;this.geodesic?(k=g.getGeodesicLength(this.map.getProjectionObject()),j="m"):(k=g.getLength(),j=this.map.getUnits());var h=OpenLayers.INCHES_PER_UNIT[f];h&&(k*=OpenLayers.INCHES_PER_UNIT[j]/h);return k},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(b){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[b])},read_wmc_SRS:function(g,f){var k=this.getChildValue(f);"object"!=typeof g.projections&&(g.projections={});for(var k=k.split(/ +/),j=0,h=k.length;j<h;j++){g.projections[k[j]]=!0}},write_wmc_Layer:function(f){var e=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[f]);if(f.srs){var h=[],g;for(g in f.srs){h.push(g)}e.appendChild(this.createElementDefaultNS("SRS",h.join(" ")))}e.appendChild(this.write_wmc_FormatList(f));e.appendChild(this.write_wmc_StyleList(f));f.dimensions&&e.appendChild(this.write_wmc_DimensionList(f));e.appendChild(this.write_wmc_LayerExtension(f))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(j,h,o,n,m,l,k){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition});this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;l&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var d=0;d<this.blocks.length;d++){var c=this.blocks[d];c.image&&c.div.removeChild(c.image);c.image=null;c.div&&this.groupDiv.removeChild(c.div);c.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+this.padding.right+"px";this.closeDiv.style.top=b.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(d){var c=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return c=c.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null,d;for(d in this.positionBlocks){e=d;break}e=this.positionBlocks[e];for(d=0;d<e.blocks.length;d++){var f={};this.blocks.push(f);f.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+d,null,null,null,"absolute",null,"hidden",null);f.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+d,null,this.imageSize,this.imageSrc,"absolute",null,null,null);f.div.appendChild(f.image);this.groupDiv.appendChild(f.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var t=this.positionBlocks[this.relativePosition],s=0;s<t.blocks.length;s++){var r=t.blocks[s],q=this.blocks[s],p=r.anchor.left,o=r.anchor.bottom,n=r.anchor.right,m=r.anchor.top,l=isNaN(r.size.w)?this.size.w-(n+p):r.size.w,k=isNaN(r.size.h)?this.size.h-(o+m):r.size.h;q.div.style.width=(0>l?0:l)+"px";q.div.style.height=(0>k?0:k)+"px";q.div.style.left=null!=p?p+"px":"";q.div.style.bottom=null!=o?o+"px":"";q.div.style.right=null!=n?n+"px":"";q.div.style.top=null!=m?m+"px":"";q.image.style.left=r.position.x+"px";q.image.style.top=r.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(j,h,o,n,m,l,k){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var d=this.layer.getURL(this.bounds),c=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&d.length>this.maxGetUrlLength;d=c&&!this.useIFrame;c=!c&&this.useIFrame;if(d||c){this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,d?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank")}}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var d=document.createElement("div"),c=d.style;c.position="absolute";c.width="100%";c.height="100%";c.zIndex=1;c.backgroundImage="url("+this._blankImageUrl+")";this.frame.appendChild(d)}d=this.id+"_iFrame";9>parseFloat(navigator.appVersion.split("MSIE")[1])?(c=document.createElement('<iframe name="'+d+'">'),c.style.backgroundColor="#FFFFFF",c.style.filter="chroma(color=#FFFFFF)"):(c=document.createElement("iframe"),c.style.backgroundColor="transparent",c.name=d);c.scrolling="no";c.marginWidth="0px";c.marginHeight="0px";c.frameBorder="0";c.style.position="absolute";c.style.width="100%";c.style.height="100%";1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,this.layer.opacity);this.frame.appendChild(c);return this.imgDiv=c}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var f=document.createElement("form");f.method="POST";var e=this.layer.params._OLSALT,e=(e?e+"_":"")+this.bounds.toBBOX();f.action=OpenLayers.Util.urlAppend(this.layer.url,e);f.target=this.id+"_iFrame";this.layer.getImageSize();var e=OpenLayers.Util.getParameters(this.url),h,g;for(g in e){h=document.createElement("input"),h.type="hidden",h.name=g,h.value=e[g],f.appendChild(h)}return f},setImgSrc:function(d){if(!0===this.useIFrame){if(d){var c=this.createRequestForm();this.frame.appendChild(c);c.submit();this.frame.removeChild(c)}else{this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null)}}else{OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)}},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var b;!1===this.useIFrame&&(b=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this));return b}};OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{gml:OpenLayers.Util.applyDefaults({name:function(d,c){c.name=this.getChildValue(d)},TimePeriod:function(d,c){c.timePeriod={};this.readChildNodes(d,c.timePeriod)},beginPosition:function(d,c){c.beginPosition=this.getChildValue(d)},endPosition:function(d,c){c.endPosition=this.getChildValue(d)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(d,c){this.readChildNodes(d,c)},Contents:function(d,c){c.contents={};this.readChildNodes(d,c.contents)},ObservationOfferingList:function(d,c){c.offeringList={};this.readChildNodes(d,c.offeringList)},ObservationOffering:function(e,d){var f=this.getAttributeNS(e,this.namespaces.gml,"id");d[f]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(e,d[f])},time:function(d,c){c.time={};this.readChildNodes(d,c.time)},procedure:function(d,c){c.procedures.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},observedProperty:function(d,c){c.observedProperties.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},featureOfInterest:function(d,c){c.featureOfInterestIds.push(this.getAttributeNS(d,this.namespaces.xlink,"href"))},responseFormat:function(d,c){c.responseFormats.push(this.getChildValue(d))},resultModel:function(d,c){c.resultModels.push(this.getChildValue(d))},responseMode:function(d,c){c.responseModes.push(this.getChildValue(d))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(d){var c=!0;this.pinching=!1;OpenLayers.Event.isMultiTouch(d)?(this.started=!0,this.last=this.start={distance:this.getDistance(d.touches),delta:0,scale:1},this.callback("start",[d,this.start]),c=!this.stopDown):(this.started=!1,this.last=this.start=null);OpenLayers.Event.stop(d);return c},touchmove:function(d){if(this.started&&OpenLayers.Event.isMultiTouch(d)){this.pinching=!0;var c=this.getPinchData(d);this.callback("move",[d,c]);this.last=c;OpenLayers.Event.stop(d)}return !0},touchend:function(b){this.started&&(this.pinching=this.started=!1,this.callback("done",[b,this.start,this.last]),this.last=this.start=null);return !0},activate:function(){var b=!1;OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,b=!0);return b},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,b=!0);return b},getDistance:function(d){var c=d[0],d=d[1];return Math.sqrt(Math.pow(c.clientX-d.clientX,2)+Math.pow(c.clientY-d.clientY,2))},getPinchData:function(b){b=this.getDistance(b.touches);return{distance:b,delta:this.last.distance-b,scale:b/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var b=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);null===this.defaultControl&&(this.defaultControl=this.controls[0]);return b},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);b&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this}));return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&this.stop();return b},reset:function(){!0===this.layer.visibility?this.start():this.stop()},start:function(){this.interval&&("number"===typeof this.interval&&0<this.interval)&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&(this.layer.refresh&&"function"==typeof this.layer.refresh)&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(g,f,k,j){var h=[],k=OpenLayers.Util.upperCaseObject(k);h.push(g,f,k,j);OpenLayers.Layer.Grid.prototype.initialize.apply(this,h);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){if(null==j||!j.isBaseLayer){this.isBaseLayer=!1}"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png")}},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(f){var f=this.adjustBounds(f),e=this.projection.getCode().split(":"),e=e[e.length-1],h=this.getImageSize(),f={BBOX:f.toBBOX(),SIZE:h.w+","+h.h,F:"image",BBOXSR:e,IMAGESR:e};if(this.layerDefs){var e=[],g;for(g in this.layerDefs){this.layerDefs.hasOwnProperty(g)&&this.layerDefs[g]&&(e.push(g),e.push(":"),e.push(this.layerDefs[g]),e.push(";"))}0<e.length&&(f.LAYERDEFS=e.join(""))}return this.getFullRequestString(f)},setLayerFilter:function(d,c){this.layerDefs||(this.layerDefs={});c?this.layerDefs[d]=c:delete this.layerDefs[d]},clearLayerFilter:function(b){b?delete this.layerDefs[b]:delete this.layerDefs},mergeNewParams:function(b){b=[OpenLayers.Util.upperCaseObject(b)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(b){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(e){var d,f,e=e.replace(/[\n\r]/g," ");if(f=this.regExes.typeStr.exec(e)){if(e=f[1].toLowerCase(),f=f[2],this.parse[e]&&(d=this.parse[e].apply(this,[f])),this.internalProjection&&this.externalProjection){if(d&&"OpenLayers.Feature.Vector"==d.CLASS_NAME){d.geometry.transform(this.externalProjection,this.internalProjection)}else{if(d&&"geometrycollection"!=e&&"object"==typeof d){e=0;for(f=d.length;e<f;e++){d[e].geometry.transform(this.externalProjection,this.internalProjection)}}}}}return d},write:function(h){var g,m;h.constructor==Array?m=!0:(h=[h],m=!1);var l=[];m&&l.push("GEOMETRYCOLLECTION(");for(var k=0,j=h.length;k<j;++k){m&&0<k&&l.push(","),g=h[k].geometry,l.push(this.extractGeometry(g))}m&&l.push(")");return l.join("")},extractGeometry:function(d){var c=d.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[c]){return null}this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));return("collection"==c?"GEOMETRYCOLLECTION":c.toUpperCase())+"("+this.extract[c].apply(this,[d])+")"},extract:{point:function(b){return b.x+" "+b.y},multipoint:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.point.apply(this,[f.components[h]])+")")}return e.join(",")},linestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extract.point.apply(this,[f.components[h]]))}return e.join(",")},multilinestring:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.linestring.apply(this,[f.components[h]])+")")}return e.join(",")},polygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.linestring.apply(this,[f.components[h]])+")")}return e.join(",")},multipolygon:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push("("+this.extract.polygon.apply(this,[f.components[h]])+")")}return e.join(",")},collection:function(f){for(var e=[],h=0,g=f.components.length;h<g;++h){e.push(this.extractGeometry.apply(this,[f.components[h]]))}return e.join(",")}},parse:{point:function(b){b=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(g){for(var f=OpenLayers.String.trim(g).split(","),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.point.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(k))},linestring:function(f){for(var f=OpenLayers.String.trim(f).split(","),e=[],h=0,g=f.length;h<g;++h){e.push(this.parse.point.apply(this,[f[h]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(e))},multilinestring:function(g){for(var f=OpenLayers.String.trim(g).split(this.regExes.parenComma),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.linestring.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(k))},polygon:function(g){for(var f,g=OpenLayers.String.trim(g).split(this.regExes.parenComma),k=[],j=0,h=g.length;j<h;++j){f=g[j].replace(this.regExes.trimParens,"$1"),f=this.parse.linestring.apply(this,[f]).geometry,f=new OpenLayers.Geometry.LinearRing(f.components),k.push(f)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(k))},multipolygon:function(g){for(var f=OpenLayers.String.trim(g).split(this.regExes.doubleParenComma),k=[],j=0,h=f.length;j<h;++j){g=f[j].replace(this.regExes.trimParens,"$1"),k.push(this.parse.polygon.apply(this,[g]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(k))},geometrycollection:function(f){for(var f=f.replace(/,\s*([A-Za-z])/g,"|$1"),f=OpenLayers.String.trim(f).split("|"),e=[],h=0,g=f.length;h<g;++h){e.push(OpenLayers.Format.WKT.prototype.read.apply(this,[f[h]]))}return e}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(b){this.passesTolerance(b.xy)&&(this.clearTimer(),this.callback("move",[b]),this.px=b.xy,b=OpenLayers.Util.extend({},b),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay));return !this.stopMove},mouseout:function(b){OpenLayers.Util.mouseLeft(b,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[b]));return !0},passesTolerance:function(d){var c=!0;this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-d.x,2)+Math.pow(this.px.y-d.y,2))<this.pixelTolerance&&(c=!1);return c},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(b){this.callback("pause",[b])},deactivate:function(){var b=!1;OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),b=!0);return b},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(b){b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.features={};this.handlers={};this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{}));this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"})));this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active){for(var b in this.handlers){this.handlers[b].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var b in this.handlers){this.handlers[b].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(d){var c=this.pixelToBounds(d.xy);this.setModifiers(d);this.request(c,{single:this.single})},selectBox:function(d){var c;if(d instanceof OpenLayers.Bounds){c=this.map.getLonLatFromPixel({x:d.left,y:d.bottom}),d=this.map.getLonLatFromPixel({x:d.right,y:d.top}),c=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}else{if(this.click){return}c=this.pixelToBounds(d)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(c)},selectHover:function(b){this.request(this.pixelToBounds(b.xy),{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,d){var d=d||{},f=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");f=this.protocol.read({maxFeatures:!0==d.single?this.maxFeatures:void 0,filter:f,callback:function(a){a.success()&&(a.features.length?!0==d.single?this.selectBestFeature(a.features,e.getCenterLonLat(),d):this.select(a.features):d.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll()));OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});!0==d.hover&&(this.hoverResponse=f)},selectBestFeature:function(k,j,q){q=q||{};if(k.length){for(var j=new OpenLayers.Geometry.Point(j.lon,j.lat),p,o,n,m=Number.MAX_VALUE,l=0;l<k.length&&!(p=k[l],p.geometry&&(n=j.distanceTo(p.geometry,{edge:!1}),n<m&&(m=n,o=p,0==m)));++l){}!0==q.hover?this.hoverSelect(o):this.select(o||k)}},setModifiers:function(b){this.modifiers={multiple:this.multiple||this.multipleKey&&b[this.multipleKey],toggle:this.toggle||this.toggleKey&&b[this.toggleKey]}},select:function(h){!this.modifiers.multiple&&!this.modifiers.toggle&&this.unselectAll();OpenLayers.Util.isArray(h)||(h=[h]);var g=this.events.triggerEvent("beforefeaturesselected",{features:h});if(!1!==g){for(var m=[],l,k=0,j=h.length;k<j;++k){l=h[k],this.features[l.fid||l.id]?this.modifiers.toggle&&this.unselect(this.features[l.fid||l.id]):(g=this.events.triggerEvent("beforefeatureselected",{feature:l}),!1!==g&&(this.features[l.fid||l.id]=l,m.push(l),this.events.triggerEvent("featureselected",{feature:l})))}this.events.triggerEvent("featuresselected",{features:m})}},hoverSelect:function(e){var d=e?e.fid||e.id:null,f=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;f&&f!=d&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null);d&&d!=f&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(b){delete this.features[b.fid||b.id];this.events.triggerEvent("featureunselected",{feature:b})},unselectAll:function(){for(var b in this.features){this.unselect(this.features[b])}},setMap:function(d){for(var c in this.handlers){this.handlers[c].setMap(d)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(d){var c=d.add(-this.clickTolerance/2,this.clickTolerance/2),d=d.add(this.clickTolerance/2,-this.clickTolerance/2),c=this.map.getLonLatFromPixel(c),d=this.map.getLonLatFromPixel(d);return new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Format.QueryStringFilter=function(){function d(b){b=b.replace(/%/g,"\\%");b=b.replace(/\\\\\.(\*)?/g,function(f,e){return e?f:"\\\\_"});b=b.replace(/\\\\\.\*/g,"\\\\%");b=b.replace(/(\\)?\.(\*)?/g,function(f,e,g){return e||g?f:"_"});b=b.replace(/(\\)?\.\*/g,function(f,e){return e?f:"%"});b=b.replace(/\\\./g,".");return b=b.replace(/(\\)?\\\*/g,function(f,e){return e?f:"*"})}var c={};c[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";c[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";c[OpenLayers.Filter.Comparison.LESS_THAN]="lt";c[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";c[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";c[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";c[OpenLayers.Filter.Comparison.LIKE]="ilike";return OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(h,g){var g=g||{},b=h.CLASS_NAME,b=b.substring(b.lastIndexOf(".")+1);switch(b){case"Spatial":switch(h.type){case OpenLayers.Filter.Spatial.BBOX:g.bbox=h.value.toArray();this.srsInBBOX&&h.projection&&g.bbox.push(h.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:g.tolerance=h.distance;case OpenLayers.Filter.Spatial.WITHIN:g.lon=h.value.x;g.lat=h.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+h.type)}break;case"Comparison":b=c[h.type];if(void 0!==b){var a=h.value;h.type==OpenLayers.Filter.Comparison.LIKE&&(a=d(a),this.wildcarded&&(a="%"+a+"%"));g[h.property+"__"+b]=a;g.queryable=g.queryable||[];g.queryable.push(h.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+h.type)}break;case"Logical":if(h.type===OpenLayers.Filter.Logical.AND){b=0;for(a=h.filters.length;b<a;b++){g=this.write(h.filters[b],g)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+h.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+b)}return g},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.element||(this.div.left="",this.div.top="",this.element=this.div);return this.div},redraw:function(d){var c;if(null==d){this.reset()}else{if(null==this.lastXy||Math.abs(d.xy.x-this.lastXy.x)>this.granularity||Math.abs(d.xy.y-this.lastXy.y)>this.granularity){this.lastXy=d.xy}else{if(c=this.map.getLonLatFromPixel(d.xy)){this.displayProjection&&c.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=d.xy,d=this.formatOutput(c),d!=this.element.innerHTML&&(this.element.innerHTML=d)}}}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(d){var c=parseInt(this.numDigits);return this.prefix+d.lon.toFixed(c)+this.separator+d.lat.toFixed(c)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return !this.geolocation?(this.events.triggerEvent("locationuncapable"),!1):OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1},deactivate:function(){this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId);return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(d){var c=(new OpenLayers.LonLat(d.coords.longitude,d.coords.latitude)).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(c);this.events.triggerEvent("locationupdated",{position:d,point:new OpenLayers.Geometry.Point(c.lon,c.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return !1}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return !0},failure:function(b){this.events.triggerEvent("locationfailed",{error:b})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var d=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(d){if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var c=new OpenLayers.Protocol.Script({url:this.url,callback:function(b){this.isLoading=false;this.events.triggerEvent("loadend");this.json=b.data},scope:this});c.read();this.request=c}else{this.request=OpenLayers.Request.GET({url:this.url,callback:function(b){this.isLoading=false;this.events.triggerEvent("loadend");b.status===200&&this.parseData(b.responseText)},scope:this})}}else{this.unload()}return d},abortLoading:function(){this.request&&(this.request.abort(),delete this.request);this.isLoading=!1},getFeatureInfo:function(f,e){var h=null;if(this.json){var g=this.getFeatureId(f,e);null!==g&&(h={id:g,data:this.json.data[g]})}return h},getFeatureId:function(g,f){var k=null;if(this.json){var j=this.utfgridResolution,j=this.indexFromCharCode(this.json.grid[Math.floor(f/j)].charCodeAt(Math.floor(g/j))),h=this.json.keys;!isNaN(j)&&j in h&&(k=h[j])}return k},indexFromCharCode:function(b){93<=b&&b--;35<=b&&b--;return b-32},parseData:function(b){this.format||(this.format=new OpenLayers.Format.JSON);this.json=this.format.read(b)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);b={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(b,this.nextOptions);this.next=new OpenLayers.Control.Button(b);this.clear()},onPreviousChange:function(b){b&&!this.previous.active?this.previous.activate():!b&&this.previous.active&&this.previous.deactivate()},onNextChange:function(b){b&&!this.next.active?this.next.activate():!b&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var b in this){this[b]=null}},setMap:function(b){this.map=b;this.next.setMap(b);this.previous.setMap(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var d=this.previousStack.shift(),c=this.previousStack.shift();void 0!=c?(this.nextStack.unshift(d),this.previousStack.unshift(c),this.restoring=!0,this.restore(c),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(d);return c},nextTrigger:function(){var b=this.nextStack.shift();void 0!=b&&(this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1));return b},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(f){var e,h;if(this.map.getProjectionObject()==f.projection){h=this.map.getZoomForResolution(f.resolution),e=f.center}else{e=f.center.clone();e.transform(f.projection,this.map.getProjectionObject());h=f.units;var g=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;h=this.map.getZoomForResolution((h&&g?OpenLayers.INCHES_PER_UNIT[h]/OpenLayers.INCHES_PER_UNIT[g]:1)*f.resolution)}this.map.setCenter(e,h)},setListeners:function(){this.listeners={};for(var b in this.registry){this.listeners[b]=OpenLayers.Function.bind(function(){if(!this.restoring){this.previousStack.unshift(this.registry[b].apply(this,arguments));if(1<this.previousStack.length){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}this.previousStack.length>this.limit+1&&this.previousStack.pop();0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))}return !0},this)}},activate:function(){var d=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var c in this.listeners){this.map.events.register(c,this,this.listeners[c])}d=!0;0==this.previousStack.length&&this.initStack()}return d},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var d=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var c in this.listeners){this.map.events.unregister(c,this,this.listeners[c])}this.clearOnDeactivate&&this.clear();d=!0}return d},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(d){d=d||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(b,e){return c.write(b,e)}}},destroy:function(){this.headers=this.params=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var d=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,f=new OpenLayers.Protocol.Response({requestType:"read"});d?(d=e.headers||{},d["Content-Type"]="application/x-www-form-urlencoded",f.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,f,e),data:OpenLayers.Util.getParameterString(e.params),headers:d})):f.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,f,e),params:e.params,headers:e.headers});return f},handleRead:function(d,c){this.handleResponse(d,c)},create:function(e,d){var d=OpenLayers.Util.applyDefaults(d,this.options),f=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});f.priv=OpenLayers.Request.POST({url:d.url,callback:this.createCallback(this.handleCreate,f,d),headers:d.headers,data:this.format.write(e)});return f},handleCreate:function(d,c){this.handleResponse(d,c)},update:function(f,e){var e=e||{},h=e.url||f.url||this.options.url+"/"+f.fid,e=OpenLayers.Util.applyDefaults(e,this.options),g=new OpenLayers.Protocol.Response({reqFeatures:f,requestType:"update"});g.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:h,callback:this.createCallback(this.handleUpdate,g,e),headers:e.headers,data:this.format.write(f)});return g},handleUpdate:function(d,c){this.handleResponse(d,c)},"delete":function(g,f){var f=f||{},k=f.url||g.url||this.options.url+"/"+g.fid,f=OpenLayers.Util.applyDefaults(f,this.options),j=new OpenLayers.Protocol.Response({reqFeatures:g,requestType:"delete"}),h=this.deleteWithPOST?"POST":"DELETE",k={url:k,callback:this.createCallback(this.handleDelete,j,f),headers:f.headers};this.deleteWithPOST&&(k.data=this.format.write(g));j.priv=OpenLayers.Request[h](k);return j},handleDelete:function(d,c){this.handleResponse(d,c)},handleResponse:function(e,d){var f=e.priv;d.callback&&(200<=f.status&&300>f.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(f)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,d.callback.call(d.scope,e))},parseFeatures:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},commit:function(D,C){function B(f){for(var d=f.features?f.features.length:0,h=Array(d),g=0;g<d;++g){h[g]=f.features[g].fid}p.insertIds=h;A.apply(this,[f])}function A(b){this.callUserCallback(b,C);q=q&&b.success();y++;y>=r&&C.callback&&(p.code=q?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,C.callback.apply(C.scope,[p]))}var C=OpenLayers.Util.applyDefaults(C,this.options),z=[],y=0,x={};x[OpenLayers.State.INSERT]=[];x[OpenLayers.State.UPDATE]=[];x[OpenLayers.State.DELETE]=[];for(var w,v,u=[],t=0,s=D.length;t<s;++t){if(w=D[t],v=x[w.state]){v.push(w),u.push(w)}}var r=(0<x[OpenLayers.State.INSERT].length?1:0)+x[OpenLayers.State.UPDATE].length+x[OpenLayers.State.DELETE].length,q=!0,p=new OpenLayers.Protocol.Response({reqFeatures:u});w=x[OpenLayers.State.INSERT];0<w.length&&z.push(this.create(w,OpenLayers.Util.applyDefaults({callback:B,scope:this},C.create)));w=x[OpenLayers.State.UPDATE];for(t=w.length-1;0<=t;--t){z.push(this.update(w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C.update)))}w=x[OpenLayers.State.DELETE];for(t=w.length-1;0<=t;--t){z.push(this["delete"](w[t],OpenLayers.Util.applyDefaults({callback:A,scope:this},C["delete"])))}return z},abort:function(b){b&&b.priv.abort()},callUserCallback:function(e,d){var f=d[e.requestType];f&&f.callback&&f.callback.call(f.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this}));return b},cacheFeatures:function(d){var c=!0;this.clustering||(this.clearCache(),this.features=d.features,this.cluster(),c=!1);return c},clearCache:function(){this.features=null},cluster:function(h){if((!h||h.zoomChanged)&&this.features){if(h=this.layer.map.getResolution(),h!=this.resolution||!this.clustersExist()){this.resolution=h;for(var h=[],g,m,l,k=0;k<this.features.length;++k){if(g=this.features[k],g.geometry){m=!1;for(var j=h.length-1;0<=j;--j){if(l=h[j],this.shouldCluster(l,g)){this.addToCluster(l,g);m=!0;break}}m||h.push(this.createCluster(this.features[k]))}}this.layer.removeAllFeatures();if(0<h.length){if(1<this.threshold){g=h.slice();h=[];k=0;for(l=g.length;k<l;++k){m=g[k],m.attributes.count<this.threshold?Array.prototype.push.apply(h,m.cluster):h.push(m)}}this.clustering=!0;this.layer.addFeatures(h);this.clustering=!1}this.clusters=h}}},clustersExist:function(){var d=!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length){for(var d=!0,c=0;c<this.clusters.length;++c){if(this.clusters[c]!=this.layer.features[c]){d=!1;break}}}return d},shouldCluster:function(f,e){var h=f.geometry.getBounds().getCenterLonLat(),g=e.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(h.lon-g.lon,2)+Math.pow(h.lat-g.lat,2))/this.resolution<=this.distance},addToCluster:function(d,c){d.cluster.push(c);d.attributes.count+=1},createCluster:function(d){var c=d.geometry.getBounds().getCenterLonLat(),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),{count:1});c.cluster=[d];return c},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.apply(this,arguments);b&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}));return b},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(g){if(!this.caching&&this.filter){var f=g.features;g.features=[];for(var k,j=0,h=f.length;j<h;++j){k=f[j],this.filter.evaluate(k)?g.features.push(k):this.cache.push(k)}}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(b){this.filter=b;b=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1);0<b.length&&(b={features:b},this.handleAdd(b),0<b.features.length&&(this.caching=!0,this.layer.addFeatures(b.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Protocol.SOS=function(d){var d=OpenLayers.Util.applyDefaults(d,OpenLayers.Protocol.SOS.DEFAULTS),c=OpenLayers.Protocol.SOS["v"+d.version.replace(/\./g,"_")];if(!c){throw"Unsupported SOS version: "+d.version}return new c(d)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(r,q){var p=[],o={};this.readChildNodes(r,{complexTypes:p,customTypes:o});for(var n=r.attributes,m,l,k=0,j=n.length;k<j;++k){m=n[k],l=m.name,0==l.indexOf("xmlns")?this.setNamespace(l.split(":")[1]||"",m.value):q[l]=m.value}q.featureTypes=p;q.targetPrefix=this.namespaceAlias[q.targetNamespace];k=0;for(j=p.length;k<j;++k){n=p[k],m=o[n.typeName],o[n.typeName]&&(n.typeName=m.name)}},complexType:function(e,d){var f={typeName:e.getAttribute("name")};this.readChildNodes(e,f);d.complexTypes.push(f)},complexContent:function(d,c){this.readChildNodes(d,c)},extension:function(d,c){this.readChildNodes(d,c)},sequence:function(e,d){var f={elements:[]};this.readChildNodes(e,f);d.properties=f.elements},element:function(j,h){if(h.elements){for(var o={},n=j.attributes,m,l=0,k=n.length;l<k;++l){m=n[l],o[m.name]=m.value}n=o.type;n||(n={},this.readChildNodes(j,n),o.restriction=n,o.type=n.base);o.localType=(n.base||n).split(":").pop();h.elements.push(o)}h.complexTypes&&(n=j.getAttribute("type"),o=n.split(":").pop(),h.customTypes[o]={name:j.getAttribute("name"),type:n})},simpleType:function(d,c){this.readChildNodes(d,c)},restriction:function(d,c){c.base=d.getAttribute("base");this.readRestriction(d,c)}}},readRestriction:function(j,h){for(var o=j.childNodes,n,m,l=0,k=o.length;l<k;++l){n=o[l],1==n.nodeType&&(m=n.nodeName.split(":").pop(),n=n.getAttribute("value"),h[m]?("string"==typeof h[m]&&(h[m]=[h[m]]),h[m].push(n)):h[m]=n)}},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(k){var j=this.getElementsByTagNameNS(k,this.georssns,"point"),q=this.getElementsByTagNameNS(k,this.geons,"lat"),p=this.getElementsByTagNameNS(k,this.geons,"long"),o=this.getElementsByTagNameNS(k,this.georssns,"line"),n=this.getElementsByTagNameNS(k,this.georssns,"polygon"),m=this.getElementsByTagNameNS(k,this.georssns,"where"),k=this.getElementsByTagNameNS(k,this.georssns,"box");if(0<j.length||0<q.length&&0<p.length){0<j.length?(q=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s+/),2!=q.length&&(q=OpenLayers.String.trim(j[0].firstChild.nodeValue).split(/\s*,\s*/))):q=[parseFloat(q[0].firstChild.nodeValue),parseFloat(p[0].firstChild.nodeValue)];var l=new OpenLayers.Geometry.Point(q[1],q[0])}else{if(0<o.length){q=OpenLayers.String.trim(this.getChildValue(o[0])).split(/\s+/);p=[];o=0;for(n=q.length;o<n;o+=2){j=new OpenLayers.Geometry.Point(q[o+1],q[o]),p.push(j)}l=new OpenLayers.Geometry.LineString(p)}else{if(0<n.length){q=OpenLayers.String.trim(this.getChildValue(n[0])).split(/\s+/);p=[];o=0;for(n=q.length;o<n;o+=2){j=new OpenLayers.Geometry.Point(q[o+1],q[o]),p.push(j)}l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)])}else{0<m.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),l=this.gmlParser.parseFeature(m[0]).geometry):0<k.length&&(q=OpenLayers.String.trim(k[0].firstChild.nodeValue).split(/\s+/),p=[],3<q.length&&(j=new OpenLayers.Geometry.Point(q[1],q[0]),p.push(j),j=new OpenLayers.Geometry.Point(q[1],q[2]),p.push(j),j=new OpenLayers.Geometry.Point(q[3],q[2]),p.push(j),j=new OpenLayers.Geometry.Point(q[3],q[0]),p.push(j),j=new OpenLayers.Geometry.Point(q[1],q[0]),p.push(j)),l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(p)]))}}}l&&(this.internalProjection&&this.externalProjection)&&l.transform(this.externalProjection,this.internalProjection);return l},createFeatureFromItem:function(h){var g=this.createGeometryFromItem(h),m=this._getChildValue(h,"*","title",this.featureTitle),l=this._getChildValue(h,"*","description",this._getChildValue(h,"*","content",this._getChildValue(h,"*","summary",this.featureDescription))),k=this._getChildValue(h,"*","link");if(!k){try{k=this.getElementsByTagNameNS(h,"*","link")[0].getAttribute("href")}catch(j){k=null}}h=this._getChildValue(h,"*","id",null);g=new OpenLayers.Feature.Vector(g,{title:m,description:l,link:k});g.fid=h;return g},_getChildValue:function(f,e,h,g){return(f=this.getElementsByTagNameNS(f,e,h))&&f[0]&&f[0].firstChild&&f[0].firstChild.nodeValue?this.getChildValue(f[0]):void 0==g?"":g},read:function(f){"string"==typeof f&&(f=OpenLayers.Format.XML.prototype.read.apply(this,[f]));var e=null,e=this.getElementsByTagNameNS(f,"*","item");0==e.length&&(e=this.getElementsByTagNameNS(f,"*","entry"));for(var f=e.length,h=Array(f),g=0;g<f;g++){h[g]=this.createFeatureFromItem(e[g])}return h},write:function(f){var e;if(OpenLayers.Util.isArray(f)){e=this.createElementNS(this.rssns,"rss");for(var h=0,g=f.length;h<g;h++){e.appendChild(this.createFeatureXML(f[h]))}}else{e=this.createFeatureXML(f)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureXML:function(h){var g=this.buildGeometryNode(h.geometry),m=this.createElementNS(this.rssns,"item"),l=this.createElementNS(this.rssns,"title");l.appendChild(this.createTextNode(h.attributes.title?h.attributes.title:""));var k=this.createElementNS(this.rssns,"description");k.appendChild(this.createTextNode(h.attributes.description?h.attributes.description:""));m.appendChild(l);m.appendChild(k);h.attributes.link&&(l=this.createElementNS(this.rssns,"link"),l.appendChild(this.createTextNode(h.attributes.link)),m.appendChild(l));for(var j in h.attributes){"link"==j||("title"==j||"description"==j)||(l=this.createTextNode(h.attributes[j]),k=j,-1!=j.search(":")&&(k=j.split(":")[1]),k=this.createElementNS(this.featureNS,"feature:"+k),k.appendChild(l),m.appendChild(k))}m.appendChild(g);return m},buildGeometryNode:function(d){this.internalProjection&&this.externalProjection&&(d=d.clone(),d.transform(this.internalProjection,this.externalProjection));var c;if("OpenLayers.Geometry.Polygon"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:polygon"),c.appendChild(this.buildCoordinatesNode(d.components[0]))}else{if("OpenLayers.Geometry.LineString"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:line"),c.appendChild(this.buildCoordinatesNode(d))}else{if("OpenLayers.Geometry.Point"==d.CLASS_NAME){c=this.createElementNS(this.georssns,"georss:point"),c.appendChild(this.buildCoordinatesNode(d))}else{throw"Couldn't parse "+d.CLASS_NAME}}}return c},buildCoordinatesNode:function(f){var e=null;f.components&&(e=f.components);if(e){for(var f=e.length,h=Array(f),g=0;g<f;g++){h[g]=e[g].y+" "+e[g].x}e=h.join(" ")}else{e=f.y+" "+f.x}return this.createTextNode(e)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);return c},readers:{wps:{Capabilities:function(d,c){this.readChildNodes(d,c)},ProcessOfferings:function(d,c){c.processOfferings={};this.readChildNodes(d,c.processOfferings)},Process:function(e,d){var f={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion")};this.readChildNodes(e,f);d[f.identifier]=f},Languages:function(d,c){c.languages=[];this.readChildNodes(d,c.languages)},Default:function(e,d){var f={isDefault:!0};this.readChildNodes(e,f);d.push(f)},Supported:function(e,d){var f={};this.readChildNodes(e,f);d.push(f)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var b=OpenLayers.Control.prototype.activate.apply(this,arguments);b&&(this.map.events.on({moveend:this.updateContainerCenter,scope:this}),this.updateContainerCenter());return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.apply(this,arguments);this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerCenter,scope:this});return b},updateContainerCenter:function(){var b=this.map.layerContainerDiv;this.containerCenter={x:parseInt(b.style.left,10)+50,y:parseInt(b.style.top,10)+50}},pinchStart:function(b){this.currentCenter=this.pinchOrigin=b.xy},pinchMove:function(j,h){var o=h.scale,n=this.containerCenter,m=this.pinchOrigin,l=j.xy,k=Math.round(l.x-m.x+(o-1)*(n.x-m.x)),n=Math.round(l.y-m.y+(o-1)*(n.y-m.y));this.applyTransform("translate("+k+"px, "+n+"px) scale("+o+")");this.currentCenter=l},applyTransform:function(d){var c=this.map.layerContainerDiv.style;c["-webkit-transform"]=d;c["-moz-transform"]=d},pinchDone:function(g,f,k){this.applyTransform("");g=this.map.getZoomForResolution(this.map.getResolution()/k.scale,!0);if(g!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var f=this.map.getResolutionForZoom(g),k=this.map.getLonLatFromPixel(this.pinchOrigin),j=this.currentCenter,h=this.map.getSize();k.lon+=f*(h.w/2-j.x);k.lat-=f*(h.h/2-j.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(k,g)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom);OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var d={click:this.defaultClick,dblclick:this.defaultDblClick},c=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,d,c);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(b){b.lastTouches&&2==b.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(b){this.map.setCenter(this.map.getLonLatFromViewPortPx(b.xy),this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(b){OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var d=0,c=this.rules.length;d<c;d++){this.rules[d].destroy()}delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var d=0,f=this.rules.length;d<f;++d){e.rules.push(this.rules[d].clone())}}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(d,c){OpenLayers.Format.GML.prototype.initialize.apply(this,[d]);this.layer=c;this.layer.featureNS&&(this.featureNS=this.layer.featureNS);this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column);this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(e){var d=this.createElementNS(this.wfsns,"wfs:Transaction");d.setAttribute("version","1.0.0");d.setAttribute("service","WFS");for(var f=0;f<e.length;f++){switch(e[f].state){case OpenLayers.State.INSERT:d.appendChild(this.insert(e[f]));break;case OpenLayers.State.UPDATE:d.appendChild(this.update(e[f]));break;case OpenLayers.State.DELETE:d.appendChild(this.remove(e[f]))}}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(g){var f=this.buildGeometryNode(g.geometry),k=this.createElementNS(this.featureNS,"feature:"+this.geometryName);k.appendChild(f);f=this.createElementNS(this.featureNS,"feature:"+this.featureName);f.appendChild(k);for(var j in g.attributes){var k=this.createTextNode(g.attributes[j]),h=j;-1!=j.search(":")&&(h=j.split(":")[1]);h=this.createElementNS(this.featureNS,"feature:"+h);h.appendChild(k);f.appendChild(h)}return f},insert:function(d){var c=this.createElementNS(this.wfsns,"wfs:Insert");c.appendChild(this.createFeatureXML(d));return c},update:function(h){h.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var g=this.createElementNS(this.wfsns,"wfs:Update");g.setAttribute("typeName",this.featurePrefix+":"+this.featureName);g.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var m=this.createElementNS(this.wfsns,"wfs:Property"),l=this.createElementNS(this.wfsns,"wfs:Name"),k=this.createTextNode(this.geometryName);l.appendChild(k);m.appendChild(l);l=this.createElementNS(this.wfsns,"wfs:Value");k=this.buildGeometryNode(h.geometry);h.layer&&k.setAttribute("srsName",h.layer.projection.getCode());l.appendChild(k);m.appendChild(l);g.appendChild(m);for(var j in h.attributes){m=this.createElementNS(this.wfsns,"wfs:Property"),l=this.createElementNS(this.wfsns,"wfs:Name"),l.appendChild(this.createTextNode(j)),m.appendChild(l),l=this.createElementNS(this.wfsns,"wfs:Value"),l.appendChild(this.createTextNode(h.attributes[j])),m.appendChild(l),g.appendChild(m)}m=this.createElementNS(this.ogcns,"ogc:Filter");j=this.createElementNS(this.ogcns,"ogc:FeatureId");j.setAttribute("fid",h.fid);m.appendChild(j);g.appendChild(m);return g},remove:function(f){if(!f.fid){return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1}var e=this.createElementNS(this.wfsns,"wfs:Delete");e.setAttribute("typeName",this.featurePrefix+":"+this.featureName);e.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=this.createElementNS(this.ogcns,"ogc:Filter"),g=this.createElementNS(this.ogcns,"ogc:FeatureId");g.setAttribute("fid",f.fid);h.appendChild(g);e.appendChild(h);return e},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(e,d){var f=this.readers.ogc._expression.call(this,e);f&&(d.priority=f)},VendorOption:function(d,c){c.vendorOptions||(c.vendorOptions={});c.vendorOptions[d.getAttribute("name")]=this.getChildValue(d)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(b){return this.writers.sld._OGCExpression.call(this,"sld:Priority",b)},VendorOption:function(b){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:b.name},value:b.value})},TextSymbolizer:function(d){var c=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);!1!==d.graphic&&(d.externalGraphic||d.graphicName)&&this.writeNode("Graphic",d,c);"priority" in d&&this.writeNode("Priority",d.priority,c);return this.addVendorOptions(c,d)},PointSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments),b)},LineSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments),b)},PolygonSymbolizer:function(b){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments),b)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(e,d){if(d.vendorOptions){for(var f in d.vendorOptions){this.writeNode("VendorOption",{name:f,value:d.vendorOptions[f]},e)}}return e},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(e){var d=this.map.getLayerPxFromLonLat({lon:e.bounds.left,lat:e.bounds.top}),f=this.map.getLayerPxFromLonLat({lon:e.bounds.right,lat:e.bounds.bottom});null==f||null==d?e.display(!1):(d=e.draw(d,{w:Math.max(1,f.x-d.x),h:Math.max(1,f.y-d.y)}),e.drawn||(this.div.appendChild(d),e.drawn=!0))},removeMarker:function(b){OpenLayers.Util.removeItem(this.markers,b);null!=b.div&&b.div.parentNode==this.div&&this.div.removeChild(b.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(d,c){c.service={};this.readChildNodes(d,c.service)},Fees:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.fees=f)},AccessConstraints:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.accessConstraints=f)},OnlineResource:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.onlineResource=f)},Keywords:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.keywords=f.split(", "))},Capability:function(d,c){c.capability={};this.readChildNodes(d,c.capability)},Request:function(d,c){c.request={};this.readChildNodes(d,c.request)},GetFeature:function(d,c){c.getfeature={href:{},formats:[]};this.readChildNodes(d,c.getfeature)},ResultFormat:function(g,f){for(var k=g.childNodes,j,h=0;h<k.length;h++){j=k[h],1==j.nodeType&&f.formats.push(j.nodeName)}},DCPType:function(d,c){this.readChildNodes(d,c)},HTTP:function(d,c){this.readChildNodes(d,c.href)},Get:function(d,c){c.get=d.getAttribute("onlineResource")},Post:function(d,c){c.post=d.getAttribute("onlineResource")},SRS:function(e,d){var f=this.getChildValue(e);f&&(d.srs=f)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var d=e;e&&9==e.nodeType&&(e=e.documentElement);var f={};this.readNode(e,f);void 0===f.service&&(e=new OpenLayers.Format.OGCExceptionReport,f.error=e.read(d));return f},readers:{wms:{Service:function(d,c){c.service={};this.readChildNodes(d,c.service)},Name:function(d,c){c.name=this.getChildValue(d)},Title:function(d,c){c.title=this.getChildValue(d)},Abstract:function(d,c){c["abstract"]=this.getChildValue(d)},BoundingBox:function(d){var c={};c.bbox=[parseFloat(d.getAttribute("minx")),parseFloat(d.getAttribute("miny")),parseFloat(d.getAttribute("maxx")),parseFloat(d.getAttribute("maxy"))];d={x:parseFloat(d.getAttribute("resx")),y:parseFloat(d.getAttribute("resy"))};if(!isNaN(d.x)||!isNaN(d.y)){c.res=d}return c},OnlineResource:function(d,c){c.href=this.getAttributeNS(d,this.namespaces.xlink,"href")},ContactInformation:function(d,c){c.contactInformation={};this.readChildNodes(d,c.contactInformation)},ContactPersonPrimary:function(d,c){c.personPrimary={};this.readChildNodes(d,c.personPrimary)},ContactPerson:function(d,c){c.person=this.getChildValue(d)},ContactOrganization:function(d,c){c.organization=this.getChildValue(d)},ContactPosition:function(d,c){c.position=this.getChildValue(d)},ContactAddress:function(d,c){c.contactAddress={};this.readChildNodes(d,c.contactAddress)},AddressType:function(d,c){c.type=this.getChildValue(d)},Address:function(d,c){c.address=this.getChildValue(d)},City:function(d,c){c.city=this.getChildValue(d)},StateOrProvince:function(d,c){c.stateOrProvince=this.getChildValue(d)},PostCode:function(d,c){c.postcode=this.getChildValue(d)},Country:function(d,c){c.country=this.getChildValue(d)},ContactVoiceTelephone:function(d,c){c.phone=this.getChildValue(d)},ContactFacsimileTelephone:function(d,c){c.fax=this.getChildValue(d)},ContactElectronicMailAddress:function(d,c){c.email=this.getChildValue(d)},Fees:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.fees=f)},AccessConstraints:function(e,d){var f=this.getChildValue(e);f&&"none"!=f.toLowerCase()&&(d.accessConstraints=f)},Capability:function(d,c){c.capability={nestedLayers:[],layers:[]};this.readChildNodes(d,c.capability)},Request:function(d,c){c.request={};this.readChildNodes(d,c.request)},GetCapabilities:function(d,c){c.getcapabilities={formats:[]};this.readChildNodes(d,c.getcapabilities)},Format:function(d,c){OpenLayers.Util.isArray(c.formats)?c.formats.push(this.getChildValue(d)):c.format=this.getChildValue(d)},DCPType:function(d,c){this.readChildNodes(d,c)},HTTP:function(d,c){this.readChildNodes(d,c)},Get:function(d,c){c.get={};this.readChildNodes(d,c.get);c.href||(c.href=c.get.href)},Post:function(d,c){c.post={};this.readChildNodes(d,c.post);c.href||(c.href=c.get.href)},GetMap:function(d,c){c.getmap={formats:[]};this.readChildNodes(d,c.getmap)},GetFeatureInfo:function(d,c){c.getfeatureinfo={formats:[]};this.readChildNodes(d,c.getfeatureinfo)},Exception:function(d,c){c.exception={formats:[]};this.readChildNodes(d,c.exception)},Layer:function(x,w){var v,u;w.capability?(u=w.capability,v=w):u=w;var t=x.getAttributeNode("queryable"),s=t&&t.specified?x.getAttribute("queryable"):null,r=(t=x.getAttributeNode("cascaded"))&&t.specified?x.getAttribute("cascaded"):null,t=(t=x.getAttributeNode("opaque"))&&t.specified?x.getAttribute("opaque"):null,q=x.getAttribute("noSubsets"),p=x.getAttribute("fixedWidth"),o=x.getAttribute("fixedHeight"),n=v||{},m=OpenLayers.Util.extend;v={nestedLayers:[],styles:v?[].concat(v.styles):[],srs:v?m({},n.srs):{},metadataURLs:[],bbox:v?m({},n.bbox):{},llbbox:n.llbbox,dimensions:v?m({},n.dimensions):{},authorityURLs:v?m({},n.authorityURLs):{},identifiers:{},keywords:[],queryable:s&&""!==s?"1"===s||"true"===s:n.queryable||!1,cascaded:null!==r?parseInt(r):n.cascaded||0,opaque:t?"1"===t||"true"===t:n.opaque||!1,noSubsets:null!==q?"1"===q||"true"===q:n.noSubsets||!1,fixedWidth:null!=p?parseInt(p):n.fixedWidth||0,fixedHeight:null!=o?parseInt(o):n.fixedHeight||0,minScale:n.minScale,maxScale:n.maxScale,attribution:n.attribution};w.nestedLayers.push(v);v.capability=u;this.readChildNodes(x,v);delete v.capability;if(v.name&&(s=v.name.split(":"),r=u.request,t=r.getfeatureinfo,0<s.length&&(v.prefix=s[0]),u.layers.push(v),void 0===v.formats&&(v.formats=r.getmap.formats),void 0===v.infoFormats&&t)){v.infoFormats=t.formats}},Attribution:function(d,c){c.attribution={};this.readChildNodes(d,c.attribution)},LogoURL:function(d,c){c.logo={width:d.getAttribute("width"),height:d.getAttribute("height")};this.readChildNodes(d,c.logo)},Style:function(e,d){var f={};d.styles.push(f);this.readChildNodes(e,f)},LegendURL:function(e,d){var f={width:e.getAttribute("width"),height:e.getAttribute("height")};d.legend=f;this.readChildNodes(e,f)},MetadataURL:function(e,d){var f={type:e.getAttribute("type")};d.metadataURLs.push(f);this.readChildNodes(e,f)},DataURL:function(d,c){c.dataURL={};this.readChildNodes(d,c.dataURL)},FeatureListURL:function(d,c){c.featureListURL={};this.readChildNodes(d,c.featureListURL)},AuthorityURL:function(f,e){var h=f.getAttribute("name"),g={};this.readChildNodes(f,g);e.authorityURLs[h]=g.href},Identifier:function(e,d){var f=e.getAttribute("authority");d.identifiers[f]=this.getChildValue(e)},KeywordList:function(d,c){this.readChildNodes(d,c)},SRS:function(d,c){c.srs[this.getChildValue(d)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(d,c){this.readChildNodes(d,c)},LayerLimit:function(d,c){c.layerLimit=parseInt(this.getChildValue(d))},MaxWidth:function(d,c){c.maxWidth=parseInt(this.getChildValue(d))},MaxHeight:function(d,c){c.maxHeight=parseInt(this.getChildValue(d))},BoundingBox:function(e,d){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,d]);f.srs=e.getAttribute("CRS");d.bbox[f.srs]=f},CRS:function(d,c){this.readers.wms.SRS.apply(this,[d,c])},EX_GeographicBoundingBox:function(d,c){c.llbbox=[];this.readChildNodes(d,c.llbbox)},westBoundLongitude:function(d,c){c[0]=this.getChildValue(d)},eastBoundLongitude:function(d,c){c[2]=this.getChildValue(d)},southBoundLatitude:function(d,c){c[1]=this.getChildValue(d)},northBoundLatitude:function(d,c){c[3]=this.getChildValue(d)},MinScaleDenominator:function(d,c){c.maxScale=parseFloat(this.getChildValue(d)).toPrecision(16)},MaxScaleDenominator:function(d,c){c.minScale=parseFloat(this.getChildValue(d)).toPrecision(16)},Dimension:function(e,d){var f={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};d.dimensions[f.name]=f},Keyword:function(e,d){var f={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};d.keywords&&d.keywords.push(f)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(d,c){this.readers.wms.UserDefinedSymbolization.apply(this,[d,c]);c.userSymbols.inlineFeature=1==parseInt(d.getAttribute("InlineFeature"));c.userSymbols.remoteWCS=1==parseInt(d.getAttribute("RemoteWCS"))},DescribeLayer:function(d,c){this.readers.wms.DescribeLayer.apply(this,[d,c])},GetLegendGraphic:function(d,c){this.readers.wms.GetLegendGraphic.apply(this,[d,c])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(f,e,h,g){this.initializeZoomify(h);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[f,e,h,{},g])},initializeZoomify:function(d){var d=d.clone(),c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles=[c];for(this.tierImageSize=[d];d.w>this.standardTileSize||d.h>this.standardTileSize;){d=new OpenLayers.Size(Math.floor(d.w/2),Math.floor(d.h/2)),c=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize)),this.tierSizeInTiles.push(c),this.tierImageSize.push(d)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;this.tileCountUpToTier=[0];for(d=1;d<this.numberOfTiers;d++){this.tileCountUpToTier.push(this.tierSizeInTiles[d-1].w*this.tierSizeInTiles[d-1].h+this.tileCountUpToTier[d-1])}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(b){null==b&&(b=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(e){var e=this.adjustBounds(e),d=this.map.getResolution(),f=Math.round((e.left-this.tileOrigin.lon)/(d*this.tileSize.w)),e=Math.round((this.tileOrigin.lat-e.top)/(d*this.tileSize.h)),d=this.map.getZoom(),f="TileGroup"+Math.floor((f+e*this.tierSizeInTiles[d].w+this.tileCountUpToTier[d])/256)+"/"+d+"-"+f+"-"+e+".jpg",e=this.url;OpenLayers.Util.isArray(e)&&(e=this.selectUrl(f,e));return e+f},getImageSize:function(){if(0<arguments.length){var g=this.adjustBounds(arguments[0]),f=this.map.getResolution(),k=Math.round((g.left-this.tileOrigin.lon)/(f*this.tileSize.w)),g=Math.round((this.tileOrigin.lat-g.top)/(f*this.tileSize.h)),f=this.map.getZoom(),j=this.standardTileSize,h=this.standardTileSize;k==this.tierSizeInTiles[f].w-1&&(j=this.tierImageSize[f].w%this.standardTileSize);g==this.tierSizeInTiles[f].h-1&&(h=this.tierImageSize[f].h%this.standardTileSize);return new OpenLayers.Size(j,h)}return this.tileSize},setMap:function(b){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(j,h,o){var n=o*this.tileSize.w,o=o*this.tileSize.h,m=j.left-h.lon,l=Math.floor(m/n)-this.buffer,j=h.lat-j.top+o,k=Math.floor(j/o)-this.buffer;return{tilelon:n,tilelat:o,tileoffsetlon:h.lon+l*n,tileoffsetlat:h.lat-o*k,tileoffsetx:-(m/n-l)*this.tileSize.w,tileoffsety:(k-j/o)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(f,e,h,g){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(null==g||null==g.isBaseLayer){this.isBaseLayer="true"!=this.params.transparent&&!0!=this.params.transparent}},clone:function(b){null==b&&(b=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getURL:function(d){var d=this.adjustBounds(d),d=[d.left,d.bottom,d.right,d.top],c=this.getImageSize();return this.getFullRequestString({mapext:d,imgext:d,map_size:[c.w,c.h],imgx:c.w/2,imgy:c.h/2,imgxy:[c.w,c.h]})},getFullRequestString:function(h,g){var m=null==g?this.url:g,l=OpenLayers.Util.extend({},this.params),l=OpenLayers.Util.extend(l,h),k=OpenLayers.Util.getParameterString(l);OpenLayers.Util.isArray(m)&&(m=this.selectUrl(k,m));var k=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(m)),j;for(j in l){j.toUpperCase() in k&&delete l[j]}k=OpenLayers.Util.getParameterString(l);l=m;k=k.replace(/,/g,"+");""!=k&&(j=m.charAt(m.length-1),l="&"==j||"?"==j?l+k:-1==m.indexOf("?")?l+("?"+k):l+("&"+k));return l},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(g){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var f=document.createStyleSheet(),k="shape rect oval fill stroke imagedata group textbox".split(" "),j=0,h=k.length;j<h;j++){f.addRule("olv\\:"+k[j],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return !!document.namespaces},setExtent:function(j,h){var o=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),m=j.left/n|0,n=j.top/n-this.size.h|0;h||!this.offset?(this.offset={x:m,y:n},n=m=0):(m-=this.offset.x,n-=this.offset.y);this.root.coordorigin=m-this.xOffset+" "+n;for(var m=[this.root,this.vectorRoot,this.textRoot],l=0,k=m.length;l<k;++l){n=m[l],n.coordsize=this.size.w+" "+this.size.h}this.root.style.flip="y";return o},setSize:function(j){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var h=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],o=this.size.w+"px",n=this.size.h+"px",m,l=0,k=h.length;l<k;++l){m=h[l],m.style.width=o,m.style.height=n}},getNodeType:function(e,d){var f=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":f=d.externalGraphic?"olv:rect":this.isComplexSymbol(d.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":f="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":f="olv:shape"}return f},setStyle:function(r,q,p,o){var q=q||r._style,p=p||r._options,n=q.fillColor;if("OpenLayers.Geometry.Point"===r._geometryClass){if(q.externalGraphic){p.isFilled=!0;q.graphicTitle&&(r.title=q.graphicTitle);var n=q.graphicWidth||q.graphicHeight,m=q.graphicHeight||q.graphicWidth,n=n?n:2*q.pointRadius,m=m?m:2*q.pointRadius,l=this.getResolution(),k=void 0!=q.graphicXOffset?q.graphicXOffset:-(0.5*n),j=void 0!=q.graphicYOffset?q.graphicYOffset:-(0.5*m);r.style.left=((o.x-this.featureDx)/l-this.offset.x+k|0)+"px";r.style.top=(o.y/l-this.offset.y-(j+m)|0)+"px";r.style.width=n+"px";r.style.height=m+"px";r.style.flip="y";n="none";p.isStroked=!1}else{this.isComplexSymbol(q.graphicName)?(m=this.importSymbol(q.graphicName),r.path=m.path,r.coordorigin=m.left+","+m.bottom,m=m.size,r.coordsize=m+","+m,this.drawCircle(r,o,q.pointRadius),r.style.flip="y"):this.drawCircle(r,o,q.pointRadius)}}p.isFilled?r.fillcolor=n:r.filled="false";o=r.getElementsByTagName("fill");o=0==o.length?null:o[0];if(p.isFilled){o||(o=this.createNode("olv:fill",r.id+"_fill"));o.opacity=q.fillOpacity;if("OpenLayers.Geometry.Point"===r._geometryClass&&q.externalGraphic&&(q.graphicOpacity&&(o.opacity=q.graphicOpacity),o.src=q.externalGraphic,o.type="frame",!q.graphicWidth||!q.graphicHeight)){o.aspect="atmost"}o.parentNode!=r&&r.appendChild(o)}else{o&&r.removeChild(o)}n=q.rotation;if(void 0!==n||void 0!==r._rotation){r._rotation=n,q.externalGraphic?(this.graphicRotate(r,k,j,q),o.opacity=0):"OpenLayers.Geometry.Point"===r._geometryClass&&(r.style.rotation=n||0)}k=r.getElementsByTagName("stroke");k=0==k.length?null:k[0];if(p.isStroked){if(k||(k=this.createNode("olv:stroke",r.id+"_stroke"),r.appendChild(k)),k.on=!0,k.color=q.strokeColor,k.weight=q.strokeWidth+"px",k.opacity=q.strokeOpacity,k.endcap="butt"==q.strokeLinecap?"flat":q.strokeLinecap||"round",q.strokeDashstyle){k.dashstyle=this.dashStyle(q)}}else{r.stroked=!1,k&&(k.on=!1)}"inherit"!=q.cursor&&null!=q.cursor&&(r.style.cursor=q.cursor);return r},graphicRotate:function(v,u,t,s){var s=s||v._style,r=s.rotation||0,q,p;if(!s.graphicWidth||!s.graphicHeight){var o=new Image;o.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==o.readyState||"interactive"==o.readyState){q=o.width/o.height,p=Math.max(2*s.pointRadius,s.graphicWidth||0,s.graphicHeight||0),u*=q,s.graphicWidth=p*q,s.graphicHeight=p,this.graphicRotate(v,u,t,s)}},this);o.src=s.externalGraphic}else{p=Math.max(s.graphicWidth,s.graphicHeight);q=s.graphicWidth/s.graphicHeight;var n=Math.round(s.graphicWidth||p*q),m=Math.round(s.graphicHeight||p);v.style.width=n+"px";v.style.height=m+"px";var l=document.getElementById(v.id+"_image");l||(l=this.createNode("olv:imagedata",v.id+"_image"),v.appendChild(l));l.style.width=n+"px";l.style.height=m+"px";l.src=s.externalGraphic;l.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";l=r*Math.PI/180;r=Math.sin(l);l=Math.cos(l);r="progid:DXImageTransform.Microsoft.Matrix(M11="+l+",M12="+-r+",M21="+r+",M22="+l+",SizingMethod='auto expand')\n";(l=s.graphicOpacity||s.fillOpacity)&&1!=l&&(r+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+l+")\n");v.style.filter=r;r=new OpenLayers.Geometry.Point(-u,-t);n=(new OpenLayers.Bounds(0,0,n,m)).toGeometry();n.rotate(s.rotation,r);n=n.getBounds();v.style.left=Math.round(parseInt(v.style.left)+n.left)+"px";v.style.top=Math.round(parseInt(v.style.top)-n.bottom)+"px"}},postDraw:function(e){e.style.visibility="visible";var d=e._style.fillColor,f=e._style.strokeColor;"none"==d&&e.fillcolor!=d&&(e.fillcolor=d);"none"==f&&e.strokecolor!=f&&(e.strokecolor=f)},setNodeDimension:function(f,e){var h=e.getBounds();if(h){var g=this.getResolution(),h=new OpenLayers.Bounds((h.left-this.featureDx)/g-this.offset.x|0,h.bottom/g-this.offset.y|0,(h.right-this.featureDx)/g-this.offset.x|0,h.top/g-this.offset.y|0);f.style.left=h.left+"px";f.style.top=h.top+"px";f.style.width=h.getWidth()+"px";f.style.height=h.getHeight()+"px";f.coordorigin=h.left+" "+h.top;f.coordsize=h.getWidth()+" "+h.getHeight()}},dashStyle:function(b){b=b.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:return b=b.split(/[ ,]/),2==b.length?1*b[0]>=2*b[1]?"longdash":1==b[0]||1==b[1]?"dot":"dash":4==b.length?1*b[0]>=2*b[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,d){var f=document.createElement(e);d&&(f.id=d);f.unselectable="on";f.onselectstart=OpenLayers.Function.False;return f},nodeTypeCompare:function(g,f){var k=f,j=k.indexOf(":");-1!=j&&(k=k.substr(j+1));var h=g.nodeName,j=h.indexOf(":");-1!=j&&(h=h.substr(j+1));return k==h},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(b){return this.nodeFactory(this.container.id+b,"olv:group")},drawPoint:function(d,c){return this.drawCircle(d,c,1)},drawCircle:function(f,e,h){if(!isNaN(e.x)&&!isNaN(e.y)){var g=this.getResolution();f.style.left=((e.x-this.featureDx)/g-this.offset.x|0)-h+"px";f.style.top=(e.y/g-this.offset.y|0)-h+"px";e=2*h;f.style.width=e+"px";f.style.height=e+"px";return f}return !1},drawLineString:function(d,c){return this.drawLine(d,c,!1)},drawLinearRing:function(d,c){return this.drawLine(d,c,!0)},drawLine:function(r,q,p){this.setNodeDimension(r,q);for(var o=this.getResolution(),n=q.components.length,m=Array(n),l,k,j=0;j<n;j++){l=q.components[j],k=(l.x-this.featureDx)/o-this.offset.x|0,l=l.y/o-this.offset.y|0,m[j]=" "+k+","+l+" l "}r.path="m"+m.join("")+(p?" x e":" e");return r},drawPolygon:function(B,A){this.setNodeDimension(B,A);var z=this.getResolution(),y=[],x,w,v,u,t,s,r,q,p,o;x=0;for(w=A.components.length;x<w;x++){y.push("m");v=A.components[x].components;u=0===x;s=t=null;r=0;for(q=v.length;r<q;r++){p=v[r],o=(p.x-this.featureDx)/z-this.offset.x|0,p=p.y/z-this.offset.y|0,o=" "+o+","+p,y.push(o),0==r&&y.push(" l"),u||(t?t!=o&&(s?s!=o&&(u=!0):s=o):t=o)}y.push(u?" x ":" ")}y.push("e");B.path=y.join("");return B},drawRectangle:function(e,d){var f=this.getResolution();e.style.left=((d.x-this.featureDx)/f-this.offset.x|0)+"px";e.style.top=(d.y/f-this.offset.y|0)+"px";e.style.width=(d.width/f|0)+"px";e.style.height=(d.height/f|0)+"px";return e},drawText:function(h,g,m){var l=this.nodeFactory(h+this.LABEL_ID_SUFFIX,"olv:rect"),k=this.nodeFactory(h+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),j=this.getResolution();l.style.left=((m.x-this.featureDx)/j-this.offset.x|0)+"px";l.style.top=(m.y/j-this.offset.y|0)+"px";l.style.flip="y";k.innerText=g.label;"inherit"!=g.cursor&&null!=g.cursor&&(k.style.cursor=g.cursor);g.fontColor&&(k.style.color=g.fontColor);g.fontOpacity&&(k.style.filter="alpha(opacity="+100*g.fontOpacity+")");g.fontFamily&&(k.style.fontFamily=g.fontFamily);g.fontSize&&(k.style.fontSize=g.fontSize);g.fontWeight&&(k.style.fontWeight=g.fontWeight);g.fontStyle&&(k.style.fontStyle=g.fontStyle);!0===g.labelSelect&&(l._featureId=h,k._featureId=h,k._geometry=m,k._geometryClass=m.CLASS_NAME);k.style.whiteSpace="nowrap";k.inset="1px,0px,0px,0px";l.parentNode||(l.appendChild(k),this.textRoot.appendChild(l));g=g.labelAlign||"cm";1==g.length&&(g+="m");h=k.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)];k=k.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];l.style.left=parseInt(l.style.left)-h-1+"px";l.style.top=parseInt(l.style.top)+k+"px"},moveRoot:function(d){var c=this.map.getLayer(d.container.id);c instanceof OpenLayers.Layer.Vector.RootContainer&&(c=this.map.getLayer(this.container.id));c&&c.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);c&&c.redraw()},importSymbol:function(j){var h=this.container.id+"-"+j,o=this.symbolCache[h];if(o){return o}o=OpenLayers.Renderer.symbol[j];if(!o){throw Error(j+" is not a valid symbol name")}for(var j=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),n=["m"],m=0;m<o.length;m+=2){var l=o[m],k=o[m+1];j.left=Math.min(j.left,l);j.bottom=Math.min(j.bottom,k);j.right=Math.max(j.right,l);j.top=Math.max(j.top,k);n.push(l);n.push(k);0==m&&n.push("l")}n.push("x e");o=n.join(" ");n=(j.getWidth()-j.getHeight())/2;0<n?(j.bottom-=n,j.top+=n):(j.left+=n,j.right-=n);o={path:o,size:j.getWidth(),left:j.left,bottom:j.bottom};return this.symbolCache[h]=o},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);var d,f=this.layers||e.layers;for(d=f.length-1;0<=d;--d){this.addLayer({layer:f[d]})}if(!this.layers){e.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(b){b.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(b){b.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(e){if(this.active&&window.localStorage&&e.tile instanceof OpenLayers.Tile.Image){var d=e.tile,f=d.url;!d.layer.crossOriginKeyword&&(OpenLayers.ProxyHost&&0===f.indexOf(OpenLayers.ProxyHost))&&(f=OpenLayers.Control.CacheWrite.urlMap[f]);if(f=window.localStorage.getItem("olCache_"+f)){d.url=f,"tileerror"===e.type&&d.setImgSrc(f)}}},destroy:function(){if(this.layers||this.map){var d,c=this.layers||this.map.layers;for(d=c.length-1;0<=d;--d){this.removeLayer({layer:c[d]})}}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var d=e.documentElement;if(d){var f=this["read_"+d.nodeName],e=f?f.call(this,d):(new OpenLayers.Format.GML(this.options?this.options:{})).read(e)}return e},read_msGMLOutput:function(r){var q=[];if(r=this.getSiblingNodesByTagCriteria(r,this.layerIdentifier)){for(var p=0,o=r.length;p<o;++p){var n=r[p],m=n.nodeName;n.prefix&&(m=m.split(":")[1]);m=m.replace(this.layerIdentifier,"");if(n=this.getSiblingNodesByTagCriteria(n,this.featureIdentifier)){for(var l=0;l<n.length;l++){var k=n[l],j=this.parseGeometry(k),k=this.parseAttributes(k),k=new OpenLayers.Feature.Vector(j.geometry,k,null);k.bounds=j.bounds;k.type=m;q.push(k)}}}}return q},read_FeatureInfoResponse:function(r){for(var q=[],r=this.getElementsByTagNameNS(r,"*","FIELDS"),p=0,o=r.length;p<o;p++){var n=r[p],m={},l,k=n.attributes.length;if(0<k){for(l=0;l<k;l++){var j=n.attributes[l];m[j.nodeName]=j.nodeValue}}else{n=n.childNodes;l=0;for(k=n.length;l<k;++l){j=n[l],3!=j.nodeType&&(m[j.getAttribute("name")]=j.getAttribute("value"))}}q.push(new OpenLayers.Feature.Vector(null,m,null))}return q},getSiblingNodesByTagCriteria:function(k,j){var q=[],p,o,n,m;if(k&&k.hasChildNodes()){p=k.childNodes;n=p.length;for(var l=0;l<n;l++){for(m=p[l];m&&1!=m.nodeType;){m=m.nextSibling,l++}o=m?m.nodeName:"";0<o.length&&-1<o.indexOf(j)?q.push(m):(o=this.getSiblingNodesByTagCriteria(m,j),0<o.length&&(0==q.length?q=o:q.push(o)))}}return q},parseAttributes:function(h){var g={};if(1==h.nodeType){for(var h=h.childNodes,m=h.length,l=0;l<m;++l){var k=h[l];if(1==k.nodeType){var j=k.childNodes,k=k.prefix?k.nodeName.split(":")[1]:k.nodeName;if(0==j.length){g[k]=null}else{if(1==j.length&&(j=j[0],3==j.nodeType||4==j.nodeType)){j=j.nodeValue.replace(this.regExes.trimSpace,""),g[k]=j}}}}}return g},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var e=this.gmlFormat.parseFeature(e),d,f=null;e&&(d=e.geometry&&e.geometry.clone(),f=e.bounds&&e.bounds.clone(),e.destroy());return{geometry:d,bounds:f}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.request(b.xy,{})},getInfoForHover:function(b){this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var f=this.layers||this.map.layers,e=[],h,g=f.length-1;0<=g;--g){if(h=f[g],h instanceof OpenLayers.Layer.WMTS&&h.requestEncoding===this.requestEncoding&&(!this.queryVisible||h.getVisibility())){if(e.push(h),!this.drillDown||this.hover){break}}}return e},buildRequestOptions:function(f,e){var h=this.map.getLonLatFromPixel(e),g=f.getURL(new OpenLayers.Bounds(h.lon,h.lat,h.lon,h.lat)),g=OpenLayers.Util.getParameters(g),h=f.getTileInfo(h);OpenLayers.Util.extend(g,{service:"WMTS",version:f.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:h.i,j:h.j});OpenLayers.Util.applyDefaults(g,this.vendorParams);return{url:OpenLayers.Util.isArray(f.url)?f.url[0]:f.url,params:OpenLayers.Util.upperCaseObject(g),callback:function(a){this.handleResponse(e,a,f)},scope:this}},request:function(j,h){var h=h||{},o=this.findLayers();if(0<o.length){for(var n,m,l=0,k=o.length;l<k;l++){m=o[l],n=this.events.triggerEvent("beforegetfeatureinfo",{xy:j,layer:m}),!1!==n&&(++this.pending,n=this.buildRequestOptions(m,j),n=OpenLayers.Request.GET(n),!0===h.hover&&(this.hoverRequest=n))}0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(j,h,o){--this.pending;0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0);if(h.status&&(200>h.status||300<=h.status)){this.events.triggerEvent("exception",{xy:j,request:h,layer:o})}else{var n=h.responseXML;if(!n||!n.documentElement){n=h.responseText}var m,l;try{m=this.format.read(n)}catch(k){l=!0,this.events.triggerEvent("exception",{xy:j,request:h,error:k,layer:o})}l||this.events.triggerEvent("getfeatureinfo",{text:h.responseText,features:m,request:h,xy:j,layer:o})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);b&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this}));return b},cacheFeatures:function(b){this.paging||(this.clearCache(),this.features=b.features,this.pageNext(b))},clearCache:function(){if(this.features){for(var b=0;b<this.features.length;++b){this.features[b].destroy()}}this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(b){b&&0<b&&(this.length=b);return this.length},pageNext:function(d){var c=!1;this.features&&(null===this.num&&(this.num=-1),c=this.page((this.num+1)*this.length,d));return c},pagePrevious:function(){var b=!1;this.features&&(null===this.num&&(this.num=this.pageCount()),b=this.page((this.num-1)*this.length));return b},page:function(f,e){var h=!1;if(this.features&&0<=f&&f<this.features.length){var g=Math.floor(f/this.length);g!=this.num&&(this.paging=!0,h=this.features.slice(f,f+this.length),this.layer.removeFeatures(this.layer.features),this.num=g,e&&e.features?e.features=h:this.layer.addFeatures(h),this.paging=!1,h=!0)}return h},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format.write(e.params);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),params:e.params,headers:e.headers,data:f});return d},handleRead:function(e,d){if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(e.data=this.parseData(f),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseData:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(d,c){this.readChildNodes(d,c)},Keyword:function(d,c){c.keywords&&c.keywords.push(this.getChildValue(d))},DescribeLayer:function(d,c){c.describelayer={formats:[]};this.readChildNodes(d,c.describelayer)},GetLegendGraphic:function(d,c){c.getlegendgraphic={formats:[]};this.readChildNodes(d,c.getlegendgraphic)},GetStyles:function(d,c){c.getstyles={formats:[]};this.readChildNodes(d,c.getstyles)},PutStyles:function(d,c){c.putstyles={formats:[]};this.readChildNodes(d,c.putstyles)},UserDefinedSymbolization:function(e,d){var f={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};d.userSymbols=f},LatLonBoundingBox:function(d,c){c.llbbox=[parseFloat(d.getAttribute("minx")),parseFloat(d.getAttribute("miny")),parseFloat(d.getAttribute("maxx")),parseFloat(d.getAttribute("maxy"))]},BoundingBox:function(e,d){var f=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,d]);f.srs=e.getAttribute("SRS");d.bbox[f.srs]=f},ScaleHint:function(h,g){var m=h.getAttribute("min"),l=h.getAttribute("max"),k=Math.pow(2,0.5),j=OpenLayers.INCHES_PER_UNIT.m;g.maxScale=parseFloat((m/k*j*OpenLayers.DOTS_PER_INCH).toPrecision(13));g.minScale=parseFloat((l/k*j*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(e,d){var f={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};d.dimensions[f.name]=f},Extent:function(f,e){var h=f.getAttribute("name").toLowerCase();if(h in e.dimensions){h=e.dimensions[h];h.nearestVal="1"===f.getAttribute("nearestValue");h.multipleVal="1"===f.getAttribute("multipleValues");h.current="1"===f.getAttribute("current");h["default"]=f.getAttribute("default")||"";var g=this.getChildValue(f);h.values=g.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(b){b=b||{};b.layerName=b.layerName||OpenLayers.i18n("Graticule");OpenLayers.Control.prototype.initialize.apply(this,[b]);this.labelSymbolizer.stroke=!1;this.labelSymbolizer.fill=!1;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var b=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":b}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var B=this.map.getExtent();if(B){this.gratLayer.destroyFeatures();var A=new OpenLayers.Projection("EPSG:4326"),z=this.map.getProjectionObject(),y=this.map.getResolution();z.proj&&"longlat"==z.proj.projName&&(this.numPoints=1);var x=this.map.getCenter(),w=new OpenLayers.Pixel(x.lon,x.lat);OpenLayers.Projection.transform(w,z,A);for(var x=this.targetSize*y,x=x*x,v,y=0;y<this.intervals.length;++y){v=this.intervals[y];var u=v/2,t=w.offset({x:-u,y:-u}),u=w.offset({x:u,y:u});OpenLayers.Projection.transform(t,A,z);OpenLayers.Projection.transform(u,A,z);if((t.x-u.x)*(t.x-u.x)+(t.y-u.y)*(t.y-u.y)<=x){break}}w.x=Math.floor(w.x/v)*v;w.y=Math.floor(w.y/v)*v;var y=0,x=[w.clone()],u=w.clone(),s;do{u=u.offset({x:0,y:v}),s=OpenLayers.Projection.transform(u.clone(),A,z),x.unshift(u)}while(B.containsPixel(s)&&1000>++y);u=w.clone();do{u=u.offset({x:0,y:-v}),s=OpenLayers.Projection.transform(u.clone(),A,z),x.push(u)}while(B.containsPixel(s)&&1000>++y);y=0;t=[w.clone()];u=w.clone();do{u=u.offset({x:-v,y:0}),s=OpenLayers.Projection.transform(u.clone(),A,z),t.unshift(u)}while(B.containsPixel(s)&&1000>++y);u=w.clone();do{u=u.offset({x:v,y:0}),s=OpenLayers.Projection.transform(u.clone(),A,z),t.push(u)}while(B.containsPixel(s)&&1000>++y);v=[];for(y=0;y<t.length;++y){s=t[y].x;for(var w=[],r=null,q=Math.min(x[0].y,90),u=Math.max(x[x.length-1].y,-90),p=(q-u)/this.numPoints,q=u,u=0;u<=this.numPoints;++u){var o=new OpenLayers.Geometry.Point(s,q);o.transform(A,z);w.push(o);q+=p;o.y>=B.bottom&&!r&&(r=o)}this.labelled&&(r=new OpenLayers.Geometry.Point(r.x,B.bottom),s={value:s,label:this.labelled?OpenLayers.Util.getFormattedLonLat(s,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(r,s)));w=new OpenLayers.Geometry.LineString(w);v.push(new OpenLayers.Feature.Vector(w))}for(u=0;u<x.length;++u){if(q=x[u].y,!(-90>q||90<q)){w=[];y=t[0].x;p=(t[t.length-1].x-y)/this.numPoints;s=y;r=null;for(y=0;y<=this.numPoints;++y){o=new OpenLayers.Geometry.Point(s,q),o.transform(A,z),w.push(o),s+=p,o.x<B.right&&(r=o)}this.labelled&&(r=new OpenLayers.Geometry.Point(B.right,r.y),s={value:q,label:this.labelled?OpenLayers.Util.getFormattedLonLat(q,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(r,s)));w=new OpenLayers.Geometry.LineString(w);v.push(new OpenLayers.Feature.Vector(w))}}this.gratLayer.addFeatures(v)}},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(b){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[b.name,b.url,{},b]);this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(b){null==b&&(b=new OpenLayers.Layer.UTFGrid(this.getOptions()));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getFeatureInfo:function(d){var c=null,d=this.getTileData(d);d.tile&&(c=d.tile.getFeatureInfo(d.i,d.j));return c},getFeatureId:function(d){var c=null,d=this.getTileData(d);d.tile&&(c=d.tile.getFeatureId(d.i,d.j));return c},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(r,q,p){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]));if(this.layerInfo){var o=this.layerInfo,n=new OpenLayers.Bounds(o.fullExtent.xmin,o.fullExtent.ymin,o.fullExtent.xmax,o.fullExtent.ymax);this.projection="EPSG:"+o.spatialReference.wkid;this.sphericalMercator=102100==o.spatialReference.wkid;this.units="esriFeet"==o.units?"ft":"m";if(o.tileInfo){this.tileSize=new OpenLayers.Size(o.tileInfo.width||o.tileInfo.cols,o.tileInfo.height||o.tileInfo.rows);this.tileOrigin=new OpenLayers.LonLat(o.tileInfo.origin.x,o.tileInfo.origin.y);var m=new OpenLayers.Geometry.Point(n.left,n.top),n=new OpenLayers.Geometry.Point(n.right,n.bottom);this.useScales?this.scales=[]:this.resolutions=[];this.lods=[];for(var l in o.tileInfo.lods){if(o.tileInfo.lods.hasOwnProperty(l)){var k=o.tileInfo.lods[l];this.useScales?this.scales.push(k.scale):this.resolutions.push(k.resolution);var j=this.getContainingTileCoords(m,k.resolution);k.startTileCol=j.x;k.startTileRow=j.y;j=this.getContainingTileCoords(n,k.resolution);k.endTileCol=j.x;k.endTileRow=j.y;this.lods.push(k)}}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);this.serverResolutions=this.resolutions;this.overrideDPI&&o.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=o.tileInfo.dpi)}}},getContainingTileCoords:function(d,c){return new OpenLayers.Pixel(Math.max(Math.floor((d.x-this.tileOrigin.lon)/(this.tileSize.w*c)),0),Math.max(Math.floor((this.tileOrigin.lat-d.y)/(this.tileSize.h*c)),0))},calculateMaxExtentWithLOD:function(e){var d=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,f=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(d,f-(e.endTileRow-e.startTileRow+1)*this.tileSize.h*e.resolution,d+(e.endTileCol-e.startTileCol+1)*this.tileSize.w*e.resolution,f)},calculateMaxExtentWithExtent:function(f,e){var h=new OpenLayers.Geometry.Point(f.left,f.top),g=new OpenLayers.Geometry.Point(f.right,f.bottom),h=this.getContainingTileCoords(h,e),g=this.getContainingTileCoords(g,e);return this.calculateMaxExtentWithLOD({resolution:e,startTileCol:h.x,startTileRow:h.y,endTileCol:g.x,endTileRow:g.y})},getUpperLeftTileCoord:function(b){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top),b)},getLowerRightTileCoord:function(b){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom),b)},getMaxExtentForResolution:function(g){var f=this.getUpperLeftTileCoord(g),k=this.getLowerRightTileCoord(g),j=this.tileOrigin.lon+f.x*this.tileSize.w*g,h=this.tileOrigin.lat-f.y*this.tileSize.h*g;return new OpenLayers.Bounds(j,h-(k.y-f.y+1)*this.tileSize.h*g,j+(k.x-f.x+1)*this.tileSize.w*g,h)},clone:function(b){null==b&&(b=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options));return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[b])},getMaxExtent:function(){return this.maxExtent=this.getMaxExtentForResolution(this.map.getResolution())},getTileOrigin:function(){var b=this.getMaxExtent();return new OpenLayers.LonLat(b.left,b.bottom)},getURL:function(g){var f=this.getResolution(),k=this.tileOrigin.lon+f*this.tileSize.w/2,j=this.tileOrigin.lat-f*this.tileSize.h/2,g=g.getCenterLonLat(),k=Math.round(Math.abs((g.lon-k)/(f*this.tileSize.w))),j=Math.round(Math.abs((j-g.lat)/(f*this.tileSize.h))),g=this.map.getZoom();if(this.lods){if(f=this.lods[this.map.getZoom()],k<f.startTileCol||k>f.endTileCol||j<f.startTileRow||j>f.endTileRow){return null}}else{var h=this.getUpperLeftTileCoord(f),f=this.getLowerRightTileCoord(f);if(k<h.x||k>=f.x||j<h.y||j>=f.y){return null}}f=this.url;h=""+k+j+g;OpenLayers.Util.isArray(f)&&(f=this.selectUrl(h,f));this.useArcGISServer?f+="/tile/${z}/${y}/${x}":(k="C"+this.zeroPad(k,8,16),j="R"+this.zeroPad(j,8,16),g="L"+this.zeroPad(g,2,16),f=f+"/${z}/${y}/${x}."+this.type);f=OpenLayers.String.format(f,{x:k,y:j,z:g});return OpenLayers.Util.urlAppend(f,OpenLayers.Util.getParameterString(this.params))},zeroPad:function(e,d,f){for(e=e.toString(f||10);e.length<d;){e="0"+e}return e},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[b]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(b.formatOptions));!0===this.drillDown&&(this.hover=!1);this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(b={},b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{}))},getInfoForClick:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(b.xy,{})},getInfoForHover:function(b){this.events.triggerEvent("beforegetfeatureinfo",{xy:b.xy});this.request(b.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var g=this.layers||this.map.layers,f=[],k,j,h=g.length-1;0<=h;--h){if(k=g[h],k instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||k.getVisibility())){j=OpenLayers.Util.isArray(k.url)?k.url[0]:k.url,!1===this.drillDown&&!this.url&&(this.url=j),(!0===this.drillDown||this.urlMatches(j))&&f.push(k)}}return f},urlMatches:function(f){var e=OpenLayers.Util.isEquivalentUrl(this.url,f);if(!e&&this.layerUrls){for(var h=0,g=this.layerUrls.length;h<g;++h){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[h],f)){e=!0;break}}}return e},buildWMSOptions:function(k,j,q,p){for(var o=[],n=[],m=0,l=j.length;m<l;m++){null!=j[m].params.LAYERS&&(o=o.concat(j[m].params.LAYERS),n=n.concat(this.getStyleNames(j[m])))}j=j[0];m=this.map.getProjection();(l=j.projection)&&l.equals(this.map.getProjectionObject())&&(m=l.getCode());p=OpenLayers.Util.extend({service:"WMS",version:j.params.VERSION,request:"GetFeatureInfo",exceptions:j.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,j.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:p,info_format:j.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(j.params.VERSION)?{crs:m,i:parseInt(q.x),j:parseInt(q.y)}:{srs:m,x:parseInt(q.x),y:parseInt(q.y)});0!=o.length&&(p=OpenLayers.Util.extend({layers:o,query_layers:o,styles:n},p));OpenLayers.Util.applyDefaults(p,this.vendorParams);return{url:k,params:OpenLayers.Util.upperCaseObject(p),callback:function(a){this.handleResponse(q,a,k)},scope:this}},getStyleNames:function(b){return b.params.STYLES?b.params.STYLES:OpenLayers.Util.isArray(b.params.LAYERS)?Array(b.params.LAYERS.length):b.params.LAYERS.replace(/[^,]/g,"")},request:function(k,j){var q=this.findLayers();if(0==q.length){this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}else{if(j=j||{},!1===this.drillDown){var q=this.buildWMSOptions(this.url,q,k,q[0].params.FORMAT),p=OpenLayers.Request.GET(q);!0===j.hover&&(this.hoverRequest=p)}else{this._numRequests=this._requestCount=0;this.features=[];for(var p={},o,n=0,m=q.length;n<m;n++){var l=q[n];o=OpenLayers.Util.isArray(l.url)?l.url[0]:l.url;o in p?p[o].push(l):(this._numRequests++,p[o]=[l])}for(o in p){q=p[o],q=this.buildWMSOptions(o,q,k,q[0].params.FORMAT),OpenLayers.Request.GET(q)}}}},triggerGetFeatureInfo:function(e,d,f){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:f,request:e,xy:d});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(f,e,h){var g=e.responseXML;if(!g||!g.documentElement){g=e.responseText}g=this.format.read(g);!1===this.drillDown?this.triggerGetFeatureInfo(e,f,g):(this._requestCount++,this._features="object"===this.output?(this._features||[]).concat({url:h,features:g}):(this._features||[]).concat(g),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(e,f,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(g){"string"==typeof g&&(g=OpenLayers.Format.XML.prototype.read.apply(this,[g]));g&&9==g.nodeType&&(g=g.documentElement);var f={features:[]};this.readNode(g,f);for(var g=[],k=0,j=f.features.length;k<j;k++){var h=f.features[k];this.internalProjection&&(this.externalProjection&&h.components[0])&&h.components[0].transform(this.externalProjection,this.internalProjection);h=new OpenLayers.Feature.Vector(h.components[0],h.attributes);g.push(h)}return g},readers:{sa:{SamplingPoint:function(e,d){if(!d.attributes){var f={attributes:{}};d.features.push(f);d=f}d.attributes.id=this.getAttributeNS(e,this.namespaces.gml,"id");this.readChildNodes(e,d)},position:function(d,c){this.readChildNodes(d,c)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(d,c){this.readChildNodes(d,c)},featureMember:function(e,d){var f={attributes:{}};d.features.push(f);this.readChildNodes(e,f)},name:function(d,c){c.attributes.name=this.getChildValue(d)},pos:function(d,c){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(d.getAttribute("srsName")));OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[d,c])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(f){for(var e=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),h=0,g=f.fois.length;h<g;h++){this.writeNode("FeatureOfInterestId",{foi:f.fois[h]},e)}return e},FeatureOfInterestId:function(b){return this.createElementNSPlus("FeatureOfInterestId",{value:b.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={measurements:[],observations:[]};this.readNode(d,c);return c},write:function(b){b=this.writeNode("sos:GetObservation",b);b.setAttribute("xmlns:om",this.namespaces.om);b.setAttribute("xmlns:ogc",this.namespaces.ogc);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(d,c){c.id=this.getAttributeNS(d,this.namespaces.gml,"id");this.readChildNodes(d,c)},member:function(d,c){this.readChildNodes(d,c)},Measurement:function(e,d){var f={};d.measurements.push(f);this.readChildNodes(e,f)},Observation:function(e,d){var f={};d.observations.push(f);this.readChildNodes(e,f)},samplingTime:function(e,d){var f={};d.samplingTime=f;this.readChildNodes(e,f)},observedProperty:function(d,c){c.observedProperty=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)},procedure:function(d,c){c.procedure=this.getAttributeNS(d,this.namespaces.xlink,"href");this.readChildNodes(d,c)},featureOfInterest:function(j,h){var o={features:[]};h.fois=[];h.fois.push(o);this.readChildNodes(j,o);for(var n=[],m=0,l=o.features.length;m<l;m++){var k=o.features[m];n.push(new OpenLayers.Feature.Vector(k.components[0],k.attributes))}o.features=n},result:function(e,d){var f={};d.result=f;""!==this.getChildValue(e)?(f.value=this.getChildValue(e),f.uom=e.getAttribute("uom")):this.readChildNodes(e,f)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(e,d){var f={};d.timeInstant=f;this.readChildNodes(e,f)},timePosition:function(d,c){c.timePosition=this.getChildValue(d)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(f){var e=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",f,e);f.eventTime&&this.writeNode("eventTime",f,e);for(var h in f.procedures){this.writeNode("procedure",f.procedures[h],e)}for(var g in f.observedProperties){this.writeNode("observedProperty",f.observedProperties[g],e)}f.foi&&this.writeNode("featureOfInterest",f.foi,e);this.writeNode("responseFormat",f,e);f.resultModel&&this.writeNode("resultModel",f,e);f.responseMode&&this.writeNode("responseMode",f,e);return e},featureOfInterest:function(d){var c=this.createElementNSPlus("featureOfInterest");this.writeNode("ObjectID",d.objectId,c);return c},ObjectID:function(b){return this.createElementNSPlus("ObjectID",{value:b})},responseFormat:function(b){return this.createElementNSPlus("responseFormat",{value:b.responseFormat})},procedure:function(b){return this.createElementNSPlus("procedure",{value:b})},offering:function(b){return this.createElementNSPlus("offering",{value:b.offering})},observedProperty:function(b){return this.createElementNSPlus("observedProperty",{value:b})},eventTime:function(d){var c=this.createElementNSPlus("eventTime");"latest"===d.eventTime&&this.writeNode("ogc:TM_Equals",d,c);return c},resultModel:function(b){return this.createElementNSPlus("resultModel",{value:b.resultModel})},responseMode:function(b){return this.createElementNSPlus("responseMode",{value:b.responseMode})}},ogc:{TM_Equals:function(d){var c=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},c);"latest"===d.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},c);return c},PropertyName:function(b){return this.createElementNSPlus("ogc:PropertyName",{value:b.property})}},gml:{TimeInstant:function(d){var c=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",d,c);return c},timePosition:function(b){return this.createElementNSPlus("gml:timePosition",{value:b.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(b){this.handlerMode=b;this.resetHandler()},resetHandler:function(){this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null);"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions));return this.handler?!0:!1},initialize:function(b){b=b||{};b.handlerOptions=b.handlerOptions||this.defaultHandlerOptions;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.resetHandler()},handleEvent:function(k){if(null==k){this.reset()}else{var j=this.map.getLonLatFromPixel(k.xy);if(j){var q=this.findLayers();if(0<q.length){for(var p={},o,n,m=0,l=q.length;m<l;m++){o=q[m],n=OpenLayers.Util.indexOf(this.map.layers,o),p[n]=o.getFeatureInfo(j)}this.callback(p,j,k.xy)}}}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var f=this.layers||this.map.layers,e=[],h,g=f.length-1;0<=g;--g){h=f[g],h instanceof OpenLayers.Layer.UTFGrid&&e.push(h)}return e},CLASS_NAME:"OpenLayers.Control.UTFGrid"});OpenLayers.Format.CQL=function(){function r(f){function d(){var b=t.pop();switch(b.type){case"LOGICAL":var x=d(),w=d();return new OpenLayers.Filter.Logical({filters:[w,x],type:m[b.text.toUpperCase()]});case"NOT":return x=d(),new OpenLayers.Filter.Logical({filters:[x],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":return t.pop(),w=d(),b=d(),x=d(),new OpenLayers.Filter.Comparison({property:x,lowerBoundary:b,upperBoundary:w,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":return w=d(),x=d(),new OpenLayers.Filter.Comparison({property:x,value:w,type:o[b.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(b.text)?b.text.substr(1,b.text.length-2):Number(b.text);case"SPATIAL":switch(b.text.toUpperCase()){case"BBOX":var x=d(),b=d(),w=d(),v=d(),e=d();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:e,value:OpenLayers.Bounds.fromArray([v,w,b,x])});case"INTERSECTS":return w=d(),x=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:x,value:w});case"WITHIN":return w=d(),x=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:x,value:w});case"CONTAINS":return w=d(),x=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:x,value:w});case"DWITHIN":return b=d(),w=d(),x=d(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:w,property:x,distance:Number(b)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(b.text);default:return b.text}}for(var u=[],t=[];f.length;){var s=f.shift();switch(s.type){case"PROPERTY":case"GEOMETRY":case"VALUE":t.push(s);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(var h=k[s.type];0<u.length&&k[u[u.length-1].type]<=h;){t.push(u.pop())}u.push(s);break;case"SPATIAL":case"NOT":case"LPAREN":u.push(s);break;case"RPAREN":for(;0<u.length&&"LPAREN"!=u[u.length-1].type;){t.push(u.pop())}u.pop();0<u.length&&"SPATIAL"==u[u.length-1].type&&t.push(u.pop());case"COMMA":case"END":break;default:throw Error("Unknown token type "+s.type)}}for(;0<u.length;){t.push(u.pop())}f=d();if(0<t.length){f="Remaining tokens after building AST: \n";for(u=t.length-1;0<=u;u--){f+=t[u].type+": "+t[u].text+"\n"}throw Error(f)}return f}var q={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(f){var e=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(f);if(e){var h=f.length,e=f.indexOf("(",e[0].length);if(-1<e){for(var g=1;e<h&&0<g;){switch(e++,f.charAt(e)){case"(":g++;break;case")":g--}}}return[f.substr(0,e+1)]}},END:/^$/},p={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},o={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},n={},m={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},l={},k={RPAREN:3,LOGICAL:2,COMPARISON:1},j;for(j in o){o.hasOwnProperty(j)&&(n[o[j]]=j)}for(j in m){m.hasOwnProperty(j)&&(l[m[j]]=j)}return OpenLayers.Class(OpenLayers.Format,{read:function(v){var u=v,v=[],s,c=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{r:{s=c;for(var b=void 0,c=void 0,a=s.length,b=0;b<a;b++){var c=s[b],t=q[c] instanceof RegExp?q[c].exec(u):(0,q[c])(u);if(t){s=t[0];u=u.substr(s.length).replace(/^\s*/,"");s={type:c,text:s,remainder:u};break r}}v="ERROR: In parsing: ["+u+"], expected one of: ";for(b=0;b<a;b++){c=s[b],v+="\n    "+c+": "+q[c]}throw Error(v)}u=s.remainder;c=p[s.type];if("END"!=s.type&&!c){throw Error("No follows list for "+s.type)}v.push(s)}while("END"!=s.type);v=r(v);this.keepData&&(this.data=v);return v},write:function(f){if(f instanceof OpenLayers.Geometry){return f.toString()}switch(f.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(f.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+f.property+","+f.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+f.property+", "+this.write(f.value)+", "+f.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+f.property+", "+this.write(f.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+f.property+", "+this.write(f.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+f.property+", "+this.write(f.value)+")";default:throw Error("Unknown spatial filter type: "+f.type)}case"OpenLayers.Filter.Logical":if(f.type==OpenLayers.Filter.Logical.NOT){return"NOT ("+this.write(f.filters[0])+")"}for(var e="(",h=!0,g=0;g<f.filters.length;g++){h?h=!1:e+=") "+l[f.type]+" (",e+=this.write(f.filters[g])}return e+")";case"OpenLayers.Filter.Comparison":return f.type==OpenLayers.Filter.Comparison.BETWEEN?f.property+" BETWEEN "+this.write(f.lowerBoundary)+" AND "+this.write(f.upperBoundary):f.property+" "+n[f.type]+" "+this.write(f.value);case void 0:if("string"===typeof f){return"'"+f+"'"}if("number"===typeof f){return""+f}default:throw Error("Can't encode: "+f.CLASS_NAME+" "+f)}},CLASS_NAME:"OpenLayers.Format.CQL"})}();OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.options=b||{};this.options.source&&this.setSource(this.options.source)},setSource:function(b){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=b,this.activate()):this.source=b},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b){if(this.source){if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}else{this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(c){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(c)})}},{layerOptions:this.sourceOptions})),this.handler.activate()}}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.call(this);b&&this.source&&this.source.events&&this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this});return b},onSketchComplete:function(b){this.feature=null;return !this.considerSplit(b.feature)},afterFeatureModified:function(b){b.modified&&"function"===typeof b.feature.geometry.split&&(this.feature=b.feature,this.considerSplit(b.feature))},removeByGeometry:function(f,e){for(var h=0,g=f.length;h<g;++h){if(f[h].geometry===e){f.splice(h,1);break}}},isEligible:function(b){return b.geometry?b.state!==OpenLayers.State.DELETE&&"function"===typeof b.geometry.split&&this.feature!==b&&(!this.targetFilter||this.targetFilter.evaluate(b.attributes)):!1},considerSplit:function(J){var I=!1,H=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(J.attributes)){for(var G=this.layer&&this.layer.features||[],F,E,D=[],C=[],B=this.layer===this.source&&this.mutual,A={edge:this.edge,tolerance:this.tolerance,mutual:B},z=[J.geometry],y,x,w,v=0,u=G.length;v<u;++v){if(y=G[v],this.isEligible(y)){x=[y.geometry];for(var t=0;t<z.length;++t){w=z[t];for(var s=0;s<x.length;++s){if(F=x[s],w.getBounds().intersectsBounds(F.getBounds())&&(F=w.split(F,A))){if(E=this.events.triggerEvent("beforesplit",{source:J,target:y}),!1!==E&&(B&&(E=F[0],1<E.length&&(E.unshift(t,1),Array.prototype.splice.apply(z,E),t+=E.length-3),F=F[1]),1<F.length)){F.unshift(s,1),Array.prototype.splice.apply(x,F),s+=F.length-3}}}}x&&1<x.length&&(this.geomsToFeatures(y,x),this.events.triggerEvent("split",{original:y,features:x}),Array.prototype.push.apply(D,x),C.push(y),H=!0)}}z&&1<z.length&&(this.geomsToFeatures(J,z),this.events.triggerEvent("split",{original:J,features:z}),Array.prototype.push.apply(D,z),C.push(J),I=!0);if(I||H){if(this.deferDelete){G=[];v=0;for(u=C.length;v<u;++v){H=C[v],H.state===OpenLayers.State.INSERT?G.push(H):(H.state=OpenLayers.State.DELETE,this.layer.drawFeature(H))}this.layer.destroyFeatures(G,{silent:!0});v=0;for(u=D.length;v<u;++v){D[v].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(C,{silent:!0})}this.layer.addFeatures(D,{silent:!0});this.events.triggerEvent("aftersplit",{source:J,features:D})}}return I},geomsToFeatures:function(h,g){var m=h.clone();delete m.geometry;for(var l,k=0,j=g.length;k<j;++k){l=m.clone(),l.geometry=g[k],l.state=OpenLayers.State.INSERT,g[k]=l}},destroy:function(){this.active&&this.deactivate();OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var d={url:!0,layer:!0,style:!0,matrixSet:!0},f;for(f in d){if(!(f in e)){throw Error("Missing property '"+f+"' in layer configuration.")}}e.params=OpenLayers.Util.upperCaseObject(e.params);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e.name,e.url,e.params,e]);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds&&(e=this.matrixIds.length)&&"string"===typeof this.matrixIds[0]){d=this.matrixIds;this.matrixIds=Array(e);for(f=0;f<e;++f){this.matrixIds[f]={identifier:d[f]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){if(this.matrix=this.getMatrix()){if(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(e,d,f){(d||!this.matrix)&&this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(b){null==b&&(b=new OpenLayers.Layer.WMTS(this.options));return b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var h;if(!this.matrixIds||0===this.matrixIds.length){h={identifier:this.getIdentifier()}}else{if("scaleDenominator" in this.matrixIds[0]){for(var g=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028,m=Number.POSITIVE_INFINITY,l,k=0,j=this.matrixIds.length;k<j;++k){l=Math.abs(1-this.matrixIds[k].scaleDenominator/g),l<m&&(m=l,h=this.matrixIds[k])}}else{h=this.matrixIds[this.getIdentifier()]}}return h},getTileInfo:function(f){var e=this.getServerResolution(),h=(f.lon-this.tileOrigin.lon)/(e*this.tileSize.w),f=(this.tileOrigin.lat-f.lat)/(e*this.tileSize.h),e=Math.floor(h),g=Math.floor(f);return{col:e,row:g,i:Math.floor((h-e)*this.tileSize.w),j:Math.floor((f-g)*this.tileSize.h)}},getURL:function(h){var h=this.adjustBounds(h),g="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(h)){var m=this.getTileInfo(h.getCenterLonLat()),h=this.dimensions;if("REST"===this.requestEncoding.toUpperCase()){if(g=this.params,"string"===typeof this.url&&-1!==this.url.indexOf("{")){var l=this.url.replace(/\{/g,"${"),m={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:m.row,TileCol:m.col};if(h){var k,j;for(j=h.length-1;0<=j;--j){k=h[j],m[k]=g[k.toUpperCase()]}}g=OpenLayers.String.format(l,m)}else{l=this.version+"/"+this.layer+"/"+this.style+"/";if(h){for(j=0;j<h.length;j++){g[h[j]]&&(l=l+g[h[j]]+"/")}}l=l+this.matrixSet+"/"+this.matrix.identifier+"/"+m.row+"/"+m.col+"."+this.formatSuffix;g=OpenLayers.Util.isArray(this.url)?this.selectUrl(l,this.url):this.url;g.match(/\/$/)||(g+="/");g+=l}}else{"KVP"===this.requestEncoding.toUpperCase()&&(g={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:m.row,TILECOL:m.col,FORMAT:this.format},g=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[g]))}}return g},mergeNewParams:function(b){if("KVP"===this.requestEncoding.toUpperCase()){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(b)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);b.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var d=new OpenLayers.Protocol.Response({requestType:"read"}),f=this.format,f=OpenLayers.Format.XML.prototype.write.apply(f,[f.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);d.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,d,e),data:f});return d},handleRead:function(e,d){if(d.callback){var f=e.priv;200<=f.status&&300>f.status?(e.features=this.parseFeatures(f),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE;d.callback.call(d.scope,e)}},parseFeatures:function(d){var c=d.responseXML;if(!c||!c.documentElement){c=d.responseText}return !c||0>=c.length?null:this.format.read(c)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(f,e,h,g){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(g){var g=this.adjustBounds(g),f=this.map.getResolution(),k=Math.round(10000*this.map.getScale())/10000,j=Math.round(g.left/f),g=-Math.round(g.top/f),f=Math.floor(j/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,h=Math.floor(g/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,k=["/",this.params.map,"/",k,"/",this.params.g.replace(/\s/g,"_"),"/def/t",h,"/l",f,"/t",g,"l",j,".",this.extension],j=this.url;OpenLayers.Util.isArray(j)&&(j=this.selectUrl(k.join(""),j));return j+k.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(b){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(d,c){c.srs[this.getChildValue(d)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(d,c){c.vendorSpecific={tileSets:[]};this.readChildNodes(d,c.vendorSpecific)},TileSet:function(e,d){var f={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,f);d.tileSets.push(f)},Resolutions:function(g,f){for(var k=this.getChildValue(g).split(" "),j=0,h=k.length;j<h;j++){""!=k[j]&&f.resolutions.push(parseFloat(k[j]))}},Width:function(d,c){c.width=parseInt(this.getChildValue(d))},Height:function(d,c){c.height=parseInt(this.getChildValue(d))},Layers:function(d,c){c.layers=this.getChildValue(d)},Styles:function(d,c){c.styles=this.getChildValue(d)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(g,f){for(var k=this.getChildValue(g).split(/ +/),j=0,h=k.length;j<h;j++){f.srs[k[j]]=!0}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[];this.roundedCorner&&OpenLayers.Console.warn("roundedCorner option is deprecated")},destroy:function(){this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.events.unregister("buttonclick",this,this.onButtonClick);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();this.outsideViewport||this.minimizeControl();this.redraw();return this.div},onButtonClick:function(b){b=b.buttonElement;b===this.minimizeDiv?this.minimizeControl():b===this.maximizeDiv?this.maximizeControl():b._layerSwitcher===this.id&&(b["for"]&&(b=document.getElementById(b["for"])),b.disabled||("radio"==b.type?(b.checked=!0,this.map.setBaseLayer(this.map.getLayer(b._layer))):(b.checked=!b.checked,this.updateMap())))},clearLayersArray:function(b){this[b+"LayersDiv"].innerHTML="";this[b+"Layers"]=[]},checkRedraw:function(){var g=!1;if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length){g=!0}else{for(var f=0,k=this.layerStates.length;f<k;f++){var j=this.layerStates[f],h=this.map.layers[f];if(j.name!=h.name||j.inRange!=h.inRange||j.id!=h.id||j.visibility!=h.visibility){g=!0;break}}}return g},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var t=!1,s=!1,r=this.map.layers.length;this.layerStates=Array(r);for(var q=0;q<r;q++){var p=this.map.layers[q];this.layerStates[q]={name:p.name,visibility:p.visibility,inRange:p.inRange,id:p.id}}var o=this.map.layers.slice();this.ascending||o.reverse();q=0;for(r=o.length;q<r;q++){var p=o[q],n=p.isBaseLayer;if(p.displayInLayerSwitcher){n?s=!0:t=!0;var m=n?p==this.map.baseLayer:p.getVisibility(),l=document.createElement("input");l.id=this.id+"_input_"+p.name;l.name=n?this.id+"_baseLayers":p.name;l.type=n?"radio":"checkbox";l.value=p.name;l.checked=m;l.defaultChecked=m;l.className="olButton";l._layer=p.id;l._layerSwitcher=this.id;!n&&!p.inRange&&(l.disabled=!0);m=document.createElement("label");m["for"]=l.id;OpenLayers.Element.addClass(m,"labelSpan olButton");m._layer=p.id;m._layerSwitcher=this.id;!n&&!p.inRange&&(m.style.color="gray");m.innerHTML=p.name;m.style.verticalAlign=n?"bottom":"baseline";var k=document.createElement("br");(n?this.baseLayers:this.dataLayers).push({layer:p,inputElem:l,labelSpan:m});p=n?this.baseLayersDiv:this.dataLayersDiv;p.appendChild(l);p.appendChild(m);p.appendChild(k)}}this.dataLbl.style.display=t?"":"none";this.baseLbl.style.display=s?"":"none";return this.div},updateMap:function(){for(var e=0,d=this.baseLayers.length;e<d;e++){var f=this.baseLayers[e];f.inputElem.checked&&this.map.setBaseLayer(f.layer,!1)}e=0;for(d=this.dataLayers.length;e<d;e++){f=this.dataLayers[e],f.layer.setVisibility(f.inputElem.checked)}},maximizeControl:function(b){this.div.style.width="";this.div.style.height="";this.showControls(!1);null!=b&&OpenLayers.Event.stop(b)},minimizeControl:function(b){this.div.style.width="0px";this.div.style.height="0px";this.showControls(!0);null!=b&&OpenLayers.Event.stop(b)},showControls:function(b){this.maximizeDiv.style.display=b?"":"none";this.minimizeDiv.style.display=b?"none":"";this.layersDiv.style.display=b?"none":""},loadContents:function(){this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv));this.div.appendChild(this.layersDiv);this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75));var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");this.maximizeDiv.style.display="none";this.div.appendChild(this.maximizeDiv);b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,b,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");this.minimizeDiv.style.display="none";this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(b){"string"==typeof b&&(b=OpenLayers.Format.XML.prototype.read.apply(this,[b]));return this.parseFeatures(b)},write:function(f){var e;if(OpenLayers.Util.isArray(f)){e=this.createElementNSPlus("atom:feed");e.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var h=0,g=f.length;h<g;h++){e.appendChild(this.buildEntryNode(f[h]))}}else{e=this.buildEntryNode(f)}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},buildContentNode:function(d){var c=this.createElementNSPlus("atom:content",{attributes:{type:d.type||null}});if(d.src){c.setAttribute("src",d.src)}else{if("text"==d.type||null==d.type){c.appendChild(this.createTextNode(d.value))}else{if("html"==d.type){if("string"!=typeof d.value){throw"HTML content must be in form of an escaped string"}c.appendChild(this.createTextNode(d.value))}else{"xhtml"==d.type?c.appendChild(d.value):"xhtml"==d.type||d.type.match(/(\+|\/)xml$/)?c.appendChild(d.value):c.appendChild(this.createTextNode(d.value))}}}return c},buildEntryNode:function(k){var j=k.attributes,q=j.atom||{},p=this.createElementNSPlus("atom:entry");if(q.authors){for(var o=OpenLayers.Util.isArray(q.authors)?q.authors:[q.authors],n=0,m=o.length;n<m;n++){p.appendChild(this.buildPersonConstructNode("author",o[n]))}}if(q.categories){for(var o=OpenLayers.Util.isArray(q.categories)?q.categories:[q.categories],l,n=0,m=o.length;n<m;n++){l=o[n],p.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:l.term,scheme:l.scheme||null,label:l.label||null}}))}}q.content&&p.appendChild(this.buildContentNode(q.content));if(q.contributors){o=OpenLayers.Util.isArray(q.contributors)?q.contributors:[q.contributors];n=0;for(m=o.length;n<m;n++){p.appendChild(this.buildPersonConstructNode("contributor",o[n]))}}k.fid&&p.appendChild(this.createElementNSPlus("atom:id",{value:k.fid}));if(q.links){o=OpenLayers.Util.isArray(q.links)?q.links:[q.links];n=0;for(m=o.length;n<m;n++){l=o[n],p.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:l.href,rel:l.rel||null,type:l.type||null,hreflang:l.hreflang||null,title:l.title||null,length:l.length||null}}))}}q.published&&p.appendChild(this.createElementNSPlus("atom:published",{value:q.published}));q.rights&&p.appendChild(this.createElementNSPlus("atom:rights",{value:q.rights}));if(q.summary||j.description){p.appendChild(this.createElementNSPlus("atom:summary",{value:q.summary||j.description}))}p.appendChild(this.createElementNSPlus("atom:title",{value:q.title||j.title||this.defaultEntryTitle}));q.updated&&p.appendChild(this.createElementNSPlus("atom:updated",{value:q.updated}));k.geometry&&(j=this.createElementNSPlus("georss:where"),j.appendChild(this.buildGeometryNode(k.geometry)),p.appendChild(j));return p},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){this.gmlParser||this.initGmlParser();return this.gmlParser.writeNode("feature:_geometry",b).firstChild},buildPersonConstructNode:function(h,g){var m=["uri","email"],l=this.createElementNSPlus("atom:"+h);l.appendChild(this.createElementNSPlus("atom:name",{value:g.name}));for(var k=0,j=m.length;k<j;k++){g[m[k]]&&l.appendChild(this.createElementNSPlus("atom:"+m[k],{value:g[m[k]]}))}return l},getFirstChildValue:function(f,e,h,g){return(f=this.getElementsByTagNameNS(f,e,h))&&0<f.length?this.getChildValue(f[0],g):g},parseFeature:function(v){var u={},t=null,s=null,r=null,q=this.namespaces.atom;this.parsePersonConstructs(v,"author",u);s=this.getElementsByTagNameNS(v,q,"category");0<s.length&&(u.categories=[]);for(var p=0,o=s.length;p<o;p++){t={};t.term=s[p].getAttribute("term");if(r=s[p].getAttribute("scheme")){t.scheme=r}if(r=s[p].getAttribute("label")){t.label=r}u.categories.push(t)}s=this.getElementsByTagNameNS(v,q,"content");if(0<s.length){t={};if(r=s[0].getAttribute("type")){t.type=r}(r=s[0].getAttribute("src"))?t.src=r:(t.value="text"==t.type||"html"==t.type||null==t.type?this.getFirstChildValue(v,q,"content",null):"xhtml"==t.type||t.type.match(/(\+|\/)xml$/)?this.getChildEl(s[0]):this.getFirstChildValue(v,q,"content",null),u.content=t)}this.parsePersonConstructs(v,"contributor",u);u.id=this.getFirstChildValue(v,q,"id",null);s=this.getElementsByTagNameNS(v,q,"link");0<s.length&&(u.links=Array(s.length));for(var n=["rel","type","hreflang","title","length"],p=0,o=s.length;p<o;p++){t={};t.href=s[p].getAttribute("href");for(var m=0,l=n.length;m<l;m++){(r=s[p].getAttribute(n[m]))&&(t[n[m]]=r)}u.links[p]=t}if(t=this.getFirstChildValue(v,q,"published",null)){u.published=t}if(t=this.getFirstChildValue(v,q,"rights",null)){u.rights=t}if(t=this.getFirstChildValue(v,q,"summary",null)){u.summary=t}u.title=this.getFirstChildValue(v,q,"title",null);u.updated=this.getFirstChildValue(v,q,"updated",null);t={title:u.title,description:u.summary,atom:u};v=this.parseLocations(v)[0];v=new OpenLayers.Feature.Vector(v,t);v.fid=u.id;return v},parseFeatures:function(f){var e=[],h=this.getElementsByTagNameNS(f,this.namespaces.atom,"entry");0==h.length&&(h=[f]);for(var f=0,g=h.length;f<g;f++){e.push(this.parseFeature(h[f]))}return e},parseLocations:function(v){var u=this.namespaces.georss,t={components:[]},s=this.getElementsByTagNameNS(v,u,"where");if(s&&0<s.length){this.gmlParser||this.initGmlParser();for(var r=0,q=s.length;r<q;r++){this.gmlParser.readChildNodes(s[r],t)}}t=t.components;if((s=this.getElementsByTagNameNS(v,u,"point"))&&0<s.length){r=0;for(q=s.length;r<q;r++){var p=OpenLayers.String.trim(s[r].firstChild.nodeValue).split(/\s+/);2!=p.length&&(p=OpenLayers.String.trim(s[r].firstChild.nodeValue).split(/\s*,\s*/));t.push(new OpenLayers.Geometry.Point(p[1],p[0]))}}var o=this.getElementsByTagNameNS(v,u,"line");if(o&&0<o.length){for(var n,r=0,q=o.length;r<q;r++){s=OpenLayers.String.trim(o[r].firstChild.nodeValue).split(/\s+/);n=[];for(var m=0,l=s.length;m<l;m+=2){p=new OpenLayers.Geometry.Point(s[m+1],s[m]),n.push(p)}t.push(new OpenLayers.Geometry.LineString(n))}}if((v=this.getElementsByTagNameNS(v,u,"polygon"))&&0<v.length){r=0;for(q=v.length;r<q;r++){s=OpenLayers.String.trim(v[r].firstChild.nodeValue).split(/\s+/);n=[];m=0;for(l=s.length;m<l;m+=2){p=new OpenLayers.Geometry.Point(s[m+1],s[m]),n.push(p)}t.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(t)]))}}if(this.internalProjection&&this.externalProjection){r=0;for(q=t.length;r<q;r++){t[r]&&t[r].transform(this.externalProjection,this.internalProjection)}}return t},parsePersonConstructs:function(x,w,v){for(var u=[],t=this.namespaces.atom,x=this.getElementsByTagNameNS(x,t,w),s=["uri","email"],r=0,q=x.length;r<q;r++){var p={};p.name=this.getFirstChildValue(x[r],t,"name",null);for(var o=0,n=s.length;o<n;o++){var m=this.getFirstChildValue(x[r],t,s[o],null);m&&(p[s[o]]=m)}u.push(p)}0<u.length&&(v[w+"s"]=u)},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(e){var d,f=!0;switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:d=this.map.getSize();this.map.pan(0,-0.75*d.h);break;case 34:d=this.map.getSize();this.map.pan(0,0.75*d.h);break;case 35:d=this.map.getSize();this.map.pan(0.75*d.w,0);break;case 36:d=this.map.getSize();this.map.pan(-0.75*d.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:f=!1}f&&OpenLayers.Event.stop(e)},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;b=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(b,this.yx)},read:function(d){"string"==typeof d&&(d=OpenLayers.Format.XML.prototype.read.apply(this,[d]));d&&9==d.nodeType&&(d=d.documentElement);var c={};this.readNode(d,c);c.version=this.version;return c},readers:{wmts:{Capabilities:function(d,c){this.readChildNodes(d,c)},Contents:function(d,c){c.contents={};c.contents.layers=[];c.contents.tileMatrixSets={};this.readChildNodes(d,c.contents)},Layer:function(e,d){var f={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(e,f);d.layers.push(f)},Style:function(e,d){var f={};f.isDefault="true"===e.getAttribute("isDefault");this.readChildNodes(e,f);d.styles.push(f)},Format:function(d,c){c.formats.push(this.getChildValue(d))},TileMatrixSetLink:function(e,d){var f={};this.readChildNodes(e,f);d.tileMatrixSetLinks.push(f)},TileMatrixSet:function(e,d){if(d.layers){var f={matrixIds:[]};this.readChildNodes(e,f);d.tileMatrixSets[f.identifier]=f}else{d.tileMatrixSet=this.getChildValue(e)}},TileMatrix:function(e,d){var f={supportedCRS:d.supportedCRS};this.readChildNodes(e,f);d.matrixIds.push(f)},ScaleDenominator:function(d,c){c.scaleDenominator=parseFloat(this.getChildValue(d))},TopLeftCorner:function(f,e){var h=this.getChildValue(f).split(" "),g;e.supportedCRS&&(g=!!this.yx[e.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2")]);e.topLeftCorner=g?new OpenLayers.LonLat(h[1],h[0]):new OpenLayers.LonLat(h[0],h[1])},TileWidth:function(d,c){c.tileWidth=parseInt(this.getChildValue(d))},TileHeight:function(d,c){c.tileHeight=parseInt(this.getChildValue(d))},MatrixWidth:function(d,c){c.matrixWidth=parseInt(this.getChildValue(d))},MatrixHeight:function(d,c){c.matrixHeight=parseInt(this.getChildValue(d))},ResourceURL:function(d,c){c.resourceUrl=c.resourceUrl||{};c.resourceUrl[d.getAttribute("resourceType")]={format:d.getAttribute("format"),template:d.getAttribute("template")}},WSDL:function(d,c){c.wsdl={};c.wsdl.href=d.getAttribute("xlink:href")},ServiceMetadataURL:function(d,c){c.serviceMetadataUrl={};c.serviceMetadataUrl.href=d.getAttribute("xlink:href")},LegendURL:function(d,c){c.legend={};c.legend.href=d.getAttribute("xlink:href");c.legend.format=d.getAttribute("format")},Dimension:function(e,d){var f={values:[]};this.readChildNodes(e,f);d.dimensions.push(f)},Default:function(d,c){c["default"]=this.getChildValue(d)},Value:function(d,c){c.values.push(this.getChildValue(d))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});var Tooltips={en:{institution:"Institution",institutions:"Institutions",institutes:"Institutes",locationType:"Location type",selectLocationType:"Select location type",mapType:"Background map",selectMapType:"Select background map",selectOverlay:"Select layer for spatial filtering",overlays:"Select layer",mapSelectorTools:"Map selector tools",overlaySelector:"Selection layer",square:"Square selection: Mouse down for the center and mouse move to set square bounds",circle:"Circle selection: Mouse down for the center and mouse move to set circle radius",polygon:"Polygon selection: Click to add vertex and double click to complete the polygon",country:"Country selection: Click inside the political borders of a country",singleEntry:"Only 1 entry available",resultsLocation:"with location information",home:"Reset map to initial view",zoomIn:"Zoom in",zoomOut:"Zoom out",zoomSlider:"Zoom slider",dragSelection:"Drag&Drop shape",zoomSelection:"Zoom into selection",clearSelection:"Clear selection",contemporaryMap:"Contemporary Map",activateGeoLocation:"Show my location",deactivateGeoLocation:"Hide my location",mapOf:"Map of",close:"Close",genericBinning:"delaunay",squareBinning:"square",hexagonalBinning:"hexagonal",triangularBinning:"triangular",noBinning:"none",selectBinningType:"Select aggregation type",binningType:"Aggregation type",binningTooltip:"Select the aggregation type for the data sources",results:"results",result:"result",timeType:"Time type",timeUnit:"Time unit:",selectTimeType:"Select time type",timeAnimation:"Animation",resultsTime:"with time information",animationDisabled:"Animation control (disabled)",animationPlay:"Animate selected time range",animationPause:"Pause animation",leftHandle:"Drag&Drop left border",rightHandle:"Drag&Drop right border",dragTimeRange:"Drag&Drop time range",connectionsOn:"Switch on time-dependent connections between map circles",connectionsOff:"Switch off time-dependent connections",timeFeather:"Adjust time range feather to smoothen map animations",allResults:"all",pageInfo:"Page PAGE_ID of PAGES_ID",resultsInfo:"RESULTS_FROM_ID-RESULTS_TO_ID of RESULTS_ID Results",otherResults:"others",mapAggregation:"Aggregation",aggregation:"Circle aggregation",noAggregation:"No circle aggregation",showBoxTitle:"Boundingbox",showBbox:"Shows given Boundingbox extension",hideBbox:"Hides given Boundingbox extension",spaceHelp:"A point on the map corresponds to one or more objects from the result list. ",timeHelp:"On the timeline are the search results sorted by year. You can choose different time-based categories as basis for the representation.",selectTablePageItemsHelp:"Click to select all rows of this page",deselectTablePageItemsHelp:"Click to deselect all rows of this page",selectAllTableItemsHelp:"Click to select all rows of the table",deselectAllTableItemsHelp:"Click to deselect all rows of the table",filter:"Filter",filterSelectedItemsHelp:"Filter the selected items",inverseFilterSelectedItemsHelp:"Apply an inverse filter on the selected items removing them from the views",undoFilterSelection:"Undo the last filter / inverse filter",cancelSelection:"Discard the current selection (all items appear as deselected)",showSelectedHelp:"Show only elements within the selection",showAllElementsHelp:"Show all elements",paginationFirsPageHelp:"Show first page",paginationPreviousPageHelp:"Show previous page",paginationNextPageHelp:"Show next page",paginationLastPageHelp:"Show last page",sortAZHelp:"Sort table elements ascending according this column",sortZAHelp:"Sort table elements descending according this column",paginationDropdownHelp:"Select number of elements per page",selectTimeUnit:"Select Time Unit",valueScale:"Value Scale",linearPlot:"Linear Value Scale",logarithmicPlot:"Logarithmic Value Scale",playButton:"Animate Selected Range",pauseButton:"Pause Animation"},de:{institution:"Institution",institutions:"Institutionen",institutes:"Institute",locationType:"Ortsfacette",selectLocationType:"Wähle Ortsfacette",mapType:"Kartentyp",selectMapType:"Wähle Kartentyp",selectOverlay:"Kartenauswahl für rämliches filtern",overlays:"Wähle layer",mapSelectorTools:"Bereichsauswahl",overlaySelector:"Selection layer",square:"Quadratauswahl: Maus ziehen und loslassen um Mittelpunkt und Seitenlänge des Quadrats zu bestimmen",circle:"Kreisauswahl: Maus ziehen und loslassen um Mittelpunkt und Radius des Kreises zu bestimmen",polygon:"Polygonauswahl: Mausklick zum Hinzufügen eines Eckpunktes, Doppelklick zum Fertigstellen",country:"Landauswahl: Mausklick innerhalb politischer Grenze eines Landes",singleEntry:"Nur 1 Eintrag vorhanden",resultsLocation:"mit Geoinformation",home:"Zurücksetzen zur initialen Sicht",zoomIn:"Vergrößern",zoomOut:"Verkleinern",zoomSlider:"Zoomregler",dragSelection:"Verschiebe Auswahl",zoomSelection:"Vergrößere Auswahl",clearSelection:"Entferne Auswahlbereich",contemporaryMap:"Aktuelle Weltkarte",activateGeoLocation:"Meinen Standort anzeigen",deactivateGeoLocation:"Meinen Standort ausblenden",mapOf:"Karte von",close:"Schließen",genericBinning:"Generisch",squareBinning:"Quadrate",hexagonalBinning:"Hexagone",triangularBinning:"Dreiecke",noBinning:"Keine Bins",selectBinningType:"Wähle Binningart",binningTooltip:"Wähle die Binninart für die Datenquellen",binningType:"Binningart",results:"Resultate",result:"Resultat",timeType:"Zeitfacette",timeUnit:"Zeiteinheit",selectTimeType:"Wähle Zeitfacette",timeAnimation:"Animation",resultsTime:"mit Zeitinformation",animationDisabled:"Animationswerkzeug (deaktiviert)",animationPlay:"Animiere ausgewählten Zeitbereich",animationPause:"Animation anhalten",leftHandle:"Verschiebe linke Grenze",rightHandle:"Verschiebe rechte Grenze",dragTimeRange:"Verschiebe Zeitbereich",connectionsOn:"Aktiviere zeitabhängige Verbindungen zwischen Kreisen auf der Karte",connectionsOff:"Deaktiviere zeitabhängige Verbindungen",timeFeather:"Verändere Zeitbereichsübergänge zum Glätten der Animation",pageInfo:"Seite PAGE_ID von PAGES_ID",resultsInfo:"RESULTS_FROM_ID-RESULTS_TO_ID von RESULTS_ID Ergebnissen",allResults:"alle",otherResults:"sonstige",mapAggregation:"Aggregation",aggregation:"Kreise aggregiert",noAggregation:"Kreise nicht aggregiert",showBbox:"Geografische Ausdehnung anzeigen",hideBbox:"Geografische Ausdehnung ausblenden",spaceHelp:"Jeder Punkt auf der Karte entspricht einem oder mehreren Objekten der Ergebnisliste. Sie können verschiedene ortsbezogene Kategorien als Grundlage für die Darstellung wählen (Auswahlfeld <strong>Ortsfacette</strong>) und verschiedene Kartentypen. <br> Da es Objekte geben kann, die keine Ortsangabe in ihrer Beschreibung enthalten, ist die Menge der in der Karte dargestellten Objekte in der Regel kleiner als in der Ergebnisliste (Anzahl darstellbarer Objekte siehe rechts oben über der Karte). <br> Mit der Karte können Sie die Suchergebnisse weiter eingrenzen, indem Sie auf einen der Punkte klicken. Wählen Sie einen Ort aus und klicken Sie auf die kleine Lupe, um die Ergebnisliste so einzuschränken, dass nur noch die diesem Ort zugeordneten Objekte als Suchergebnis erscheinen. Mehr zur Karte im Benutzerhandbuch ...",timeHelp:"In der Zeitleiste sind die Suchergebnisse nach Jahren geordnet. Sie können verschiedene zeitbezogene Kategorien als Grundlage für die Darstellung wählen (Auswahlfeld <strong>Zeitfacette</strong>). <br> Da es Objekte geben kann, die keine Zeitangabe in ihrer Beschreibung enthalten, ist die Zahl der in der Zeitleiste dargestellten Objekte in der Regel kleiner als in der Ergebnisliste. Die Angabe über darstellbare Objekte finden Sie rechts über der Zeitleiste. <br>Mit der Zeitleiste können Sie die Suchergebnisse weiter eingrenzen. Wählen Sie ein Jahr oder einen Zeitraum durch Klicken und Ziehen und klicken Sie auf die kleine Lupe. Die Ergebnisliste zeigt nur noch die Objekte in diesem Zeitraum. Mehr zur Zeitleiste im Benutzerhandbuch ...",selectTablePageItemsHelp:"Click to select all rows of this page",deselectTablePageItemsHelp:"Click to deselect all rows of this page",selectAllTableItemsHelp:"Click to select all rows of the table",deselectAllTableItemsHelp:"Click to deselect all rows of the table",filter:"Filter",filterSelectedItemsHelp:"Filter the selected items",inverseFilterSelectedItemsHelp:"Apply an inverse filter on the selected items removing them from the views",undoFilterSelection:"Undo the last filter / inverse filter",cancelSelection:"Discard the current selection (all items appear as deselected)",showSelectedHelp:"Show only elements within the selection",showAllElementsHelp:"Show all elements",paginationFirsPageHelp:"Show first page",paginationPreviousPageHelp:"Show previous page",paginationNextPageHelp:"Show next page",paginationLastPageHelp:"Show last page",sortAZHelp:"Sort table elements ascending according this column",sortZAHelp:"Sort table elements descending according this column",paginationDropdownHelp:"Select number of elements per page",selectTimeUnit:"Wähle Zeitinervalle",valueScale:"Value Scale",linearPlot:"Linear Value Scale",logarithmicPlot:"Logarithmic Value Scale",playButton:"Animate Selected Range",pauseButton:"Pause Animation"}};var GeoTemConfig={incompleteData:true,inverseFilter:true,mouseWheelZoom:true,language:"de",allowFilter:true,colors:[{r1:165,g1:0,b1:59,r0:240,g0:99,b0:115},{r1:144,g1:26,b1:255,r0:230,g0:225,b0:255},{r1:0,g1:217,b1:0,r0:213,g0:255,b0:213},{r1:240,g1:220,b1:0,r0:247,g0:244,b0:197}]};GeoTemConfig.ie=false;GeoTemConfig.ie8=false;if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){GeoTemConfig.ie=true;var ieversion=new Number(RegExp.$1);if(ieversion==8){GeoTemConfig.ie8=true}}GeoTemConfig.determineAndSetUrlPrefix=function(a){if(typeof GeoTemCoMinifier_urlPrefix!="undefined"){GeoTemConfig.configure(GeoTemCoMinifier_urlPrefix)}else{var b=GeoTemConfig.resolveUrlPrefix(a);GeoTemConfig.configure(b)}};GeoTemConfig.resolveUrlPrefix=function(a){var c=document.getElementsByTagName("script");for(var d=0;d<c.length;d++){var b=c[d].src.indexOf(a);if(b!=-1){return c[d].src.substring(0,b)}}if(typeof console!="undefined"){console.warn("cannot resolve url prefix of: "+a)}};GeoTemConfig.configure=function(a){if(typeof console!="undefined"){console.log("GeoTemConfig.configure urlPrefix: "+a)}GeoTemConfig.urlPrefix=a;GeoTemConfig.path=GeoTemConfig.urlPrefix+"images/"};GeoTemConfig.applySettings=function(a){$.extend(this,a)};GeoTemConfig.getColor=function(a){if(GeoTemConfig.colors.length<=a){GeoTemConfig.colors.push({r1:Math.floor((Math.random()*255)+1),g1:Math.floor((Math.random()*255)+1),b1:Math.floor((Math.random()*255)+1),r0:230,g0:230,b0:230})}return GeoTemConfig.colors[a]};GeoTemConfig.getString=function(a){if(typeof Tooltips[GeoTemConfig.language]=="undefined"){GeoTemConfig.language="de"}return Tooltips[GeoTemConfig.language][a]};GeoTemConfig.getMousePosition=function(b){if(!b){b=window.event}var a=(window.document.compatMode&&window.document.compatMode=="CSS1Compat")?window.document.documentElement:window.document.body;return{top:b.pageY?b.pageY:b.clientY,left:b.pageX?b.pageX:b.clientX}};GeoTemConfig.getJson=function(a){var b;$.ajax({url:a,async:false,dataType:"json",success:function(c){b=c}});return b};GeoTemConfig.mergeObjects=function(f,e){var a=[];var d=[];for(var c=0;c<f.length;c++){a.push([]);d.push([]);for(var b=0;b<f[c].length;b++){a[c][f[c][b].index]=true;d[c].push(f[c][b])}}for(var c=0;c<e.length;c++){for(var b=0;b<e[c].length;b++){if(!a[c][e[c][b].index]){d[c].push(e[c][b])}}}return d};GeoTemConfig.getKml=function(a,d){var c;var b=false;if(d){b=true}$.ajax({url:a,async:b,dataType:"xml",success:function(e){if(d){d(e)}else{c=e}}});if(!b){return c}};GeoTemConfig.getTimeData=function(k){if(!k){return}var b;try{var g=false;if(k.startsWith("-")){g=true;k=k.substring(1)}var a=k.split("T");var j=a[0].split("-");for(var f=0;f<j.length;f++){parseInt(j[f])}if(g){j[0]="-"+j[0]}if(a.length==1){b=j}else{var c;if(a[1].indexOf("Z")!=-1){c=a[1].substring(0,a[1].indexOf("Z")-1).split(":")}else{c=a[1].substring(0,a[1].indexOf("+")-1).split(":")}for(var f=0;f<j.length;f++){parseInt(c[f])}b=j.concat(c)}}catch(d){return null}var e,h;if(b.length==6){h=SimileAjax.DateTime.SECOND;e=new Date(Date.UTC(b[0],b[1]-1,b[2],b[3],b[4],b[5]))}else{if(b.length==3){h=SimileAjax.DateTime.DAY;e=new Date(Date.UTC(b[0],b[1]-1,b[2]))}else{if(b.length==2){h=SimileAjax.DateTime.MONTH;e=new Date(Date.UTC(b[0],b[1]-1,1))}else{if(b.length==1){h=SimileAjax.DateTime.YEAR;e=new Date(Date.UTC(b[0],0,1))}}}}if(j[0]&&j[0]<100){e.setFullYear(j[0])}return{date:e,granularity:h}};GeoTemConfig.loadJson=function(a){var l=[];var k=0;for(var q in a){try{var t=a[q];var g=t.index||t.id||k++;var v=t.name||"";var o=t.description||"";var s=t.tableContent||[];var u=[];if(t.location instanceof Array){for(var p=0;p<t.location.length;p++){var m=t.location[p].place||"unknown";var b=t.location[p].lon||"";var f=t.location[p].lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!GeoTemConfig.incompleteData){throw"e"}u.push({longitude:b,latitude:f,place:m})}}else{var m=t.place||"unknown";var b=t.lon||"";var f=t.lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!GeoTemConfig.incompleteData){throw"e"}u.push({longitude:b,latitude:f,place:m})}var d=[];if(t.time instanceof Array){for(var p=0;p<t.time.length;p++){var h=GeoTemConfig.getTimeData(t.time[p]);if(h==null&&!GeoTemConfig.incompleteData){throw"e"}d.push(h)}}else{var h=GeoTemConfig.getTimeData(t.time);if(h==null&&!GeoTemConfig.incompleteData){throw"e"}d.push(h)}var n=t.weight||1;var c=new DataObject(v,o,u,d,n,s);c.setIndex(g);l.push(c)}catch(r){continue}}return l};GeoTemConfig.loadKml=function(A){var u=[];var p=A.getElementsByTagName("Placemark");if(p.length==0){return[]}var k=0;for(var t=0;t<p.length;t++){var x=p[t];var B,s,n,c,g,j,w=[],l=[],b=[];var o=1;var a=false,r=false;try{B=x.getElementsByTagName("name")[0].childNodes[0].nodeValue;w.name=B}catch(v){B=""}try{s=x.getElementsByTagName("description")[0].childNodes[0].nodeValue;w.description=s}catch(v){s=""}try{n=x.getElementsByTagName("address")[0].childNodes[0].nodeValue;w.place=n}catch(v){n=""}try{var d=x.getElementsByTagName("Point")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;var m=d.split(",");g=m[0];j=m[1];if(g==""||j==""||isNaN(g)||isNaN(j)){throw"e"}b.push({longitude:g,latitude:j,place:n})}catch(v){if(!GeoTemConfig.incompleteData){continue}}try{var q=GeoTemConfig.getTimeData(x.getElementsByTagName("TimeStamp")[0].getElementsByTagName("when")[0].childNodes[0].nodeValue);if(q!=null){l.push(q);a=true}else{if(!GeoTemConfig.incompleteData){continue}}}catch(v){try{throw"e";var y=x.getElementsByTagName("TimeSpan")[0];var h=GeoTemConfig.getTimeData(y.getElementsByTagName("begin")[0].childNodes[0].nodeValue);timeStart=h.d;c=h.g;var f=GeoTemConfig.getTimeData(y.getElementsByTagName("end")[0].childNodes[0].nodeValue);timeEnd=f.d;if(f.g>c){c=f.g}a=true}catch(v){if(!GeoTemConfig.incompleteData){continue}}}var z=new DataObject(B,s,b,l,1,w);z.setIndex(k);k++;u.push(z)}return u};function MapControl(e,c,b,f,a){var d=this;this.button=c;this.enabled=true;this.activated=false;this.label=b;if(this.button!=null){$(this.button).addClass(b+"Deactivated");$(this.button).attr("title",GeoTemConfig.getString(GeoTemConfig.language,b));$(this.button).click(function(){d.checkStatus()})}this.checkStatus=function(){if(d.enabled){if(typeof e.activeControl!="undefined"){if(d.activated){d.deactivate()}else{e.activeControl.deactivate();d.activate()}}else{d.activate()}}};this.setButtonClass=function(h,g){if(this.button!=null){$(this.button).removeClass(b+h);$(this.button).addClass(b+g);$(this.button).attr("title",GeoTemConfig.getString(GeoTemConfig.language,b))}};this.disable=function(){this.enabled=false;this.setButtonClass("Deactivated","Disabled")};this.enable=function(){this.enabled=true;this.setButtonClass("Disabled","Deactivated")};this.activate=function(){f();this.activated=true;this.setButtonClass("Deactivated","Activated");e.activeControl=this};this.deactivate=function(){a();this.activated=false;this.setButtonClass("Activated","Deactivated");e.activeControl=undefined}}CircleObject=function(h,g,f,e,a,d,j,c,b){this.originX=h;this.originY=g;this.shiftX=f;this.shiftY=e;this.elements=a;this.radius=d;this.search=j;this.weight=c;this.overlay=0;this.smoothness=0;this.fatherBin=b;this.feature;this.olFeature;this.percentage=0;this.selected=false};CircleObject.prototype={setFeature:function(a){this.feature=a},setOlFeature:function(a){this.olFeature=a},reset:function(){this.overlay=0;this.smoothness=0},setSelection:function(a){this.selected=a},toggleSelection:function(){this.selected=!this.selected}};function FilterBar(a,c){var b=this;this.filter=document.createElement("div");this.filter.setAttribute("class","smallButton filterDisabled");this.filter.onclick=function(){a.filtering()};this.filterInverse=document.createElement("div");this.filterInverse.setAttribute("class","smallButton filterInverseDisabled");this.filterInverse.onclick=function(){a.inverseFiltering()};if(!GeoTemConfig.inverseFilter){this.filterInverse.style.display="none"}this.cancelSelection=document.createElement("div");this.cancelSelection.setAttribute("class","smallButton filterCancelDisabled");this.cancelSelection.onclick=function(){a.deselection()};this.appendTo=function(d){d.appendChild(this.filter);d.appendChild(this.filterInverse);d.appendChild(this.cancelSelection)};if(typeof c!="undefined"){this.appendTo(c)}this.reset=function(d){if(d){this.filter.setAttribute("class","smallButton filter");this.filterInverse.setAttribute("class","smallButton filterInverse");this.cancelSelection.setAttribute("class","smallButton filterCancel")}else{this.filter.setAttribute("class","smallButton filterDisabled");this.filterInverse.setAttribute("class","smallButton filterInverseDisabled");this.cancelSelection.setAttribute("class","smallButton filterCancelDisabled")}}}function Selection(c,b){this.objects=c;if(typeof c=="undefined"){this.objects=[];for(var a=0;a<GeoTemConfig.datasets;a++){this.objects.push([])}}this.widget=b;this.getObjects=function(e){if(!this.equal(e)){return this.objects}this.objects=[];for(var d=0;d<GeoTemConfig.datasets;d++){this.objects.push([])}return this.objects};this.equal=function(d){if(this.valid()&&this.widget!=d){return false}return true};this.valid=function(){if(typeof this.widget!="undefined"){return true}return false}}function PlacenameTags(b,a){this.circle=b;this.map=a;this.placeLabels;this.selectedLabel;this.allLabel;this.othersLabel;this.unknownLabel;this.calculate=function(){this.calculateLabels();this.calculatePlacenameTags()};this.calculateLabels=function(){var d=this.circle.elements;var f=this.circle.search;var m=0;var n=[];var e=this.map.getLevelOfDetail();for(var l=0;l<d.length;l++){m+=d[l].weight;var s=false;var q=d[l].getPlace(this.map.options.mapIndex,e);if(q==""){q="unknown"}for(var h=0;h<n.length;h++){if(n[h].place==q){n[h].elements.push(d[l]);n[h].weight+=d[l].weight;s=true;break}}if(!s){n.push({id:d[l].name,place:q,elements:new Array(d[l]),weight:d[l].weight,index:f})}}var p=function(j,c){if(j.weight>c.weight){return -1}return 1};n.sort(p);if(a.options.maxPlaceLabels){var g=a.options.maxPlaceLabels;if(g==1){n=[];n.push({place:"all",elements:d,weight:m,index:f})}if(g==2){g++}if(g>2&&n.length+1>g){var o=[];var r=0;for(var l=g-2;l<n.length;l++){o=o.concat(n[l].elements);r+=n[l].weight}n=n.slice(0,g-2);n.push({place:"others",elements:o,weight:r,index:f})}if(g>1&&n.length>1){n.push({place:"all",elements:d,weight:m,index:f})}}this.placeLabels=n};this.calculatePlacenameTags=function(){var k=this;var n=GeoTemConfig.getColor(this.circle.search);var s="rgb("+n.r0+","+n.g0+","+n.b0+")";var r="rgb("+n.r1+","+n.g1+","+n.b1+")";var g="",j="",o="",p="",q="";if(GeoTemConfig.ie){o+=a.options.ieHighlightLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";j+=a.options.ieHoveredLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";p+=a.options.ieSelectedLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";q+=a.options.ieUnselectedLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";"}else{o+=a.options.highlightLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";j+=a.options.hoveredLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";p+=a.options.selectedLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";";q+=a.options.unselectedLabel.replace(/COLOR1/g,r).replace(/COLOR0/g,s)+";"}var f=function(c){c.div.onclick=function(){k.changeLabelSelection(c)}};var e=this.count;for(var m=0;m<this.placeLabels.length;m++){var h=this.placeLabels[m];h.selected=false;var d=document.createElement("div");d.setAttribute("class","tagCloudItem");var t=1+(h.weight-1)/this.map.count*a.options.maxLabelIncrease;if(h.place=="all"){t=1}d.style.fontSize=t+"em";h.allStyle=g+"font-size: "+t+"em;";h.selectedStyle=p;h.unselectedStyle=q;h.highlightStyle=o;h.hoverStyle=j;d.innerHTML=h.place+"<span style='font-size:"+(1/t)+"em'>&nbsp;("+h.weight+")</span>";h.div=d;f(h)}if(a.options.labelGrid){this.showPlacelabels()}else{for(var m=0;m<this.placeLabels.length;m++){this.placeLabels[m].div.setAttribute("style",this.placeLabels[m].allStyle+""+this.placeLabels[m].highlightStyle)}}};this.selectLabel=function(c){if(typeof c=="undefined"){c=this.placeLabels[this.placeLabels.length-1]}if(this.map.popup){this.map.popup.showLabelContent(c)}this.selectedLabel=c;this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.selectedStyle);this.map.mapLabelSelection(c)};this.changeLabelSelection=function(c){if(this.selectedLabel==c){return}if(typeof this.selectedLabel!="undefined"){this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.unselectedStyle)}this.selectLabel(c)};this.showPlacelabels=function(){this.leftDiv=document.createElement("div");this.leftDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.leftDiv);this.rightDiv=document.createElement("div");this.rightDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.rightDiv);for(var c=0;c<this.placeLabels.length;c++){if(c%2==0){this.leftDiv.appendChild(this.placeLabels[c].div)}else{this.rightDiv.appendChild(this.placeLabels[c].div)}this.placeLabels[c].div.setAttribute("style",this.placeLabels[c].allStyle+""+this.placeLabels[c].highlightStyle)}this.placeTagCloud()};this.placeTagCloud=function(){var h=new OpenLayers.LonLat(this.circle.feature.geometry.x,this.circle.feature.geometry.y);var c=a.openlayersMap.getPixelFromLonLat(h);var j=this.circle.feature.style.pointRadius;var e=this.leftDiv.offsetWidth;var d=this.rightDiv.offsetWidth;this.leftDiv.style.left=(c.x-j-e-5)+"px";this.rightDiv.style.left=(c.x+j+5)+"px";var l=this.leftDiv.offsetHeight;var k=this.rightDiv.offsetHeight;var g=c.y-l/2;var f=c.y-k/2;this.leftDiv.style.top=g+"px";this.rightDiv.style.top=f+"px"};this.remove=function(){$(this.leftDiv).remove();$(this.rightDiv).remove()}}function PackPlacenameTags(b,a){this.circle=b;this.map=a;this.placeLabels;this.selectedLabel;this.allLabel;this.othersLabel;this.unknownLabel;this.calculate=function(){this.calculateLabels();this.calculatePlacenameTags()};this.getLabelList=function(e){var d=e.elements;var g=e.search;var o=0;var p=[];var f=this.map.getLevelOfDetail();for(var m=0;m<d.length;m++){o+=d[m].weight;var v=false;var t=d[m].getPlace(this.map.options.mapIndex,f);if(t==""){t="unknown"}for(var l=0;l<p.length;l++){if(p[l].place==t){p[l].elements.push(d[m]);p[l].weight+=d[m].weight;v=true;break}}if(!v){p.push({id:d[m].name,place:t,elements:new Array(d[m]),weight:d[m].weight,index:g})}}var s=function(j,c){if(j.weight>c.weight){return -1}return 1};p.sort(s);var n=[];if(a.options.maxPlaceLabels){var h=a.options.maxPlaceLabels;if(h==1){p=[];p.push({place:"all",elements:d,weight:o,index:g})}if(h==2){h++}if(h>2&&p.length+1>h){var r=[];var u=0;for(var m=h-2;m<p.length;m++){r=r.concat(p[m].elements);u+=p[m].weight;n.push(p[m])}p=p.slice(0,h-2);var q={place:"others",elements:r,weight:u,index:g};p.push(q);this.othersLabels.push(q)}}if(p.length>1){p.push({place:"all",elements:d,weight:o,index:g})}this.placeLabels.push(p);this.droppedLabels.push(n)};this.calculateLabels=function(){var d=this.circle.circles;this.placeLabels=[];this.droppedLabels=[];this.othersLabels=[];for(var c=0;c<d.length;c++){this.getLabelList(d[c])}};this.calculatePlacenameTags=function(){var m=this;var y=[];var j=[];var e=[];for(var t=0;t<this.placeLabels.length;t++){var x=GeoTemConfig.getColor(this.circle.circles[t].search);var w="rgb("+x.r0+","+x.g0+","+x.b0+")";var v="rgb("+x.r1+","+x.g1+","+x.b1+")";var o="",n="",h="",r="",g="";if(GeoTemConfig.ie){h+=a.options.ieHighlightLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";n+=a.options.ieHoveredLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";r+=a.options.ieSelectedLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";g+=a.options.ieUnselectedLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";"}else{h+=a.options.highlightLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";n+=a.options.hoveredLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";r+=a.options.selectedLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";";g+=a.options.unselectedLabel.replace(/COLOR1/g,v).replace(/COLOR0/g,w)+";"}o+="margin-right:5px;";o+="margin-left:5px;";y.push(g);j.push(r);e.push(n);var d=function(c,k){c.div.onmouseover=function(){if(!c.opposite){var C,A;c.div.setAttribute("style",o+""+j[k]);var D=GeoTemConfig.getColor(k);var l="rgb("+D.r0+","+D.g0+","+D.b0+")";if(k==0){for(var z=0;z<m.droppedLabels[1].length;z++){if(m.droppedLabels[1][z].place==c.place){C=m.droppedLabels[1][z];m.rightDiv.appendChild(C.div);m.drawLine(m.ctxOl,c.div,C.div);var B=m.othersLabels[1].div;B.innerHTML=B.innerHTML.replace(/\(\d*\)/g,"("+(m.othersLabels[1].weight-C.weight)+")");break}}}else{for(var z=0;z<m.droppedLabels[0].length;z++){if(m.droppedLabels[0][z].place==c.place){C=m.droppedLabels[0][z];m.leftDiv.appendChild(C.div);m.drawLine(m.ctxOl,C.div,c.div);var B=m.othersLabels[0].div;B.innerHTML=B.innerHTML.replace(/\(\d*\)/g,"("+(m.othersLabels[0].weight-C.weight)+")");break}}}if(typeof C=="undefined"){C={div:m.naDiv};if(k==0){m.rightDiv.appendChild(m.naDiv);m.drawLine(m.ctxOl,c.div,m.naDiv);C.div.setAttribute("style",o+""+j[1])}else{m.leftDiv.appendChild(m.naDiv);m.drawLine(m.ctxOl,m.naDiv,c.div);C.div.setAttribute("style",o+""+j[0])}m.map.mapLabelHighlight(c)}else{m.map.mapLabelHighlight([c,C])}c.div.onmouseout=function(){c.div.setAttribute("style",o+""+y[k]);var F=m.othersLabels[0].div;F.innerHTML=F.innerHTML.replace(/\(\d*\)/g,"("+m.othersLabels[0].weight+")");var E=m.othersLabels[1].div;E.innerHTML=E.innerHTML.replace(/\(\d*\)/g,"("+m.othersLabels[1].weight+")");$(C.div).remove();m.ctxOl.clearRect(0,0,m.cvOl.width,m.cvOl.height);m.map.mapLabelHighlight()}}}};var p=this.count;for(var u=0;u<this.placeLabels[t].length;u++){var s=this.placeLabels[t][u];s.selected=false;var q=document.createElement("div");q.setAttribute("class","tagCloudItem");var f=1+(s.weight-1)/this.map.count*a.options.maxLabelIncrease;if(s.place=="all"){f=1}q.style.fontSize=f+"em";s.allStyle=o+"font-size: "+f+"em;";s.selectedStyle=r;s.unselectedStyle=g;s.hoverStyle=n;q.innerHTML=s.place+"<span style='font-size:"+(1/f)+"em'>&nbsp;("+s.weight+")</span>";s.div=q;d(s,t)}for(var u=0;u<this.droppedLabels[t].length;u++){var s=this.droppedLabels[t][u];s.selected=false;var q=document.createElement("div");q.setAttribute("class","tagCloudItem");var f=1+(s.weight-1)/this.map.count*a.options.maxLabelIncrease;q.style.fontSize=f+"em";s.allStyle=o+"font-size: "+f+"em;";s.selectedStyle=r;s.unselectedStyle=g;s.hoverStyle=n;q.innerHTML=s.place+"<span style='font-size:"+(1/f)+"em'>&nbsp;("+s.weight+")</span>";s.div=q;q.setAttribute("style",o+""+r)}}this.naDiv=document.createElement("div");this.naDiv.setAttribute("class","tagCloudItem");var f=1;q.style.fontSize=f+"em";s.allStyle=o+"font-size: "+f+"em;";s.selectedStyle=r;s.unselectedStyle=g;s.hoverStyle=n;this.naDiv.innerHTML="Not available";s.div=this.naDiv;if(a.options.labelGrid){this.showPlacelabels()}};this.showPlacelabels=function(){this.leftDiv=document.createElement("div");this.leftDiv.setAttribute("class","tagCloudDiv");this.leftDiv.style.textAlign="right";this.map.gui.mapWindow.appendChild(this.leftDiv);this.centerDiv=document.createElement("div");this.centerDiv.setAttribute("class","tagCloudDiv");this.centerDiv.style.opacity=0.7;this.map.gui.mapWindow.appendChild(this.centerDiv);this.centerDivOl=document.createElement("div");this.centerDivOl.setAttribute("class","tagCloudDiv");this.centerDivOl.style.opacity=0.7;this.map.gui.mapWindow.appendChild(this.centerDivOl);this.rightDiv=document.createElement("div");this.rightDiv.setAttribute("class","tagCloudDiv");this.rightDiv.style.textAlign="left";this.map.gui.mapWindow.appendChild(this.rightDiv);for(var d=0;d<this.placeLabels.length;d++){for(var c=0;c<this.placeLabels[d].length;c++){if(d==0){this.leftDiv.appendChild(this.placeLabels[d][c].div)}else{this.rightDiv.appendChild(this.placeLabels[d][c].div)}this.placeLabels[d][c].div.setAttribute("style",this.placeLabels[d][c].allStyle+""+this.placeLabels[d][c].unselectedStyle)}}this.placeTagCloud();this.setCanvas()};this.placeTagCloud=function(){var h=new OpenLayers.LonLat(this.circle.feature.geometry.x,this.circle.feature.geometry.y);var c=a.openlayersMap.getPixelFromLonLat(h);var j=this.circle.feature.style.pointRadius;var e=this.leftDiv.offsetWidth;var d=this.rightDiv.offsetWidth;this.leftDiv.style.left=(c.x-j-e-5)+"px";this.rightDiv.style.left=(c.x+j+5)+"px";var l=this.leftDiv.offsetHeight;var k=this.rightDiv.offsetHeight;var g=c.y-l/2;var f=c.y-k/2;this.leftDiv.style.top=g+"px";this.rightDiv.style.top=f+"px"};this.setCanvas=function(){var c=Math.max(this.leftDiv.offsetHeight,this.rightDiv.offsetHeight);var h=Math.min(this.leftDiv.offsetTop,this.rightDiv.offsetTop);var g=this.leftDiv.offsetLeft+this.leftDiv.offsetWidth;this.width=this.rightDiv.offsetLeft-g;this.centerDiv.style.left=g+"px";this.centerDiv.style.top=h+"px";this.centerDiv.style.height=c+"px";this.centerDiv.style.width=this.width+"px";this.centerDivOl.style.left=g+"px";this.centerDivOl.style.top=h+"px";this.centerDivOl.style.height=c+"px";this.centerDivOl.style.width=this.width+"px";var d=document.createElement("canvas");this.centerDiv.appendChild(d);if(!d.getContext&&G_vmlCanvasManager){d=G_vmlCanvasManager.initElement(d)}d.width=this.width;d.height=c;ctx=d.getContext("2d");this.cvOl=document.createElement("canvas");this.centerDivOl.appendChild(this.cvOl);if(!this.cvOl.getContext&&G_vmlCanvasManager){this.cvOl=G_vmlCanvasManager.initElement(this.cvOl)}this.cvOl.width=this.width;this.cvOl.height=c+50;this.ctxOl=this.cvOl.getContext("2d");for(var f=0;f<this.placeLabels[0].length;f++){this.placeLabels[0][f].opposite=false}for(var f=0;f<this.placeLabels[1].length;f++){this.placeLabels[1][f].opposite=false}for(var f=0;f<this.placeLabels[0].length;f++){for(var e=0;e<this.placeLabels[1].length;e++){if(this.placeLabels[0][f].place==this.placeLabels[1][e].place){this.drawLine(ctx,this.placeLabels[0][f].div,this.placeLabels[1][e].div);this.placeLabels[0][f].opposite=true;this.placeLabels[1][e].opposite=true}}}};this.drawLine=function(c,j,h){var e=5;var d=this.width-5;var g=j.offsetTop+j.offsetHeight/2;var f=h.offsetTop+h.offsetHeight/2;if(this.leftDiv.offsetTop>this.rightDiv.offsetTop){g+=this.leftDiv.offsetTop-this.rightDiv.offsetTop}else{f+=this.rightDiv.offsetTop-this.leftDiv.offsetTop}c.lineCap="round";c.lineWidth=5;c.beginPath();c.moveTo(e,g);c.lineTo(d,f);c.strokeStyle="#555";c.stroke()};this.remove=function(){$(this.leftDiv).remove();$(this.rightDiv).remove();$(this.centerDiv).remove();$(this.centerDivOl).remove()}}function MapConfig(a){this.options={mapWidth:false,mapHeight:"580px",mapTitle:"GeoTemCo Map View",mapIndex:0,alternativeMap:false,googleMaps:false,bingMaps:false,bingApiKey:"none",osmMaps:true,baseLayer:"Open Street Map",resetMap:true,countrySelect:true,polygonSelect:true,circleSelect:true,squareSelect:true,multiSelection:true,popups:true,olNavigation:false,olLayerSwitcher:false,olMapOverview:false,olKeyboardDefaults:true,olScaleLine:false,geoLocation:true,boundaries:{minLon:-29,minLat:35,maxLon:44,maxLat:67},mapCanvasFrom:"#9db9d8",mapCanvasTo:"#5783b5",labelGrid:true,maxPlaceLabels:0,selectDefault:true,maxLabelIncrease:2,labelHover:true,ieHighlightLabel:"color: COLOR1; background-color: COLOR0; filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';",highlightLabel:"color: COLOR0; text-shadow: 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em COLOR0;",ieSelectedLabel:"color: COLOR1; font-weight: bold;",selectedLabel:"color: COLOR1; font-weight: bold;",ieUnselectedLabel:"color: COLOR1; font-weight: normal;",unselectedLabel:"color: COLOR1; font-weight: normal;",ieHoveredLabel:"color: COLOR1; font-weight: bold;",hoveredLabel:"color: COLOR1; font-weight: bold;",circleGap:0,minimumRadius:4,circleOutline:true,circleTransparency:true,minTransparency:0.4,maxTransparency:0.8,binning:"generic",noBinningRadii:"dynamic",circlePackings:true,binCount:10,showDescriptions:true,mapSelection:true,binningSelection:false,mapSelectionTools:true,dataInformation:true,overlayVisibility:false,proxyHost:""};if(typeof a!="undefined"){$.extend(this.options,a)}}MapGuiCanvasEmulation=false;function MapGui(b,a,m){this.map=b;this.container=a;if(m.mapWidth){this.container.style.width=m.mapWidth}if(m.mapHeight){this.container.style.height=m.mapHeight}this.container.style.position="relative";this.mapWindow=document.createElement("div");this.mapWindow.id="mapWindow";this.container.appendChild(this.mapWindow);this.mapContainer=document.createElement("div");this.mapContainer.id="mapContainer";this.mapContainer.style.position="absolute";this.mapContainer.style.zIndex=0;this.mapWindow.appendChild(this.mapContainer);if(MapGuiCanvasEmulation){if(typeof console!="undefined"){console.warn("With canvas emulation")}this.background=document.createElement("canvas");this.background.setAttribute("class","mapCanvas");this.mapWindow.appendChild(this.background);if(!this.background.getContext&&G_vmlCanvasManager){this.background=G_vmlCanvasManager.initElement(this.background)}}else{if(typeof console!="undefined"){console.warn("No canvas emulation")}}var j=document.createElement("table");j.setAttribute("class","absoluteToolbar ddbToolbar");this.container.appendChild(j);this.mapToolbar=j;var g=document.createElement("tr");j.appendChild(g);var h=document.createElement("tr");j.appendChild(h);if(m.mapSelection){this.mapTypeTitle=document.createElement("td");g.appendChild(this.mapTypeTitle);this.mapTypeTitle.innerHTML=GeoTemConfig.getString("mapType");this.mapTypeSelector=document.createElement("td");h.appendChild(this.mapTypeSelector)}if(m.mapSelectionTools){this.mapSelectorTitle=document.createElement("td");g.appendChild(this.mapSelectorTitle);this.mapSelectorTitle.innerHTML=GeoTemConfig.getString("mapSelectorTools");var k=document.createElement("td");var l=this.map.initSelectorTools();for(var f in l){k.appendChild(l[f].button)}h.appendChild(k)}if(m.binningSelection){this.binningTitle=document.createElement("td");g.appendChild(this.binningTitle);this.binningTitle.innerHTML=GeoTemConfig.getString("binningType");this.binningSelector=document.createElement("td");h.appendChild(this.binningSelector)}if(GeoTemConfig.allowFilter){this.filterTitle=document.createElement("td");g.appendChild(this.filterTitle);this.filterTitle.innerHTML=GeoTemConfig.getString("filter");this.filterOptions=document.createElement("td");h.appendChild(this.filterOptions)}if(m.dataInformation){this.infoTitle=document.createElement("td");this.infoTitle.innerHTML=m.mapTitle;g.appendChild(this.infoTitle);var e=document.createElement("td");this.mapElements=document.createElement("div");this.mapElements.setAttribute("class","ddbElementsCount");e.appendChild(this.mapElements);h.appendChild(e)}var c=this;if(navigator.geolocation&&m.geoLocation){this.geoActive=false;this.geoLocation=document.createElement("div");this.geoLocation.setAttribute("class","geoLocationOff");this.geoLocation.title=GeoTemConfig.getString("activateGeoLocation");this.container.appendChild(this.geoLocation);this.geoLocation.style.left="20px";this.geoLocation.onclick=function(){var n=function(){if(c.geoActive){c.geoLocation.setAttribute("class","geoLocationOn");c.geoLocation.title=GeoTemConfig.getString(GeoTemConfig.language,"deactivateGeoLocation")}else{c.geoLocation.setAttribute("class","geoLocationOff");c.geoLocation.title=GeoTemConfig.getString(GeoTemConfig.language,"activateGeoLocation")}};if(!c.geoActive){if(typeof c.longitude=="undefined"){navigator.geolocation.getCurrentPosition(function(o){c.longitude=o.coords.longitude;c.latitude=o.coords.latitude;c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;n()},function(o){if(typeof console!="undefined"){console.log(typeof o=="string"?o:"error")}})}else{c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;n()}}else{c.map.removeMarker();c.geoActive=false;n()}}}if(!m.olNavigation){this.map.zoomSlider=new MapZoomSlider(this.map,"vertical");this.container.appendChild(this.map.zoomSlider.div);this.map.zoomSlider.div.style.left="20px";this.map.zoomSlider.setLanguage()}if(m.resetMap){this.homeButton=document.createElement("div");this.homeButton.setAttribute("class","mapHome");this.homeButton.title=GeoTemConfig.getString("home");this.container.appendChild(this.homeButton);this.homeButton.style.left="20px";var d=this.map;this.homeButton.onclick=function(){if(d.popup){d.popup.reset()}if(m.detailedViewSpec){b.centerAndMarkPosition()}else{c.map.drawObjectLayer(true)}}}this.resize=function(){var p=this.container.offsetWidth;var q=this.container.offsetHeight;this.mapWindow.style.height=q+"px";this.mapContainer.style.height=q+"px";var t=j.offsetHeight+20;if(m.olLayerSwitcher){var s=$(".olControlLayerSwitcher")[0];$(s).css("top",t+"px")}if(typeof this.geoLocation!="undefined"){this.geoLocation.style.top=t+"px";t+=this.geoLocation.offsetHeight+4}if(m.olNavigation){var u=$(".olControlPanZoom")[0];$(u).css("top",t+"px");$(u).css("left","12px");var o=document.getElementById("OpenLayers.Control.PanZoom_23_zoomout");t+=$(o).height()+$(o).position().top+4}else{this.map.zoomSlider.div.style.top=t+"px";t+=this.map.zoomSlider.div.offsetHeight+2}if(m.resetMap){this.homeButton.style.top=t+"px"}if(MapGuiCanvasEmulation){this.background.width=p;this.background.height=q;var n=this.background.getContext("2d");var r=n.createLinearGradient(0,0,0,q);r.addColorStop(0,m.mapCanvasFrom);r.addColorStop(1,m.mapCanvasTo);n.fillStyle=r;n.fillRect(0,0,p,q)}this.headerHeight=j.offsetHeight;this.headerWidth=j.offsetWidth};this.updateSpaceQuantity=function(n){if(!m.dataInformation){return}this.mapCount=n;if(n!=1){this.mapElements.innerHTML=this.beautifyCount(n)+" "+GeoTemConfig.getString("results")}else{this.mapElements.innerHTML=this.beautifyCount(n)+" "+GeoTemConfig.getString("result")}};this.setMapsDropdown=function(){if(!m.mapSelection){return}$(this.mapTypeSelector).empty();var q=[];var o=this;var n=function(s,r){var t=function(){o.map.setMap(r)};q.push({name:s,onclick:t})};for(var p=0;p<this.map.baseLayers.length;p++){n(this.map.baseLayers[p].name,p)}this.mapTypeDropdown=new Dropdown(this.mapTypeSelector,q,GeoTemConfig.getString("selectMapType"))};this.setMap=function(){if(m.mapSelection){this.mapTypeDropdown.setEntry(this.map.baselayerIndex)}};this.setBinningDropdown=function(){if(!m.binningSelection){return}$(this.binningSelector).empty();var p=[];var n=this;var o=0;var s;var r=function(u,v){if(m.binning==v){s=o}else{o++}var t=function(){m.binning=v;n.map.initWidget(n.map.datasets,false);n.map.riseLayer()};p.push({name:u,onclick:t})};r(GeoTemConfig.getString("genericBinning"),"generic");r(GeoTemConfig.getString("squareBinning"),"square");r(GeoTemConfig.getString("hexagonalBinning"),"hexagonal");r(GeoTemConfig.getString("triangularBinning"),"triangular");r(GeoTemConfig.getString("noBinning"),false);var q=new Dropdown(this.binningSelector,p,GeoTemConfig.getString("binningTooltip"));q.setEntry(s)};this.setBinningDropdown();this.beautifyCount=function(o){var r=o+"";var q=0;var n=r.length;while(n-q>3){q+=3;r=r.substring(0,n-q)+"."+r.substring(n-q);q++;n++}return r};$(window).resize(function(){})}function MapWidget(a,c,b){this.core=a;this.core.setWidget(this);this.openlayersMap;this.baseLayers;this.objectLayer;this.drawPolygon;this.drawCircle;this.selectCountry;this.dragArea;this.selectFeature;this.navigation;this.div=c;this.options=(new MapConfig(b)).options;this.formerCP=this.options.circlePackings;this.gui=new MapGui(this,this.div,this.options);this.initialize()}MapWidget.prototype={initialize:function(){var d=this;if(d.options.proxyHost){OpenLayers.ProxyHost=d.options.proxyHost}this.polygons=[];this.connections=[];this.selection=new Selection();this.wmsOverlays=[];this.layerZIndex=1;this.zIndices=[];var e=function(){d.dragArea.activate()};var c=function(){d.dragArea.deactivate()};this.dragControl=new MapControl(this,null,"drag",e,c);var n="http://www.openstreetmap.org/";var p="http://creativecommons.org/licenses/by-sa/2.0/";this.osmLink=document.createElement("div");this.osmLink.setAttribute("class","osmLink");this.osmLink.innerHTML="© <a href="+n+">OpenStreetMap contributors</a>, <a href="+p+">CC-BY-SA</a>";this.gui.mapWindow.appendChild(this.osmLink);this.filterBar=new FilterBar(this,this.gui.filterOptions);this.objectLayer=new OpenLayers.Layer.Vector("Data Objects",{projection:"EPSG:4326",displayInLayerSwitcher:false,rendererOptions:{zIndexing:true}});this.markerLayer=new OpenLayers.Layer.Markers("Markers");this.navigation=new OpenLayers.Control.Navigation({zoomWheelEnabled:GeoTemConfig.mouseWheelZoom});this.navigation.defaultDblClick=function(s){if(d.popup){d.popup.reset()}var r=this.map.getLonLatFromViewPortPx(s.xy);this.map.setCenter(r,this.map.zoom+1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}};this.navigation.wheelUp=function(r){if(d.popup){d.popup.reset()}this.wheelChange(r,1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}d.core.triggerHighlight([])};this.navigation.wheelDown=function(r){if(d.popup){d.popup.reset()}this.wheelChange(r,-1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}d.core.triggerHighlight([])};this.resolutions=[78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677];var q={controls:[this.navigation],projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),resolutions:this.resolutions,units:"meters",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)};this.openlayersMap=new OpenLayers.Map("mapContainer",q);if(d.options.navigate){this.activeControl="navigate"}this.mds=new MapDataSource(this.openlayersMap,this.options);if(d.options.olNavigation){var g=new OpenLayers.Control.PanZoom();g.onButtonClick=function(r){var s=r.buttonElement;switch(s.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":if(d.popup){d.popup.reset()}d.zoom(1);break;case"zoomout":if(d.popup){d.popup.reset()}d.zoom(-1);break;case"zoomworld":if(this.map){if(d.popup){d.popup.reset()}d.zoom(this.map.zoom*-1)}break}};this.openlayersMap.addControl(g)}if(d.options.popups){var h=function(){if(d.selectedGlyph){var s=new OpenLayers.LonLat(d.selectedGlyph.lon,d.selectedGlyph.lat);var r=d.openlayersMap.getPixelFromLonLat(s);if(d.popup){d.popup.shift(r.x,r.y)}}};this.openlayersMap.events.register("move",this.openlayersMap,h)}if(d.options.olMapOverview){this.openlayersMap.addControl(new OpenLayers.Control.OverviewMap())}if(d.options.olKeyboardDefaults){var l=new OpenLayers.Control.KeyboardDefaults();l.defaultKeyPress=function(r){switch(r.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var s=this.map.getSize();this.map.pan(0,-0.75*s.h);break;case 34:var s=this.map.getSize();this.map.pan(0,0.75*s.h);break;case 35:var s=this.map.getSize();this.map.pan(0.75*s.w,0);break;case 36:var s=this.map.getSize();this.map.pan(-0.75*s.w,0);break;case 43:case 61:case 187:case 107:d.zoom(1);break;case 45:case 109:case 189:case 95:d.zoom(-1);break}};this.openlayersMap.addControl(l)}if(d.options.olLayerSwitcher){this.openlayersMap.addControl(new OpenLayers.Control.LayerSwitcher())}if(d.options.olScaleLine){this.openlayersMap.addControl(new OpenLayers.Control.ScaleLine())}this.gui.resize();this.openlayersMap.updateSize();this.setBaseLayers();this.gui.setMapsDropdown();this.gui.setMap();this.openlayersMap.addLayers([this.objectLayer,this.markerLayer]);if(d.options.boundaries){var f=d.options.boundaries;var b=new OpenLayers.Bounds(f.minLon,f.minLat,f.maxLon,f.maxLat);var o=b.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.zoomToExtent(o)}else{this.openlayersMap.zoomToMaxExtent()}this.drawnPolygonHandler=function(z){if(d.mds.getAllObjects()==null){return}var s;if(z instanceof OpenLayers.Geometry.Polygon){s=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon([z]))}else{if(z instanceof OpenLayers.Geometry.MultiPolygon){s=new OpenLayers.Feature.Vector(z)}}d.polygons.push(s);var r=$.extend(true,{},OpenLayers.Feature.Vector.style["default"]);r.graphicZIndex=0;s.style=r;d.objectLayer.addFeatures([s]);try{d.activeControl.deactivate()}catch(x){}var w=d.mds.getObjectsByZoom();for(var v=0;v<w.length;v++){for(var u=0;u<w[v].length;u++){var y=w[v][u];if(d.inPolygon(y)){if(typeof y.fatherBin!="undefined"){for(var t=0;t<y.fatherBin.circles.length;t++){if(y.fatherBin.circles[t]){y.fatherBin.circles[t].setSelection(true)}}}else{y.setSelection(true)}}}}d.mapSelection()};this.polygonDeselection=function(){var t=d.mds.getObjectsByZoom();for(var s=0;s<t.length;s++){for(var r=0;r<t[s].length;r++){var u=t[s][r];if(d.inPolygon(u)){u.setSelection(false)}}}};this.snapper=function(){if(d.polygons.length==0||!d.options.multiSelection){d.deselection()}};if(d.options.polygonSelect){this.drawPolygon=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawPolygon)}if(d.options.circleSelect){this.drawCircle=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:40},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawCircle)}if(d.options.squareSelect){this.drawSquare=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:4},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawSquare)}if(d.options.polygonSelect||d.options.circleSelect||d.options.squareSelect){this.dragArea=new OpenLayers.Control.DragFeature(d.objectLayer,{onStart:function(r){r.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(r){r.style.graphicZIndex=0;d.drawnPolygonHandler(r.geometry)}});this.openlayersMap.addControl(this.dragArea);this.modifyArea=new OpenLayers.Control.ModifyFeature(d.objectLayer,{onStart:function(r){r.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(r){r.style.graphicZIndex=0;d.drawnPolygonHandler(r.geometry)}});this.openlayersMap.addControl(this.modifyArea);this.modifyArea.mode=OpenLayers.Control.ModifyFeature.RESHAPE}var a=function(s){var r=s.feature;if(r.geometry instanceof OpenLayers.Geometry.Point){if(typeof d.placenameTags!="undefined"){d.placenameTags.remove()}var t=s.feature.parent;if(t instanceof CircleObject){t.placenameTags=new PlacenameTags(t,d);d.placenameTags=t.placenameTags}else{return}t.placenameTags.calculate();d.mapCircleHighlight(r.parent,false);if(typeof d.featureInfo!="undefined"){d.featureInfo.deactivate()}}else{d.dragControl.checkStatus()}};var j=function(s){var r=s.feature;if(r.geometry instanceof OpenLayers.Geometry.Point){var t=s.feature.parent;if(!(t instanceof CircleObject)){return}t.placenameTags.remove();d.mapCircleHighlight(r.parent,true);if(typeof d.featureInfo!="undefined"){d.featureInfo.activate()}}else{d.dragControl.deactivate()}};var m=new OpenLayers.Control.SelectFeature(this.objectLayer,{hover:true,highlightOnly:true,renderIntent:"temporary",eventListeners:{featurehighlighted:a,featureunhighlighted:j}});this.openlayersMap.addControl(m);m.activate();this.selectFeature=new OpenLayers.Control.SelectFeature(this.objectLayer);document.onkeydown=function(r){if(typeof r!="undefined"&&r.ctrlKey){d.ctrlKey=true}};document.onkeyup=function(r){d.ctrlKey=false};var k=function(t,r){if(!(t.feature.geometry instanceof OpenLayers.Geometry.Point)){return}var v=t.feature.parent;if(d.options.multiSelection&&d.ctrlKey){if(d.popup){d.popup.reset();d.selectedGlyph=false}v.toggleSelection();d.mapSelection();return}d.reset();v.setSelection(true);d.objectLayer.drawFeature(v.feature);if(d.options.popups){if(d.popup){d.popup.reset()}var u=t.feature.geometry.getBounds().getCenterLonLat();var s=d.openlayersMap.getPixelFromLonLat(u);d.selectedGlyph={lon:u.lon,lat:u.lat};d.popup=new PlacenamePopup(d);d.popup.createPopup(s.x,s.y,v.placenameTags.placeLabels);if(d.options.selectDefault){v.placenameTags.selectLabel()}}};this.objectLayer.events.on({featureselected:k});this.openlayersMap.addControl(this.selectFeature);this.selectFeature.activate();if(this.zoomSlider){this.zoomSlider.setMaxAndLevels(1000,this.openlayersMap.getNumZoomLevels());this.zoomSlider.setValue(this.openlayersMap.getZoom())}},shift:function(b,a){this.openlayersMap.pan(b,a)},addBaseLayers:function(c){if(c instanceof Array){for(var b in c){var a=new OpenLayers.Layer.WMS(c[b].name,c[b].url,{projection:"EPSG:4326",layers:c[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:true});this.baseLayers.push(a);this.openlayersMap.addLayers([a])}}this.gui.setMapsDropdown()},setBaseLayers:function(){this.baseLayers=[];if(this.options.googleMaps){var a=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,minZoomLevel:1,maxZoomLevel:19});var c=new OpenLayers.Layer.Google("Google Streets",{minZoomLevel:1,maxZoomLevel:19});var g=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,minZoomLevel:1,maxZoomLevel:19});var f=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,minZoomLevel:1,maxZoomLevel:19});this.baseLayers.push(a);this.baseLayers.push(c);this.baseLayers.push(g);this.baseLayers.push(f)}if(this.options.bingMaps){var j=this.options.bingApiKey;var d=new OpenLayers.Layer.Bing({name:"Road",key:j,type:"Road"});var l=new OpenLayers.Layer.Bing({name:"Hybrid",key:j,type:"AerialWithLabels"});var k=new OpenLayers.Layer.Bing({name:"Aerial",key:j,type:"Aerial"});this.baseLayers.push(d);this.baseLayers.push(l);this.baseLayers.push(k)}if(this.options.osmMaps){var e="maps.deutsche-digitale-bibliothek.de";var b=["http://a.tile."+e+"/${z}/${x}/${y}.png","http://b.tile."+e+"/${z}/${x}/${y}.png","http://c.tile."+e+"/${z}/${x}/${y}.png"];if(typeof console!="undefined"){console.log("new Openlayers.Layers.OSM('OpenStreetMap', '"+b+"', {..}")}this.baseLayers.push(new OpenLayers.Layer.OSM("Open Street Map",b,{sphericalMercator:true,zoomOffset:1,resolutions:this.resolutions}))}for(var h=0;h<this.baseLayers.length;h++){this.openlayersMap.addLayers([this.baseLayers[h]])}if(this.options.alternativeMap){this.addBaseLayers([this.options.alternativeMap])}for(var h=0;h<this.baseLayers.length;h++){if(this.baseLayers[h].name==this.options.baseLayer){this.setMap(h)}}},getBaseLayerName:function(){return this.openlayersMap.baseLayer.name},setOverlays:function(e){var d=this;for(var b in this.wmsOverlays){this.openlayersMap.removeLayer(this.wmsOverlays[b])}this.wmsOverlays=[];var c=[];if(e instanceof Array){for(var b in e){var a=new OpenLayers.Layer.WMS(e[b].name,e[b].url,{projection:"EPSG:4326",layers:e[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:false,visibility:d.options.overlayVisibility});this.wmsOverlays.push(a);if(e[b].featureInfo){c.push(a)}}this.openlayersMap.addLayers(this.wmsOverlays)}if(this.wmsOverlays.length>0&&d.options.overlayVisibility){var d=this;if(typeof this.featureInfo!="undefined"){this.featureInfo.deactivate();this.openlayersMap.removeControl(this.featureInfo)}this.featureInfo=new OpenLayers.Control.WMSGetFeatureInfo({url:"/geoserver/wms",layers:c,eventListeners:{getfeatureinfo:function(f){if(f.text==""){return}var g=d.openlayersMap.getLonLatFromPixel(new OpenLayers.Pixel(f.xy.x,f.xy.y));d.selectedGlyph={lon:g.lon,lat:g.lat};if(typeof d.popup!="undefined"){d.popup.reset()}d.popup=new MapPopup(d);d.popup.initialize(f.xy.x,f.xy.y);d.popup.setContent(f.text)}}});this.openlayersMap.addControl(this.featureInfo);this.featureInfo.activate();this.activateCountrySelector(this.wmsOverlays[this.wmsOverlays.length-1])}else{this.deactivateCountrySelector();if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.activateCountrySelector(this.openlayersMap.baseLayer)}}},addBaseLayer:function(b){this.baseLayers.push(b);this.openlayersMap.addLayers([b]);for(var a in this.baseLayers){if(this.baseLayers[a].name==this.options.baseLayer){this.setMap(a)}}},drawObjectLayer:function(b){if(typeof this.placenameTags!="undefined"){this.placenameTags.remove()}var w=this.mds.getAllObjects();if(w==null){return}this.objectLayer.removeAllFeatures();if(b){var c,s,a,n;if(this.options.boundaries){var A=this.options.boundaries;var h=new OpenLayers.Bounds(A.minLon,A.minLat,A.maxLon,A.maxLat);var B=h.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.zoomToExtent(B)}else{var f=w[w.length-1];for(var z=0;z<f.length;z++){for(var v=0;v<f[z].length;v++){var u=f[z][v];if(a==null||u.originX<a){a=u.originX}if(n==null||u.originX>n){n=u.originX}if(c==null||u.originY<c){c=u.originY}if(s==null||u.originY>s){s=u.originY}}}if(a==n&&c==s){this.openlayersMap.setCenter(new OpenLayers.LonLat(a,c))}else{var g=0.1*(n-a);var e=0.1*(s-c);var d=(this.gui.headerHeight/this.gui.mapWindow.offsetHeight+0.1)*(s-c);this.openlayersMap.zoomToExtent(new OpenLayers.Bounds(a-g,c-e,n+g,s+d));this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()))}}if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}var k=this.mds.getObjectsByZoom();var t=this.openlayersMap.getResolution();for(var z=0;z<k.length;z++){for(var v=0;v<k[z].length;v++){var q=k[z][v];var m=q.originX+t*q.shiftX;var l=q.originY+t*q.shiftY;q.feature.geometry.x=m;q.feature.geometry.y=l;q.olFeature.geometry.x=m;q.olFeature.geometry.y=l;q.feature.style.graphicZIndex=this.zIndices[z];q.olFeature.style.graphicZIndex=this.zIndices[z]+1;this.objectLayer.addFeatures([q.feature]);this.objectLayer.addFeatures([q.olFeature])}}var o=this.openlayersMap.getZoom();var r=function(p,j){return Math.sqrt((p.x-j.x)*(p.x-j.x)+(p.y-j.y)*(p.y-j.y))};this.highlightChanged(this.selection.getObjects(this.core))},riseLayer:function(a){this.lastId=a;if(typeof a=="undefined"){a=this.lastId||0}this.zIndices[a]=this.layerZIndex;this.layerZIndex+=2;this.reset();this.drawObjectLayer(false)},initWidget:function(m,a){this.clearMap();this.datasets=m;var z=[];for(var x=0;x<m.length;x++){z.push(m[x].objects)}if(z.length>4){this.options.circlePackings=false}else{this.options.circlePackings=this.formerCP}if(typeof z=="undefined"){return}this.count=0;this.objectCount=0;for(var x=0;x<z.length;x++){var B=0;for(var u=0;u<z[x].length;u++){if(z[x][u].isGeospatial){B+=z[x][u].weight;this.objectCount++}}this.count+=B;this.zIndices.push(this.layerZIndex);this.layerZIndex+=2}this.mds.initialize(z);var v=this.mds.getAllObjects();if(v==null){return}var n=function(c){return Math.PI*c*c};for(var x=0;x<v.length;x++){var A=0;var l=0;for(var u=0;u<v[x].length;u++){for(var t=0;t<v[x][u].length;t++){if(v[x][u][t].radius>l){l=v[x][u][t].radius;A=n(l)}}}var g=n(this.options.minimumRadius);var o=A-g;for(var u=0;u<v[x].length;u++){for(var t=0;t<v[x][u].length;t++){var r=v[x][u][t];var B=GeoTemConfig.getColor(r.search);var q=1;if(this.options.circleTransparency){var s=this.options.minTransparency;var w=this.options.maxTransparency;q=s+Math.abs(s-w)*(1-(n(r.radius)-g)/o)}var f=this.options.circleOutline;var y={fillColor:"rgb("+B.r0+","+B.g0+","+B.b0+")",fillOpacity:q,strokeWidth:2,strokeColor:"rgb("+B.r1+","+B.g1+","+B.b1+")",stroke:f,pointRadius:r.radius,cursor:"pointer"};var e=new OpenLayers.Geometry.Point(r.originX,r.originY,null);var h=new OpenLayers.Feature.Vector(e);h.style=y;h.parent=r;r.setFeature(h);var b={fillColor:"rgb("+B.r1+","+B.g1+","+B.b1+")",fillOpacity:q,stroke:false,pointRadius:0,cursor:"pointer"};var d=new OpenLayers.Geometry.Point(r.originX,r.originY,null);var p=new OpenLayers.Feature.Vector(d);p.style=b;p.parent=r;r.setOlFeature(p)}}}if(typeof a=="undefined"){this.drawObjectLayer(true)}else{this.drawObjectLayer(a)}this.gui.updateSpaceQuantity(this.count)},reset:function(){if(typeof this.placenameTags!="undefined"){this.placenameTags.remove()}this.objectLayer.removeFeatures(this.polygons);this.polygons=[];this.objectLayer.removeFeatures(this.connections);this.connections=[];this.selectFeature.unselectAll();this.selectedGlyph=false;if(this.dragControl.activated){this.dragControl.deactivate()}if(this.popup){this.popup.reset()}this.filterBar.reset(false);var c=this.mds.getObjectsByZoom();if(c==null){return}for(var b=0;b<c.length;b++){for(var a=0;a<c[b].length;a++){c[b][a].setSelection(false)}}},clearMap:function(){this.reset();this.selection=new Selection();this.zIndices=[];this.layerZIndex=1;this.objectLayer.destroyFeatures()},updatePoint:function(a,b){var c=this.mds.binning.getRadius(a.overlay);if(c!=a.olFeature.style.pointRadius){a.olFeature.style.pointRadius=c;if(b.containsPoint(a.feature.geometry)){this.objectLayer.drawFeature(a.olFeature)}}},highlightChanged:function(e){this.mds.clearOverlay();if(this.selection.valid()){this.mds.setOverlay(GeoTemConfig.mergeObjects(e,this.selection.getObjects()))}else{this.mds.setOverlay(e)}var d=this.mds.getObjectsByZoom();var c=this.openlayersMap.getExtent().toGeometry();for(var b in d){for(var a in d[b]){this.updatePoint(d[b][a],c)}}this.displayConnections()},selectionChanged:function(a){this.reset();this.selection=a;this.highlightChanged(a.objects)},inPolygon:function(a){for(var d=0;d<this.polygons.length;d++){var c=this.polygons[d].geometry;for(var b=0;b<c.components.length;b++){if(c.components[b].containsPoint(a.feature.geometry)){return true}}}return false},mapSelection:function(){var a=[];for(var d=0;d<this.mds.size();d++){a.push([])}var e=this.mds.getObjectsByZoom();for(var d=0;d<e.length;d++){for(var b=0;b<e[d].length;b++){var f=e[d][b];if(f.selected){a[d]=a[d].concat(f.elements)}}}this.selection=new Selection(a,this);this.highlightChanged(a);this.core.triggerSelection(this.selection);this.filterBar.reset(true)},deselection:function(){this.reset();this.selection=new Selection();this.highlightChanged([]);this.core.triggerSelection(this.selection)},filtering:function(){for(var a=0;a<this.datasets.length;a++){this.datasets[a].objects=this.selection.objects[a]}this.core.triggerRefining(this.datasets)},inverseFiltering:function(){var a=[];for(var d=0;d<this.mds.size();d++){a.push([])}var e=this.mds.getObjectsByZoom();for(var d=0;d<e.length;d++){for(var b=0;b<e[d].length;b++){var f=e[d][b];if(!f.selected){a[d]=a[d].concat(f.elements)}}}this.selection=new Selection(a,this);this.filtering()},mapCircleHighlight:function(d,a){if(this.polygons.length>0&&this.inPolygon(d)){return}var c=[];for(var b=0;b<this.mds.size();b++){c.push([])}if(!a&&!d.selected){c[d.search]=d.elements}this.objectLayer.drawFeature(d.feature);this.core.triggerHighlight(c)},mapLabelSelection:function(b){var a=[];for(var c=0;c<this.mds.size();c++){a.push([])}a[b.index]=b.elements;this.selection=new Selection(a,this);this.highlightChanged(a);this.core.triggerSelection(this.selection);this.filterBar.reset(true)},displayConnections:function(){return;if(typeof this.connection!="undefined"){this.objectLayer.removeFeatures(this.connections);this.connections=[]}if(this.options.connections){var u=this.mds.getObjectsByZoom();for(var v in u){for(var t in u[v]){}}var b=this.core.timeplot.getSlices();for(var v=0;v<b.length;v++){for(var t=0;t<b[v].stacks.length;t++){var x=b[v].stacks[t].elements;if(x.length==0){continue}var u=[];for(var r=0;r<x.length;r++){var p=this.mds.getCircle(t,x[r].index).feature.geometry;if(arrayIndex(u,p)==-1){u.push(p)}}var s=new AdjMatrix(u.length);for(var r=0;r<u.length-1;r++){for(var q=r+1;q<u.length;q++){s.setEdge(r,q,dist(u[r],u[q]))}}var o=Prim(s);var a=[];for(var g=0;g<o.length;g++){a.push(new OpenLayers.Geometry.LineString(new Array(u[o[g].v1],u[o[g].v2])))}this.connections[t].push({first:this.mds.getCircle(t,x[0].index).feature.geometry,last:this.mds.getCircle(t,x[x.length-1].index).feature.geometry,lines:a,time:b[v].date})}}var A=this.core.timeplot.leftFlagTime;var f=this.core.timeplot.rightFlagTime;if(A==undefined||A==null){return}else{A=A.getTime();f=f.getTime()}if(thisConnections){for(var v=0;v<this.connections.length;v++){var y=GeoTemConfig.colors[v];var w={strokeColor:"rgb("+y.r1+","+y.g1+","+y.b1+")",strokeOpacity:0.5,strokeWidth:3};var n=[];var h=undefined;for(var t=0;t<this.connections[v].length;t++){var y=this.connections[v][t];var d=y.time.getTime();if(d>=A&&d<=f){if(h!=undefined){var m=new OpenLayers.Geometry.LineString(new Array(h,y.first));this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(m,null,w)])}for(var r=0;r<y.lines.length;r++){this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(y.lines[r],null,w)])}h=y.last}}}}}},zoom:function(b){var a=this.openlayersMap.getZoom()+b;if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.openlayersMap.zoomTo(a)}else{this.openlayersMap.zoomTo(Math.round(a));if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}this.drawObjectLayer(false);return true},deactivateCountrySelector:function(){this.openlayersMap.removeControl(this.selectCountry);this.selectCountry=undefined},activateCountrySelector:function(a){var b=this;if(this.options.countrySelect&&this.options.mapSelectionTools){this.selectCountry=new OpenLayers.Control.GetFeature({protocol:OpenLayers.Protocol.WFS.fromWMSLayer(a),click:true});this.selectCountry.events.register("featureselected",this,function(c){b.snapper();b.drawnPolygonHandler(c.feature.geometry)});this.openlayersMap.addControl(this.selectCountry);this.countrySelectionControl.enable()}},setMap:function(a){this.baselayerIndex=a;if(this.selectCountry){this.deactivateCountrySelector()}if(this.baseLayers[a] instanceof OpenLayers.Layer.WMS){this.activateCountrySelector(this.baseLayers[a])}else{if(this.countrySelectionControl){this.countrySelectionControl.disable()}}this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()));this.openlayersMap.setBaseLayer(this.baseLayers[a]);if(this.baseLayers[a].name=="Open Street Map"){this.osmLink.style.visibility="visible"}else{this.osmLink.style.visibility="hidden"}},initSelectorTools:function(){var d=this;this.mapControls=[];if(this.options.squareSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawSquare.activate()};var c=function(){d.drawSquare.deactivate()};this.mapControls.push(new MapControl(this,a,"square",b,c))}if(this.options.circleSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawCircle.activate()};var c=function(){d.drawCircle.deactivate()};this.mapControls.push(new MapControl(this,a,"circle",b,c))}if(this.options.polygonSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawPolygon.activate()};var c=function(){d.drawPolygon.deactivate()};this.mapControls.push(new MapControl(this,a,"polygon",b,c))}if(this.options.countrySelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.selectCountry.activate();d.dragControl.disable()};var c=function(){d.selectCountry.deactivate();d.dragControl.enable()};this.countrySelectionControl=new MapControl(this,a,"country",b,c);this.mapControls.push(this.countrySelectionControl)}return this.mapControls},getZoom:function(){return this.openlayersMap.getZoom()},centerAndMarkPosition:function(){var m=this.options.detailedViewSpec;var a=m.longitude;var g=m.latitude;var d=m.zoomLevel;var j=GeoTemConfig.path+m.marker;var c=m.markerWidth;var k=m.markerHeight;var b=new OpenLayers.Geometry.Point(a,g,null);b.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.setCenter(new OpenLayers.LonLat(b.x,b.y));var l=new OpenLayers.Size(c,k);var e=new OpenLayers.Pixel(-(l.w/2),-l.h);var h=new OpenLayers.Icon(j,l,e);var f=new OpenLayers.Marker(new OpenLayers.LonLat(b.x,b.y),h);f.setOpacity(0.9);this.markerLayer.setZIndex(parseInt(this.objectLayer.getZIndex())+1);this.markerLayer.addMarker(f);this.openlayersMap.zoomTo(d);if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}this.drawObjectLayer(true);if(typeof console!="undefined"){console.log("openlayers getZoom: "+this.openlayersMap.getZoom())}},setMarker:function(b,g){var o=new OpenLayers.Geometry.Point(b,g,null);o.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.setCenter(new OpenLayers.LonLat(o.x,o.y));var l=new OpenLayers.Size(22,33);var f=new OpenLayers.Pixel(-(l.w/2),-l.h);var x=new OpenLayers.Icon(GeoTemConfig.path+"marker.png",l,f);var h=new OpenLayers.Marker(new OpenLayers.LonLat(o.x,o.y),x);h.setOpacity(0.9);this.markerLayer.setZIndex(parseInt(this.objectLayer.getZIndex())+1);this.markerLayer.addMarker(h);var m;var u=this.mds.getAllObjects();if(u==null){return}var q=function(j,d){return Math.sqrt((j.x-d.x)*(j.x-d.x)+(j.y-d.y)*(j.y-d.y))};var B=this.openlayersMap.getNumZoomLevels();var a=u[B-1];var z=undefined;var c;for(var v=0;v<a.length;v++){for(var t=0;t<a[v].length;t++){var s=a[v][t].feature.geometry;var y=q(s,o);if(!z||y<z){z=y;c=s}}}var n=0;var e=this.gui.mapWindow.offsetWidth/2-n;var w=this.gui.mapWindow.offsetHeight/2-n;var A=Math.abs(o.x-c.x);var k=Math.abs(o.y-c.y);for(var v=0;v<B;v++){var r=this.openlayersMap.getResolutionForZoom(B-v-1);if(A/r<e&&k/r<w){this.openlayersMap.zoomTo(B-v-1);if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}this.drawObjectLayer(false);break}}},removeMarker:function(){this.markerLayer.removeMarker(this.markerLayer.markers[0])},getLevelOfDetail:function(){var a=Math.floor(this.openlayersMap.getZoom());if(a<=1){return 0}else{if(a<=3){return 1}else{if(a<=8){return 2}else{return 3}}}}};MapGui_IE8CanvasEmulation=false;function MapGui_IE8Gen(b,c,a){if(typeof console!="undefined"){console.warn("MapGui_IE8 created")}this.map=b;this.container=c;this.container.style.position="relative";this.mapWindow=document.createElement("div");this.mapWindow.id="mapWindow";this.container.appendChild(this.mapWindow);$(window).resize(function(){});this.changeMap=function(h){var e=h[0];if(this.mapWindow.hasChildNodes()){this.mapWindow.removeChild(this.mapImg);this.mapWindow.removeChild(this.mapClickAreas)}this.mapImg=document.createElement("img");this.mapImg.setAttribute("src",e.mapUrl);this.mapImg.setAttribute("width","730px");this.mapImg.setAttribute("height","670px");this.mapImg.setAttribute("usemap","#ddbmap");this.mapWindow.appendChild(this.mapImg);this.mapClickAreas=document.createElement("map");this.mapClickAreas.setAttribute("name","ddbmap");var k=e.clusterSet.clusters;for(var f=0;f<k.length;f++){var d=document.createElement("area");var m=k[f];var l=m.x;var j=m.y;var g=m.radius;d.setAttribute("shape","circle");d.setAttribute("coords",l+","+j+","+g);d.setAttribute("alt"," :-( ");d.setAttribute("onclick","MapWidget_IE8Gen_onClusterClick("+l+","+j+","+f+")");this.mapClickAreas.appendChild(d)}this.mapWindow.appendChild(this.mapClickAreas)}}MapWidget_IE8Gen_onClusterClick=function(b,a,c){if(typeof console!="undefined"){console.log("global onClusterClick("+b+", "+a+", "+c+")")}InstitutionsMapModel.mapWidget().onClusterClick(b,a,c)};function MapWidget_IE8Gen(a,c,b){this.core=a;this.core.setWidget(this);this.openlayersMap;this.baseLayers;this.objectLayer;this.drawPolygon;this.drawCircle;this.selectCountry;this.dragArea;this.selectFeature;this.navigation;this.div=c;this.options=(new MapConfig(b)).options;this.formerCP=this.options.circlePackings;this.gui=new MapGui_IE8Gen(this,this.div,this.options);this.initialize()}MapWidget_IE8Gen.prototype={initialize:function(){var a=this;if(typeof console!="undefined"){console.warn("MapWidget_IE8Gen.initialize()")}},onClusterClick:function(b,a,d){var c=this;c.reset();if(typeof console!="undefined"){console.log("onClusterClick("+b+", "+a+", "+d+")")}if(c.popup){c.popup.reset()}c.popup=new PlacenamePopup_IE8Gen(c);c.popup.createPopup(b,a,d)},drawObjectLayer:function(a){if(typeof console!="undefined"){console.log("drawObjectLayer")}this.gui.changeMap(a)},initWidget:function(a){if(typeof console!="undefined"){console.log("initWidget -"+a+"-"+(typeof a)+"+");console.dir(a)}this.clearMap();this.drawObjectLayer(a)},reset:function(){if(this.popup){this.popup.reset()}},clearMap:function(){this.reset()},updatePoint:function(a,b){},highlightChanged:function(a){},selectionChanged:function(a){},mapSelection:function(){},deselection:function(){},filtering:function(){},inverseFiltering:function(){},mapCircleHighlight:function(b,a){},zoom:function(a){},deactivateCountrySelector:function(){},activateCountrySelector:function(a){},setMap:function(a){},getZoom:function(){return 5},getLevelOfDetail:function(){return 2}};function DataObject(c,e,a,g,f,b){this.name=c;this.description=e;this.weight=f;this.tableContent=b;this.percentage=0;this.setPercentage=function(h){this.percentage=h};this.locations=a;this.isGeospatial=false;if(this.locations.length>0){this.isGeospatial=true}this.placeDetails=[];for(var d=0;d<this.locations.length;d++){this.placeDetails.push(this.locations[d].place.split("/"))}this.getLatitude=function(h){return this.locations[h].latitude};this.getLongitude=function(h){return this.locations[h].longitude};this.getPlace=function(h,j){if(j>=this.placeDetails[h].length){return this.placeDetails[h][this.placeDetails[h].length-1]}return this.placeDetails[h][j]};this.dates=g;this.isTemporal=false;if(this.dates.length>0){this.isTemporal=true}this.getDate=function(h){return this.dates[h].date};this.getTimeGranularity=function(h){return this.dates[h].granularity};this.setIndex=function(h){this.index=h};this.getTimeString=function(){if(this.timeStart!=this.timeEnd){return(SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+" - "+SimileAjax.DateTime.getTimeString(this.granularity,this.timeEnd))}else{return SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+""}}}function Dataset(b,a){this.objects=b;this.label=a}Binning=function(b,a){this.map=b;this.options=a;this.reset()};Binning.prototype={getSet:function(){var a=this.options.binning;if(!a){return this.getExactBinning()}else{if(a=="generic"){return this.getGenericBinning()}else{if(a=="square"){return this.getSquareBinning()}else{if(a=="hexagonal"){return this.getHexagonalBinning()}else{if(a=="triangular"){return this.getTriangularBinning()}}}}}},getExactBinning:function(){if(typeof this.binnings.exact=="undefined"){this.exactBinning()}return this.binnings.exact},getGenericBinning:function(){if(typeof this.binnings.generic=="undefined"){this.genericBinning()}return this.binnings.generic},getSquareBinning:function(){if(typeof this.binnings.square=="undefined"){this.squareBinning()}return this.binnings.square},getHexagonalBinning:function(){if(typeof this.binnings.hexagonal=="undefined"){this.hexagonalBinning()}return this.binnings.hexagonal},getTriangularBinning:function(){if(typeof this.binnings.triangular=="undefined"){this.triangularBinning()}return this.binnings.triangular},reset:function(){this.zoomLevels=this.map.getNumZoomLevels();this.binnings=[];this.minimumRadius=this.options.minimumRadius;this.maximumRadius=0;this.maximumPoints=0;this.minArea=0;this.maxArea=0},getMaxRadius:function(a){return 4*Math.log(a)/Math.log(2)},setObjects:function(e){this.objects=e;for(var b=0;b<this.objects.length;b++){var d=0;for(var a=0;a<this.objects[b].length;a++){if(this.objects[b][a].isGeospatial){d+=this.objects[b][a].weight}}var c=this.getMaxRadius(d);if(c>this.maximumRadius){this.maximumRadius=c;this.maximumPoints=d;this.maxArea=Math.PI*this.maximumRadius*this.maximumRadius;this.minArea=Math.PI*this.minimumRadius*this.minimumRadius}}},dist:function(b,d,a,c){return Math.sqrt((b-a)*(b-a)+(d-c)*(d-c))},exactBinning:function(){var w=[];var d=[];var a=[];var u=[];var n=[];for(var t=0;t<this.objects.length;t++){n.push([]);u.push([]);for(var s=0;s<this.objects[t].length;s++){var m=this.objects[t][s];if(m.isGeospatial){if(typeof u[t][""+m.getLongitude(this.options.mapIndex)]=="undefined"){u[t][""+m.getLongitude(this.options.mapIndex)]=[]}if(typeof u[t][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)]=="undefined"){u[t][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)]=[];n[t].push(u[t][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)])}u[t][""+m.getLongitude(this.options.mapIndex)][""+m.getLatitude(this.options.mapIndex)].push(m)}}}var r=[];var e=[];var v=[];for(var t=0;t<n.length;t++){r.push([]);e.push([]);v.push([]);for(var s=0;s<n[t].length;s++){var h=n[t][s];var l=new OpenLayers.Geometry.Point(h[0].getLongitude(this.options.mapIndex),h[0].getLatitude(this.options.mapIndex),null);l.transform(this.map.displayProjection,this.map.projection);var g=0;for(var f=0;f<h.length;f++){g+=h[f].weight}var b=this.options.minimumRadius;if(this.options.noBinningRadii=="dynamic"){b=this.getRadius(g)}var c=new CircleObject(l.x,l.y,0,0,h,b,t,g);r[t].push(c);for(var f=0;f<h.length;f++){e[t][h[f].index]=c;v[t][h[f].index]=false}}}for(var q=0;q<this.zoomLevels;q++){w.push(r);d.push(e);a.push(v)}this.binnings.exact={circleSets:w,hashMaps:d,selectionHashs:a}},genericClustering:function(a,h){var s=[];var F=[];var c=[];var b=[];var f=new Clustering(-20037508.34,-20037508.34,20037508.34,20037508.34);for(var C=0;C<a.length;C++){for(var z=0;z<a[C].length;z++){var m=a[C][z];if(m.isGeospatial){var l=new OpenLayers.Geometry.Point(m.getLongitude(this.options.mapIndex),m.getLatitude(this.options.mapIndex),null);l.transform(this.map.displayProjection,this.map.projection);var r=new Vertex(Math.floor(l.x),Math.floor(l.y),a.length,this);r.addElement(m,m.weight,C);f.add(r)}}}for(var C=0;C<this.zoomLevels;C++){var n=[];var w=[];var e=[];var D=[];for(var z=0;z<a.length;z++){w.push([]);e.push([]);D.push([])}var t=this.map.getResolutionForZoom(this.zoomLevels-C-1);f.mergeForResolution(t,this.options.circleGap);for(var z=0;z<f.vertices.length;z++){var r=f.vertices[z];if(!r.legal){continue}var I=[];for(var v=0;v<r.elements.length;v++){if(r.elements[v].length>0){I.push({search:v,elements:r.elements[v],radius:r.radii[v],weight:r.weights[v]})}}var g=function(j,d){if(j.radius>d.radius){return -1}if(d.radius>j.radius){return 1}return 0};var H={circles:[],length:0,radius:r.radius/t,x:r.x,y:r.y};for(var v=0;v<a.length;v++){H.circles.push(false)}var G=function(K,J,p){var j=h||p.search;var o=new CircleObject(r.x,r.y,K,J,p.elements,p.radius,j,p.weight,H);w[p.search].push(o);H.circles[j]=o;H.length++;for(var d=0;d<p.elements.length;d++){e[p.search][p.elements[d].index]=o;D[p.search][p.elements[d].index]=false}};if(I.length==1){G(0,0,I[0])}else{if(I.length==2){var B=I[0].radius;var y=I[1].radius;G(-1*y,0,I[0]);G(B,0,I[1])}else{if(I.length==3){I.sort(g);var B=I[0].radius;var y=I[1].radius;var u=I[2].radius;var E=((2/3*Math.sqrt(3)-1)/2)*y;var A=r.radius/t-B-E;var x=B-A;G(-A,0,I[0]);G(x+y-3*E,y,I[1]);G(x+u-(3*E*u/y),-1*u,I[2])}else{if(I.length==4){I.sort(g);var B=I[0].radius;var y=I[1].radius;var u=I[2].radius;var q=I[3].radius;var E=(Math.sqrt(2)-1)*y;G(-1*E-y,0,I[0]);G(B-y,-1*E-q,I[3]);G(B-y,E+u,I[2]);G(E+B,0,I[1])}}}}if(H.length>1){n.push(H)}}F.push(w);s.push(n);c.push(e);b.push(D)}F.reverse();s.reverse();c.reverse();b.reverse();return{circleSets:F,binSets:s,hashMaps:c,selectionHashs:b}},genericBinning:function(){if(this.options.circlePackings||this.objects.length==1){this.binnings.generic=this.genericClustering(this.objects)}else{var a=[];var f=[];var d=[];for(var c=0;c<this.objects.length;c++){var e=this.genericClustering([this.objects[c]],c);if(c==0){a=e.circleSets;f=e.hashMaps;d=e.selectionHashs}else{for(var b=0;b<a.length;b++){a[b]=a[b].concat(e.circleSets[b]);f[b]=f[b].concat(e.hashMaps[b]);d[b]=d[b].concat(e.selectionHashs[b])}}}this.binnings.generic={circleSets:a,hashMaps:f,selectionHashs:d}}},getRadius:function(a){if(a==0){return 0}if(a==1){return this.minimumRadius}return Math.sqrt((this.minArea+(this.maxArea-this.minArea)/(this.maximumPoints-1)*(a-1))/Math.PI)},getBinRadius:function(e,b,c){if(e==0){return 0}var d=Math.PI*this.options.minimumRadius*this.options.minimumRadius;var a=Math.PI*b*b;return Math.sqrt((d+(a-d)/(c-1)*(e-1))/Math.PI)},shift:function(h,r,g,a){var c=r.x,b=0;var o=r.y,k=0;for(var f=0;f<a.length;f++){b+=a[f].x/a.length;k+=a[f].y/a.length}var l=0,j=0;if(h=="square"){var q=Math.abs(b-c);var p=Math.abs(k-o);var e=p/q;var d=o-e*c;if(q>p){l=r.x-(c+r.r-g);j=r.y-(e*r.x+d)}else{j=r.y-(o+r.r-g);l=r.x-(r.y-d)/e}}return{x:l,y:j}},binSize:function(c){var b=0;for(var a in c){b+=c[a].weight}return b},setCircleSet:function(m,n){var y=[];var d=[];var a=[];for(var v=0;v<n.length;v++){var p=[];var e=[];var x=[];for(var s=0;s<this.objects.length;s++){p.push([]);e.push([]);x.push([])}var t=[];var u=0;var b=0;var o=this.map.getResolutionForZoom(v);for(var s=0;s<n[v].length;s++){for(var q=0;q<n[v][s].bin.length;q++){var A=this.binSize(n[v][s].bin[q]);if(A>u){u=A;b=n[v][s].r/o}}}for(var s=0;s<n[v].length;s++){var l=n[v][s];for(var q=0;q<l.bin.length;q++){if(l.bin[q].length==0){continue}var g=this.binSize(l.bin[q]);var h=this.getBinRadius(g,b,u);var w=this.shift(m,l,h*o,l.bin[q],v);var c=new CircleObject(l.x-w.x,l.y-w.y,0,0,l.bin[q],h,q,g);p[q].push(c);for(var f=0;f<l.bin[q].length;f++){e[q][l.bin[q][f].index]=c;x[q][l.bin[q][f].index]=false}}}y.push(p);d.push(e);a.push(x)}this.binnings[m]={circleSets:y,hashMaps:d,selectionHashs:a}},squareBinning:function(){var f=20037508.34;var w=f*f*4;var n=this.options.binCount;var A=[];var q=[];for(var g=0;g<this.zoomLevels;g++){A.push([]);q.push([])}for(var m=0;m<this.objects.length;m++){for(var h=0;h<this.objects[m].length;h++){var e=this.objects[m][h];if(!e.isGeospatial){continue}var c=new OpenLayers.Geometry.Point(e.getLongitude(this.options.mapIndex),e.getLatitude(this.options.mapIndex),null);c.transform(this.map.displayProjection,this.map.projection);e.x=c.x;e.y=c.y;for(var g=0;g<this.zoomLevels;g++){var r=n*Math.pow(2,g);var v=2*f/r;var d=Math.floor((c.x+f)/(2*f)*r);var b=Math.floor((c.y+f)/(2*f)*r);if(typeof A[g][""+d]=="undefined"){A[g][""+d]=[]}if(typeof A[g][""+d][""+b]=="undefined"){A[g][""+d][""+b]=[];for(var s=0;s<this.objects.length;s++){A[g][""+d][""+b].push([])}var u=d*v+v/2-f;var t=b*v+v/2-f;q[g].push({bin:A[g][""+d][""+b],x:u,y:t,a:v,r:v/2})}A[g][""+d][""+b][m].push(e)}}}this.setCircleSet("square",q)},triangularBinning:function(){var w=20037508.34;var K=this.options.binCount;var J=Math.sqrt(4*K*K/Math.sqrt(3));var A=K/J*K;var u=[];var s=[];for(var B=0;B<this.zoomLevels;B++){u.push([]);s.push([])}for(var D=0;D<this.objects.length;D++){for(var C=0;C<this.objects[D].length;C++){var t=this.objects[D][C];if(!t.isGeospatial){continue}var q=new OpenLayers.Geometry.Point(t.getLongitude(this.options.mapIndex),t.getLatitude(this.options.mapIndex),null);q.transform(this.map.displayProjection,this.map.projection);t.x=q.x;t.y=q.y;for(var B=0;B<this.zoomLevels;B++){var v=A*Math.pow(2,B);var G=v*v/Math.sqrt(v*v-v*v/4);var I=2*w/v;var F=2*w/G;var c=Math.floor((q.y+w)/(2*w)*G);if(typeof u[B][""+c]=="undefined"){u[B][""+c]=[]}var E;var e=v*2;var d=Math.floor((q.x+w)/(2*w)*e);var H=I/2;var b=F;var m=q.x+w-d*I/2;var g=q.y+w-c*F;if(c%2==0&&d%2==1||c%2==1&&d%2==0){if(g+b/H*m<b){E=d}else{E=d+1}}else{if(g>b/H*m){E=d}else{E=d+1}}if(typeof u[B][""+c][""+E]=="undefined"){u[B][""+c][""+E]=[];for(var f=0;f<this.objects.length;f++){u[B][""+c][""+E].push([])}var n=Math.sqrt(3)/6*I;var m=(E-1)*I/2+I/2-w;var g;if(c%2==0&&E%2==0||c%2==1&&E%2==1){g=c*F+F-n-w}else{g=c*F+n-w}s[B].push({bin:u[B][""+c][""+E],x:m,y:g,a:I,r:n})}u[B][""+c][""+E][D].push(t)}}}this.setCircleSet("triangular",s)},hexagonalBinning:function(){var E=20037508.34;var Q=this.options.binCount;var P=Math.sqrt(4*Q*Q/Math.sqrt(3))/Math.sqrt(6);var F=Q/P*Q;var C=[];var w=[];for(var G=0;G<this.zoomLevels;G++){C.push([]);w.push([])}for(var I=0;I<this.objects.length;I++){for(var H=0;H<this.objects[I].length;H++){var A=this.objects[I][H];if(!A.isGeospatial){continue}var v=new OpenLayers.Geometry.Point(A.getLongitude(this.options.mapIndex),A.getLatitude(this.options.mapIndex),null);v.transform(this.map.displayProjection,this.map.projection);A.x=v.x;A.y=v.y;for(var G=0;G<this.zoomLevels;G++){var D=F*Math.pow(2,G);var L=D*D/Math.sqrt(D*D-D*D/4);var N=2*E/D;var K=2*E/L;var d=Math.floor((v.y+E)/(2*E)*L);if(typeof C[G][""+d]=="undefined"){C[G][""+d]=[]}var J;var g=D*2;var f=Math.floor((v.x+E)/(2*E)*g);var M=N/2;var b=K;var s=v.x+E-f*N/2;var q=v.y+E-d*K;if(d%2==0&&f%2==1||d%2==1&&f%2==0){if(q+b/M*s<b){J=f}else{J=f+1}}else{if(q>b/M*s){J=f}else{J=f+1}}if(typeof C[G][""+d][""+J]=="undefined"){C[G][""+d][""+J]=[];for(var n=0;n<this.objects.length;n++){C[G][""+d][""+J].push([])}var t=Math.sqrt(3)/6*N;var s=(J-1)*N/2+N/2-E;var q;if(d%2==0&&J%2==0||d%2==1&&J%2==1){q=d*K+K-t-E}else{q=d*K+t-E}w[G].push({bin:C[G][""+d][""+J],x:s,y:q,a:N,r:t,h:K,binX:J,binY:d})}C[G][""+d][""+J][I].push(A)}}}var O=[];var c=[];for(var G=0;G<this.zoomLevels;G++){O.push([]);c.push([])}for(var I=0;I<w.length;I++){for(var H=0;H<w[I].length;H++){var u=w[I][H];var d=Math.floor(u.binY/2);var e=Math.floor(u.binX/3);var s,q;var N=u.a;var K=u.h;if(u.binX%6<3){if(typeof O[I][""+d]=="undefined"){O[I][""+d]=[]}q=d*2*u.h+u.h-E;s=e*1.5*u.a+N/2-E}else{if(u.binY%2==1){d++}if(typeof O[I][""+d]=="undefined"){O[I][""+d]=[]}q=d*2*u.h-E;s=e*1.5*u.a+N/2-E}if(typeof O[I][""+d][""+e]=="undefined"){O[I][""+d][""+e]=[];for(var n=0;n<this.objects.length;n++){O[I][""+d][""+e].push([])}c[I].push({bin:O[I][""+d][""+e],x:s,y:q,a:u.a,r:u.h})}for(var G=0;G<u.bin.length;G++){for(var B=0;B<u.bin[G].length;B++){O[I][""+d][""+e][G].push(u.bin[G][B])}}}}this.setCircleSet("hexagonal",c)}};function MapDataSource(b,a){this.olMap=b;this.circleSets=[];this.binning=new Binning(b,a)}MapDataSource.prototype={initialize:function(b){if(b!=this.mapObjects){this.binning.reset();this.binning.setObjects(b)}this.mapObjects=b;var d=(new Date()).getTime();var c=this.binning.getSet();this.circleSets=c.circleSets;this.binSets=c.binSets;this.hashMapping=c.hashMaps;timeCluster=(new Date()).getTime();var a=(this.mapObjects[0].length+" elements clustered in "+(timeCluster-d)+"ms");if(typeof console!="undefined"){console.log(a)}},getObjectsByZoom:function(){var a=Math.floor(this.olMap.getZoom());if(this.circleSets.length<a){return null}return this.circleSets[a]},getAllObjects:function(){if(this.circleSets.length==0){return null}return this.circleSets},getAllBins:function(){if(this.binSets.length==0){return null}return this.binSets},clearOverlay:function(){var c=Math.floor(this.olMap.getZoom());var d=this.circleSets[c];for(var b in d){for(var a in d[b]){d[b][a].reset()}}},setOverlay:function(d){var c=Math.floor(this.olMap.getZoom());for(var b in d){for(var a in d[b]){var e=d[b][a];if(e.isGeospatial){this.hashMapping[c][b][e.index].overlay+=e.weight}}}},size:function(){if(this.circleSets.length==0){return 0}return this.circleSets[0].length},getCircle:function(a,c){var b=Math.floor(this.olMap.getZoom());return this.hashMapping[b][a][c]}};function Vertex(a,e,c,b){this.x=a;this.y=e;this.radius;this.size=0;this.elements=[];this.radii=[];this.weights=[];this.legal=true;this.binning=b;if(c!=undefined){for(var d=0;d<c;d++){this.elements.push([]);this.weights.push(0)}}}Vertex.prototype.merge=function(a,c){for(var b=0;b<a.elements.length;b++){this.elements[b]=a.elements[b].concat(c.elements[b]);this.weights[b]=a.weights[b]+c.weights[b];this.size+=this.weights[b]}};Vertex.prototype.CalculateRadius=function(c){this.radii=[];for(i in this.elements){this.radii.push(this.binning.getRadius(this.weights[i]))}if(this.radii.length==1){this.radius=this.radii[0]*c}else{var e=0;var b=0;var a=0;for(i in this.radii){if(this.radii[i]!=0){e++}if(this.radii[i]>b){if(b>a){a=b}b=this.radii[i]}else{if(this.radii[i]>a){a=this.radii[i]}}}if(e==1){this.radius=b*c}else{if(e==2){this.radius=(b+a)*c}else{if(e==3){var f=(2/3*Math.sqrt(3)-1)*b;this.radius=(f+b+a)*c}else{if(e==4){var f=(Math.sqrt(2)-1)*a;this.radius=(f+b+a)*c}}}}}};Vertex.prototype.addElement=function(c,b,a){this.elements[a].push(c);this.size+=b;this.weights[a]+=b};function Edge(a,b){this.v0=a;this.v1=b;this.leftFace;this.rightFace;this.legal=true;this.setLength()}Edge.prototype.setLength=function(){var b=this.v0.x-this.v1.x;var a=this.v0.y-this.v1.y;this.length=Math.sqrt(b*b+a*a)};Edge.prototype.contains=function(a){if(this.v0==a||this.v1==a){return true}return false};Edge.prototype.replaceFace=function(b,a){if(this.leftFace==b){this.leftFace=a}else{if(this.rightFace==b){this.rightFace=a}}};Edge.prototype.setFace=function(a){if(a.leftOf(this)){this.leftFace=a}else{this.rightFace=a}};Edge.prototype.setFaces=function(a,b){if(a.leftOf(this)){this.leftFace=a;this.rightFace=b}else{this.leftFace=b;this.rightFace=a}};Edge.prototype.removeFace=function(a){if(this.leftFace==a){this.leftFace=null}else{this.rightFace=null}};Edge.prototype.equals=function(a){if(this.v0==a.v0&&this.v1==a.v1||this.v0==a.v1&&this.v1==a.v0){return true}return false};function Triangle(a){this.edges=a;this.setVertices();this.descendants=[]}Triangle.prototype.getTriple=function(b){var a=arrayIndex(this.edges,b);return{e_s:this.edges[(a+1)%3],e_p:this.edges[(a+2)%3],u:this.vertices[(a+2)%3]}};Triangle.prototype.leftOf=function(b){var a=arrayIndex(this.edges,b);if(this.vertices[a].y!=this.vertices[(a+1)%3].y){return this.vertices[a].y>this.vertices[(a+1)%3].y}return this.vertices[a].y>this.vertices[(a+2)%3].y};Triangle.prototype.getNext=function(a){var b=arrayIndex(this.vertices,a);return this.vertices[(b+1)%3]};Triangle.prototype.oppositeEdge=function(a){var b=arrayIndex(this.vertices,a);return this.edges[(b+1)%3]};Triangle.prototype.contains=function(a){return arrayIndex(this.vertices,a)!=-1};Triangle.prototype.replace=function(a,b){this.edges[arrayIndex(this.edges,a)]=b};Triangle.prototype.setVertices=function(){if(this.edges[1].v0==this.edges[0].v0||this.edges[1].v1==this.edges[0].v0){this.vertices=[this.edges[0].v1,this.edges[0].v0]}else{this.vertices=[this.edges[0].v0,this.edges[0].v1]}if(this.edges[2].v0==this.vertices[0]){this.vertices.push(this.edges[2].v1)}else{this.vertices.push(this.edges[2].v0)}};Triangle.prototype.replaceBy=function(a){this.descendants=a;this.edges[0].replaceFace(this,a[0]);this.edges[1].replaceFace(this,a[1]);this.edges[2].replaceFace(this,a[2])};Triangle.prototype.CalcCircumcircle=function(){var j=this.vertices[0];var h=this.vertices[1];var g=this.vertices[2];var d=h.x-j.x;var c=h.y-j.y;var b=g.x-j.x;var a=g.y-j.y;var o=d*(j.x+h.x)+c*(j.y+h.y);var m=b*(j.x+g.x)+a*(j.y+g.y);var k=2*(d*(g.y-h.y)-c*(g.x-h.x));var f=(a*o-c*m)/k;var e=(d*m-b*o)/k;this.center=new Vertex(f,e);var n=this.center.x-j.x;var l=this.center.y-j.y;this.radius_squared=n*n+l*l};Triangle.prototype.inCircumcircle=function(c){if(this.radius_squared==undefined){this.CalcCircumcircle()}var b=this.center.x-c.x;var a=this.center.y-c.y;var d=b*b+a*a;return(d<=this.radius_squared)};Triangle.prototype.interior=function(b){var a=this.vertices[0];var g=this.vertices[1];var e=this.vertices[2];var d=(b.x-a.x)*(a.y-g.y)+(b.y-a.y)*(g.x-a.x);var f=(b.x-g.x)*(g.y-e.y)+(b.y-g.y)*(e.x-g.x);var c=(b.x-e.x)*(e.y-a.y)+(b.y-e.y)*(a.x-e.x);if(d>0||f>0||c>0){return null}else{if(d<0&&f<0&&c<0){return this}else{if(d==0){if(f==0){return this.vertices[1]}else{if(c==0){return this.vertices[0]}}return this.edges[0]}else{if(f==0){if(c==0){return this.vertices[2]}return this.edges[1]}else{if(c==0){return this.edges[2]}}}}}};function Clustering(b,a,d,c){this.triangles=[];this.newTriangles=[];this.bbox={x1:b,y1:a,x2:d,y2:c};this.CreateBoundingTriangle();this.edges=[];this.vertices=[];this.legalizes=0;this.collapses=0}Clustering.prototype.locate=function(b){if(this.boundingTriangle.descendants.length==0){return this.boundingTriangle}var d=this.boundingTriangle.descendants;while(true){for(var c=0;c<d.length;c++){var a=d[c].interior(b);if(a==null){continue}if(a instanceof Vertex||this.isLeaf(d[c])){return a}d=d[c].descendants;break}}};Clustering.prototype.legalize=function(m,j,l){if(!j.v0.legal&&!j.v1.legal){return}this.legalizes++;var g=false;var k,f;if(j.leftFace==l&&j.rightFace.inCircumcircle(m)){g=true;k=j.rightFace}else{if(j.rightFace==l&&j.leftFace.inCircumcircle(m)){g=true;k=j.leftFace}}if(g){var h=l.getTriple(j);var f=k.getTriple(j);var d=new Edge(h.u,f.u);var a=[];a.push(j.v0);a.push(d.v0);a.push(j.v1);a.push(d.v1);if(!this.JordanTest(a,d)){return}j.legal=false;this.edges.push(d);var c=new Triangle([d,h.e_p,f.e_s]);var b=new Triangle([d,f.e_p,h.e_s]);d.setFaces(c,b);h.e_p.replaceFace(l,c);f.e_s.replaceFace(k,c);f.e_p.replaceFace(k,b);h.e_s.replaceFace(l,b);l.descendants=[c,b];k.descendants=[c,b];this.legalize(m,c.edges[2],c);this.legalize(m,b.edges[1],b)}};Clustering.prototype.add=function(a){this.addVertex(a,this.locate(a))};Clustering.prototype.addVertex=function(o,p){if(p instanceof Vertex){p.merge(p,o)}else{if(p instanceof Edge){this.vertices.push(o);p.legal=false;var g=p.leftFace.getTriple(p);var e=p.rightFace.getTriple(p);var n=new Edge(o,g.u);var m=new Edge(o,p.leftFace.getNext(g.u));var l=new Edge(o,e.u);var k=new Edge(o,p.rightFace.getNext(e.u));var j=new Triangle([n,g.e_p,m]);var h=new Triangle([m,e.e_s,l]);var f=new Triangle([l,e.e_p,k]);var d=new Triangle([k,g.e_s,n]);p.leftFace.descendants=[j,d];p.rightFace.descendants=[h,f];this.edges.push(n);this.edges.push(m);this.edges.push(l);this.edges.push(k);n.setFaces(j,d);m.setFaces(j,h);l.setFaces(h,f);k.setFaces(f,d);g.e_p.replaceFace(p.leftFace,j);e.e_s.replaceFace(p.rightFace,h);e.e_p.replaceFace(p.rightFace,f);g.e_s.replaceFace(p.leftFace,d);this.legalize(o,g.e_p,j);this.legalize(o,e.e_s,h);this.legalize(o,e.e_p,f);this.legalize(o,g.e_s,d)}else{this.vertices.push(o);var c=new Edge(p.vertices[0],o);var b=new Edge(p.vertices[1],o);var a=new Edge(p.vertices[2],o);this.edges.push(c);this.edges.push(b);this.edges.push(a);var j=new Triangle([c,p.edges[0],b]);var h=new Triangle([b,p.edges[1],a]);var f=new Triangle([a,p.edges[2],c]);c.setFaces(j,f);b.setFaces(j,h);a.setFaces(h,f);p.replaceBy([j,h,f]);this.legalize(o,p.edges[0],j);this.legalize(o,p.edges[1],h);this.legalize(o,p.edges[2],f)}}};Clustering.prototype.isLeaf=function(a){return a.descendants.length==0};Clustering.prototype.CreateBoundingTriangle=function(){var j=(this.bbox.x2-this.bbox.x1)*10;var h=(this.bbox.y2-this.bbox.y1)*10;var g=new Vertex(this.bbox.x1-j,this.bbox.y1-h*3);var f=new Vertex(this.bbox.x2+j*3,this.bbox.y2+h);var e=new Vertex(this.bbox.x1-j,this.bbox.y2+h);var d=new Edge(f,g);var c=new Edge(g,e);var b=new Edge(e,f);g.legal=false;f.legal=false;e.legal=false;this.boundingTriangle=new Triangle([d,c,b]);var a=new Triangle([d,c,b]);d.setFaces(this.boundingTriangle,a);c.setFaces(this.boundingTriangle,a);b.setFaces(this.boundingTriangle,a)};Clustering.prototype.mergeVertices=function(E){this.collapses++;var g=E.v0.size;var f=E.v1.size;var r=(E.v0.x*g+E.v1.x*f)/(g+f);var p=(E.v0.y*g+E.v1.y*f)/(g+f);var u=new Vertex(r,p,E.v0.elements.length,E.v0.binning);u.merge(E.v0,E.v1);E.v0.legal=false;E.v1.legal=false;var w=[];var C=[];E.legal=false;var n=[];var D=function(b,v,e){b.legal=false;do{var j;if(b.leftFace==e){j=b.rightFace.getTriple(b);C.push(b.rightFace);j.e_s.removeFace(b.rightFace);e=b.rightFace}else{j=b.leftFace.getTriple(b);C.push(b.leftFace);j.e_s.removeFace(b.leftFace);e=b.leftFace}if(arrayIndex(w,j.e_s)==-1){w.push(j.e_s)}n.push(j.u);b=j.e_p;b.legal=false}while(b!=v)};var H=E.leftFace.getTriple(E);var G=E.rightFace.getTriple(E);C.push(E.leftFace);C.push(E.rightFace);D(H.e_p,G.e_s,E.leftFace);D(G.e_p,H.e_s,E.rightFace);var m=new Clustering(this.bbox.x1-10,this.bbox.y1-10,this.bbox.x2+10,this.bbox.y2+10);var z=[];for(var B in w){if(!(w[B].leftFace==null&&w[B].rightFace==null)){z.push(w[B].v0);z.push(w[B].v1)}}var k=[];var a=[];for(var B in n){if(arrayIndex(a,n[B])==-1){m.add(n[B]);a.push(n[B])}if(arrayIndex(z,n[B])!=-1){k.push(n[B])}}var c=[];var d=function(j){for(var b=0;b<w.length;b++){if(w[b].equals(j)){return b}}return -1};var h=new Array(w.length);var t=[];for(var B=0;B<m.edges.length;B++){var E=m.edges[B];var F=d(E);if(F!=-1){if(!E.legal){var q=E.leftFace.getTriple(E);var o=E.rightFace.getTriple(E);var l=new Edge(q.u,o.u);for(var A=0;A<m.edges.length;A++){if(m.edges[A].equals(l)&&m.edges[A].legal){m.edges[A].legal=false;break}}q.e_p.setFace(E.leftFace);q.e_s.setFace(E.leftFace);o.e_p.setFace(E.rightFace);o.e_s.setFace(E.rightFace);E.legal=true}h[F]=E}else{t.push(E)}}for(var B=0;B<h.length;B++){var E=h[B];if(w[B].leftFace==null){w[B].leftFace=E.leftFace;w[B].leftFace.replace(E,w[B]);if(arrayIndex(c,w[B].leftFace)==-1){c.push(w[B].leftFace)}}if(w[B].rightFace==null){w[B].rightFace=E.rightFace;w[B].rightFace.replace(E,w[B]);if(arrayIndex(c,w[B].rightFace)==-1){c.push(w[B].rightFace)}}}for(var B=0;B<t.length;B++){var E=t[B];if(!E.legal){continue}if(this.JordanTest(k,E)){this.edges.push(E);if(arrayIndex(c,E.rightFace)==-1){c.push(E.rightFace)}if(arrayIndex(c,E.leftFace)==-1){c.push(E.leftFace)}}}for(var B in C){C[B].descendants=c}for(var B=0;B<c.length;B++){var s=c[B].interior(u);if(s==null){continue}else{this.addVertex(u,s);break}}return u};Clustering.prototype.JordanTest=function(d,h){var g=new Vertex((h.v0.x+h.v1.x)*0.5,(h.v0.y+h.v1.y)*0.5);var a=false;var c,b=d.length-1;for(c=0;c<d.length;b=c++){var k=d[c];var f=d[b];if((((k.y<=g.y)&&(g.y<f.y))||((f.y<=g.y)&&(g.y<k.y)))&&(g.x<(f.x-k.x)*(g.y-k.y)/(f.y-k.y)+k.x)){a=!a}}return a};Clustering.prototype.mergeForResolution=function(d,g){this.deleteEdges=new BinaryHeap(function(k){return k.weight});this.weightEdges(d,g);var c=0;while(this.deleteEdges.size()>0){var j=this.deleteEdges.pop();if(j.legal){var a=this.edges.length;var h=this.mergeVertices(j);h.CalculateRadius(d);for(var b=a;b<this.edges.length;b++){var f=this.edges[b];if(f.legal){f.weight=f.length/(f.v0.radius+f.v1.radius+g*d);if(f.weight<1){this.deleteEdges.push(f)}}}}}};Clustering.prototype.weightEdges=function(b,d){for(var c=0;c<this.vertices.length;c++){if(this.vertices[c].legal){this.vertices[c].CalculateRadius(b)}}var a=[];for(var c=0;c<this.edges.length;c++){var f=this.edges[c];if(f.legal){if(!f.v0.legal||!f.v1.legal){f.weight=1}else{f.weight=f.length/(f.v0.radius+f.v1.radius+d*b);if(f.weight<1){this.deleteEdges.push(f)}}a.push(f)}}this.edges=a};Clustering.prototype.ValidityTest=function(){console.info("Test 1: Valid Delaunay ...");for(i in this.edges){var h=this.edges[i];if(h.leftFace==null||h.rightFace==null){console.info(h);alert()}}var a=function(q,p,m){var e=q.x-p.x;var c=q.x-m.x;var o=q.y-p.y;var n=q.y-m.y;if(e*n-o*c<0){return true}return false};var j=0;for(i in this.edges){var h=this.edges[i];var g=h.leftFace.getTriple(h);var d=h.rightFace.getTriple(h);if(h.v0.y==h.v1.y){if(g.u.y>d.u.y){console.info("equal y conflict ...");console.info(h);alert();j++}}else{var l,k;if(h.v0.y>h.v1.y){l=h.v0;k=h.v1}else{l=h.v1;k=h.v0}if(!a(l,k,g.u)){console.info("left right conflict ... left is right");console.info(h);alert();j++}if(a(l,k,d.u)){console.info("left right conflict ... right is left");console.info(h);alert();j++}}}for(i in this.edges){if(this.edges[i].legal){var h=this.edges[i];var f=h.leftFace.getTriple(h);var b=h.rightFace.getTriple(h);if(!f.e_p.legal||!f.e_s.legal||!b.e_p.legal||!b.e_s.legal){console.info(h);console.info("conflict in edge continuity");return}}}};function BinaryHeap(a){this.content=[];this.scoreFunction=a}BinaryHeap.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0];var b=this.content.pop();if(this.content.length>0){this.content[0]=b;this.sinkDown(0)}return a},remove:function(d){var a=this.content.length;for(var c=0;c<a;c++){if(this.content[c]==d){var b=this.content.pop();if(c!=a-1){this.content[c]=b;if(this.scoreFunction(b)<this.scoreFunction(d)){this.bubbleUp(c)}else{this.sinkDown(c)}}return}}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(d){var a=this.content[d];while(d>0){var c=Math.floor((d+1)/2)-1,b=this.content[c];if(this.scoreFunction(a)<this.scoreFunction(b)){this.content[c]=a;this.content[d]=b;d=c}else{break}}},sinkDown:function(b){var a=this.content.length,f=this.content[b],h=this.scoreFunction(f);while(true){var e=(b+1)*2,k=e-1;var c=null;if(k<a){var j=this.content[k],l=this.scoreFunction(j);if(l<h){c=k}}if(e<a){var g=this.content[e],d=this.scoreFunction(g);if(d<(c==null?h:l)){c=e}}if(c!=null){this.content[b]=this.content[c];this.content[c]=f;b=c}else{break}}}};function Dropdown(j,a,g){var k=this;this.visibility=false;this.div=document.createElement("div");this.div.setAttribute("class","dropdown");this.selection=document.createElement("div");this.selection.setAttribute("class","dropdownSelection");j.appendChild(this.div);var b=document.createElement("div");b.setAttribute("class","dropdownLeft");this.div.appendChild(b);this.div.appendChild(this.selection);var f=document.createElement("div");this.div.appendChild(f);if(a.length>1){f.setAttribute("class","dropdownButtonEnabled")}else{f.setAttribute("class","dropdownButtonDisabled")}f.onclick=function(){if(a.length>1){k.changeVisibility()}};f.title=g;this.getValue=function(){return this.selectedEntry.innerHTML};var h=document.createElement("div");h.setAttribute("class","dropdownMenu");this.div.appendChild(h);var e=document.createElement("dl");var c=function(m){var l=document.createElement("dt");l.innerHTML=m.name;l.onclick=function(){m.onclick();k.changeVisibility();k.changeEntries(m)};e.appendChild(l);m.entry=l};for(var d=0;d<a.length;d++){c(a[d])}h.appendChild(e);this.selection.style.width=h.offsetWidth+"px";h.style.width=(h.offsetWidth+b.offsetWidth+f.offsetWidth-2)+"px";this.div.style.maxHeight=this.div.offsetHeight+"px";h.style.display="none";this.setEntry=function(l){if(typeof(l)=="undefined"){if((a)&&a.length>0){this.changeEntries(a[0])}}else{this.changeEntries(a[l])}};this.changeEntries=function(l){if(this.selectedEntry){this.selectedEntry.setAttribute("class","dropdownUnselectedEntry")}this.selectedEntry=l.entry;this.selectedEntry.setAttribute("class","dropdownSelectedEntry");this.selection.innerHTML="<div style='display:inline-block;vertical-align:middle;'>"+l.name+"</div>"};this.changeVisibility=function(){this.visibility=!this.visibility;if(this.visibility){h.style.display="block"}else{h.style.display="none"}}}function MapZoomSlider(c,b){this.parent=c;var f=this;this.div=document.createElement("div");this.div.setAttribute("class","sliderStyle-"+b);var e=document.createElement("div");e.setAttribute("class","zoomSliderContainer-"+b);var g=document.createElement("div");g.tabIndex=1;var d=document.createElement("div");g.appendChild(d);e.appendChild(g);this.slider=new Slider(g,d,b);this.div.appendChild(e);var h=document.createElement("img");h.src=GeoTemConfig.path+"ddb_zoom_in.png";h.setAttribute("class","zoomSliderIn-"+b);h.onclick=function(){if(f.parent.core.widget.popup){f.parent.core.widget.popup.reset()}f.parent.zoom(1)};this.div.appendChild(h);var a=document.createElement("img");a.src=GeoTemConfig.path+"ddb_zoom_out.png";a.setAttribute("class","zoomSliderOut-"+b);a.onclick=function(){if(f.parent.core.widget.popup){f.parent.core.widget.popup.reset()}f.parent.zoom(-1)};this.div.appendChild(a);this.slider.onclick=function(){if(typeof console!="undefined"){console.info(f.slider.getValue())}};this.slider.handle.onmousedown=function(){if(f.parent.core.widget.popup){f.parent.core.widget.popup.reset()}var j=f.slider.getValue();document.onmouseup=function(){if(!f.parent.zoom((f.slider.getValue()-j)/f.max*f.levels)){f.setValue(j)}document.onmouseup=null}};this.setValue=function(j){this.slider.setValue(j/this.levels*this.max)};this.setMaxAndLevels=function(j,k){this.max=j;this.levels=k;this.slider.setMaximum(j)};this.setLanguage=function(){h.title=GeoTemConfig.getString("zoomIn");a.title=GeoTemConfig.getString("zoomOut");this.slider.handle.title=GeoTemConfig.getString("zoomSlider")}}function MapPopup(a){this.parentDiv=a.gui.mapWindow;this.initialize=function(b,e,d){var c=this;this.x=b;this.y=e;this.popupDiv=document.createElement("div");this.popupDiv.setAttribute("class","ddbPopupDiv");this.popupDiv.onclick=function(){if(typeof d!="undefined"){d()}c.reset()};this.parentDiv.appendChild(this.popupDiv);this.headDiv=document.createElement("div");this.headDiv.setAttribute("class","ddbPopupHead");this.title=document.createElement("div");this.title.setAttribute("class","ddbPopupTitle");this.cancel=document.createElement("div");this.cancel.setAttribute("class","ddbPopupCancel");this.cancel.title=GeoTemConfig.getString("close");this.cancel.onclick=function(){if(typeof d!="undefined"){d()}c.reset()};this.headDiv.appendChild(this.title);this.headDiv.appendChild(this.cancel);this.input=document.createElement("div");this.input.style.maxWidth=Math.floor(this.parentDiv.offsetWidth*0.75)+"px";this.input.style.maxHeight=Math.floor(this.parentDiv.offsetHeight*0.75)+"px";this.input.setAttribute("class","ddbPopupInput");this.popupDiv.appendChild(this.headDiv);this.popupDiv.appendChild(this.input)};this.makeAndPlacePeak=function(b){var c=document.createElement("div");c.setAttribute("class","popupPeak"+b);c.title=GeoTemConfig.getString("close");c.onclick=function(){if(typeof onclose!="undefined"){onclose()}popup.reset()};this.popupDiv.appendChild(c)};this.setContent=function(b){$(this.input).empty();this.visible=true;$(this.input).append(b);this.decorate()};this.reset=function(){$(this.popupDiv).remove();this.visible=false};this.decorate=function(){var d=this.popupDiv.offsetHeight;var b=this.popupDiv.offsetWidth;var c=["NO","SO","NW","SW"];this.left=this.x;this.top=this.y-this.popupDiv.offsetHeight;var g=0;if(this.top<10){this.top=this.top+d+10;g=1}else{this.top=this.top-10;g=0}if(this.left+b>730-9){g+=2;this.left=this.left-b-9}else{this.left+=9}this.popupDiv.style.left=this.left+"px";this.popupDiv.style.top=this.top+"px";this.makeAndPlacePeak(c[g]);var f=0,e=0;if(this.popupDiv.offsetTop<a.gui.headerHeight+10){e=-1*(a.gui.headerHeight+10-this.popupDiv.offsetTop)}if(this.popupDiv.offsetLeft+this.popupDiv.offsetWidth>a.gui.headerWidth-10){f=-1*(a.gui.headerWidth-10-this.popupDiv.offsetLeft-this.popupDiv.offsetWidth)}a.shift(f,e)};this.shift=function(b,c){this.left=this.left-this.x+b;this.top=this.top-this.y+c;this.x=b;this.y=c;if(this.left+this.popupDiv.offsetWidth>this.parentDiv.offsetWidth){this.popupDiv.style.left="auto";this.popupDiv.style.right=(this.parentDiv.offsetWidth-this.left-this.popupDiv.offsetWidth)+"px"}else{this.popupDiv.style.right="auto";this.popupDiv.style.left=this.left+"px"}this.popupDiv.style.top=this.top+"px"}}function PlacenamePopup(a){this.parentDiv=a.gui.mapWindow;this.createPopup=function(b,h,g){this.labels=g;var e=this;var d=new MapPopup(a);var c=function(){a.deselection();e.reset()};d.initialize(b,h,c);$.extend(this,d);this.content=document.createElement("div");this.inner=document.createElement("div");this.inner.setAttribute("class","ddbPopupInner");this.content.appendChild(this.inner);var f=this.listLabelsDdb();this.showLabelsDdb(f)};this.setCount=function(){var b=this.count;if(b>1){this.resultsLabel.innerHTML=b+" "+GeoTemConfig.getString("results")}else{this.resultsLabel.innerHTML=b+" "+GeoTemConfig.getString("result")}};this.listLabelsDdb=function(){var h=this.labels;var b=[];for(var e=0;e<h.length;e++){var d=h[e];for(var c=0;c<d.elements.length;c++){var g=d.elements[c].description;var f={member:true,description:g};b.push(f)}}return b};this.showLabelsDdb=function(h){var m=h.length;var g="";if(m==1){g=GeoTemConfig.getString("institution")}else{g=GeoTemConfig.getString("institutions")}this.title.innerHTML=m+" "+g;function c(u,t){var n=InstitutionsMapModel.getNode(u.description.superNode);if(n){var v={member:false,description:n.description};c(v,t)}t.push(u)}var f=[];for(var k=0;k<h.length;k++){var j=h[k];c(j,f)}f.sort(function(t,n){var u=t.description.number;var v=n.description.number;if(u<v){return -1}if(u>v){return 1}return 0});var p=[];if(f.length>0){var q=f[0];var o=q.description.number;for(var e=0;e<f.length;e++){var d=f[e];var l=d.description.number;if(l!==o){p.push(q);q=d;o=d.description.number}else{if(d.member){q=d}}}p.push(q)}function b(w){var n=document.createElement("li");n.setAttribute("class","ddbPopupLine");var t=w.description.node;var v=t.name+" ("+InstitutionsMapModel.sectorName(t.sector)+")";var u=InstitutionsMapModel.isSelected(t.sector);var x=((u)?"<strong>":"")+'<a href="'+t.detailViewUri+'">'+v+"</a>"+((u)?"</strong>":"");n.innerHTML=x;return n}function s(n,v,y,x){for(var w=n;w<v.length;w++){var t=v[w].description.indentLevel;if(t<y){return w}else{if(t>y){var u=document.createElement("ul");u.setAttribute("class","ddb_grey-arrow ddbPopupInnerUL");w=s(w,v,t,u);x.appendChild(u);if(w<v.length){var z=v[w];x.appendChild(b(z))}}else{var z=v[w];x.appendChild(b(z))}}}return w}var r=document.createElement("ul");r.setAttribute("class","ddb_plum-arrow ddbPopupList ddbPopupRootUL");if(p.length>0){s(0,p,p[0].description.indentLevel,r)}$(this.inner).empty();this.inner.style.width="0px";this.inner.appendChild(r);this.setContent(this.content)};this.showLabelContent=function(b){};this.setLanguage=function(b){this.language=b;if(this.visible){this.updateTexts()}}}function MapPopup_IE8Gen(a){this.parentDiv=a.gui.mapWindow;this.initialize=function(b,e,d){var c=this;this.x=b;this.y=e;this.popupDiv=document.createElement("div");this.popupDiv.setAttribute("class","ddbPopupDiv");this.popupDiv.onclick=function(){if(typeof d!="undefined"){d()}c.reset()};this.parentDiv.appendChild(this.popupDiv);this.headDiv=document.createElement("div");this.headDiv.setAttribute("class","ddbPopupHead");this.title=document.createElement("div");this.title.setAttribute("class","ddbPopupTitle");this.cancel=document.createElement("div");this.cancel.setAttribute("class","ddbPopupCancel");this.cancel.title=GeoTemConfig.getString("close");this.cancel.onclick=function(){if(typeof d!="undefined"){d()}c.reset()};this.headDiv.appendChild(this.title);this.headDiv.appendChild(this.cancel);this.input=document.createElement("div");this.input.style.maxWidth=Math.floor(this.parentDiv.offsetWidth*0.75)+"px";this.input.style.maxHeight=Math.floor(this.parentDiv.offsetHeight*0.75)+"px";this.input.setAttribute("class","ddbPopupInput");this.popupDiv.appendChild(this.headDiv);this.popupDiv.appendChild(this.input)};this.makeAndPlacePeak=function(b){var c=document.createElement("div");c.setAttribute("class","popupPeak"+b);c.title=GeoTemConfig.getString("close");c.onclick=function(){if(typeof onclose!="undefined"){onclose()}popup.reset()};this.popupDiv.appendChild(c)};this.setContent=function(b){$(this.input).empty();this.visible=true;$(this.input).append(b);this.decorate()};this.reset=function(){$(this.popupDiv).remove();this.visible=false};this.decorate=function(){var d=this.popupDiv.offsetHeight;var b=this.popupDiv.offsetWidth;var c=["NO","SO","NW","SW"];this.left=this.x;this.top=this.y-this.popupDiv.offsetHeight;var e=0;if(this.top<10){this.top=this.top+d+10;e=1}else{this.top=this.top-10;e=0}if(this.left+b>730-9){e+=2;this.left=this.left-b-9}else{this.left+=9}this.popupDiv.style.left=this.left+"px";this.popupDiv.style.top=this.top+"px";this.makeAndPlacePeak(c[e])};this.shift=function(b,c){this.left=this.left-this.x+b;this.top=this.top-this.y+c;this.x=b;this.y=c;if(this.left+this.popupDiv.offsetWidth>this.parentDiv.offsetWidth){this.popupDiv.style.left="auto";this.popupDiv.style.right=(this.parentDiv.offsetWidth-this.left-this.popupDiv.offsetWidth)+"px"}else{this.popupDiv.style.right="auto";this.popupDiv.style.left=this.left+"px"}this.popupDiv.style.top=this.top+"px"}}function PlacenamePopup_IE8Gen(a){this.parentDiv=a.gui.mapWindow;this.createPopup=function(b,h,g){var e=this;var d=new MapPopup_IE8Gen(a);var c=function(){a.deselection();e.reset()};d.initialize(b,h,c);$.extend(this,d);this.theCluster=InstitutionsMapModel.getCluster(g);this.x=this.theCluster.x;this.y=this.theCluster.y;this.content=document.createElement("div");this.inner=document.createElement("div");this.inner.setAttribute("class","ddbPopupInner");this.content.appendChild(this.inner);var f=this.listLabelsDdb();this.showLabelsDdb(f)};this.listLabelsDdb=function(){var c=[];var f=this.theCluster.elementIds;for(var b=0;b<f.length;b++){var g=f[b];var e=InstitutionsMapModel.getNode(g);if(!e){continue}var d={member:true,description:e.description};c.push(d)}return c};this.showLabelsDdb=function(j){function c(v,u){var n=InstitutionsMapModel.getNode(v.description.superNode);if(n){var w={member:false,description:n.description};c(w,u)}u.push(v)}var g=[];for(var l=0;l<j.length;l++){var k=j[l];c(k,g)}g.sort(function(u,n){var v=u.description.number;var w=n.description.number;if(v<w){return -1}if(v>w){return 1}return 0});var q=[];if(g.length>0){var r=g[0];var p=r.description.number;for(var e=0;e<g.length;e++){var d=g[e];var o=d.description.number;if(o!==p){q.push(r);r=d;p=d.description.number}else{if(d.member){r=d}}}q.push(r)}function b(y,u){var n=document.createElement("li");u.push(1);n.setAttribute("class","ddbPopupLine");var v=y.description.node;var x=v.name+" ("+InstitutionsMapModel.sectorName(v.sector)+")";var w=InstitutionsMapModel.isSelected(v.sector);var z=((w)?"<strong>":"")+'<a href="'+v.detailViewUri+'">'+x+"</a>"+((w)?"</strong>":"");n.innerHTML=z;return n}function t(u,z,n,B,w){for(var x=u;x<z.length;x++){var A=z[x].description.indentLevel;if(A<n){return x}else{if(A>n){var y=document.createElement("ul");y.setAttribute("class","ddb_grey-arrow ddbPopupInnerUL");x=t(x,z,A,y,w);B.appendChild(y);if(x<z.length){var v=z[x];B.appendChild(b(v,w))}}else{var v=z[x];B.appendChild(b(v,w))}}}return x}var s=document.createElement("ul");s.setAttribute("class","ddb_plum-arrow ddbPopupList ddbPopupRootUL");var f=[];if(q.length>0){t(0,q,q[0].description.indentLevel,s,f)}var m=f.length;var h="";if(m==1){h=GeoTemConfig.getString("institution")}else{h=GeoTemConfig.getString("institutions")}this.title.innerHTML=m+" "+h;$(this.inner).empty();this.inner.style.width="0px";this.inner.appendChild(s);this.setContent(this.content)};this.showLabelContent=function(b){};this.setLanguage=function(b){this.language=b;if(this.visible){this.updateTexts()}}}if(typeof GeoPublisher=="undefined"){GeoPublisher=function(){var d={};var c=function(f){var g=d[f];if(!g){g=d[f]=[]}return g};var b=function(f,j,h){var k=c(f);for(var g=0;g<k.length;g++){if(h==null||k[g].client!=h){k[g].callback(j)}}};var a=function(g,h,f){var j=c(g);j.push({client:h,callback:f})};var e=function(f,h){var j=c(f);for(var g=0;g<j.length;g++){if(j[g].client==h){j.splice(g,1);return}}};return{GeoPublish:b,GeoSubscribe:a,GeoUnsubscribe:e,topics:d}}();if(typeof console!="undefined"){console.log("GeoPublisher created")}}function WidgetWrapper(){var a=this;this.setWidget=function(b){this.widget=b};this.display=function(b){if(b instanceof Array){GeoTemConfig.datasets=b.length;if(typeof a.widget!="undefined"){this.widget.initWidget(b)}}};GeoPublisher.GeoSubscribe("highlight",this,function(b){if(b==undefined){return}if(typeof a.widget!="undefined"){a.widget.highlightChanged(b)}});GeoPublisher.GeoSubscribe("selection",this,function(b){if(typeof a.widget!="undefined"){a.widget.selectionChanged(b)}});GeoPublisher.GeoSubscribe("filter",this,function(b){a.display(b)});GeoPublisher.GeoSubscribe("rise",this,function(b){if(typeof a.widget!="undefined"&&typeof a.widget.riseLayer!="undefined"){a.widget.riseLayer(b)}});this.triggerRefining=function(b){GeoPublisher.GeoPublish("filter",b,null)};this.triggerSelection=function(b){GeoPublisher.GeoPublish("selection",b,this)};this.triggerHighlight=function(b){GeoPublisher.GeoPublish("highlight",b,this)};this.triggerRise=function(b){GeoPublisher.GeoPublish("rise",b)}}if(typeof InstitutionsMapController=="undefined"){InstitutionsMapController=(function(){var f=(new Date).getTime();var b=0;var k=[];var a=function(p,n){var o=(new Date()).getTime()-f;var m="  XXXXX "+b+"ms + "+o+"ms | "+p;b+=o;if(typeof console!="undefined"){console.log((k.length)+m+" -- args: "+n)}k.push((k.length)+m);f=(new Date()).getTime()};var d=function(){GeoPublisher.GeoSubscribe("GeoTemCoReady",this,function(){a("<<< GeoTemCoReady")})};var g=function(m,p){if(!InstitutionsMapModel.isInitialized()){}var o=InstitutionsMapModel.initialize(m,p);var n=j("data/institutions_map.json",c)};var c=function(n){InstitutionsMapModel.prepareInstitutionsData(n);var m={selected:l,deselected:h};InstitutionsMapModel.selectSectors(m)};var e=function(){};d();var j=function(n,m){$.ajax({url:n,async:true,dataType:"json",success:m})};var l=[{sector:"sec_01",name:"Archiv"},{sector:"sec_02",name:"Bibliothek"},{sector:"sec_03",name:"Denkmalpflege"},{sector:"sec_04",name:"Forschung"},{sector:"sec_05",name:"Mediathek"},{sector:"sec_06",name:"Museum"},{sector:"sec_07",name:"Sonstige"},];var h=[];return{logEvent:a,startup:g,deactivate:e}})()}if(typeof InstitutionsMapModel=="undefined"){InstitutionsMapModel=(function(){var b=false;var j;var A={minLat:46.69258,minLon:2.48328,maxLat:55.86127,maxLon:18.5233};var w;var s;var n;var B;var c;var d;var y;var a;var f;var x;var p=function(){var E=-1;if(navigator.appName=="Microsoft Internet Explorer"){var C=navigator.userAgent;var D=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(D.exec(C)!=null){E=parseFloat(RegExp.$1)}}return E};var k=function(){return b};var o=function(H,G){GeoTemConfig.determineAndSetUrlPrefix("InstitutionsMapModel.js");var E=p();f=(E>-1&&E<=8);if(f&&typeof console!="undefined"){console.warn("running Internet Explorer 8 or less")}if(typeof console!="undefined"){console.log("f_initialize mapDivId="+H+" language="+G);console.log("f_initialize _urlPrefix="+h())}GeoTemConfig.language=G;GeoTemConfig.allowFilter=false;var D=document.getElementById(H);var F=new WidgetWrapper();if(f){w=new MapWidget_IE8Gen(F,D)}else{var C=new MapWidget(F,D,{mapTitle:GeoTemConfig.getString("institutes"),mapHeight:false,showDescriptions:false,olNavigation:false,mapSelectionTools:false,labelGrid:false,countrySelect:false,resetMap:true,mapSelection:false,boundaries:A,maxPlaceLabels:0,circleTransparency:true,geoLocation:false})}if(typeof console!="undefined"){console.log("MapWidget displayed")}b=true;$(".absoluteToolbar").css("display","none");return F};var q=function(E){var C={};for(var F=0;F<E.length;F++){var D=E[F];C[D.sector]={count:0,name:D.value}}return C};var u=function(J){if(typeof console!="undefined"){console.log("sectors selected: "+J.selected.length+" deselected: "+J.deselected.length)}B=J;var I=(new Date()).getTime();c=q(B.selected);var H=q(B.deselected);a={};$.extend(a,c);$.extend(a,H);d=(B.selected.length===0)?H:c;if(f){x=t(d);var C=[];C.push(x);GeoPublisher.GeoPublish("filter",C,null)}else{y=[];for(var G=0;G<s.length;G++){var F=s[G];var E=F.description.node.sector;if(d[E]!==undefined){y.push(F);d[E].count++}}var D=[];D.push(new Dataset(y,"institutions"));GeoPublisher.GeoPublish("filter",D,null)}};var g=function(C){if(a){return a[C].name}else{return undefined}};var l=function(C){if(c){return c[C]}else{return undefined}};var t=function(E){var D=GeoTemConfig.urlPrefix+"ddb-map/";var F="";var C=[];for(var H in E){C.push(H.replace("_",""))}C.sort();F=("_"+C.join("_"));var I=D+"cluster"+F+".json";var G=D+"map"+F+".jpg";if(typeof console!="undefined"){console.log(I)}clusterSet=GeoTemConfig.getJson(I);if(typeof console!="undefined"){console.log("clusterSet name: "+clusterSet.name);console.log("clusterSet size: "+clusterSet.clusters.length+" clusters")}_ie8MapCluster={clusterUrl:I,mapUrl:G,clusterSet:clusterSet};return _ie8MapCluster};var v=function(F){var C=H(F.institutions);s=GeoTemConfig.loadJson(C);n={};for(var G=0;G<s.length;G++){el=s[G];n[el.description.node.id]=el}function E(M,I,K,J){var O=M.latitude;var L=M.longitude;if(O<A.minLat||O>A.maxLat||L<A.minLon||L>A.maxLon){return null}var N={indentLevel:J,number:K,node:M,superNode:I};return{id:M.id,place:M.name,sector:M.sector,lat:O,lon:L,description:N}}function H(J){var I=D(J,null,0,{count:0,list:[]});if(typeof console!="undefined"){console.log("number of institutions: "+I.count)}return I.list}function D(O,J,P,I){for(var M=0;M<O.length;M++){var N=O[M];if(N!==null){var L=E(N,J,I.count,P);I.count++;if(L!==null){I.list.push(L)}else{if(typeof console!=="undefined"){console.log("out of germanys bounding box:");console.dir(N)}}var K=N.children;if(K instanceof Array){D(K,L.id,P+1,I)}}}return I}};var r=function(){if(d){return d}else{return undefined}};var h=function(){return GeoTemConfig.urlPrefix};var z=function(){return w};var m=function(C){return x.clusterSet.clusters[C]};var e=function(C){return n[C]};return{initialize:o,isInitialized:k,getUrlPrefix:h,prepareInstitutionsData:v,selectSectors:u,isSelected:l,sectorName:g,filterSectors:r,getNode:e,getCluster:m,mapWidget:z}})()}OpenLayers.Util.getImagesLocation=function(){return GeoTemCoMinifier_urlPrefix+"lib/openlayers/img/"};OpenLayers._getScriptLocation=function(){return GeoTemCoMinifier_urlPrefix+"lib/openlayers/"};GeoTemConfig.configure(GeoTemCoMinifier_urlPrefix);GeoPublisher.GeoPublish("GeoTemCoReady");